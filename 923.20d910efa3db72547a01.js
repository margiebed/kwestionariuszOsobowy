"use strict";(self.webpackChunkquestionnaire=self.webpackChunkquestionnaire||[]).push([[923],{4614:(Zn,ie,k)=>{Object.defineProperty(ie,"__esModule",{value:!0});var ae=k(6279),M=k(209),m=k(1704),n=k(300),ot=k(1100);function We(r){return r&&"object"==typeof r&&"default"in r?r:{default:r}}var r,de=We(ae),gt=function(){function r(e){this.domStorage_=e,this.prefix_="firebase:"}return r.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),m.stringify(t))},r.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:m.jsonEval(t)},r.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},r.prototype.prefixedName_=function(e){return this.prefix_+e},r.prototype.toString=function(){return this.domStorage_.toString()},r}(),Et=function(){function r(){this.cache_={},this.isInMemoryStorage=!0}return r.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},r.prototype.get=function(e){return m.contains(this.cache_,e)?this.cache_[e]:null},r.prototype.remove=function(e){delete this.cache_[e]},r}(),st=function(r){try{if("undefined"!=typeof window&&void 0!==window[r]){var e=window[r];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new gt(e)}}catch(t){}return new Et},me=st("localStorage"),Re=st("sessionStorage"),ge=new n.Logger("@firebase/database"),ze=(r=1,function(){return r++}),at=function(r){var e=m.stringToByteArray(r),t=new m.Sha1;t.update(e);var i=t.digest();return m.base64.encodeByteArray(i)},pe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];for(var t="",i=0;i<r.length;i++){var o=r[i];Array.isArray(o)||o&&"object"==typeof o&&"number"==typeof o.length?t+=pe.apply(null,o):t+="object"==typeof o?m.stringify(o):o,t+=" "}return t},Ee=null,lt=!0,Be=function(r,e){m.assert(!e||!0===r||!1===r,"Can't turn on custom loggers persistently."),!0===r?(ge.logLevel=n.LogLevel.VERBOSE,Ee=ge.log.bind(ge),e&&Re.set("logging_enabled",!0)):"function"==typeof r?Ee=r:(Ee=null,Re.remove("logging_enabled"))},G=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(!0===lt&&(lt=!1,null===Ee&&!0===Re.get("logging_enabled")&&Be(!0)),Ee){var t=pe.apply(null,r);Ee(t)}},xe=function(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];G.apply(void 0,M.__spread([r],e))}},Ve=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t="FIREBASE INTERNAL ERROR: "+pe.apply(void 0,M.__spread(r));ge.error(t)},he=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t="FIREBASE FATAL ERROR: "+pe.apply(void 0,M.__spread(r));throw ge.error(t),new Error(t)},K=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t="FIREBASE WARNING: "+pe.apply(void 0,M.__spread(r));ge.warn(t)},S=function(r){return"number"==typeof r&&(r!=r||r===Number.POSITIVE_INFINITY||r===Number.NEGATIVE_INFINITY)},Z="[MIN_NAME]",x="[MAX_NAME]",A=function(r,e){if(r===e)return 0;if(r===Z||e===x)return-1;if(e===Z||r===x)return 1;var t=Tt(r),i=Tt(e);return null!==t?null!==i?t-i==0?r.length-e.length:t-i:-1:null!==i?1:r<e?-1:1},q=function(r,e){return r===e?0:r<e?-1:1},j=function(r,e){if(e&&r in e)return e[r];throw new Error("Missing required key ("+r+") in object: "+m.stringify(e))},re=function(r){if("object"!=typeof r||null===r)return m.stringify(r);var e=[];for(var t in r)e.push(t);e.sort();for(var i="{",o=0;o<e.length;o++)0!==o&&(i+=","),i+=m.stringify(e[o]),i+=":",i+=re(r[e[o]]);return i+"}"},O=function(r,e){var t=r.length;if(t<=e)return[r];for(var i=[],o=0;o<t;o+=e)i.push(r.substring(o,o+e>t?t:o+e));return i};function z(r,e){for(var t in r)r.hasOwnProperty(t)&&e(t,r[t])}var Ne,ke,Je,Kt,Xt,Ge,oe=function(r){m.assert(!S(r),"Invalid JSON number");var o,s,u,c,f,i=1023;0===r?(s=0,u=0,o=1/r==-1/0?1:0):(o=r<0,(r=Math.abs(r))>=Math.pow(2,1-i)?(s=(c=Math.min(Math.floor(Math.log(r)/Math.LN2),i))+i,u=Math.round(r*Math.pow(2,52-c)-Math.pow(2,52))):(s=0,u=Math.round(r/Math.pow(2,-1074))));var d=[];for(f=52;f;f-=1)d.push(u%2?1:0),u=Math.floor(u/2);for(f=11;f;f-=1)d.push(s%2?1:0),s=Math.floor(s/2);d.push(o?1:0),d.reverse();var y=d.join(""),g="";for(f=0;f<64;f+=8){var E=parseInt(y.substr(f,8),2).toString(16);1===E.length&&(E="0"+E),g+=E}return g.toLowerCase()},Ct=new RegExp("^-?(0*)\\d{1,10}$"),Tt=function(r){if(Ct.test(r)){var e=Number(r);if(e>=-2147483648&&e<=2147483647)return e}return null},Fe=function(r){try{r()}catch(e){setTimeout(function(){throw K("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},Ye=function(r,e){var t=setTimeout(r,e);return"object"==typeof t&&t.unref&&t.unref(),t},I=function(){function r(e,t){if(void 0===t){this.pieces_=e.split("/");for(var i=0,o=0;o<this.pieces_.length;o++)this.pieces_[o].length>0&&(this.pieces_[i]=this.pieces_[o],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return Object.defineProperty(r,"Empty",{get:function(){return new r("")},enumerable:!1,configurable:!0}),r.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},r.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},r.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new r(this.pieces_,e)},r.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},r.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},r.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},r.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},r.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],t=this.pieceNum_;t<this.pieces_.length-1;t++)e.push(this.pieces_[t]);return new r(e,0)},r.prototype.child=function(e){for(var t=[],i=this.pieceNum_;i<this.pieces_.length;i++)t.push(this.pieces_[i]);if(e instanceof r)for(i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{var o=e.split("/");for(i=0;i<o.length;i++)o[i].length>0&&t.push(o[i])}return new r(t,0)},r.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},r.relativePath=function(e,t){var i=e.getFront(),o=t.getFront();if(null===i)return t;if(i===o)return r.relativePath(e.popFront(),t.popFront());throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")},r.comparePaths=function(e,t){for(var i=e.slice(),o=t.slice(),s=0;s<i.length&&s<o.length;s++){var u=A(i[s],o[s]);if(0!==u)return u}return i.length===o.length?0:i.length<o.length?-1:1},r.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,i=e.pieceNum_;t<=this.pieces_.length;t++,i++)if(this.pieces_[t]!==e.pieces_[i])return!1;return!0},r.prototype.contains=function(e){var t=this.pieceNum_,i=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0},r}(),Rn=function(){function r(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var i=0;i<this.parts_.length;i++)this.byteLength_+=m.stringLength(this.parts_[i]);this.checkValid_()}return Object.defineProperty(r,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(r,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),r.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=m.stringLength(e),this.checkValid_()},r.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=m.stringLength(e),this.parts_.length>0&&(this.byteLength_-=1)},r.prototype.checkValid_=function(){if(this.byteLength_>r.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+r.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>r.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+r.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},r.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},r}(),wt="firebaseio.com",Fn="websocket",Le="long_polling",ut=function(){function r(e,t,i,o,s,u,c){void 0===s&&(s=!1),void 0===u&&(u=""),void 0===c&&(c=!1),this.secure=t,this.namespace=i,this.webSocketOnly=o,this.nodeAdmin=s,this.persistenceKey=u,this.includeNamespaceInQueryParams=c,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=me.get("host:"+e)||this.host}return r.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},r.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},r.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},r.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},r.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&me.set("host:"+this.host,this.internalHost))},r.prototype.connectionURL=function(e,t){var i;if(m.assert("string"==typeof e,"typeof type must == string"),m.assert("object"==typeof t,"typeof params must == object"),e===Fn)i=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==Le)throw new Error("Unknown connection type: "+e);i=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var o=[];return z(t,function(s,u){o.push(s+"="+u)}),i+o.join("&")},r.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},r.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},r}(),St=function(r,e){var t=Ir(r),i=t.namespace;return"firebase.com"===t.domain&&he(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==t.domain&&he("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&K("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new ut(t.host,t.secure,i,e,"ws"===t.scheme||"wss"===t.scheme,"",i!==t.subdomain),path:new I(t.pathString)}},Ir=function(r){var e="",t="",i="",o="",s="",u=!0,c="https",f=443;if("string"==typeof r){var d=r.indexOf("//");d>=0&&(c=r.substring(0,d-1),r=r.substring(d+2));var y=r.indexOf("/");-1===y&&(y=r.length);var g=r.indexOf("?");-1===g&&(g=r.length),e=r.substring(0,Math.min(y,g)),y<g&&(o=function(r){for(var e="",t=r.split("/"),i=0;i<t.length;i++)if(t[i].length>0){var o=t[i];try{o=decodeURIComponent(o.replace(/\+/g," "))}catch(s){}e+="/"+o}return e}(r.substring(y,g)));var E=function(r){var e,t,i={};"?"===r.charAt(0)&&(r=r.substring(1));try{for(var o=M.__values(r.split("&")),s=o.next();!s.done;s=o.next()){var u=s.value;if(0!==u.length){var c=u.split("=");2===c.length?i[decodeURIComponent(c[0])]=decodeURIComponent(c[1]):K("Invalid query segment '"+u+"' in query '"+r+"'")}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return i}(r.substring(Math.min(r.length,g)));(d=e.indexOf(":"))>=0?(u="https"===c||"wss"===c,f=parseInt(e.substring(d+1),10)):d=e.length;var T=e.slice(0,d);if("localhost"===T.toLowerCase())t="localhost";else if(T.split(".").length<=2)t=T;else{var N=e.indexOf(".");i=e.substring(0,N).toLowerCase(),t=e.substring(N+1),s=i}"ns"in E&&(s=E.ns)}return{host:e,port:f,domain:t,subdomain:i,secure:u,scheme:c,pathString:o,namespace:s}},Zr=/[\[\].#$\/\u0000-\u001F\u007F]/,Rr=/[\[\].#$\u0000-\u001F\u007F]/,Jt=10485760,Nt=function(r){return"string"==typeof r&&0!==r.length&&!Zr.test(r)},It=function(r){return"string"==typeof r&&0!==r.length&&!Rr.test(r)},Me=function(r){return null===r||"string"==typeof r||"number"==typeof r&&!S(r)||r&&"object"==typeof r&&m.contains(r,".sv")},Se=function(r,e,t,i,o){o&&void 0===t||ct(m.errorPrefix(r,e,o),t,i)},ct=function(r,e,t){var i=t instanceof I?new Rn(t,r):t;if(void 0===e)throw new Error(r+"contains undefined "+i.toErrorString());if("function"==typeof e)throw new Error(r+"contains a function "+i.toErrorString()+" with contents = "+e.toString());if(S(e))throw new Error(r+"contains "+e.toString()+" "+i.toErrorString());if("string"==typeof e&&e.length>Jt/3&&m.stringLength(e)>Jt)throw new Error(r+"contains a string greater than "+Jt+" utf8 bytes "+i.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var o=!1,s=!1;if(z(e,function(u,c){if(".value"===u)o=!0;else if(".priority"!==u&&".sv"!==u&&(s=!0,!Nt(u)))throw new Error(r+" contains an invalid key ("+u+") "+i.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.push(u),ct(r,c,i),i.pop()}),o&&s)throw new Error(r+' contains ".value" child '+i.toErrorString()+" in addition to actual children.")}},kn=function(r,e,t,i,o){if(!o||void 0!==t){var s=m.errorPrefix(r,e,o);if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(s+" must be an object containing the children to replace.");var u=[];z(t,function(c,f){var d=new I(c);if(ct(s,f,i.child(d)),".priority"===d.getBack()&&!Me(f))throw new Error(s+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");u.push(d)}),function(r,e){var t,i;for(t=0;t<e.length;t++)for(var o=(i=e[t]).slice(),s=0;s<o.length;s++)if((".priority"!==o[s]||s!==o.length-1)&&!Nt(o[s]))throw new Error(r+"contains an invalid key ("+o[s]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(I.comparePaths);var u=null;for(t=0;t<e.length;t++){if(i=e[t],null!==u&&u.contains(i))throw new Error(r+"contains a path "+u.toString()+" that is ancestor of another path "+i.toString());u=i}}(s,u)}},Ue=function(r,e,t,i){if(!i||void 0!==t){if(S(t))throw new Error(m.errorPrefix(r,e,i)+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Me(t))throw new Error(m.errorPrefix(r,e,i)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Gt=function(r,e,t,i){if(!i||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(m.errorPrefix(r,e,i)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},$t=function(r,e,t,i){if(!(i&&void 0===t||Nt(t)))throw new Error(m.errorPrefix(r,e,i)+'was an invalid key = "'+t+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},pt=function(r,e,t,i){if(!(i&&void 0===t||It(t)))throw new Error(m.errorPrefix(r,e,i)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},kr=function(r,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),pt(r,e,t,i)},le=function(r,e){if(".info"===e.getFront())throw new Error(r+" failed = Can't modify data under /.info/")},Pn=function(r,e,t){var i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Nt(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&!function(r){return r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),It(r)}(i))throw new Error(m.errorPrefix(r,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Pr=function(r,e,t,i){if((!i||void 0!==t)&&"boolean"!=typeof t)throw new Error(m.errorPrefix(r,e,i)+"must be a boolean.")},Dn=function(){function r(e,t){this.repo_=e,this.path_=t}return r.prototype.cancel=function(e){m.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),m.validateCallback("OnDisconnect.cancel",1,e,!0);var t=new m.Deferred;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},r.prototype.remove=function(e){m.validateArgCount("OnDisconnect.remove",0,1,arguments.length),le("OnDisconnect.remove",this.path_),m.validateCallback("OnDisconnect.remove",1,e,!0);var t=new m.Deferred;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},r.prototype.set=function(e,t){m.validateArgCount("OnDisconnect.set",1,2,arguments.length),le("OnDisconnect.set",this.path_),Se("OnDisconnect.set",1,e,this.path_,!1),m.validateCallback("OnDisconnect.set",2,t,!0);var i=new m.Deferred;return this.repo_.onDisconnectSet(this.path_,e,i.wrapCallback(t)),i.promise},r.prototype.setWithPriority=function(e,t,i){m.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),le("OnDisconnect.setWithPriority",this.path_),Se("OnDisconnect.setWithPriority",1,e,this.path_,!1),Ue("OnDisconnect.setWithPriority",2,t,!1),m.validateCallback("OnDisconnect.setWithPriority",3,i,!0);var o=new m.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,o.wrapCallback(i)),o.promise},r.prototype.update=function(e,t){if(m.validateArgCount("OnDisconnect.update",1,2,arguments.length),le("OnDisconnect.update",this.path_),Array.isArray(e)){for(var i={},o=0;o<e.length;++o)i[""+o]=e[o];e=i,K("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}kn("OnDisconnect.update",1,e,this.path_,!1),m.validateCallback("OnDisconnect.update",2,t,!0);var s=new m.Deferred;return this.repo_.onDisconnectUpdate(this.path_,e,s.wrapCallback(t)),s.promise},r}(),Dr=function(){function r(e,t){this.committed=e,this.snapshot=t}return r.prototype.toJSON=function(){return m.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},r}(),L=function(){var r="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",e=0,t=[];return function(i){var o=i===e;e=i;var s,u=new Array(8);for(s=7;s>=0;s--)u[s]=r.charAt(i%64),i=Math.floor(i/64);m.assert(0===i,"Cannot push at time == 0");var c=u.join("");if(o){for(s=11;s>=0&&63===t[s];s--)t[s]=0;t[s]++}else for(s=0;s<12;s++)t[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)c+=r.charAt(t[s]);return m.assert(20===c.length,"nextPushId: Length should be 20."),c}}(),U=function(){function r(e,t){this.name=e,this.node=t}return r.Wrap=function(e,t){return new r(e,t)},r}(),Te=function(){function r(){}return r.prototype.getCompare=function(){return this.compare.bind(this)},r.prototype.indexedValueChanged=function(e,t){var i=new U(Z,e),o=new U(Z,t);return 0!==this.compare(i,o)},r.prototype.minPost=function(){return U.MIN},r}(),Zt=function(r){function e(){return null!==r&&r.apply(this,arguments)||this}return M.__extends(e,r),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return Ne},set:function(t){Ne=t},enumerable:!1,configurable:!0}),e.prototype.compare=function(t,i){return A(t.name,i.name)},e.prototype.isDefinedOn=function(t){throw m.assertionError("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,i){return!1},e.prototype.minPost=function(){return U.MIN},e.prototype.maxPost=function(){return new U(x,Ne)},e.prototype.makePost=function(t,i){return m.assert("string"==typeof t,"KeyIndex indexValue must always be a string."),new U(t,Ne)},e.prototype.toString=function(){return".key"},e}(Te),Ie=new Zt,qe=function(r){return"number"==typeof r?"number:"+oe(r):"string:"+r},ht=function(r){if(r.isLeafNode()){var e=r.val();m.assert("string"==typeof e||"number"==typeof e||"object"==typeof e&&m.contains(e,".sv"),"Priority must be a string or number.")}else m.assert(r===ke||r.isEmpty(),"priority of unexpected type.");m.assert(r===ke||r.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Qe=function(){function r(e,t){void 0===t&&(t=r.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=t,this.lazyHash_=null,m.assert(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),ht(this.priorityNode_)}return Object.defineProperty(r,"__childrenNodeConstructor",{get:function(){return Je},set:function(e){Je=e},enumerable:!1,configurable:!0}),r.prototype.isLeafNode=function(){return!0},r.prototype.getPriority=function(){return this.priorityNode_},r.prototype.updatePriority=function(e){return new r(this.value_,e)},r.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:r.__childrenNodeConstructor.EMPTY_NODE},r.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:r.__childrenNodeConstructor.EMPTY_NODE},r.prototype.hasChild=function(){return!1},r.prototype.getPredecessorChildName=function(e,t){return null},r.prototype.updateImmediateChild=function(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:r.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)},r.prototype.updateChild=function(e,t){var i=e.getFront();return null===i?t:t.isEmpty()&&".priority"!==i?this:(m.assert(".priority"!==i||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(i,r.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),t)))},r.prototype.isEmpty=function(){return!1},r.prototype.numChildren=function(){return 0},r.prototype.forEachChild=function(e,t){return!1},r.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},r.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+qe(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?oe(this.value_):this.value_,this.lazyHash_=at(e)}return this.lazyHash_},r.prototype.getValue=function(){return this.value_},r.prototype.compareTo=function(e){return e===r.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof r.__childrenNodeConstructor?-1:(m.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},r.prototype.compareToLeafNode_=function(e){var t=typeof e.value_,i=typeof this.value_,o=r.VALUE_TYPE_ORDER.indexOf(t),s=r.VALUE_TYPE_ORDER.indexOf(i);return m.assert(o>=0,"Unknown leaf type: "+t),m.assert(s>=0,"Unknown leaf type: "+i),o===s?"object"===i?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-o},r.prototype.withIndex=function(){return this},r.prototype.isIndexed=function(){return!0},r.prototype.equals=function(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))},r.VALUE_TYPE_ORDER=["object","boolean","number","string"],r}(),V=new(function(r){function e(){return null!==r&&r.apply(this,arguments)||this}return M.__extends(e,r),e.prototype.compare=function(t,i){var o=t.node.getPriority(),s=i.node.getPriority(),u=o.compareTo(s);return 0===u?A(t.name,i.name):u},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,i){return!t.getPriority().equals(i.getPriority())},e.prototype.minPost=function(){return U.MIN},e.prototype.maxPost=function(){return new U(x,new Qe("[PRIORITY-POST]",Xt))},e.prototype.makePost=function(t,i){var o=Kt(t);return new U(i,new Qe("[PRIORITY-POST]",o))},e.prototype.toString=function(){return".priority"},e}(Te)),ft=function(){function r(e,t,i,o,s){void 0===s&&(s=null),this.isReverse_=o,this.resultGenerator_=s,this.nodeStack_=[];for(var u=1;!e.isEmpty();)if(e=e,u=t?i(e.key,t):1,o&&(u*=-1),u<0)e=this.isReverse_?e.left:e.right;else{if(0===u){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return r.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},r.prototype.hasNext=function(){return this.nodeStack_.length>0},r.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},r}(),fe=function(){function r(e,t,i,o,s){this.key=e,this.value=t,this.color=null!=i?i:r.RED,this.left=null!=o?o:be.EMPTY_NODE,this.right=null!=s?s:be.EMPTY_NODE}return r.prototype.copy=function(e,t,i,o,s){return new r(null!=e?e:this.key,null!=t?t:this.value,null!=i?i:this.color,null!=o?o:this.left,null!=s?s:this.right)},r.prototype.count=function(){return this.left.count()+1+this.right.count()},r.prototype.isEmpty=function(){return!1},r.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},r.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},r.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},r.prototype.minKey=function(){return this.min_().key},r.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},r.prototype.insert=function(e,t,i){var o=this,s=i(e,o.key);return(o=s<0?o.copy(null,null,null,o.left.insert(e,t,i),null):0===s?o.copy(null,t,null,null,null):o.copy(null,null,null,null,o.right.insert(e,t,i))).fixUp_()},r.prototype.removeMin_=function(){if(this.left.isEmpty())return be.EMPTY_NODE;var e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},r.prototype.remove=function(e,t){var i,o;if(t(e,(i=this).key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),0===t(e,i.key)){if(i.right.isEmpty())return be.EMPTY_NODE;o=i.right.min_(),i=i.copy(o.key,o.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()},r.prototype.isRed_=function(){return this.color},r.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},r.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},r.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},r.prototype.rotateLeft_=function(){var e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},r.prototype.rotateRight_=function(){var e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},r.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},r.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},r.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},r.RED=!0,r.BLACK=!1,r}(),Ln=function(){function r(){}return r.prototype.copy=function(e,t,i,o,s){return this},r.prototype.insert=function(e,t,i){return new fe(e,t,null)},r.prototype.remove=function(e,t){return this},r.prototype.count=function(){return 0},r.prototype.isEmpty=function(){return!0},r.prototype.inorderTraversal=function(e){return!1},r.prototype.reverseTraversal=function(e){return!1},r.prototype.minKey=function(){return null},r.prototype.maxKey=function(){return null},r.prototype.check_=function(){return 0},r.prototype.isRed_=function(){return!1},r}(),be=function(){function r(e,t){void 0===t&&(t=r.EMPTY_NODE),this.comparator_=e,this.root_=t}return r.prototype.insert=function(e,t){return new r(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,fe.BLACK,null,null))},r.prototype.remove=function(e){return new r(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,fe.BLACK,null,null))},r.prototype.get=function(e){for(var t,i=this.root_;!i.isEmpty();){if(0===(t=this.comparator_(e,i.key)))return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null},r.prototype.getPredecessorKey=function(e){for(var t,i=this.root_,o=null;!i.isEmpty();){if(0===(t=this.comparator_(e,i.key))){if(i.left.isEmpty())return o?o.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}t<0?i=i.left:t>0&&(o=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},r.prototype.isEmpty=function(){return this.root_.isEmpty()},r.prototype.count=function(){return this.root_.count()},r.prototype.minKey=function(){return this.root_.minKey()},r.prototype.maxKey=function(){return this.root_.maxKey()},r.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},r.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},r.prototype.getIterator=function(e){return new ft(this.root_,null,this.comparator_,!1,e)},r.prototype.getIteratorFrom=function(e,t){return new ft(this.root_,e,this.comparator_,!1,t)},r.prototype.getReverseIteratorFrom=function(e,t){return new ft(this.root_,e,this.comparator_,!0,t)},r.prototype.getReverseIterator=function(e){return new ft(this.root_,null,this.comparator_,!0,e)},r.EMPTY_NODE=new Ln,r}(),Mn=Math.log(2),Un=function(){function r(e){this.count=parseInt(Math.log(e+1)/Mn,10),this.current_=this.count-1;var o=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&o}return r.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},r}(),dt=function(r,e,t,i){r.sort(e);var o=function(f,d){var g,E,y=d-f;if(0===y)return null;if(1===y)return g=r[f],E=t?t(g):g,new fe(E,g.node,fe.BLACK,null,null);var T=parseInt(y/2,10)+f,N=o(f,T),R=o(T+1,d);return g=r[T],E=t?t(g):g,new fe(E,g.node,fe.BLACK,N,R)},c=function(f){for(var d=null,y=null,g=r.length,E=function(B,ce){var ve=g-B,rt=g;g-=B;var it=o(ve+1,rt),Sr=r[ve],wi=t?t(Sr):Sr;T(new fe(wi,Sr.node,ce,null,it))},T=function(B){d?(d.left=B,d=B):(y=B,d=B)},N=0;N<f.count;++N){var R=f.nextBitIsOne(),W=Math.pow(2,f.count-(N+1));R?E(W,fe.BLACK):(E(W,fe.BLACK),E(W,fe.RED))}return y}(new Un(r.length));return new be(i||e,c)},Pe={},$e=function(){function r(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(r,"Default",{get:function(){return m.assert(Pe&&V,"ChildrenNode.ts has not been loaded"),Ge=Ge||new r({".priority":Pe},{".priority":V})},enumerable:!1,configurable:!0}),r.prototype.get=function(e){var t=m.safeGet(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof be?t:null},r.prototype.hasIndex=function(e){return m.contains(this.indexSet_,e.toString())},r.prototype.addIndex=function(e,t){m.assert(e!==Ie,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var i=[],o=!1,s=t.getIterator(U.Wrap),u=s.getNext();u;)o=o||e.isDefinedOn(u.node),i.push(u),u=s.getNext();var c;c=o?dt(i,e.getCompare()):Pe;var f=e.toString(),d=M.__assign({},this.indexSet_);d[f]=e;var y=M.__assign({},this.indexes_);return y[f]=c,new r(y,d)},r.prototype.addToIndexes=function(e,t){var i=this;return new r(m.map(this.indexes_,function(s,u){var c=m.safeGet(i.indexSet_,u);if(m.assert(c,"Missing index implementation for "+u),s===Pe){if(c.isDefinedOn(e.node)){for(var f=[],d=t.getIterator(U.Wrap),y=d.getNext();y;)y.name!==e.name&&f.push(y),y=d.getNext();return f.push(e),dt(f,c.getCompare())}return Pe}var g=t.get(e.name),E=s;return g&&(E=E.remove(new U(e.name,g))),E.insert(e,e.node)}),this.indexSet_)},r.prototype.removeFromIndexes=function(e,t){return new r(m.map(this.indexes_,function(o){if(o===Pe)return o;var s=t.get(e.name);return s?o.remove(new U(e.name,s)):o}),this.indexSet_)},r}();function H(r,e){return A(r.name,e.name)}function Ke(r,e){return A(r,e)}var Xe,P=function(){function r(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&ht(this.priorityNode_),this.children_.isEmpty()&&m.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(r,"EMPTY_NODE",{get:function(){return Xe||(Xe=new r(new be(Ke),null,$e.Default))},enumerable:!1,configurable:!0}),r.prototype.isLeafNode=function(){return!1},r.prototype.getPriority=function(){return this.priorityNode_||Xe},r.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new r(this.children_,e,this.indexMap_)},r.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Xe:t},r.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},r.prototype.hasChild=function(e){return null!==this.children_.get(e)},r.prototype.updateImmediateChild=function(e,t){if(m.assert(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);var i=new U(e,t),o=void 0,s=void 0;t.isEmpty()?(o=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(i,this.children_));var u=o.isEmpty()?Xe:this.priorityNode_;return new r(o,u,s)},r.prototype.updateChild=function(e,t){var i=e.getFront();if(null===i)return t;m.assert(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var o=this.getImmediateChild(i).updateChild(e.popFront(),t);return this.updateImmediateChild(i,o)},r.prototype.isEmpty=function(){return this.children_.isEmpty()},r.prototype.numChildren=function(){return this.children_.count()},r.prototype.val=function(e){if(this.isEmpty())return null;var t={},i=0,o=0,s=!0;if(this.forEachChild(V,function(f,d){t[f]=d.val(e),i++,s&&r.INTEGER_REGEXP_.test(f)?o=Math.max(o,Number(f)):s=!1}),!e&&s&&o<2*i){var u=[];for(var c in t)u[c]=t[c];return u}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t},r.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+qe(this.getPriority().val())+":"),this.forEachChild(V,function(t,i){var o=i.hash();""!==o&&(e+=":"+t+":"+o)}),this.lazyHash_=""===e?"":at(e)}return this.lazyHash_},r.prototype.getPredecessorChildName=function(e,t,i){var o=this.resolveIndex_(i);if(o){var s=o.getPredecessorKey(new U(e,t));return s?s.name:null}return this.children_.getPredecessorKey(e)},r.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var i=t.minKey();return i&&i.name}return this.children_.minKey()},r.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new U(t,this.children_.get(t)):null},r.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var i=t.maxKey();return i&&i.name}return this.children_.maxKey()},r.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new U(t,this.children_.get(t)):null},r.prototype.forEachChild=function(e,t){var i=this.resolveIndex_(e);return i?i.inorderTraversal(function(o){return t(o.name,o.node)}):this.children_.inorderTraversal(t)},r.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},r.prototype.getIteratorFrom=function(e,t){var i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,function(u){return u});for(var o=this.children_.getIteratorFrom(e.name,U.Wrap),s=o.peek();null!=s&&t.compare(s,e)<0;)o.getNext(),s=o.peek();return o},r.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},r.prototype.getReverseIteratorFrom=function(e,t){var i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,function(u){return u});for(var o=this.children_.getReverseIteratorFrom(e.name,U.Wrap),s=o.peek();null!=s&&t.compare(s,e)>0;)o.getNext(),s=o.peek();return o},r.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===et?-1:0},r.prototype.withIndex=function(e){if(e===Ie||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new r(this.children_,this.priorityNode_,t)},r.prototype.isIndexed=function(e){return e===Ie||this.indexMap_.hasIndex(e)},r.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var i=this.getIterator(V),o=t.getIterator(V),s=i.getNext(),u=o.getNext();s&&u;){if(s.name!==u.name||!s.node.equals(u.node))return!1;s=i.getNext(),u=o.getNext()}return null===s&&null===u}return!1}return!1},r.prototype.resolveIndex_=function(e){return e===Ie?null:this.indexMap_.get(e.toString())},r.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,r}(),et=new(function(r){function e(){return r.call(this,new be(Ke),P.EMPTY_NODE,$e.Default)||this}return M.__extends(e,r),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return P.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(P));function J(r,e){if(void 0===e&&(e=null),null===r)return P.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(e=r[".priority"]),m.assert(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new Qe(r,J(e));if(r instanceof Array){var f=P.EMPTY_NODE;return z(r,function(d,y){if(m.contains(r,d)&&"."!==d.substring(0,1)){var g=J(y);(g.isLeafNode()||!g.isEmpty())&&(f=f.updateImmediateChild(d,g))}}),f.updatePriority(J(e))}var i=[],o=!1;if(z(r,function(d,y){if("."!==d.substring(0,1)){var g=J(y);g.isEmpty()||(o=o||!g.getPriority().isEmpty(),i.push(new U(d,g)))}}),0===i.length)return P.EMPTY_NODE;var u=dt(i,H,function(d){return d.name},Ke);if(o){var c=dt(i,V.getCompare());return new P(u,J(e),new $e({".priority":c},{".priority":V}))}return new P(u,J(e),$e.Default)}Object.defineProperties(U,{MIN:{value:new U(Z,P.EMPTY_NODE)},MAX:{value:new U(x,et)}}),Zt.__EMPTY_NODE=P.EMPTY_NODE,Qe.__childrenNodeConstructor=P,function(r){ke=r}(et),function(r){Xt=r}(et),function(r){Kt=r}(J);var Ft,Rt=new(function(r){function e(){return null!==r&&r.apply(this,arguments)||this}return M.__extends(e,r),e.prototype.compare=function(t,i){var o=t.node.compareTo(i.node);return 0===o?A(t.name,i.name):o},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,i){return!t.equals(i)},e.prototype.minPost=function(){return U.MIN},e.prototype.maxPost=function(){return U.MAX},e.prototype.makePost=function(t,i){var o=J(t);return new U(i,o)},e.prototype.toString=function(){return".value"},e}(Te)),xt=function(r){function e(t){var i=r.call(this)||this;return i.indexPath_=t,m.assert(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),i}return M.__extends(e,r),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,i){var o=this.extractChild(t.node),s=this.extractChild(i.node),u=o.compareTo(s);return 0===u?A(t.name,i.name):u},e.prototype.makePost=function(t,i){var o=J(t),s=P.EMPTY_NODE.updateChild(this.indexPath_,o);return new U(i,s)},e.prototype.maxPost=function(){var t=P.EMPTY_NODE.updateChild(this.indexPath_,et);return new U(x,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(Te),De=function(){function r(e,t,i){this.node_=e,this.ref_=t,this.index_=i}return r.prototype.val=function(){return m.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},r.prototype.exportVal=function(){return m.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},r.prototype.toJSON=function(){return m.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},r.prototype.exists=function(){return m.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},r.prototype.child=function(e){m.validateArgCount("DataSnapshot.child",0,1,arguments.length),e=String(e),pt("DataSnapshot.child",1,e,!1);var t=new I(e),i=this.ref_.child(t);return new r(this.node_.getChild(t),i,V)},r.prototype.hasChild=function(e){m.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),pt("DataSnapshot.hasChild",1,e,!1);var t=new I(e);return!this.node_.getChild(t).isEmpty()},r.prototype.getPriority=function(){return m.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},r.prototype.forEach=function(e){var t=this;if(m.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),m.validateCallback("DataSnapshot.forEach",1,e,!1),this.node_.isLeafNode())return!1;var i=this.node_;return!!i.forEachChild(this.index_,function(o,s){return e(new r(s,t.ref_.child(o),V))})},r.prototype.hasChildren=function(){return m.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(r.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),r.prototype.numChildren=function(){return m.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},r.prototype.getRef=function(){return m.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(r.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),r}(),tn=function(){function r(e,t,i,o){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=o}return r.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},r.prototype.getEventType=function(){return this.eventType},r.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},r.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+m.stringify(this.snapshot.exportVal())},r}(),nn=function(){function r(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}return r.prototype.getPath=function(){return this.path},r.prototype.getEventType=function(){return"cancel"},r.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},r.prototype.toString=function(){return this.path.toString()+":cancel"},r}(),rn=function(){function r(e,t,i){this.callback_=e,this.cancelCallback_=t,this.context_=i}return r.prototype.respondsTo=function(e){return"value"===e},r.prototype.createEvent=function(e,t){var i=t.getQueryParams().getIndex();return new tn("value",this,new De(e.snapshotNode,t.getRef(),i))},r.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){m.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var i=this.cancelCallback_;return function(){i.call(t,e.error)}}var o=this.callback_;return function(){o.call(t,e.snapshot)}},r.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new nn(this,e,t):null},r.prototype.matches=function(e){return e instanceof r&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},r.prototype.hasAnyCallback=function(){return null!==this.callback_},r}(),on=function(){function r(e,t,i){this.callbacks_=e,this.cancelCallback_=t,this.context_=i}return r.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return m.contains(this.callbacks_,t="children_removed"===t?"child_removed":t)},r.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new nn(this,e,t):null},r.prototype.createEvent=function(e,t){m.assert(null!=e.childName,"Child events should have a childName.");var i=t.getRef().child(e.childName),o=t.getQueryParams().getIndex();return new tn(e.type,this,new De(e.snapshotNode,i,o),e.prevName)},r.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){m.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var i=this.cancelCallback_;return function(){i.call(t,e.error)}}var o=this.callbacks_[e.eventType];return function(){o.call(t,e.snapshot,e.prevName)}},r.prototype.matches=function(e){var t=this;if(e instanceof r){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var i=Object.keys(e.callbacks_),o=Object.keys(this.callbacks_),s=i.length;if(s===o.length){if(1===s){var c=i[0],f=o[0];return!(f!==c||e.callbacks_[c]&&this.callbacks_[f]&&e.callbacks_[c]!==this.callbacks_[f])}return o.every(function(d){return e.callbacks_[d]===t.callbacks_[d]})}}}return!1},r.prototype.hasAnyCallback=function(){return null!==this.callbacks_},r}(),mt=function(){function r(e,t,i,o){this.repo=e,this.path=t,this.queryParams_=i,this.orderByCalled_=o}return Object.defineProperty(r,"__referenceConstructor",{get:function(){return m.assert(Ft,"Reference.ts has not been loaded"),Ft},set:function(e){Ft=e},enumerable:!1,configurable:!0}),r.validateQueryEndpoints_=function(e){var t=null,i=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(i=e.getIndexEndValue()),e.getIndex()===Ie){var o="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==Z)throw new Error(o);if("string"!=typeof t)throw new Error(s)}if(e.hasEnd()){if(e.getIndexEndName()!==x)throw new Error(o);if("string"!=typeof i)throw new Error(s)}}else if(e.getIndex()===V){if(null!=t&&!Me(t)||null!=i&&!Me(i))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(m.assert(e.getIndex()instanceof xt||e.getIndex()===Rt,"unknown index type."),null!=t&&"object"==typeof t||null!=i&&"object"==typeof i)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},r.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},r.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},r.prototype.getQueryParams=function(){return this.queryParams_},r.prototype.getRef=function(){return m.validateArgCount("Query.ref",0,0,arguments.length),new r.__referenceConstructor(this.repo,this.path)},r.prototype.on=function(e,t,i,o){m.validateArgCount("Query.on",2,4,arguments.length),Gt("Query.on",1,e,!1),m.validateCallback("Query.on",2,t,!1);var s=r.getCancelAndContextArgs_("Query.on",i,o);if("value"===e)this.onValueEvent(t,s.cancel,s.context);else{var u={};u[e]=t,this.onChildEvent(u,s.cancel,s.context)}return t},r.prototype.onValueEvent=function(e,t,i){var o=new rn(e,t||null,i||null);this.repo.addEventCallbackForQuery(this,o)},r.prototype.onChildEvent=function(e,t,i){var o=new on(e,t,i);this.repo.addEventCallbackForQuery(this,o)},r.prototype.off=function(e,t,i){m.validateArgCount("Query.off",0,3,arguments.length),Gt("Query.off",1,e,!0),m.validateCallback("Query.off",2,t,!0),m.validateContextObject("Query.off",3,i,!0);var o=null,s=null;if("value"===e){var u=t||null;o=new rn(u,null,i||null)}else e&&(t&&((s={})[e]=t),o=new on(s,null,i||null));this.repo.removeEventCallbackForQuery(this,o)},r.prototype.once=function(e,t,i,o){var s=this;m.validateArgCount("Query.once",1,4,arguments.length),Gt("Query.once",1,e,!1),m.validateCallback("Query.once",2,t,!0);var u=r.getCancelAndContextArgs_("Query.once",i,o),c=!0,f=new m.Deferred;f.promise.catch(function(){});var d=function(y){c&&(c=!1,s.off(e,d),t&&t.bind(u.context)(y),f.resolve(y))};return this.on(e,d,function(y){s.off(e,d),u.cancel&&u.cancel.bind(u.context)(y),f.reject(y)}),f.promise},r.prototype.limitToFirst=function(e){if(m.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new r(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},r.prototype.limitToLast=function(e){if(m.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new r(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},r.prototype.orderByChild=function(e){if(m.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');pt("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var t=new I(e);if(t.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var i=new xt(t),o=this.queryParams_.orderBy(i);return r.validateQueryEndpoints_(o),new r(this.repo,this.path,o,!0)},r.prototype.orderByKey=function(){m.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(Ie);return r.validateQueryEndpoints_(e),new r(this.repo,this.path,e,!0)},r.prototype.orderByPriority=function(){m.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(V);return r.validateQueryEndpoints_(e),new r(this.repo,this.path,e,!0)},r.prototype.orderByValue=function(){m.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Rt);return r.validateQueryEndpoints_(e),new r(this.repo,this.path,e,!0)},r.prototype.startAt=function(e,t){void 0===e&&(e=null),m.validateArgCount("Query.startAt",0,2,arguments.length),Se("Query.startAt",1,e,this.path,!0),$t("Query.startAt",2,t,!0);var i=this.queryParams_.startAt(e,t);if(r.validateLimit_(i),r.validateQueryEndpoints_(i),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,t=null),new r(this.repo,this.path,i,this.orderByCalled_)},r.prototype.endAt=function(e,t){void 0===e&&(e=null),m.validateArgCount("Query.endAt",0,2,arguments.length),Se("Query.endAt",1,e,this.path,!0),$t("Query.endAt",2,t,!0);var i=this.queryParams_.endAt(e,t);if(r.validateLimit_(i),r.validateQueryEndpoints_(i),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new r(this.repo,this.path,i,this.orderByCalled_)},r.prototype.equalTo=function(e,t){if(m.validateArgCount("Query.equalTo",1,2,arguments.length),Se("Query.equalTo",1,e,this.path,!1),$t("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},r.prototype.toString=function(){return m.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},r.prototype.toJSON=function(){return m.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},r.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},r.prototype.queryIdentifier=function(){var e=this.queryObject(),t=re(e);return"{}"===t?"default":t},r.prototype.isEqual=function(e){if(m.validateArgCount("Query.isEqual",1,1,arguments.length),!(e instanceof r)){var t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}var i=this.repo===e.repo,o=this.path.equals(e.path),s=this.queryIdentifier()===e.queryIdentifier();return i&&o&&s},r.getCancelAndContextArgs_=function(e,t,i){var o={cancel:null,context:null};if(t&&i)o.cancel=t,m.validateCallback(e,3,o.cancel,!0),o.context=i,m.validateContextObject(e,4,o.context,!0);else if(t)if("object"==typeof t&&null!==t)o.context=t;else{if("function"!=typeof t)throw new Error(m.errorPrefix(e,3,!0)+" must either be a cancel callback or a context object.");o.cancel=t}return o},Object.defineProperty(r.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),r}(),zn=function(){function r(e){this.node_=e}return r.prototype.getImmediateChild=function(e){return new r(this.node_.getImmediateChild(e))},r.prototype.node=function(){return this.node_},r}(),Bn=function(){function r(e,t){this.syncTree_=e,this.path_=t}return r.prototype.getImmediateChild=function(e){var t=this.path_.child(e);return new r(this.syncTree_,t)},r.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},r}(),sn=function(r,e,t){return r&&"object"==typeof r?(m.assert(".sv"in r,"Unexpected leaf node or priority contents"),"string"==typeof r[".sv"]?jn(r[".sv"],e,t):"object"==typeof r[".sv"]?Yn(r[".sv"],e):void m.assert(!1,"Unexpected server value: "+JSON.stringify(r,null,2))):r},jn=function(r,e,t){switch(r){case"timestamp":return t.timestamp;default:m.assert(!1,"Unexpected server value: "+r)}},Yn=function(r,e,t){r.hasOwnProperty("increment")||m.assert(!1,"Unexpected server value: "+JSON.stringify(r,null,2));var i=r.increment;"number"!=typeof i&&m.assert(!1,"Unexpected increment value: "+i);var o=e.node();if(m.assert(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return i;var u=o.getValue();return"number"!=typeof u?i:u+i},an=function(r,e,t,i){return Pt(e,new Bn(t,r),i)},kt=function(r,e,t){return Pt(r,new zn(e),t)};function Pt(r,e,t){var s,i=r.getPriority().val(),o=sn(i,e.getImmediateChild(".priority"),t);if(r.isLeafNode()){var u=r,c=sn(u.getValue(),e,t);return c!==u.getValue()||o!==u.getPriority().val()?new Qe(c,J(o)):r}var f=r;return s=f,o!==f.getPriority().val()&&(s=s.updatePriority(new Qe(o))),f.forEachChild(V,function(d,y){var g=Pt(y,e.getImmediateChild(d),t);g!==y&&(s=s.updateImmediateChild(d,g))}),s}var Ot,tt,Dt=function(){function r(){this.value=null,this.children=new Map}return r.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!e.isEmpty()&&this.children.size>0){var t=e.getFront();return e=e.popFront(),this.children.has(t)?this.children.get(t).find(e):null}return null},r.prototype.remember=function(e,t){if(e.isEmpty())this.value=t,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(e,t);else{var i=e.getFront();this.children.has(i)||this.children.set(i,new r);var o=this.children.get(i);e=e.popFront(),o.remember(e,t)}},r.prototype.forget=function(e){if(e.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var i=this;return t.forEachChild(V,function(u,c){i.remember(new I(u),c)}),this.forget(e)}if(this.children.size>0){var o=e.getFront();return e=e.popFront(),this.children.has(o)&&this.children.get(o).forget(e)&&this.children.delete(o),0===this.children.size}return!0},r.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild(function(i,o){var s=new I(e.toString()+"/"+i);o.forEachTree(s,t)})},r.prototype.forEachChild=function(e){this.children.forEach(function(t,i){e(i,t)})},r}(),ue=(()=>(function(r){r[r.OVERWRITE=0]="OVERWRITE",r[r.MERGE=1]="MERGE",r[r.ACK_USER_WRITE=2]="ACK_USER_WRITE",r[r.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(ue||(ue={})),ue))(),we=function(){function r(e,t,i,o){this.fromUser=e,this.fromServer=t,this.queryId=i,this.tagged=o,m.assert(!o||t,"Tagged queries must be from server.")}return r.User=new r(!0,!1,null,!1),r.Server=new r(!1,!0,null,!1),r.forServerTaggedQuery=function(e){return new r(!1,!0,e,!0)},r}(),Hn=function(){function r(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=ue.ACK_USER_WRITE,this.source=we.User}return r.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return m.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new I(e));return new r(I.Empty,t,this.revert)}return m.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new r(this.path.popFront(),this.affectedTree,this.revert)},r}(),se=function(){function r(e,t){void 0===t&&(Ot||(Ot=new be(q)),t=Ot),this.value=e,this.children=t}return r.fromObject=function(e){var t=r.Empty;return z(e,function(i,o){t=t.set(new I(i),o)}),t},r.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},r.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:I.Empty,value:this.value};if(e.isEmpty())return null;var i=e.getFront(),o=this.children.get(i);if(null!==o){var s=o.findRootMostMatchingPathAndValue(e.popFront(),t);return null!=s?{path:new I(i).child(s.path),value:s.value}:null}return null},r.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},r.prototype.subtree=function(e){if(e.isEmpty())return this;var t=e.getFront(),i=this.children.get(t);return null!==i?i.subtree(e.popFront()):r.Empty},r.prototype.set=function(e,t){if(e.isEmpty())return new r(t,this.children);var i=e.getFront(),s=(this.children.get(i)||r.Empty).set(e.popFront(),t),u=this.children.insert(i,s);return new r(this.value,u)},r.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?r.Empty:new r(null,this.children);var t=e.getFront(),i=this.children.get(t);if(i){var o=i.remove(e.popFront()),s=void 0;return s=o.isEmpty()?this.children.remove(t):this.children.insert(t,o),null===this.value&&s.isEmpty()?r.Empty:new r(this.value,s)}return this},r.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),i=this.children.get(t);return i?i.get(e.popFront()):null},r.prototype.setTree=function(e,t){if(e.isEmpty())return t;var u,i=e.getFront(),s=(this.children.get(i)||r.Empty).setTree(e.popFront(),t);return u=s.isEmpty()?this.children.remove(i):this.children.insert(i,s),new r(this.value,u)},r.prototype.fold=function(e){return this.fold_(I.Empty,e)},r.prototype.fold_=function(e,t){var i={};return this.children.inorderTraversal(function(o,s){i[o]=s.fold_(e.child(o),t)}),t(e,this.value,i)},r.prototype.findOnPath=function(e,t){return this.findOnPath_(e,I.Empty,t)},r.prototype.findOnPath_=function(e,t,i){var o=!!this.value&&i(t,this.value);if(o)return o;if(e.isEmpty())return null;var s=e.getFront(),u=this.children.get(s);return u?u.findOnPath_(e.popFront(),t.child(s),i):null},r.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,I.Empty,t)},r.prototype.foreachOnPath_=function(e,t,i){if(e.isEmpty())return this;this.value&&i(t,this.value);var o=e.getFront(),s=this.children.get(o);return s?s.foreachOnPath_(e.popFront(),t.child(o),i):r.Empty},r.prototype.foreach=function(e){this.foreach_(I.Empty,e)},r.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(i,o){o.foreach_(e.child(i),t)}),this.value&&t(e,this.value)},r.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,i){i.value&&e(t,i.value)})},r.Empty=new r(null),r}(),ln=function(){function r(e,t){this.source=e,this.path=t,this.type=ue.LISTEN_COMPLETE}return r.prototype.operationForChild=function(e){return this.path.isEmpty()?new r(this.source,I.Empty):new r(this.source,this.path.popFront())},r}(),_t=function(){function r(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=ue.OVERWRITE}return r.prototype.operationForChild=function(e){return this.path.isEmpty()?new r(this.source,I.Empty,this.snap.getImmediateChild(e)):new r(this.source,this.path.popFront(),this.snap)},r}(),Lt=function(){function r(e,t,i){this.source=e,this.path=t,this.children=i,this.type=ue.MERGE}return r.prototype.operationForChild=function(e){if(this.path.isEmpty()){var t=this.children.subtree(new I(e));return t.isEmpty()?null:t.value?new _t(this.source,I.Empty,t.value):new r(this.source,I.Empty,t)}return m.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new r(this.source,this.path.popFront(),this.children)},r.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},r}(),Ae=function(){function r(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}return r.prototype.isFullyInitialized=function(){return this.fullyInitialized_},r.prototype.isFiltered=function(){return this.filtered_},r.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},r.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},r.prototype.getNode=function(){return this.node_},r}(),un=function(){function r(e,t){this.eventCache_=e,this.serverCache_=t}return r.prototype.updateEventSnap=function(e,t,i){return new r(new Ae(e,t,i),this.serverCache_)},r.prototype.updateServerSnap=function(e,t,i){return new r(this.eventCache_,new Ae(e,t,i))},r.prototype.getEventCache=function(){return this.eventCache_},r.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},r.prototype.getServerCache=function(){return this.serverCache_},r.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},r.Empty=new r(new Ae(P.EMPTY_NODE,!1,!1),new Ae(P.EMPTY_NODE,!1,!1)),r}(),Q=function(){function r(e,t,i,o,s){this.type=e,this.snapshotNode=t,this.childName=i,this.oldSnap=o,this.prevName=s}return r.valueChange=function(e){return new r(r.VALUE,e)},r.childAddedChange=function(e,t){return new r(r.CHILD_ADDED,t,e)},r.childRemovedChange=function(e,t){return new r(r.CHILD_REMOVED,t,e)},r.childChangedChange=function(e,t,i){return new r(r.CHILD_CHANGED,t,e,i)},r.childMovedChange=function(e,t){return new r(r.CHILD_MOVED,t,e)},r.CHILD_ADDED="child_added",r.CHILD_REMOVED="child_removed",r.CHILD_CHANGED="child_changed",r.CHILD_MOVED="child_moved",r.VALUE="value",r}(),Mt=function(){function r(e){this.index_=e}return r.prototype.updateChild=function(e,t,i,o,s,u){m.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var c=e.getImmediateChild(t);return c.getChild(o).equals(i.getChild(o))&&c.isEmpty()===i.isEmpty()||(null!=u&&(i.isEmpty()?e.hasChild(t)?u.trackChildChange(Q.childRemovedChange(t,c)):m.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):c.isEmpty()?u.trackChildChange(Q.childAddedChange(t,i)):u.trackChildChange(Q.childChangedChange(t,i,c))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)},r.prototype.updateFullNode=function(e,t,i){return null!=i&&(e.isLeafNode()||e.forEachChild(V,function(o,s){t.hasChild(o)||i.trackChildChange(Q.childRemovedChange(o,s))}),t.isLeafNode()||t.forEachChild(V,function(o,s){if(e.hasChild(o)){var u=e.getImmediateChild(o);u.equals(s)||i.trackChildChange(Q.childChangedChange(o,s,u))}else i.trackChildChange(Q.childAddedChange(o,s))})),t.withIndex(this.index_)},r.prototype.updatePriority=function(e,t){return e.isEmpty()?P.EMPTY_NODE:e.updatePriority(t)},r.prototype.filtersNodes=function(){return!1},r.prototype.getIndexedFilter=function(){return this},r.prototype.getIndex=function(){return this.index_},r}(),Gn=function(){function r(){this.changeMap=new Map}return r.prototype.trackChildChange=function(e){var t=e.type,i=e.childName;m.assert(t===Q.CHILD_ADDED||t===Q.CHILD_CHANGED||t===Q.CHILD_REMOVED,"Only child changes supported for tracking"),m.assert(".priority"!==i,"Only non-priority child changes can be tracked.");var o=this.changeMap.get(i);if(o){var s=o.type;if(t===Q.CHILD_ADDED&&s===Q.CHILD_REMOVED)this.changeMap.set(i,Q.childChangedChange(i,e.snapshotNode,o.snapshotNode));else if(t===Q.CHILD_REMOVED&&s===Q.CHILD_ADDED)this.changeMap.delete(i);else if(t===Q.CHILD_REMOVED&&s===Q.CHILD_CHANGED)this.changeMap.set(i,Q.childRemovedChange(i,o.oldSnap));else if(t===Q.CHILD_CHANGED&&s===Q.CHILD_ADDED)this.changeMap.set(i,Q.childAddedChange(i,e.snapshotNode));else{if(t!==Q.CHILD_CHANGED||s!==Q.CHILD_CHANGED)throw m.assertionError("Illegal combination of changes: "+e+" occurred after "+o);this.changeMap.set(i,Q.childChangedChange(i,e.snapshotNode,o.oldSnap))}}else this.changeMap.set(i,e)},r.prototype.getChanges=function(){return Array.from(this.changeMap.values())},r}(),cn=new(function(){function r(){}return r.prototype.getCompleteChild=function(e){return null},r.prototype.getChildAfterChild=function(e,t,i){return null},r}()),Ut=function(){function r(e,t,i){void 0===i&&(i=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}return r.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var i=null!=this.optCompleteServerCache_?new Ae(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,i)},r.prototype.getChildAfterChild=function(e,t,i){var o=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),s=this.writes_.calcIndexedSlice(o,t,1,i,e);return 0===s.length?null:s[0]},r}(),Kn=function(e,t){this.viewCache=e,this.changes=t},Xn=function(){function r(e){this.filter_=e}return r.prototype.assertIndexed=function(e){m.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),m.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},r.prototype.applyOperation=function(e,t,i,o){var u,c,s=new Gn;if(t.type===ue.OVERWRITE){var f=t;f.source.fromUser?u=this.applyUserOverwrite_(e,f.path,f.snap,i,o,s):(m.assert(f.source.fromServer,"Unknown source."),c=f.source.tagged||e.getServerCache().isFiltered()&&!f.path.isEmpty(),u=this.applyServerOverwrite_(e,f.path,f.snap,i,o,c,s))}else if(t.type===ue.MERGE){var d=t;d.source.fromUser?u=this.applyUserMerge_(e,d.path,d.children,i,o,s):(m.assert(d.source.fromServer,"Unknown source."),c=d.source.tagged||e.getServerCache().isFiltered(),u=this.applyServerMerge_(e,d.path,d.children,i,o,c,s))}else if(t.type===ue.ACK_USER_WRITE){var y=t;u=y.revert?this.revertUserWrite_(e,y.path,i,o,s):this.ackUserWrite_(e,y.path,y.affectedTree,i,o,s)}else{if(t.type!==ue.LISTEN_COMPLETE)throw m.assertionError("Unknown operation type: "+t.type);u=this.listenComplete_(e,t.path,i,s)}var g=s.getChanges();return r.maybeAddValueEvent_(e,u,g),new Kn(u,g)},r.maybeAddValueEvent_=function(e,t,i){var o=t.getEventCache();if(o.isFullyInitialized()){var s=o.getNode().isLeafNode()||o.getNode().isEmpty(),u=e.getCompleteEventSnap();(i.length>0||!e.getEventCache().isFullyInitialized()||s&&!o.getNode().equals(u)||!o.getNode().getPriority().equals(u.getPriority()))&&i.push(Q.valueChange(t.getCompleteEventSnap()))}},r.prototype.generateEventCacheAfterServerEvent_=function(e,t,i,o,s){var u=e.getEventCache();if(null!=i.shadowingWrite(t))return e;var c=void 0,f=void 0;if(t.isEmpty())if(m.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var d=e.getCompleteServerSnap(),g=i.calcCompleteEventChildren(d instanceof P?d:P.EMPTY_NODE);c=this.filter_.updateFullNode(e.getEventCache().getNode(),g,s)}else{var E=i.calcCompleteEventCache(e.getCompleteServerSnap());c=this.filter_.updateFullNode(e.getEventCache().getNode(),E,s)}else{var T=t.getFront();if(".priority"===T){m.assert(1===t.getLength(),"Can't have a priority with additional path components");var N=u.getNode();f=e.getServerCache().getNode();var R=i.calcEventCacheAfterServerOverwrite(t,N,f);c=null!=R?this.filter_.updatePriority(N,R):u.getNode()}else{var W=t.popFront(),B=void 0;if(u.isCompleteForChild(T)){f=e.getServerCache().getNode();var ce=i.calcEventCacheAfterServerOverwrite(t,u.getNode(),f);B=null!=ce?u.getNode().getImmediateChild(T).updateChild(W,ce):u.getNode().getImmediateChild(T)}else B=i.calcCompleteChild(T,e.getServerCache());c=null!=B?this.filter_.updateChild(u.getNode(),T,B,W,o,s):u.getNode()}}return e.updateEventSnap(c,u.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},r.prototype.applyServerOverwrite_=function(e,t,i,o,s,u,c){var d,f=e.getServerCache(),y=u?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())d=y.updateFullNode(f.getNode(),i,null);else if(y.filtersNodes()&&!f.isFiltered()){var g=f.getNode().updateChild(t,i);d=y.updateFullNode(f.getNode(),g,null)}else{var E=t.getFront();if(!f.isCompleteForPath(t)&&t.getLength()>1)return e;var T=t.popFront(),R=f.getNode().getImmediateChild(E).updateChild(T,i);d=".priority"===E?y.updatePriority(f.getNode(),R):y.updateChild(f.getNode(),E,R,T,cn,null)}var W=e.updateServerSnap(d,f.isFullyInitialized()||t.isEmpty(),y.filtersNodes()),B=new Ut(o,W,s);return this.generateEventCacheAfterServerEvent_(W,t,o,B,c)},r.prototype.applyUserOverwrite_=function(e,t,i,o,s,u){var f,d,c=e.getEventCache(),y=new Ut(o,e,s);if(t.isEmpty())d=this.filter_.updateFullNode(e.getEventCache().getNode(),i,u),f=e.updateEventSnap(d,!0,this.filter_.filtersNodes());else{var g=t.getFront();if(".priority"===g)d=this.filter_.updatePriority(e.getEventCache().getNode(),i),f=e.updateEventSnap(d,c.isFullyInitialized(),c.isFiltered());else{var E=t.popFront(),T=c.getNode().getImmediateChild(g),N=void 0;if(E.isEmpty())N=i;else{var R=y.getCompleteChild(g);N=null!=R?".priority"===E.getBack()&&R.getChild(E.parent()).isEmpty()?R:R.updateChild(E,i):P.EMPTY_NODE}if(T.equals(N))f=e;else{var W=this.filter_.updateChild(c.getNode(),g,N,E,y,u);f=e.updateEventSnap(W,c.isFullyInitialized(),this.filter_.filtersNodes())}}}return f},r.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},r.prototype.applyUserMerge_=function(e,t,i,o,s,u){var c=this,f=e;return i.foreach(function(d,y){var g=t.child(d);r.cacheHasChild_(e,g.getFront())&&(f=c.applyUserOverwrite_(f,g,y,o,s,u))}),i.foreach(function(d,y){var g=t.child(d);r.cacheHasChild_(e,g.getFront())||(f=c.applyUserOverwrite_(f,g,y,o,s,u))}),f},r.prototype.applyMerge_=function(e,t){return t.foreach(function(i,o){e=e.updateChild(i,o)}),e},r.prototype.applyServerMerge_=function(e,t,i,o,s,u,c){var f=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var y,d=e;y=t.isEmpty()?i:se.Empty.setTree(t,i);var g=e.getServerCache().getNode();return y.children.inorderTraversal(function(E,T){if(g.hasChild(E)){var N=e.getServerCache().getNode().getImmediateChild(E),R=f.applyMerge_(N,T);d=f.applyServerOverwrite_(d,new I(E),R,o,s,u,c)}}),y.children.inorderTraversal(function(E,T){var N=!e.getServerCache().isCompleteForChild(E)&&null==T.value;if(!g.hasChild(E)&&!N){var R=e.getServerCache().getNode().getImmediateChild(E),W=f.applyMerge_(R,T);d=f.applyServerOverwrite_(d,new I(E),W,o,s,u,c)}}),d},r.prototype.ackUserWrite_=function(e,t,i,o,s,u){if(null!=o.shadowingWrite(t))return e;var c=e.getServerCache().isFiltered(),f=e.getServerCache();if(null!=i.value){if(t.isEmpty()&&f.isFullyInitialized()||f.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,f.getNode().getChild(t),o,s,c,u);if(t.isEmpty()){var d=se.Empty;return f.getNode().forEachChild(Ie,function(g,E){d=d.set(new I(g),E)}),this.applyServerMerge_(e,t,d,o,s,c,u)}return e}var y=se.Empty;return i.foreach(function(g,E){var T=t.child(g);f.isCompleteForPath(T)&&(y=y.set(g,f.getNode().getChild(T)))}),this.applyServerMerge_(e,t,y,o,s,c,u)},r.prototype.listenComplete_=function(e,t,i,o){var s=e.getServerCache(),u=e.updateServerSnap(s.getNode(),s.isFullyInitialized()||t.isEmpty(),s.isFiltered());return this.generateEventCacheAfterServerEvent_(u,t,i,cn,o)},r.prototype.revertUserWrite_=function(e,t,i,o,s){var u;if(null!=i.shadowingWrite(t))return e;var c=new Ut(i,e,o),f=e.getEventCache().getNode(),d=void 0;if(t.isEmpty()||".priority"===t.getFront()){var y=void 0;if(e.getServerCache().isFullyInitialized())y=i.calcCompleteEventCache(e.getCompleteServerSnap());else{var g=e.getServerCache().getNode();m.assert(g instanceof P,"serverChildren would be complete if leaf node"),y=i.calcCompleteEventChildren(g)}d=this.filter_.updateFullNode(f,y=y,s)}else{var E=t.getFront(),T=i.calcCompleteChild(E,e.getServerCache());null==T&&e.getServerCache().isCompleteForChild(E)&&(T=f.getImmediateChild(E)),(d=null!=T?this.filter_.updateChild(f,E,T,t.popFront(),c,s):e.getEventCache().getNode().hasChild(E)?this.filter_.updateChild(f,E,P.EMPTY_NODE,t.popFront(),c,s):f).isEmpty()&&e.getServerCache().isFullyInitialized()&&(u=i.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(d=this.filter_.updateFullNode(d,u,s))}return u=e.getServerCache().isFullyInitialized()||null!=i.shadowingWrite(I.Empty),e.updateEventSnap(d,u,this.filter_.filtersNodes())},r}(),er=function(){function r(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return r.prototype.generateEventsForChanges=function(e,t,i){var o=this,s=[],u=[];return e.forEach(function(c){c.type===Q.CHILD_CHANGED&&o.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&u.push(Q.childMovedChange(c.childName,c.snapshotNode))}),this.generateEventsForType_(s,Q.CHILD_REMOVED,e,i,t),this.generateEventsForType_(s,Q.CHILD_ADDED,e,i,t),this.generateEventsForType_(s,Q.CHILD_MOVED,u,i,t),this.generateEventsForType_(s,Q.CHILD_CHANGED,e,i,t),this.generateEventsForType_(s,Q.VALUE,e,i,t),s},r.prototype.generateEventsForType_=function(e,t,i,o,s){var u=this,c=i.filter(function(f){return f.type===t});c.sort(this.compareChanges_.bind(this)),c.forEach(function(f){var d=u.materializeSingleChange_(f,s);o.forEach(function(y){y.respondsTo(f.type)&&e.push(y.createEvent(d,u.query_))})})},r.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_)),e},r.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw m.assertionError("Should only compare child_ events.");var i=new U(e.childName,e.snapshotNode),o=new U(t.childName,t.snapshotNode);return this.index_.compare(i,o)},r}(),tr=function(){function r(e,t){this.query_=e,this.eventRegistrations_=[];var i=this.query_.getQueryParams(),o=new Mt(i.getIndex()),s=i.getNodeFilter();this.processor_=new Xn(s);var u=t.getServerCache(),c=t.getEventCache(),f=o.updateFullNode(P.EMPTY_NODE,u.getNode(),null),d=s.updateFullNode(P.EMPTY_NODE,c.getNode(),null),y=new Ae(f,u.isFullyInitialized(),o.filtersNodes()),g=new Ae(d,c.isFullyInitialized(),s.filtersNodes());this.viewCache_=new un(g,y),this.eventGenerator_=new er(this.query_)}return r.prototype.getQuery=function(){return this.query_},r.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},r.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},r.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},r.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},r.prototype.removeEventRegistration=function(e,t){var i=[];if(t){m.assert(null==e,"A cancel should cancel all event registrations.");var o=this.query_.path;this.eventRegistrations_.forEach(function(f){var d=f.createCancelEvent(t=t,o);d&&i.push(d)})}if(e){for(var s=[],u=0;u<this.eventRegistrations_.length;++u){var c=this.eventRegistrations_[u];if(c.matches(e)){if(e.hasAnyCallback()){s=s.concat(this.eventRegistrations_.slice(u+1));break}}else s.push(c)}this.eventRegistrations_=s}else this.eventRegistrations_=[];return i},r.prototype.applyOperation=function(e,t,i){e.type===ue.MERGE&&null!==e.source.queryId&&(m.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),m.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var o=this.viewCache_,s=this.processor_.applyOperation(o,e,t,i);return this.processor_.assertIndexed(s.viewCache),m.assert(s.viewCache.getServerCache().isFullyInitialized()||!o.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=s.viewCache,this.generateEventsForChanges_(s.changes,s.viewCache.getEventCache().getNode(),null)},r.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(V,function(s,u){i.push(Q.childAddedChange(s,u))}),t.isFullyInitialized()&&i.push(Q.valueChange(t.getNode())),this.generateEventsForChanges_(i,t.getNode(),e)},r.prototype.generateEventsForChanges_=function(e,t,i){return this.eventGenerator_.generateEventsForChanges(e,t,i?[i]:this.eventRegistrations_)},r}(),qt=function(){function r(){this.views=new Map}return Object.defineProperty(r,"__referenceConstructor",{get:function(){return m.assert(tt,"Reference.ts has not been loaded"),tt},set:function(e){m.assert(!tt,"__referenceConstructor has already been defined"),tt=e},enumerable:!1,configurable:!0}),r.prototype.isEmpty=function(){return 0===this.views.size},r.prototype.applyOperation=function(e,t,i){var o,s,u=e.source.queryId;if(null!==u){var c=this.views.get(u);return m.assert(null!=c,"SyncTree gave us an op for an invalid query."),c.applyOperation(e,t,i)}var f=[];try{for(var d=M.__values(this.views.values()),y=d.next();!y.done;y=d.next())f=f.concat((c=y.value).applyOperation(e,t,i))}catch(g){o={error:g}}finally{try{y&&!y.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}return f},r.prototype.addEventRegistration=function(e,t,i,o,s){var u=e.queryIdentifier(),c=this.views.get(u);if(!c){var f=i.calcCompleteEventCache(s?o:null),d=!1;f?d=!0:o instanceof P?(f=i.calcCompleteEventChildren(o),d=!1):(f=P.EMPTY_NODE,d=!1);var y=new un(new Ae(f,d,!1),new Ae(o,s,!1));c=new tr(e,y),this.views.set(u,c)}return c.addEventRegistration(t),c.getInitialEvents(t)},r.prototype.removeEventRegistration=function(e,t,i){var o,s,u=e.queryIdentifier(),c=[],f=[],d=this.hasCompleteView();if("default"===u)try{for(var y=M.__values(this.views.entries()),g=y.next();!g.done;g=y.next()){var N,E=M.__read(g.value,2),T=E[0];f=f.concat((N=E[1]).removeEventRegistration(t,i)),N.isEmpty()&&(this.views.delete(T),N.getQuery().getQueryParams().loadsAllData()||c.push(N.getQuery()))}}catch(R){o={error:R}}finally{try{g&&!g.done&&(s=y.return)&&s.call(y)}finally{if(o)throw o.error}}else(N=this.views.get(u))&&(f=f.concat(N.removeEventRegistration(t,i)),N.isEmpty()&&(this.views.delete(u),N.getQuery().getQueryParams().loadsAllData()||c.push(N.getQuery())));return d&&!this.hasCompleteView()&&c.push(new r.__referenceConstructor(e.repo,e.path)),{removed:c,events:f}},r.prototype.getQueryViews=function(){var e,t,i=[];try{for(var o=M.__values(this.views.values()),s=o.next();!s.done;s=o.next()){var u=s.value;u.getQuery().getQueryParams().loadsAllData()||i.push(u)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return i},r.prototype.getCompleteServerCache=function(e){var t,i,o=null;try{for(var s=M.__values(this.views.values()),u=s.next();!u.done;u=s.next())o=o||u.value.getCompleteServerCache(e)}catch(f){t={error:f}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return o},r.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var i=e.queryIdentifier();return this.views.get(i)},r.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},r.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},r.prototype.getCompleteView=function(){var e,t;try{for(var i=M.__values(this.views.values()),o=i.next();!o.done;o=i.next()){var s=o.value;if(s.getQuery().getQueryParams().loadsAllData())return s}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return null},r}(),pn=function(){function r(e){this.writeTree_=e}return r.prototype.addWrite=function(e,t){if(e.isEmpty())return new r(new se(t));var i=this.writeTree_.findRootMostValueAndPath(e);if(null!=i){var o=i.path,s=i.value,u=I.relativePath(o,e);return s=s.updateChild(u,t),new r(this.writeTree_.set(o,s))}var c=new se(t);return new r(this.writeTree_.setTree(e,c))},r.prototype.addWrites=function(e,t){var i=this;return z(t,function(o,s){i=i.addWrite(e.child(o),s)}),i},r.prototype.removeWrite=function(e){return e.isEmpty()?r.Empty:new r(this.writeTree_.setTree(e,se.Empty))},r.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},r.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(I.relativePath(t.path,e)):null},r.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(V,function(i,o){e.push(new U(i,o))}):this.writeTree_.children.inorderTraversal(function(i,o){null!=o.value&&e.push(new U(i,o.value))}),e},r.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var t=this.getCompleteNode(e);return new r(null!=t?new se(t):this.writeTree_.subtree(e))},r.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},r.prototype.apply=function(e){return hn(I.Empty,this.writeTree_,e)},r.Empty=new r(new se(null)),r}();function hn(r,e,t){if(null!=e.value)return t.updateChild(r,e.value);var i=null;return e.children.inorderTraversal(function(o,s){".priority"===o?(m.assert(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):t=hn(r.child(o),s,t)}),!t.getChild(r).isEmpty()&&null!==i&&(t=t.updateChild(r.child(".priority"),i)),t}var nr=function(){function r(){this.visibleWrites_=pn.Empty,this.allWrites_=[],this.lastWriteId_=-1}return r.prototype.childWrites=function(e){return new rr(e,this)},r.prototype.addOverwrite=function(e,t,i,o){m.assert(i>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),this.allWrites_.push({path:e,snap:t,writeId:i,visible:o}),o&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=i},r.prototype.addMerge=function(e,t,i){m.assert(i>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:i,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=i},r.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var i=this.allWrites_[t];if(i.writeId===e)return i}return null},r.prototype.removeWrite=function(e){var t=this,i=this.allWrites_.findIndex(function(y){return y.writeId===e});m.assert(i>=0,"removeWrite called with nonexistent writeId.");var o=this.allWrites_[i];this.allWrites_.splice(i,1);for(var s=o.visible,u=!1,c=this.allWrites_.length-1;s&&c>=0;){var f=this.allWrites_[c];f.visible&&(c>=i&&this.recordContainsPath_(f,o.path)?s=!1:o.path.contains(f.path)&&(u=!0)),c--}return!!s&&(u?(this.resetTree_(),!0):(o.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(o.path):z(o.children,function(y){t.visibleWrites_=t.visibleWrites_.removeWrite(o.path.child(y))}),!0))},r.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},r.prototype.calcCompleteEventCache=function(e,t,i,o){if(i||o){var f=this.visibleWrites_.childCompoundWrite(e);return!o&&f.isEmpty()?t:o||null!=t||f.hasCompleteWrite(I.Empty)?r.layerTree_(this.allWrites_,function(E){return(E.visible||o)&&(!i||!~i.indexOf(E.writeId))&&(E.path.contains(e)||e.contains(E.path))},e).apply(t||P.EMPTY_NODE):null}var s=this.visibleWrites_.getCompleteNode(e);if(null!=s)return s;var u=this.visibleWrites_.childCompoundWrite(e);return u.isEmpty()?t:null!=t||u.hasCompleteWrite(I.Empty)?u.apply(t||P.EMPTY_NODE):null},r.prototype.calcCompleteEventChildren=function(e,t){var i=P.EMPTY_NODE,o=this.visibleWrites_.getCompleteNode(e);if(o)return o.isLeafNode()||o.forEachChild(V,function(c,f){i=i.updateImmediateChild(c,f)}),i;if(t){var s=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(V,function(c,f){var d=s.childCompoundWrite(new I(c)).apply(f);i=i.updateImmediateChild(c,d)}),s.getCompleteChildren().forEach(function(c){i=i.updateImmediateChild(c.name,c.node)}),i}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach(function(c){i=i.updateImmediateChild(c.name,c.node)}),i},r.prototype.calcEventCacheAfterServerOverwrite=function(e,t,i,o){m.assert(i||o,"Either existingEventSnap or existingServerSnap must exist");var s=e.child(t);if(this.visibleWrites_.hasCompleteWrite(s))return null;var u=this.visibleWrites_.childCompoundWrite(s);return u.isEmpty()?o.getChild(t):u.apply(o.getChild(t))},r.prototype.calcCompleteChild=function(e,t,i){var o=e.child(t),s=this.visibleWrites_.getCompleteNode(o);return null!=s?s:i.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(o).apply(i.getNode().getImmediateChild(t)):null},r.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},r.prototype.calcIndexedSlice=function(e,t,i,o,s,u){var c,f=this.visibleWrites_.childCompoundWrite(e),d=f.getCompleteNode(I.Empty);if(null!=d)c=d;else{if(null==t)return[];c=f.apply(t)}if((c=c.withIndex(u)).isEmpty()||c.isLeafNode())return[];for(var y=[],g=u.getCompare(),E=s?c.getReverseIteratorFrom(i,u):c.getIteratorFrom(i,u),T=E.getNext();T&&y.length<o;)0!==g(T,i)&&y.push(T),T=E.getNext();return y},r.prototype.recordContainsPath_=function(e,t){if(e.snap)return e.path.contains(t);for(var i in e.children)if(e.children.hasOwnProperty(i)&&e.path.child(i).contains(t))return!0;return!1},r.prototype.resetTree_=function(){this.visibleWrites_=r.layerTree_(this.allWrites_,r.DefaultFilter_,I.Empty),this.lastWriteId_=this.allWrites_.length>0?this.allWrites_[this.allWrites_.length-1].writeId:-1},r.DefaultFilter_=function(e){return e.visible},r.layerTree_=function(e,t,i){for(var o=pn.Empty,s=0;s<e.length;++s){var u=e[s];if(t(u)){var c=u.path,f=void 0;if(u.snap)i.contains(c)?(f=I.relativePath(i,c),o=o.addWrite(f,u.snap)):c.contains(i)&&(f=I.relativePath(c,i),o=o.addWrite(I.Empty,u.snap.getChild(f)));else{if(!u.children)throw m.assertionError("WriteRecord should have .snap or .children");if(i.contains(c))f=I.relativePath(i,c),o=o.addWrites(f,u.children);else if(c.contains(i))if((f=I.relativePath(c,i)).isEmpty())o=o.addWrites(I.Empty,u.children);else{var d=m.safeGet(u.children,f.getFront());if(d){var y=d.getChild(f.popFront());o=o.addWrite(I.Empty,y)}}}}}return o},r}(),rr=function(){function r(e,t){this.treePath_=e,this.writeTree_=t}return r.prototype.calcCompleteEventCache=function(e,t,i){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,i)},r.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},r.prototype.calcEventCacheAfterServerOverwrite=function(e,t,i){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,i)},r.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},r.prototype.calcIndexedSlice=function(e,t,i,o,s){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,i,o,s)},r.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},r.prototype.child=function(e){return new r(this.treePath_.child(e),this.writeTree_)},r}(),fn=function(){function r(e){this.listenProvider_=e,this.syncPointTree_=se.Empty,this.pendingWriteTree_=new nr,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return r.prototype.applyUserOverwrite=function(e,t,i,o){return this.pendingWriteTree_.addOverwrite(e,t,i,o),o?this.applyOperationToSyncPoints_(new _t(we.User,e,t)):[]},r.prototype.applyUserMerge=function(e,t,i){this.pendingWriteTree_.addMerge(e,t,i);var o=se.fromObject(t);return this.applyOperationToSyncPoints_(new Lt(we.User,e,o))},r.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var i=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var s=se.Empty;return null!=i.snap?s=s.set(I.Empty,!0):z(i.children,function(u,c){s=s.set(new I(u),c)}),this.applyOperationToSyncPoints_(new Hn(i.path,s,t))}return[]},r.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new _t(we.Server,e,t))},r.prototype.applyServerMerge=function(e,t){var i=se.fromObject(t);return this.applyOperationToSyncPoints_(new Lt(we.Server,e,i))},r.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new ln(we.Server,e))},r.prototype.applyTaggedQueryOverwrite=function(e,t,i){var o=this.queryKeyForTag_(i);if(null!=o){var s=r.parseQueryKey_(o),u=s.path,c=s.queryId,f=I.relativePath(u,e),d=new _t(we.forServerTaggedQuery(c),f,t);return this.applyTaggedOperation_(u,d)}return[]},r.prototype.applyTaggedQueryMerge=function(e,t,i){var o=this.queryKeyForTag_(i);if(o){var s=r.parseQueryKey_(o),u=s.path,c=s.queryId,f=I.relativePath(u,e),d=se.fromObject(t),y=new Lt(we.forServerTaggedQuery(c),f,d);return this.applyTaggedOperation_(u,y)}return[]},r.prototype.applyTaggedListenComplete=function(e,t){var i=this.queryKeyForTag_(t);if(i){var o=r.parseQueryKey_(i),s=o.path,u=o.queryId,c=I.relativePath(s,e),f=new ln(we.forServerTaggedQuery(u),c);return this.applyTaggedOperation_(s,f)}return[]},r.prototype.addEventRegistration=function(e,t){var i=e.path,o=null,s=!1;this.syncPointTree_.foreachOnPath(i,function(R,W){var B=I.relativePath(R,i);o=o||W.getCompleteServerCache(B),s=s||W.hasCompleteView()});var c,u=this.syncPointTree_.get(i);u?(s=s||u.hasCompleteView(),o=o||u.getCompleteServerCache(I.Empty)):(u=new qt,this.syncPointTree_=this.syncPointTree_.set(i,u)),null!=o?c=!0:(c=!1,o=P.EMPTY_NODE,this.syncPointTree_.subtree(i).foreachChild(function(R,W){var B=W.getCompleteServerCache(I.Empty);B&&(o=o.updateImmediateChild(R,B))}));var d=u.viewExistsForQuery(e);if(!d&&!e.getQueryParams().loadsAllData()){var y=r.makeQueryKey_(e);m.assert(!this.queryToTagMap.has(y),"View does not exist, but we have a tag");var g=r.getNextQueryTag_();this.queryToTagMap.set(y,g),this.tagToQueryMap.set(g,y)}var E=this.pendingWriteTree_.childWrites(i),T=u.addEventRegistration(e,t,E,o,c);if(!d&&!s){var N=u.viewForQuery(e);T=T.concat(this.setupListener_(e,N))}return T},r.prototype.removeEventRegistration=function(e,t,i){var o=this,s=e.path,u=this.syncPointTree_.get(s),c=[];if(u&&("default"===e.queryIdentifier()||u.viewExistsForQuery(e))){var f=u.removeEventRegistration(e,t,i);u.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(s));var d=f.removed;c=f.events;var y=-1!==d.findIndex(function(ve){return ve.getQueryParams().loadsAllData()}),g=this.syncPointTree_.findOnPath(s,function(ve,rt){return rt.hasCompleteView()});if(y&&!g){var E=this.syncPointTree_.subtree(s);if(!E.isEmpty())for(var T=this.collectDistinctViewsForSubTree_(E),N=0;N<T.length;++N){var R=T[N],W=R.getQuery(),B=this.createListenerForView_(R);this.listenProvider_.startListening(r.queryForListening_(W),this.tagForQuery_(W),B.hashFn,B.onComplete)}}!g&&d.length>0&&!i&&(y?this.listenProvider_.stopListening(r.queryForListening_(e),null):d.forEach(function(ve){var rt=o.queryToTagMap.get(r.makeQueryKey_(ve));o.listenProvider_.stopListening(r.queryForListening_(ve),rt)})),this.removeTags_(d)}return c},r.prototype.calcCompleteEventCache=function(e,t){var o=this.pendingWriteTree_,s=this.syncPointTree_.findOnPath(e,function(u,c){var f=I.relativePath(u,e),d=c.getCompleteServerCache(f);if(d)return d});return o.calcCompleteEventCache(e,s,t,!0)},r.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(t,i,o){if(i&&i.hasCompleteView())return[i.getCompleteView()];var u=[];return i&&(u=i.getQueryViews()),z(o,function(c,f){u=u.concat(f)}),u})},r.prototype.removeTags_=function(e){for(var t=0;t<e.length;++t){var i=e[t];if(!i.getQueryParams().loadsAllData()){var o=r.makeQueryKey_(i),s=this.queryToTagMap.get(o);this.queryToTagMap.delete(o),this.tagToQueryMap.delete(s)}}},r.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},r.prototype.setupListener_=function(e,t){var i=e.path,o=this.tagForQuery_(e),s=this.createListenerForView_(t),u=this.listenProvider_.startListening(r.queryForListening_(e),o,s.hashFn,s.onComplete),c=this.syncPointTree_.subtree(i);if(o)m.assert(!c.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var f=c.fold(function(g,E,T){if(!g.isEmpty()&&E&&E.hasCompleteView())return[E.getCompleteView().getQuery()];var N=[];return E&&(N=N.concat(E.getQueryViews().map(function(R){return R.getQuery()}))),z(T,function(R,W){N=N.concat(W)}),N}),d=0;d<f.length;++d){var y=f[d];this.listenProvider_.stopListening(r.queryForListening_(y),this.tagForQuery_(y))}return u},r.prototype.createListenerForView_=function(e){var t=this,i=e.getQuery(),o=this.tagForQuery_(i);return{hashFn:function(){return(e.getServerCache()||P.EMPTY_NODE).hash()},onComplete:function(s){if("ok"===s)return o?t.applyTaggedListenComplete(i.path,o):t.applyListenComplete(i.path);var u=function(r,e){var t="Unknown Error";"too_big"===r?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===r?t="Client doesn't have permission to access the desired data.":"unavailable"===r&&(t="The service is unavailable");var i=new Error(r+" at "+e.path.toString()+": "+t);return i.code=r.toUpperCase(),i}(s,i);return t.removeEventRegistration(i,null,u)}}},r.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},r.parseQueryKey_=function(e){var t=e.indexOf("$");return m.assert(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new I(e.substr(0,t))}},r.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},r.prototype.tagForQuery_=function(e){var t=r.makeQueryKey_(e);return this.queryToTagMap.get(t)},r.getNextQueryTag_=function(){return r.nextQueryTag_++},r.prototype.applyTaggedOperation_=function(e,t){var i=this.syncPointTree_.get(e);m.assert(i,"Missing sync point for query tag that we're tracking");var o=this.pendingWriteTree_.childWrites(e);return i.applyOperation(t,o,null)},r.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(I.Empty))},r.prototype.applyOperationHelper_=function(e,t,i,o){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,i,o);var s=t.get(I.Empty);null==i&&null!=s&&(i=s.getCompleteServerCache(I.Empty));var u=[],c=e.path.getFront(),f=e.operationForChild(c),d=t.children.get(c);if(d&&f){var y=i?i.getImmediateChild(c):null,g=o.child(c);u=u.concat(this.applyOperationHelper_(f,d,y,g))}return s&&(u=u.concat(s.applyOperation(e,o,i))),u},r.prototype.applyOperationDescendantsHelper_=function(e,t,i,o){var s=this,u=t.get(I.Empty);null==i&&null!=u&&(i=u.getCompleteServerCache(I.Empty));var c=[];return t.children.inorderTraversal(function(f,d){var y=i?i.getImmediateChild(f):null,g=o.child(f),E=e.operationForChild(f);E&&(c=c.concat(s.applyOperationDescendantsHelper_(E,d,y,g)))}),u&&(c=c.concat(u.applyOperation(e,o,i))),c},r.nextQueryTag_=1,r}(),dn=function(){function r(){this.rootNode_=P.EMPTY_NODE}return r.prototype.getNode=function(e){return this.rootNode_.getChild(e)},r.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},r}(),Qt=function(){function r(){this.counters_={}}return r.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),m.contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},r.prototype.get=function(){return m.deepCopy(this.counters_)},r}(),yt=function(){function r(){}return r.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new Qt),this.collections_[t]},r.getOrCreateReporter=function(e,t){var i=e.toString();return this.reporters_[i]||(this.reporters_[i]=t()),this.reporters_[i]},r.collections_={},r.reporters_={},r}(),mn=function(){function r(e){this.collection_=e,this.last_=null}return r.prototype.get=function(){var e=this.collection_.get(),t=M.__assign({},e);return this.last_&&z(this.last_,function(i,o){t[i]=t[i]-o}),this.last_=e,t},r}(),sr=function(){function r(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new mn(e);var i=1e4+2e4*Math.random();Ye(this.reportStats_.bind(this),Math.floor(i))}return r.prototype.includeStat=function(e){this.statsToReport_[e]=!0},r.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),i={},o=!1;z(t,function(s,u){u>0&&m.contains(e.statsToReport_,s)&&(i[s]=u,o=!0)}),o&&this.server_.reportStats(i),Ye(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},r}(),ar=function(){function r(){this.eventLists_=[],this.recursionDepth_=0}return r.prototype.queueEvents=function(e){for(var t=null,i=0;i<e.length;i++){var o=e[i],s=o.getPath();null!==t&&!s.equals(t.getPath())&&(this.eventLists_.push(t),t=null),null===t&&(t=new lr(s)),t.add(o)}t&&this.eventLists_.push(t)},r.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(i){return i.equals(e)})},r.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(i){return i.contains(e)||e.contains(i)})},r.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,i=0;i<this.eventLists_.length;i++){var o=this.eventLists_[i];o&&(e(o.getPath())?(this.eventLists_[i].raise(),this.eventLists_[i]=null):t=!1)}t&&(this.eventLists_=[]),this.recursionDepth_--},r}(),lr=function(){function r(e){this.path_=e,this.events_=[]}return r.prototype.add=function(e){this.events_.push(e)},r.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var i=t.getEventRunner();Ee&&G("event: "+t.toString()),Fe(i)}}},r.prototype.getPath=function(){return this.path_},r}(),yn=function(){function r(e){this.allowedEvents_=e,this.listeners_={},m.assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return r.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(Array.isArray(this.listeners_[e]))for(var o=M.__spread(this.listeners_[e]),s=0;s<o.length;s++)o[s].callback.apply(o[s].context,t)},r.prototype.on=function(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});var o=this.getInitialEvent(e);o&&t.apply(i,o)},r.prototype.off=function(e,t,i){this.validateEventType_(e);for(var o=this.listeners_[e]||[],s=0;s<o.length;s++)if(o[s].callback===t&&(!i||i===o[s].context))return void o.splice(s,1)},r.prototype.validateEventType_=function(e){m.assert(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},r}(),ur=function(r){function e(){var i,o,t=r.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(o="visibilitychange",i="hidden"):void 0!==document.mozHidden?(o="mozvisibilitychange",i="mozHidden"):void 0!==document.msHidden?(o="msvisibilitychange",i="msHidden"):void 0!==document.webkitHidden&&(o="webkitvisibilitychange",i="webkitHidden")),t.visible_=!0,o&&document.addEventListener(o,function(){var s=!document[i];s!==t.visible_&&(t.visible_=s,t.trigger("visible",s))},!1),t}return M.__extends(e,r),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return m.assert("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(yn),vn=function(r){function e(){var t=r.call(this,["online"])||this;return t.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!m.isMobileCordova()&&(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return M.__extends(e,r),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return m.assert("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(yn),cr=function(){function r(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return r.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},r.prototype.handleResponse=function(e,t){var i=this;this.pendingResponses[e]=t;for(var o=function(){var c=s.pendingResponses[s.currentResponseNum];delete s.pendingResponses[s.currentResponseNum];for(var f=function(y){c[y]&&Fe(function(){i.onMessage_(c[y])})},d=0;d<c.length;++d)f(d);if(s.currentResponseNum===s.closeAfterResponse)return s.onClose&&(s.onClose(),s.onClose=null),"break";s.currentResponseNum++},s=this;this.pendingResponses[this.currentResponseNum]&&"break"!==o(););},r}(),Sn=function(){function r(e,t,i,o,s){this.connId=e,this.repoInfo=t,this.applicationId=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=xe(e),this.stats_=yt.getCollection(t),this.urlFn=function(u){return t.connectionURL(Le,u)}}return r.prototype.open=function(e,t){var i=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new cr(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){i.log_("Timed out trying to connect."),i.onClosed_(),i.connectTimeoutTimer_=null},Math.floor(3e4)),function(r){if(m.isNodeSdk()||"complete"===document.readyState)r();else{var e=!1,t=function(){document.body?e||(e=!0,r()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(function(){if(!i.isClosed_){i.scriptTagHolder=new Cr(function(){for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var f=M.__read(u,5),d=f[0],y=f[1],g=f[2];if(i.incrementIncomingBytes_(u),i.scriptTagHolder)if(i.connectTimeoutTimer_&&(clearTimeout(i.connectTimeoutTimer_),i.connectTimeoutTimer_=null),i.everConnected_=!0,"start"===d)i.id=y,i.password=g;else{if("close"!==d)throw new Error("Unrecognized command received: "+d);y?(i.scriptTagHolder.sendNewPolls=!1,i.myPacketOrderer.closeAfter(y,function(){i.onClosed_()})):i.onClosed_()}},function(){for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];var f=M.__read(u,2),d=f[0],y=f[1];i.incrementIncomingBytes_(u),i.myPacketOrderer.handleResponse(d,y)},function(){i.onClosed_()},i.urlFn);var o={start:"t"};o.ser=Math.floor(1e8*Math.random()),i.scriptTagHolder.uniqueCallbackIdentifier&&(o.cb=i.scriptTagHolder.uniqueCallbackIdentifier),o.v="5",i.transportSessionId&&(o.s=i.transportSessionId),i.lastSessionId&&(o.ls=i.lastSessionId),i.applicationId&&(o.p=i.applicationId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(wt)&&(o.r="f");var s=i.urlFn(o);i.log_("Connecting via long-poll to "+s),i.scriptTagHolder.addTag(s,function(){})}})},r.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},r.forceAllow=function(){r.forceAllow_=!0},r.forceDisallow=function(){r.forceDisallow_=!0},r.isAvailable=function(){return!(m.isNodeSdk()||!r.forceAllow_&&(r.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},r.prototype.markConnectionHealthy=function(){},r.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},r.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},r.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},r.prototype.send=function(e){var t=m.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var i=m.base64Encode(t),o=O(i,1840),s=0;s<o.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,o.length,o[s]),this.curSegmentNum++},r.prototype.addDisconnectPingFrame=function(e,t){if(!m.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var i={dframe:"t"};i.id=e,i.pw=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},r.prototype.incrementIncomingBytes_=function(e){var t=m.stringify(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},r}(),Cr=function(){function r(e,t,i,o){if(this.onDisconnect=i,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,m.isNodeSdk())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=ze(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=r.createIFrame_();var s="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(s='<script>document.domain="'+document.domain+'";<\/script>');var c="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(f){G("frame writing exception"),f.stack&&G(f.stack),G(f)}}}return r.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||G("No IE domain setting required")}catch(o){var i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},r.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},r.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},r.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),i="",o=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){var u=this.pendingSegs.shift();i=i+"&seg"+o+"="+u.seg+"&ts"+o+"="+u.ts+"&d"+o+"="+u.d,o++}return this.addLongPollTag_(t+=i,this.currentSerial),!0}return!1},r.prototype.enqueueSegment=function(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()},r.prototype.addLongPollTag_=function(e,t){var i=this;this.outstandingRequests.add(t);var o=function(){i.outstandingRequests.delete(t),i.newRequest_()},s=setTimeout(o,Math.floor(25e3));this.addTag(e,function(){clearTimeout(s),o()})},r.prototype.addTag=function(e,t){var i=this;m.isNodeSdk()?this.doNodeLongPoll(e,t):setTimeout(function(){try{if(!i.sendNewPolls)return;var o=i.myIFrame.doc.createElement("script");o.type="text/javascript",o.async=!0,o.src=e,o.onload=o.onreadystatechange=function(){var s=o.readyState;(!s||"loaded"===s||"complete"===s)&&(o.onload=o.onreadystatechange=null,o.parentNode&&o.parentNode.removeChild(o),t())},o.onerror=function(){G("Long-poll script failed to load: "+e),i.sendNewPolls=!1,i.close()},i.myIFrame.doc.body.appendChild(o)}catch(s){}},Math.floor(1))},r}(),Wt="",p=null;"undefined"!=typeof MozWebSocket?p=MozWebSocket:"undefined"!=typeof WebSocket&&(p=WebSocket);var l=function(){function r(e,t,i,o,s){this.connId=e,this.applicationId=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=xe(this.connId),this.stats_=yt.getCollection(t),this.connURL=r.connectionURL_(t,o,s),this.nodeAdmin=t.nodeAdmin}return r.connectionURL_=function(e,t,i){var o={v:"5"};return!m.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(wt)&&(o.r="f"),t&&(o.s=t),i&&(o.ls=i),e.connectionURL(Fn,o)},r.prototype.open=function(e,t){var i=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,me.set("previous_websocket_failure",!0);try{if(m.isNodeSdk()){var s={headers:{"User-Agent":"Firebase/5/"+Wt+"/"+process.platform+"/"+(this.nodeAdmin?"AdminNode":"Node"),"X-Firebase-GMPID":this.applicationId||""}},u=process.env,c=0===this.connURL.indexOf("wss://")?u.HTTPS_PROXY||u.https_proxy:u.HTTP_PROXY||u.http_proxy;c&&(s.proxy={origin:c}),this.mySock=new p(this.connURL,[],s)}else this.mySock=new p(this.connURL,[],s={headers:{"X-Firebase-GMPID":this.applicationId||""}})}catch(d){this.log_("Error instantiating WebSocket.");var f=d.message||d.data;return f&&this.log_(f),void this.onClosed_()}this.mySock.onopen=function(){i.log_("Websocket connected."),i.everConnected_=!0},this.mySock.onclose=function(){i.log_("Websocket connection was disconnected."),i.mySock=null,i.onClosed_()},this.mySock.onmessage=function(d){i.handleIncomingFrame(d)},this.mySock.onerror=function(d){i.log_("WebSocket error.  Closing connection.");var y=d.message||d.data;y&&i.log_(y),i.onClosed_()}},r.prototype.start=function(){},r.forceDisallow=function(){r.forceDisallow_=!0},r.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var i=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&null!==p&&!r.forceDisallow_},r.previouslyFailed=function(){return me.isInMemoryStorage||!0===me.get("previous_websocket_failure")},r.prototype.markConnectionHealthy=function(){me.remove("previous_websocket_failure")},r.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var i=m.jsonEval(t);this.onMessage(i)}},r.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},r.prototype.extractFrameCount_=function(e){if(m.assert(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},r.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var i=this.extractFrameCount_(t);null!==i&&this.appendFrame_(i)}}},r.prototype.send=function(e){this.resetKeepAlive();var t=m.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var i=O(t,16384);i.length>1&&this.sendString_(String(i.length));for(var o=0;o<i.length;o++)this.sendString_(i[o])},r.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},r.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},r.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},r.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(45e3))},r.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},r.responsesRequiredToBeHealthy=2,r.healthyTimeout=3e4,r}(),h=function(){function r(e){this.initTransports_(e)}return Object.defineProperty(r,"ALL_TRANSPORTS",{get:function(){return[Sn,l]},enumerable:!1,configurable:!0}),r.prototype.initTransports_=function(e){var t,i,o=l&&l.isAvailable(),s=o&&!l.previouslyFailed();if(e.webSocketOnly&&(o||K("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[l];else{var u=this.transports_=[];try{for(var c=M.__values(r.ALL_TRANSPORTS),f=c.next();!f.done;f=c.next()){var d=f.value;d&&d.isAvailable()&&u.push(d)}}catch(y){t={error:y}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(t)throw t.error}}}},r.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},r.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},r}(),Mr=function(){function r(e,t,i,o,s,u,c,f){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=xe("c:"+this.id+":"),this.transportManager_=new h(t),this.log_("Connection created"),this.start_()}return r.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var i=this.connReceiver_(this.conn_),o=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(i,o)},Math.floor(0));var s=t.healthyTimeout||0;s>0&&(this.healthyTimeout_=Ye(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(s)))},r.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},r.prototype.disconnReceiver_=function(e){var t=this;return function(i){e===t.conn_?t.onConnectionLost_(i):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},r.prototype.connReceiver_=function(e){var t=this;return function(i){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(i):e===t.secondaryConn_?t.onSecondaryMessageReceived_(i):t.log_("message on old connection"))}},r.prototype.sendRequest=function(e){this.sendData_({t:"d",d:e})},r.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},r.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},r.prototype.onSecondaryMessageReceived_=function(e){var t=j("t",e),i=j("d",e);if("c"===t)this.onSecondaryControl_(i);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(i)}},r.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},r.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},r.prototype.onPrimaryMessageReceived_=function(e){var t=j("t",e),i=j("d",e);"c"===t?this.onControl_(i):"d"===t&&this.onDataMessage_(i)},r.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},r.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},r.prototype.onControl_=function(e){var t=j("t",e);if("d"in e){var i=e.d;if("h"===t)this.onHandshake_(i);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var o=0;o<this.pendingDataMessages.length;++o)this.onDataMessage_(this.pendingDataMessages[o]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(i):"r"===t?this.onReset_(i):"e"===t?Ve("Server Error: "+i):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ve("Unknown control packet command: "+t)}},r.prototype.onHandshake_=function(e){var t=e.ts,i=e.v,o=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(o),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==i&&K("Protocol version mismatch detected"),this.tryStartUpgrade_())},r.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},r.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var i=this.connReceiver_(this.secondaryConn_),o=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(i,o),Ye(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(6e4))},r.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},r.prototype.onConnectionEstablished_=function(e,t){var i=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ye(function(){i.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},r.prototype.sendPingOnPrimaryIfNecessary_=function(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},r.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()},r.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(me.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},r.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},r.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},r.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},r.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},r}(),Ur=function(){function r(){}return r.prototype.put=function(e,t,i,o){},r.prototype.merge=function(e,t,i,o){},r.prototype.refreshAuthToken=function(e){},r.prototype.onDisconnectPut=function(e,t,i){},r.prototype.onDisconnectMerge=function(e,t,i){},r.prototype.onDisconnectCancel=function(e,t){},r.prototype.reportStats=function(e){},r}(),zt=1e3,nt=function(r){function e(t,i,o,s,u,c,f){var d=r.call(this)||this;if(d.repoInfo_=t,d.applicationId_=i,d.onDataUpdate_=o,d.onConnectStatus_=s,d.onServerInfoUpdate_=u,d.authTokenProvider_=c,d.authOverride_=f,d.id=e.nextPersistentConnectionId_++,d.log_=xe("p:"+d.id+":"),d.interruptReasons_={},d.listens=new Map,d.outstandingPuts_=[],d.outstandingPutCount_=0,d.onDisconnectRequestQueue_=[],d.connected_=!1,d.reconnectDelay_=zt,d.maxReconnectDelay_=3e5,d.securityDebugCallback_=null,d.lastSessionId=null,d.establishConnectionTimer_=null,d.visible_=!1,d.requestCBHash_={},d.requestNumber_=0,d.realtime_=null,d.authToken_=null,d.forceTokenRefresh_=!1,d.invalidAuthTokenCount_=0,d.firstConnection_=!0,d.lastConnectionAttemptTime_=null,d.lastConnectionEstablishedTime_=null,f&&!m.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return d.scheduleConnect_(0),ur.getInstance().on("visible",d.onVisible_,d),-1===t.host.indexOf("fblocal")&&vn.getInstance().on("online",d.onOnline_,d),d}return M.__extends(e,r),e.prototype.sendRequest=function(t,i,o){var s=++this.requestNumber_,u={r:s,a:t,b:i};this.log_(m.stringify(u)),m.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(u),o&&(this.requestCBHash_[s]=o)},e.prototype.listen=function(t,i,o,s){var u=t.queryIdentifier(),c=t.path.toString();this.log_("Listen called for "+c+" "+u),this.listens.has(c)||this.listens.set(c,new Map),m.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),m.assert(!this.listens.get(c).has(u),"listen() called twice for same path/queryId.");var f={onComplete:s,hashFn:i,query:t,tag:o};this.listens.get(c).set(u,f),this.connected_&&this.sendListen_(f)},e.prototype.sendListen_=function(t){var i=this,o=t.query,s=o.path.toString(),u=o.queryIdentifier();this.log_("Listen on "+s+" for "+u);var c={p:s};t.tag&&(c.q=o.queryObject(),c.t=t.tag),c.h=t.hashFn(),this.sendRequest("q",c,function(d){var y=d.d,g=d.s;e.warnOnListenWarnings_(y,o),(i.listens.get(s)&&i.listens.get(s).get(u))===t&&(i.log_("listen response",d),"ok"!==g&&i.removeListen_(s,u),t.onComplete&&t.onComplete(g,y))})},e.warnOnListenWarnings_=function(t,i){if(t&&"object"==typeof t&&m.contains(t,"w")){var o=m.safeGet(t,"w");if(Array.isArray(o)&&~o.indexOf("no_index")){var s='".indexOn": "'+i.getQueryParams().getIndex().toString()+'"',u=i.path.toString();K("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+s+" at "+u+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||m.isAdmin(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var i=this.authToken_,o=m.isValidFormat(i)?"auth":"gauth",s={cred:i};null===this.authOverride_?s.noauth=!0:"object"==typeof this.authOverride_&&(s.authvar=this.authOverride_),this.sendRequest(o,s,function(u){var c=u.s,f=u.d||"error";t.authToken_===i&&("ok"===c?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(c,f))})}},e.prototype.unlisten=function(t,i){var o=t.path.toString(),s=t.queryIdentifier();this.log_("Unlisten called for "+o+" "+s),m.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,s)&&this.connected_&&this.sendUnlisten_(o,s,t.queryObject(),i)},e.prototype.sendUnlisten_=function(t,i,o,s){this.log_("Unlisten on "+t+" for "+i);var u={p:t};s&&(u.q=o,u.t=s),this.sendRequest("n",u)},e.prototype.onDisconnectPut=function(t,i,o){this.connected_?this.sendOnDisconnect_("o",t,i,o):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:o})},e.prototype.onDisconnectMerge=function(t,i,o){this.connected_?this.sendOnDisconnect_("om",t,i,o):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:o})},e.prototype.onDisconnectCancel=function(t,i){this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})},e.prototype.sendOnDisconnect_=function(t,i,o,s){var u={p:i,d:o};this.log_("onDisconnect "+t,u),this.sendRequest(t,u,function(c){s&&setTimeout(function(){s(c.s,c.d)},Math.floor(0))})},e.prototype.put=function(t,i,o,s){this.putInternal("p",t,i,o,s)},e.prototype.merge=function(t,i,o,s){this.putInternal("m",t,i,o,s)},e.prototype.putInternal=function(t,i,o,s,u){var c={p:i,d:o};void 0!==u&&(c.h=u),this.outstandingPuts_.push({action:t,request:c,onComplete:s}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)},e.prototype.sendPut_=function(t){var i=this,o=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,u=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(o,s,function(c){i.log_(o+" response",c),delete i.outstandingPuts_[t],i.outstandingPutCount_--,0===i.outstandingPutCount_&&(i.outstandingPuts_=[]),u&&u(c.s,c.d)})},e.prototype.reportStats=function(t){var i=this;if(this.connected_){var o={c:t};this.log_("reportStats",o),this.sendRequest("s",o,function(s){"ok"!==s.s&&i.log_("reportStats","Error sending stats: "+s.d)})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+m.stringify(t));var i=t.r,o=this.requestCBHash_[i];o&&(delete this.requestCBHash_[i],o(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,i){this.log_("handleServerMessage",t,i),"d"===t?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===t?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===t?this.onListenRevoked_(i.p,i.q):"ac"===t?this.onAuthRevoked_(i.s,i.d):"sd"===t?this.onSecurityDebugPacket_(i):Ve("Unrecognized action received from server: "+m.stringify(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var i=this;m.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){i.establishConnectionTimer_=null,i.establishConnection_()},Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=zt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=zt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=zt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var i=(new Date).getTime()-this.lastConnectionAttemptTime_,o=Math.max(0,this.reconnectDelay_-i);o=Math.random()*o,this.log_("Trying to reconnect in "+o+"ms"),this.scheduleConnect_(o),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){var t=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var i=this.onDataMessage_.bind(this),o=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),u=this.id+":"+e.nextConnectionId_++,c=this,f=this.lastSessionId,d=!1,y=null,g=function(){y?y.close():(d=!0,s())};this.realtime_={close:g,sendRequest:function(N){m.assert(y,"sendRequest call when we're not connected not allowed."),y.sendRequest(N)}};var T=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(T).then(function(N){d?G("getToken() completed but was canceled"):(G("getToken() completed. Creating connection."),c.authToken_=N&&N.accessToken,y=new Mr(u,c.repoInfo_,c.applicationId_,i,o,s,function(R){K(R+" ("+c.repoInfo_.toString()+")"),c.interrupt("server_kill")},f))}).then(null,function(N){c.log_("Failed to get token: "+N),d||(t.repoInfo_.nodeAdmin&&K(N),g())})}},e.prototype.interrupt=function(t){G("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){G("Resuming connection for reason: "+t),delete this.interruptReasons_[t],m.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=zt,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var i=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,i){var o;o=i?i.map(function(u){return re(u)}).join("$"):"default";var s=this.removeListen_(t,o);s&&s.onComplete&&s.onComplete("permission_denied")},e.prototype.removeListen_=function(t,i){var s,o=new I(t).toString();if(this.listens.has(o)){var u=this.listens.get(o);s=u.get(i),u.delete(i),0===u.size&&this.listens.delete(o)}else s=void 0;return s},e.prototype.onAuthRevoked_=function(t,i){G("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,i,o,s;this.tryAuth();try{for(var u=M.__values(this.listens.values()),c=u.next();!c.done;c=u.next()){var f=c.value;try{for(var d=(o=void 0,M.__values(f.values())),y=d.next();!y.done;y=d.next())this.sendListen_(y.value)}catch(N){o={error:N}}finally{try{y&&!y.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}}}catch(N){t={error:N}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(t)throw t.error}}for(var E=0;E<this.outstandingPuts_.length;E++)this.outstandingPuts_[E]&&this.sendPut_(E);for(;this.onDisconnectRequestQueue_.length;){var T=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(T.action,T.pathString,T.data,T.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},i="js";m.isNodeSdk()&&(i=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+i+"."+Wt.replace(/\./g,"-")]=1,m.isMobileCordova()?t["framework.cordova"]=1:m.isReactNative()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=vn.getInstance().currentlyOnline();return m.isEmpty(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(Ur),Kr=function(r){function e(t,i,o){var s=r.call(this)||this;return s.repoInfo_=t,s.onDataUpdate_=i,s.authTokenProvider_=o,s.log_=xe("p:rest:"),s.listens_={},s}return M.__extends(e,r),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,i){return void 0!==i?"tag$"+i:(m.assert(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,i,o,s){var u=this,c=t.path.toString();this.log_("Listen called for "+c+" "+t.queryIdentifier());var f=e.getListenId_(t,o),d={};this.listens_[f]=d;var y=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(c+".json",y,function(g,E){var T=E;404===g&&(T=null,g=null),null===g&&u.onDataUpdate_(c,T,!1,o),m.safeGet(u.listens_,f)===d&&s(g?401===g?"permission_denied":"rest_error:"+g:"ok",null)})},e.prototype.unlisten=function(t,i){var o=e.getListenId_(t,i);delete this.listens_[o]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,i,o){var s=this;void 0===i&&(i={}),i.format="export",this.authTokenProvider_.getToken(!1).then(function(u){var c=u&&u.accessToken;c&&(i.auth=c);var f=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+t+"?ns="+s.repoInfo_.namespace+m.querystring(i);s.log_("Sending REST request for "+f);var d=new XMLHttpRequest;d.onreadystatechange=function(){if(o&&4===d.readyState){s.log_("REST Response for "+f+" received. status:",d.status,"response:",d.responseText);var y=null;if(d.status>=200&&d.status<300){try{y=m.jsonEval(d.responseText)}catch(g){K("Failed to parse JSON response for "+f+": "+d.responseText)}o(null,y)}else 401!==d.status&&404!==d.status&&K("Got unsuccessful REST response for "+f+" Status: "+d.status),o(d.status);o=null}},d.open("GET",f,!0),d.send()})},e}(Ur),Qr="repo_interrupt",ne=function(){function r(e,t,i,o){var s=this;if(this.repoInfo_=e,this.app=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ar,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Dt,this.persistentConnection_=null,this.stats_=yt.getCollection(e),t||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new Kr(this.repoInfo_,this.onDataUpdate_.bind(this),o),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var u=i.options.databaseAuthVariableOverride;if(null!=u){if("object"!=typeof u)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{m.stringify(u)}catch(c){throw new Error("Invalid authOverride provided: "+c)}}this.persistentConnection_=new nt(this.repoInfo_,i.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),o,u),this.server_=this.persistentConnection_}o.addTokenChangeListener(function(c){s.server_.refreshAuthToken(c)}),this.statsReporter_=yt.getOrCreateReporter(e,function(){return new sr(s.stats_,s.server_)}),this.transactionsInit_(),this.infoData_=new dn,this.infoSyncTree_=new fn({startListening:function(c,f,d,y){var g=[],E=s.infoData_.getNode(c.path);return E.isEmpty()||(g=s.infoSyncTree_.applyServerOverwrite(c.path,E),setTimeout(function(){y("ok")},0)),g},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new fn({startListening:function(c,f,d,y){return s.server_.listen(c,d,f,function(g,E){var T=y(g,E);s.eventQueue_.raiseEventsForChangedPath(c.path,T)}),[]},stopListening:function(c,f){s.server_.unlisten(c,f)}})}return r.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},r.prototype.name=function(){return this.repoInfo_.namespace},r.prototype.serverTime=function(){var t=this.infoData_.getNode(new I(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},r.prototype.generateServerValues=function(){return function(r){return(r=r||{}).timestamp=r.timestamp||(new Date).getTime(),r}({timestamp:this.serverTime()})},r.prototype.onDataUpdate_=function(e,t,i,o){this.dataUpdateCount++;var s=new I(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var u=[];if(o)if(i){var c=m.map(t,function(E){return J(E)});u=this.serverSyncTree_.applyTaggedQueryMerge(s,c,o)}else{var f=J(t);u=this.serverSyncTree_.applyTaggedQueryOverwrite(s,f,o)}else if(i){var d=m.map(t,function(E){return J(E)});u=this.serverSyncTree_.applyServerMerge(s,d)}else{var y=J(t);u=this.serverSyncTree_.applyServerOverwrite(s,y)}var g=s;u.length>0&&(g=this.rerunTransactions_(s)),this.eventQueue_.raiseEventsForChangedPath(g,u)},r.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},r.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},r.prototype.onServerInfoUpdate_=function(e){var t=this;z(e,function(i,o){t.updateInfo_(i,o)})},r.prototype.updateInfo_=function(e,t){var i=new I("/.info/"+e),o=J(t);this.infoData_.updateSnapshot(i,o);var s=this.infoSyncTree_.applyServerOverwrite(i,o);this.eventQueue_.raiseEventsForChangedPath(i,s)},r.prototype.getNextWriteId_=function(){return this.nextWriteId_++},r.prototype.setWithPriority=function(e,t,i,o){var s=this;this.log_("set",{path:e.toString(),value:t,priority:i});var u=this.generateServerValues(),c=J(t,i),f=this.serverSyncTree_.calcCompleteEventCache(e),d=kt(c,f,u),y=this.getNextWriteId_(),g=this.serverSyncTree_.applyUserOverwrite(e,d,y,!0);this.eventQueue_.queueEvents(g),this.server_.put(e.toString(),c.val(!0),function(T,N){var R="ok"===T;R||K("set at "+e+" failed: "+T);var W=s.serverSyncTree_.ackUserWrite(y,!R);s.eventQueue_.raiseEventsForChangedPath(e,W),s.callOnCompleteCallback(o,T,N)});var E=this.abortTransactions_(e);this.rerunTransactions_(E),this.eventQueue_.raiseEventsForChangedPath(E,[])},r.prototype.update=function(e,t,i){var o=this;this.log_("update",{path:e.toString(),value:t});var s=!0,u=this.generateServerValues(),c={};if(z(t,function(y,g){s=!1,c[y]=an(e.child(y),J(g),o.serverSyncTree_,u)}),s)G("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(i,"ok");else{var f=this.getNextWriteId_(),d=this.serverSyncTree_.applyUserMerge(e,c,f);this.eventQueue_.queueEvents(d),this.server_.merge(e.toString(),t,function(y,g){var E="ok"===y;E||K("update at "+e+" failed: "+y);var T=o.serverSyncTree_.ackUserWrite(f,!E),N=T.length>0?o.rerunTransactions_(e):e;o.eventQueue_.raiseEventsForChangedPath(N,T),o.callOnCompleteCallback(i,y,g)}),z(t,function(y){var g=o.abortTransactions_(e.child(y));o.rerunTransactions_(g)}),this.eventQueue_.raiseEventsForChangedPath(e,[])}},r.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),i=new Dt;this.onDisconnect_.forEachTree(I.Empty,function(s,u){var c=an(s,u,e.serverSyncTree_,t);i.remember(s,c)});var o=[];i.forEachTree(I.Empty,function(s,u){o=o.concat(e.serverSyncTree_.applyServerOverwrite(s,u));var c=e.abortTransactions_(s);e.rerunTransactions_(c)}),this.onDisconnect_=new Dt,this.eventQueue_.raiseEventsForChangedPath(I.Empty,o)},r.prototype.onDisconnectCancel=function(e,t){var i=this;this.server_.onDisconnectCancel(e.toString(),function(o,s){"ok"===o&&i.onDisconnect_.forget(e),i.callOnCompleteCallback(t,o,s)})},r.prototype.onDisconnectSet=function(e,t,i){var o=this,s=J(t);this.server_.onDisconnectPut(e.toString(),s.val(!0),function(u,c){"ok"===u&&o.onDisconnect_.remember(e,s),o.callOnCompleteCallback(i,u,c)})},r.prototype.onDisconnectSetWithPriority=function(e,t,i,o){var s=this,u=J(t,i);this.server_.onDisconnectPut(e.toString(),u.val(!0),function(c,f){"ok"===c&&s.onDisconnect_.remember(e,u),s.callOnCompleteCallback(o,c,f)})},r.prototype.onDisconnectUpdate=function(e,t,i){var o=this;if(m.isEmpty(t))return G("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(e.toString(),t,function(s,u){"ok"===s&&z(t,function(c,f){var d=J(f);o.onDisconnect_.remember(e.child(c),d)}),o.callOnCompleteCallback(i,s,u)})},r.prototype.addEventCallbackForQuery=function(e,t){var i;i=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,i)},r.prototype.removeEventCallbackForQuery=function(e,t){var i;i=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,i)},r.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Qr)},r.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Qr)},r.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new mn(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var i=Object.keys(t).reduce(function(o,s){return Math.max(s.length,o)},0);z(t,function(o,s){for(var u=o,c=o.length;c<i+2;c++)u+=" ";console.log(u+s)})}},r.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},r.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i="";this.persistentConnection_&&(i=this.persistentConnection_.id+":"),G.apply(void 0,M.__spread([i],e))},r.prototype.callOnCompleteCallback=function(e,t,i){e&&Fe(function(){if("ok"===t)e(null);else{var o=(t||"error").toUpperCase(),s=o;i&&(s+=": "+i);var u=new Error(s);u.code=o,e(u)}})},Object.defineProperty(r.prototype,"database",{get:function(){return this.__database||(this.__database=new In(this))},enumerable:!1,configurable:!0}),r}(),Wr=function(){function r(e){this.indexedFilter_=new Mt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=r.getStartPost_(e),this.endPost_=r.getEndPost_(e)}return r.prototype.getStartPost=function(){return this.startPost_},r.prototype.getEndPost=function(){return this.endPost_},r.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},r.prototype.updateChild=function(e,t,i,o,s,u){return this.matches(new U(t,i))||(i=P.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,o,s,u)},r.prototype.updateFullNode=function(e,t,i){t.isLeafNode()&&(t=P.EMPTY_NODE);var o=t.withIndex(this.index_);o=o.updatePriority(P.EMPTY_NODE);var s=this;return t.forEachChild(V,function(u,c){s.matches(new U(u,c))||(o=o.updateImmediateChild(u,P.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,o,i)},r.prototype.updatePriority=function(e,t){return e},r.prototype.filtersNodes=function(){return!0},r.prototype.getIndexedFilter=function(){return this.indexedFilter_},r.prototype.getIndex=function(){return this.index_},r.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},r.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},r}(),Xr=function(){function r(e){this.rangedFilter_=new Wr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return r.prototype.updateChild=function(e,t,i,o,s,u){return this.rangedFilter_.matches(new U(t,i))||(i=P.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,o,s,u):this.fullLimitUpdateChild_(e,t,i,s,u)},r.prototype.updateFullNode=function(e,t,i){var o;if(t.isLeafNode()||t.isEmpty())o=P.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){o=P.EMPTY_NODE.withIndex(this.index_);var s=void 0;s=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var u=0;s.hasNext()&&u<this.limit_;){var c=s.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),c)<=0:this.index_.compare(c,this.rangedFilter_.getEndPost())<=0))break;o=o.updateImmediateChild(c.name,c.node),u++}}else{o=(o=t.withIndex(this.index_)).updatePriority(P.EMPTY_NODE);var d=void 0,y=void 0,g=void 0;if(s=void 0,this.reverse_){s=o.getReverseIterator(this.index_),d=this.rangedFilter_.getEndPost(),y=this.rangedFilter_.getStartPost();var E=this.index_.getCompare();g=function(W,B){return E(B,W)}}else s=o.getIterator(this.index_),d=this.rangedFilter_.getStartPost(),y=this.rangedFilter_.getEndPost(),g=this.index_.getCompare();u=0;for(var T=!1;s.hasNext();)c=s.getNext(),!T&&g(d,c)<=0&&(T=!0),T&&u<this.limit_&&g(c,y)<=0?u++:o=o.updateImmediateChild(c.name,P.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,o,i)},r.prototype.updatePriority=function(e,t){return e},r.prototype.filtersNodes=function(){return!0},r.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},r.prototype.getIndex=function(){return this.index_},r.prototype.fullLimitUpdateChild_=function(e,t,i,o,s){var u;if(this.reverse_){var c=this.index_.getCompare();u=function(ce,ve){return c(ve,ce)}}else u=this.index_.getCompare();var f=e;m.assert(f.numChildren()===this.limit_,"");var d=new U(t,i),y=this.reverse_?f.getFirstChild(this.index_):f.getLastChild(this.index_),g=this.rangedFilter_.matches(d);if(f.hasChild(t)){for(var E=f.getImmediateChild(t),T=o.getChildAfterChild(this.index_,y,this.reverse_);null!=T&&(T.name===t||f.hasChild(T.name));)T=o.getChildAfterChild(this.index_,T,this.reverse_);var N=null==T?1:u(T,d);if(g&&!i.isEmpty()&&N>=0)return null!=s&&s.trackChildChange(Q.childChangedChange(t,i,E)),f.updateImmediateChild(t,i);null!=s&&s.trackChildChange(Q.childRemovedChange(t,E));var W=f.updateImmediateChild(t,P.EMPTY_NODE);return null!=T&&this.rangedFilter_.matches(T)?(null!=s&&s.trackChildChange(Q.childAddedChange(T.name,T.node)),W.updateImmediateChild(T.name,T.node)):W}return i.isEmpty()?e:g&&u(y,d)>=0?(null!=s&&(s.trackChildChange(Q.childRemovedChange(y.name,y.node)),s.trackChildChange(Q.childAddedChange(t,i))),f.updateImmediateChild(t,i).updateImmediateChild(y.name,P.EMPTY_NODE)):e},r}(),ei=function(){function r(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=V}return r.prototype.hasStart=function(){return this.startSet_},r.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},r.prototype.getIndexStartValue=function(){return m.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},r.prototype.getIndexStartName=function(){return m.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Z},r.prototype.hasEnd=function(){return this.endSet_},r.prototype.getIndexEndValue=function(){return m.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},r.prototype.getIndexEndName=function(){return m.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:x},r.prototype.hasLimit=function(){return this.limitSet_},r.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},r.prototype.getLimit=function(){return m.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},r.prototype.getIndex=function(){return this.index_},r.prototype.copy_=function(){var e=new r;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},r.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},r.prototype.limitToFirst=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,t},r.prototype.limitToLast=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,t},r.prototype.startAt=function(e,t){var i=this.copy_();return i.startSet_=!0,void 0===e&&(e=null),i.indexStartValue_=e,null!=t?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i},r.prototype.endAt=function(e,t){var i=this.copy_();return i.endSet_=!0,void 0===e&&(e=null),i.indexEndValue_=e,void 0!==t?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i},r.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},r.prototype.getQueryObject=function(){var e=r.WIRE_PROTOCOL_CONSTANTS_,t={};if(this.startSet_&&(t[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(t[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(t[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(t[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){t[e.LIMIT]=this.limit_;var i=this.viewFrom_;""===i&&(i=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),t[e.VIEW_FROM]=i}return this.index_!==V&&(t[e.INDEX]=this.index_.toString()),t},r.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},r.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===V},r.prototype.getNodeFilter=function(){return this.loadsAllData()?new Mt(this.getIndex()):this.hasLimit()?new Xr(this):new Wr(this)},r.prototype.toRestQueryStringParameters=function(){var i,e=r.REST_QUERY_CONSTANTS_,t={};return this.isDefault()||(this.index_===V?i=e.PRIORITY_INDEX:this.index_===Rt?i=e.VALUE_INDEX:this.index_===Ie?i=e.KEY_INDEX:(m.assert(this.index_ instanceof xt,"Unrecognized index type!"),i=this.index_.toString()),t[e.ORDER_BY]=m.stringify(i),this.startSet_&&(t[e.START_AT]=m.stringify(this.indexStartValue_),this.startNameSet_&&(t[e.START_AT]+=","+m.stringify(this.indexStartName_))),this.endSet_&&(t[e.END_AT]=m.stringify(this.indexEndValue_),this.endNameSet_&&(t[e.END_AT]+=","+m.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?t[e.LIMIT_TO_FIRST]=this.limit_:t[e.LIMIT_TO_LAST]=this.limit_)),t},r.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},r.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},r.DEFAULT=new r,r}(),Ze=function(r){function e(t,i){if(!(t instanceof ne))throw new Error("new Reference() no longer supported - use app.database().");return r.call(this,t,i,ei.DEFAULT,!1)||this}return M.__extends(e,r),e.prototype.getKey=function(){return m.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return m.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof I||(null===this.path.getFront()?kr("Reference.child",1,t,!1):pt("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){m.validateArgCount("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){m.validateArgCount("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,i){m.validateArgCount("Reference.set",1,2,arguments.length),le("Reference.set",this.path),Se("Reference.set",1,t,this.path,!1),m.validateCallback("Reference.set",2,i,!0);var o=new m.Deferred;return this.repo.setWithPriority(this.path,t,null,o.wrapCallback(i)),o.promise},e.prototype.update=function(t,i){if(m.validateArgCount("Reference.update",1,2,arguments.length),le("Reference.update",this.path),Array.isArray(t)){for(var o={},s=0;s<t.length;++s)o[""+s]=t[s];t=o,K("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}kn("Reference.update",1,t,this.path,!1),m.validateCallback("Reference.update",2,i,!0);var u=new m.Deferred;return this.repo.update(this.path,t,u.wrapCallback(i)),u.promise},e.prototype.setWithPriority=function(t,i,o){if(m.validateArgCount("Reference.setWithPriority",2,3,arguments.length),le("Reference.setWithPriority",this.path),Se("Reference.setWithPriority",1,t,this.path,!1),Ue("Reference.setWithPriority",2,i,!1),m.validateCallback("Reference.setWithPriority",3,o,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var s=new m.Deferred;return this.repo.setWithPriority(this.path,t,i,s.wrapCallback(o)),s.promise},e.prototype.remove=function(t){return m.validateArgCount("Reference.remove",0,1,arguments.length),le("Reference.remove",this.path),m.validateCallback("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,i,o){if(m.validateArgCount("Reference.transaction",1,3,arguments.length),le("Reference.transaction",this.path),m.validateCallback("Reference.transaction",1,t,!1),m.validateCallback("Reference.transaction",2,i,!0),Pr("Reference.transaction",3,o,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===o&&(o=!0);var s=new m.Deferred;"function"==typeof i&&s.promise.catch(function(){});var u=function(c,f,d){c?s.reject(c):s.resolve(new Dr(f,d)),"function"==typeof i&&i(c,f,d)};return this.repo.startTransaction(this.path,t,u,o),s.promise},e.prototype.setPriority=function(t,i){m.validateArgCount("Reference.setPriority",1,2,arguments.length),le("Reference.setPriority",this.path),Ue("Reference.setPriority",1,t,!1),m.validateCallback("Reference.setPriority",2,i,!0);var o=new m.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),t,null,o.wrapCallback(i)),o.promise},e.prototype.push=function(t,i){m.validateArgCount("Reference.push",0,2,arguments.length),le("Reference.push",this.path),Se("Reference.push",1,t,this.path,!0),m.validateCallback("Reference.push",2,i,!0);var f,o=this.repo.serverTime(),s=L(o),u=this.child(s),c=this.child(s);return f=null!=t?u.set(t,i).then(function(){return c}):Promise.resolve(c),u.then=f.then.bind(f),u.catch=f.then.bind(f,void 0),"function"==typeof i&&f.catch(function(){}),u},e.prototype.onDisconnect=function(){return le("Reference.onDisconnect",this.path),new Dn(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),e}(mt);mt.__referenceConstructor=Ze,qt.__referenceConstructor=Ze;var zr=function(){this.children={},this.childCount=0,this.value=null},ti=function(){function r(e,t,i){void 0===e&&(e=""),void 0===t&&(t=null),void 0===i&&(i=new zr),this.name_=e,this.parent_=t,this.node_=i}return r.prototype.subTree=function(e){for(var t=e instanceof I?e:new I(e),i=this,o=t.getFront();null!==o;)i=new r(o,i,m.safeGet(i.node_.children,o)||new zr),o=(t=t.popFront()).getFront();return i},r.prototype.getValue=function(){return this.node_.value},r.prototype.setValue=function(e){m.assert(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},r.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},r.prototype.hasChildren=function(){return this.node_.childCount>0},r.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},r.prototype.forEachChild=function(e){var t=this;z(this.node_.children,function(i,o){e(new r(i,t,o))})},r.prototype.forEachDescendant=function(e,t,i){t&&!i&&e(this),this.forEachChild(function(o){o.forEachDescendant(e,!0,i)}),t&&i&&e(this)},r.prototype.forEachAncestor=function(e,t){for(var i=t?this:this.parent();null!==i;){if(e(i))return!0;i=i.parent()}return!1},r.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},r.prototype.path=function(){return new I(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},r.prototype.name=function(){return this.name_},r.prototype.parent=function(){return this.parent_},r.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},r.prototype.updateChild_=function(e,t){var i=t.isEmpty(),o=m.contains(this.node_.children,e);i&&o?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):!i&&!o&&(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},r}(),$=(()=>(function(r){r[r.RUN=0]="RUN",r[r.SENT=1]="SENT",r[r.COMPLETED=2]="COMPLETED",r[r.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",r[r.NEEDS_ABORT=4]="NEEDS_ABORT"}($||($={})),$))();ne.MAX_TRANSACTION_RETRIES_=25,ne.prototype.transactionsInit_=function(){this.transactionQueueTree_=new ti},ne.prototype.startTransaction=function(r,e,t,i){this.log_("transaction on "+r);var o=function(){},s=new Ze(this,r);s.on("value",o);var c={path:r,update:e,onComplete:t,status:null,order:ze(),applyLocally:i,retryCount:0,unwatcher:function(){s.off("value",o)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},f=this.getLatestState_(r);c.currentInputSnapshot=f;var d=c.update(f.val());if(void 0===d){if(c.unwatcher(),c.currentOutputSnapshotRaw=null,c.currentOutputSnapshotResolved=null,c.onComplete){var y=new De(c.currentInputSnapshot,new Ze(this,c.path),V);c.onComplete(null,!1,y)}}else{ct("transaction failed: Data returned ",d,c.path),c.status=$.RUN;var g=this.transactionQueueTree_.subTree(r),E=g.getValue()||[];E.push(c),g.setValue(E);var T=void 0;"object"==typeof d&&null!==d&&m.contains(d,".priority")?(T=m.safeGet(d,".priority"),m.assert(Me(T),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):T=(this.serverSyncTree_.calcCompleteEventCache(r)||P.EMPTY_NODE).getPriority().val(),T=T;var R=this.generateServerValues(),W=J(d,T),B=kt(W,f,R);c.currentOutputSnapshotRaw=W,c.currentOutputSnapshotResolved=B,c.currentWriteId=this.getNextWriteId_();var ce=this.serverSyncTree_.applyUserOverwrite(r,B,c.currentWriteId,c.applyLocally);this.eventQueue_.raiseEventsForChangedPath(r,ce),this.sendReadyTransactions_()}},ne.prototype.getLatestState_=function(r,e){return this.serverSyncTree_.calcCompleteEventCache(r,e)||P.EMPTY_NODE},ne.prototype.sendReadyTransactions_=function(r){var e=this;if(void 0===r&&(r=this.transactionQueueTree_),r||this.pruneCompletedTransactionsBelowNode_(r),null!==r.getValue()){var t=this.buildTransactionQueue_(r);m.assert(t.length>0,"Sending zero length transaction queue"),t.every(function(o){return o.status===$.RUN})&&this.sendTransactionQueue_(r.path(),t)}else r.hasChildren()&&r.forEachChild(function(o){e.sendReadyTransactions_(o)})},ne.prototype.sendTransactionQueue_=function(r,e){for(var t=this,i=e.map(function(E){return E.currentWriteId}),o=this.getLatestState_(r,i),s=o,u=o.hash(),c=0;c<e.length;c++){var f=e[c];m.assert(f.status===$.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=$.SENT,f.retryCount++;var d=I.relativePath(r,f.path);s=s.updateChild(d,f.currentOutputSnapshotRaw)}var y=s.val(!0),g=r;this.server_.put(g.toString(),y,function(E){t.log_("transaction put response",{path:g.toString(),status:E});var T=[];if("ok"===E){for(var N=[],R=0;R<e.length;R++){if(e[R].status=$.COMPLETED,T=T.concat(t.serverSyncTree_.ackUserWrite(e[R].currentWriteId)),e[R].onComplete){var W=e[R].currentOutputSnapshotResolved,B=new Ze(t,e[R].path),ce=new De(W,B,V);N.push(e[R].onComplete.bind(null,null,!0,ce))}e[R].unwatcher()}for(t.pruneCompletedTransactionsBelowNode_(t.transactionQueueTree_.subTree(r)),t.sendReadyTransactions_(),t.eventQueue_.raiseEventsForChangedPath(r,T),R=0;R<N.length;R++)Fe(N[R])}else{if("datastale"===E)for(R=0;R<e.length;R++)e[R].status=e[R].status===$.SENT_NEEDS_ABORT?$.NEEDS_ABORT:$.RUN;else for(K("transaction at "+g.toString()+" failed: "+E),R=0;R<e.length;R++)e[R].status=$.NEEDS_ABORT,e[R].abortReason=E;t.rerunTransactions_(r)}},u)},ne.prototype.rerunTransactions_=function(r){var e=this.getAncestorTransactionNode_(r),t=e.path(),i=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(i,t),t},ne.prototype.rerunTransactionQueue_=function(r,e){if(0!==r.length){for(var t=[],i=[],s=r.filter(function(it){return it.status===$.RUN}).map(function(it){return it.currentWriteId}),u=0;u<r.length;u++){var c=r[u],f=I.relativePath(e,c.path),d=!1,y=void 0;if(m.assert(null!==f,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===$.NEEDS_ABORT)d=!0,y=c.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else if(c.status===$.RUN)if(c.retryCount>=ne.MAX_TRANSACTION_RETRIES_)d=!0,y="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0));else{var g=this.getLatestState_(c.path,s);c.currentInputSnapshot=g;var E=r[u].update(g.val());if(void 0!==E){ct("transaction failed: Data returned ",E,c.path);var T=J(E);"object"==typeof E&&null!=E&&m.contains(E,".priority")||(T=T.updatePriority(g.getPriority()));var R=c.currentWriteId,W=this.generateServerValues(),B=kt(T,g,W);c.currentOutputSnapshotRaw=T,c.currentOutputSnapshotResolved=B,c.currentWriteId=this.getNextWriteId_(),s.splice(s.indexOf(R),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(c.path,B,c.currentWriteId,c.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(R,!0))}else d=!0,y="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(c.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],d&&(r[u].status=$.COMPLETED,setTimeout(r[u].unwatcher,Math.floor(0)),r[u].onComplete))if("nodata"===y){var ce=new Ze(this,r[u].path),rt=new De(r[u].currentInputSnapshot,ce,V);t.push(r[u].onComplete.bind(null,null,!1,rt))}else t.push(r[u].onComplete.bind(null,new Error(y),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),u=0;u<t.length;u++)Fe(t[u]);this.sendReadyTransactions_()}},ne.prototype.getAncestorTransactionNode_=function(r){var e,t=this.transactionQueueTree_;for(e=r.getFront();null!==e&&null===t.getValue();)t=t.subTree(e),e=(r=r.popFront()).getFront();return t},ne.prototype.buildTransactionQueue_=function(r){var e=[];return this.aggregateTransactionQueuesForNode_(r,e),e.sort(function(t,i){return t.order-i.order}),e},ne.prototype.aggregateTransactionQueuesForNode_=function(r,e){var t=this,i=r.getValue();if(null!==i)for(var o=0;o<i.length;o++)e.push(i[o]);r.forEachChild(function(s){t.aggregateTransactionQueuesForNode_(s,e)})},ne.prototype.pruneCompletedTransactionsBelowNode_=function(r){var e=this,t=r.getValue();if(t){for(var i=0,o=0;o<t.length;o++)t[o].status!==$.COMPLETED&&(t[i]=t[o],i++);t.length=i,r.setValue(t.length>0?t:null)}r.forEachChild(function(s){e.pruneCompletedTransactionsBelowNode_(s)})},ne.prototype.abortTransactions_=function(r){var e=this,t=this.getAncestorTransactionNode_(r).path(),i=this.transactionQueueTree_.subTree(r);return i.forEachAncestor(function(o){e.abortTransactionsOnNode_(o)}),this.abortTransactionsOnNode_(i),i.forEachDescendant(function(o){e.abortTransactionsOnNode_(o)}),t},ne.prototype.abortTransactionsOnNode_=function(r){var e=r.getValue();if(null!==e){for(var t=[],i=[],o=-1,s=0;s<e.length;s++)e[s].status!==$.SENT_NEEDS_ABORT&&(e[s].status===$.SENT?(m.assert(o===s-1,"All SENT items should be at beginning of queue."),o=s,e[s].status=$.SENT_NEEDS_ABORT,e[s].abortReason="set"):(m.assert(e[s].status===$.RUN,"Unexpected transaction status in abort"),e[s].unwatcher(),i=i.concat(this.serverSyncTree_.ackUserWrite(e[s].currentWriteId,!0)),e[s].onComplete&&t.push(e[s].onComplete.bind(null,new Error("set"),!1,null))));for(-1===o?r.setValue(null):e.length=o+1,this.eventQueue_.raiseEventsForChangedPath(r.path(),i),s=0;s<t.length;s++)Fe(t[s])}};var wr,ni=function(){function r(e,t){var i=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then(function(o){return i.auth_=o})}return r.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch(function(t){return t&&"auth/token-not-initialized"===t.code?(G("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)}):Promise.resolve(null)},r.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout(function(){return e(null)},0),this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)}))},r.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})},r.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';K(e+="credential"in this.app_.options?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.')},r}(),ri=function(){function r(){}return r.prototype.getToken=function(e){return Promise.resolve({accessToken:r.EMULATOR_AUTH_TOKEN})},r.prototype.addTokenChangeListener=function(e){e(r.EMULATOR_AUTH_TOKEN)},r.prototype.removeTokenChangeListener=function(e){},r.prototype.notifyForInvalidToken=function(){},r.EMULATOR_AUTH_TOKEN="owner",r}(),Ar=function(){function r(){this.repos_={},this.useRestClient_=!1}return r.getInstance=function(){return wr||(wr=new r),wr},r.prototype.interrupt=function(){var e,t,i,o;try{for(var s=M.__values(Object.keys(this.repos_)),u=s.next();!u.done;u=s.next()){var c=u.value;try{for(var f=(i=void 0,M.__values(Object.keys(this.repos_[c]))),d=f.next();!d.done;d=f.next())this.repos_[c][d.value].interrupt()}catch(g){i={error:g}}finally{try{d&&!d.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}}catch(g){e={error:g}}finally{try{u&&!u.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}},r.prototype.resume=function(){var e,t,i,o;try{for(var s=M.__values(Object.keys(this.repos_)),u=s.next();!u.done;u=s.next()){var c=u.value;try{for(var f=(i=void 0,M.__values(Object.keys(this.repos_[c]))),d=f.next();!d.done;d=f.next())this.repos_[c][d.value].resume()}catch(g){i={error:g}}finally{try{d&&!d.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}}catch(g){e={error:g}}finally{try{u&&!u.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}},r.prototype.databaseFromApp=function(e,t,i,o){var s=i||e.options.databaseURL;void 0===s&&(e.options.projectId||he("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),G("Using default host for project ",e.options.projectId),s=e.options.projectId+"-default-rtdb.firebaseio.com");var f,u=St(s,o),c=u.repoInfo,d=void 0;"undefined"!=typeof process&&(d=process.env.FIREBASE_DATABASE_EMULATOR_HOST),d?(f=!0,c=(u=St(s="http://"+d+"?ns="+c.namespace,o)).repoInfo):f=!u.repoInfo.secure;var y=o&&f?new ri:new ni(e,t);return Pn("Invalid Firebase Database URL",1,u),u.path.isEmpty()||he("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(c,e,y).database},r.prototype.deleteRepo=function(e){var t=m.safeGet(this.repos_,e.app.name);(!t||m.safeGet(t,e.repoInfo_.toURLString())!==e)&&he("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.repoInfo_.toURLString()]},r.prototype.createRepo=function(e,t,i){var o=m.safeGet(this.repos_,t.name);o||(this.repos_[t.name]=o={});var s=m.safeGet(o,e.toURLString());return s&&he("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new ne(e,this.useRestClient_,t,i),o[e.toURLString()]=s,s},r.prototype.forceRestClient=function(e){this.useRestClient_=e},r}(),In=function(){function r(e){this.repo_=e,e instanceof ne||he("Don't call new Database() directly - please use firebase.database()."),this.root_=new Ze(e,I.Empty),this.INTERNAL=new oi(this)}return Object.defineProperty(r.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),r.prototype.ref=function(e){return this.checkDeleted_("ref"),m.validateArgCount("database.ref",0,1,arguments.length),e instanceof Ze?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},r.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),m.validateArgCount(t,1,1,arguments.length);var i=St(e,this.repo_.repoInfo_.nodeAdmin);Pn(t,1,i);var o=i.repoInfo;return o.host!==this.repo_.repoInfo_.host&&he(t+": Host name does not match the current database: (found "+o.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(i.path.toString())},r.prototype.checkDeleted_=function(e){null===this.repo_&&he("Cannot call "+e+" on a deleted database.")},r.prototype.goOffline=function(){m.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},r.prototype.goOnline=function(){m.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},r.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},r}(),oi=function(){function r(e){this.database=e}return r.prototype.delete=function(){return M.__awaiter(this,void 0,void 0,function(){return M.__generator(this,function(e){return this.database.checkDeleted_("delete"),Ar.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},r}(),di=Object.freeze({__proto__:null,forceLongPolling:function(){l.forceDisallow(),Sn.forceAllow()},forceWebSockets:function(){Sn.forceDisallow()},isWebSocketsAvailable:function(){return l.isAvailable()},setSecurityDebugCallback:function(r,e){r.repo.persistentConnection_.securityDebugCallback_=e},stats:function(r,e){r.repo.stats(e)},statsIncrementCounter:function(r,e){r.repo.statsIncrementCounter(e)},dataUpdateCount:function(r){return r.repo.dataUpdateCount},interceptServerData:function(r,e){return r.repo.interceptServerData_(e)}}),mi=nt;nt.prototype.simpleListen=function(r,e){this.sendRequest("q",{p:r},e)},nt.prototype.echo=function(r,e){this.sendRequest("echo",{d:r},e)};var Ci=Object.freeze({__proto__:null,DataConnection:mi,RealTimeConnection:Mr,hijackHash:function(r){var e=nt.prototype.put;return nt.prototype.put=function(t,i,o,s){void 0!==s&&(s=r()),e.call(this,t,i,o,s)},function(){nt.prototype.put=e}},ConnectionTarget:ut,queryIdentifier:function(r){return r.queryIdentifier()},forceRestClient:function(r){Ar.getInstance().forceRestClient(r)}}),Br=In.ServerValue;function Vr(r){!function(r){Wt=r}(r.SDK_VERSION);var e=r.INTERNAL.registerComponent(new ot.Component("database",function(t,i){var o=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal");return Ar.getInstance().databaseFromApp(o,s,i)},"PUBLIC").setServiceProps({Reference:Ze,Query:mt,Database:In,DataSnapshot:De,enableLogging:Be,INTERNAL:di,ServerValue:Br,TEST_ACCESS:Ci}).setMultipleInstances(!0));r.registerVersion("@firebase/database","0.6.13"),m.isNodeSdk()&&(Zn.exports=e)}Vr(de.default),ie.DataSnapshot=De,ie.Database=In,ie.OnDisconnect=Dn,ie.Query=mt,ie.Reference=Ze,ie.ServerValue=Br,ie.enableLogging=Be,ie.registerDatabase=Vr},2923:(Zn,ie,k)=>{k.r(ie),k.d(ie,{QuestionnaireModule:()=>br});var ae=k(8583),M=k(282),m=k(5987),n=k(7716),ot=k(5319),We=k(7001),de=k(8002),gt=k(3637),Et=k(7574),st=k(5917),me=k(6682),Re=k(8819),ge=k(3190),ze=k(2145),at=k(7519),pe=k(5197),Ee=k(509);class Be{constructor(p,l){this.observables=p,this.project=l}call(p,l){return l.subscribe(new G(p,this.observables,this.project))}}class G extends pe.L{constructor(p,l,h){super(p),this.observables=l,this.project=h,this.toRespond=[];const _=l.length;this.values=new Array(_);for(let v=0;v<_;v++)this.toRespond.push(v);for(let v=0;v<_;v++)this.add((0,Ee.D)(this,l[v],void 0,v))}notifyNext(p,l,h){this.values[h]=l;const _=this.toRespond;if(_.length>0){const v=_.indexOf(h);-1!==v&&_.splice(v,1)}}notifyComplete(){}_next(p){if(0===this.toRespond.length){const l=[p,...this.values];this.project?this._tryProject(l):this.destination.next(l)}}_tryProject(p){let l;try{l=this.project.apply(this,p)}catch(h){return void this.destination.error(h)}this.destination.next(l)}}var xe=k(7393);class he{constructor(p){this.predicate=p}call(p,l){return l.subscribe(new K(p,this.predicate))}}class K extends xe.L{constructor(p,l){super(p),this.predicate=l,this.skipping=!0,this.index=0}_next(p){const l=this.destination;this.skipping&&this.tryCallPredicate(p),this.skipping||l.next(p)}tryCallPredicate(p){try{const l=this.predicate(p,this.index++);this.skipping=Boolean(l)}catch(l){this.destination.error(l)}}}var C=k(57),b=(k(4614),k(9829)),Z=k(4395),x=k.n(Z);function j(a){return null==a}function re(a){return"function"==typeof a.set}function O(a,p){return re(p)?p:a.ref(p)}function z(a,p){if(function(a){return"string"==typeof a}(a))return p.stringCase();if(re(a))return p.firebaseCase();if(function(a){return"function"==typeof a.exportVal}(a))return p.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof a)}function oe(a,p,l="on",h=gt.z){return new Et.y(_=>{let v=null;return v=a[l](p,(w,F)=>{h.schedule(()=>{_.next({snapshot:w,prevKey:F})}),"once"===l&&h.schedule(()=>_.complete())},w=>{h.schedule(()=>_.error(w))}),"on"===l?{unsubscribe(){null!=v&&a.off(p,v)}}:{unsubscribe(){}}}).pipe((0,de.U)(_=>{const{snapshot:v,prevKey:w}=_;let F=null;return v.exists()&&(F=v.key),{type:p,payload:v,prevKey:w,key:F}}),(0,Re.B)())}function Ce(a,p){const l=a.length;for(let h=0;h<l;h++)if(a[h].payload.key===p)return h;return-1}function Ct(a,p){const{payload:l,prevKey:h,key:_}=p,v=Ce(a,_),w=function(a,p){if(j(p))return 0;{const l=Ce(a,p);return-1===l?a.length:l+1}}(a,h);switch(p.type){case"value":if(p.payload&&p.payload.exists()){let F=null;p.payload.forEach(Y=>{const D={payload:Y,type:"value",prevKey:F,key:Y.key};return F=Y.key,a=[...a,D],!1})}return a;case"child_added":if(v>-1){const F=a[v-1];(F&&F.key||null)!==h&&(a=a.filter(Y=>Y.payload.key!==l.key)).splice(w,0,p)}else{if(null==h)return[p,...a];(a=a.slice()).splice(w,0,p)}return a;case"child_removed":return a.filter(F=>F.payload.key!==l.key);case"child_changed":return a.map(F=>F.payload.key===_?p:F);case"child_moved":if(v>-1){const F=a.splice(v,1)[0];return(a=a.slice()).splice(w,0,F),a}return a;default:return a}}function Tt(a){return(j(a)||0===a.length)&&(a=["child_added","child_removed","child_changed","child_moved"]),a}function Fe(a,p,l){return function(a,p,l){return oe(a,"value","once",l).pipe((0,ge.w)(h=>{const _=[(0,st.of)(h)];return p.forEach(v=>_.push(oe(a,v,"on",l))),(0,me.T)(..._).pipe((0,ze.R)(Ct,[]))}),(0,at.x)())}(a,p=Tt(p),l)}function Bt(a,p,l){const h=(p=Tt(p)).map(_=>oe(a,_,"on",l));return(0,me.T)(...h)}function He(a,p){return function(h,_){return z(h,{stringCase:()=>a.child(h)[p](_),firebaseCase:()=>h[p](_),snapshotCase:()=>h.ref[p](_)})}}function Vt(a){return function(l){return l?z(l,{stringCase:()=>a.child(l).remove(),firebaseCase:()=>l.remove(),snapshotCase:()=>l.ref.remove()}):a.remove()}}function bt(a,p){return function(){return oe(a,"value","on",p)}}const wt=new n.OlP("angularfire2.realtimeDatabaseURL"),At=new n.OlP("angularfire2.database.use-emulator");let xn=(()=>{class a{constructor(l,h,_,v,w,F,Y){this.schedulers=new C.HU(w),this.keepUnstableUntilFirst=(0,C.ss)(this.schedulers);const D=F,ee=(0,C.on)(l,w,h);!x().auth&&Y&&(0,C.yq)(),this.database=(0,C.sI)(`${ee.name}.database.${_}`,"AngularFireDatabase",ee,()=>{const ye=w.runOutsideAngular(()=>ee.database(_||void 0));return D&&ye.useEmulator(...D),ye},[D])}list(l,h){const _=this.schedulers.ngZone.runOutsideAngular(()=>O(this.database,l));let v=_;return h&&(v=h(_)),function(a,p){const l=p.schedulers.outsideAngular,h=p.schedulers.ngZone.run(()=>a.ref);return{query:a,update:He(h,"update"),set:He(h,"set"),push:_=>h.push(_),remove:Vt(h),snapshotChanges:_=>Fe(a,_,l).pipe(p.keepUnstableUntilFirst),stateChanges:_=>Bt(a,_,l).pipe(p.keepUnstableUntilFirst),auditTrail:_=>function(a,p,l){return function(a,p,l){return function(a,p){return oe(a,"value","on",p).pipe((0,de.U)(l=>{let h;return l.payload.forEach(_=>(h=_.key,!1)),{data:l,lastKeyToLoad:h}}))}(a,l).pipe(function(...a){return p=>{let l;return"function"==typeof a[a.length-1]&&(l=a.pop()),p.lift(new Be(a,l))}}(p),(0,de.U)(([_,v])=>{const w=_.lastKeyToLoad,F=v.map(Y=>Y.key);return{actions:v,lastKeyToLoad:w,loadedKeys:F}}),function(a){return p=>p.lift(new he(a))}(_=>-1===_.loadedKeys.indexOf(_.lastKeyToLoad)),(0,de.U)(_=>_.actions))}(a,Bt(a,p).pipe((0,ze.R)((_,v)=>[..._,v],[])),l)}(a,_,l).pipe(p.keepUnstableUntilFirst),valueChanges:(_,v)=>Fe(a,_,l).pipe((0,de.U)(F=>F.map(Y=>v&&v.idField?Object.assign(Object.assign({},Y.payload.val()),{[v.idField]:Y.key}):Y.payload.val())),p.keepUnstableUntilFirst)}}(v,this)}object(l){return function(a,p){return{query:a,snapshotChanges:()=>bt(a,p.schedulers.outsideAngular)().pipe(p.keepUnstableUntilFirst),update:l=>a.ref.update(l),set:l=>a.ref.set(l),remove:()=>a.ref.remove(),valueChanges:()=>bt(a,p.schedulers.outsideAngular)().pipe(p.keepUnstableUntilFirst,(0,de.U)(h=>h.payload.exists()?h.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>O(this.database,l)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return a.\u0275fac=function(l){return new(l||a)(n.LFG(C.Dh),n.LFG(C.xv,8),n.LFG(wt,8),n.LFG(n.Lbi),n.LFG(n.R0b),n.LFG(At,8),n.LFG(b.Qv,8))},a.\u0275prov=n.Yz7({factory:function(){return new a(n.LFG(C.Dh),n.LFG(C.xv,8),n.LFG(wt,8),n.LFG(n.Lbi),n.LFG(n.R0b),n.LFG(At,8),n.LFG(b.Qv,8))},token:a,providedIn:"any"}),a})(),Le=(()=>{class a{constructor(l){this.db=l,this.API_URL="/employees"}getEmployeesFromProjector(){return this.db.list(this.API_URL).snapshotChanges().pipe((0,de.U)(l=>l.map(h=>this.assignKey(h))))}getEmployee(l){return this.db.object(`${this.API_URL}/${l}`).snapshotChanges().pipe((0,de.U)(h=>this.assignKey(h)))}addEmployee(l){return this.db.list(this.API_URL).push(l)}editEmployee(l,h){return this.db.object(`${this.API_URL}/${l}`).update(h)}assignKey(l){return Object.assign(Object.assign({},l.payload.val()),{key:l.key})}}return a.\u0275fac=function(l){return new(l||a)(n.LFG(xn))},a.\u0275prov=n.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var L=k(3679),U=k(6215),Te=(()=>{return(a=Te||(Te={})).P="podstawowe",a.S="\u015brednie",a.W="wy\u017csze",Te;var a})(),Ne=(()=>{return(a=Ne||(Ne={})).spouse="wsp\xf3\u0142ma\u0142\u017conek",a.child="dziecko",Ne;var a})();const Zt=[{label:"nie dotyczy",value:"nieDot"},{label:"licencjat",value:"lic"},{label:"magister",value:"mgr"},{label:"in\u017cynier",value:"inz"},{label:"magister in\u017cynier",value:"mgrInz"}],Ie=[{label:"Tak",value:"Y"},{label:"Nie",value:"N"}];var ke=(()=>{return(a=ke||(ke={})).Y="w trakcie",a.N="uko\u0144czone",ke;var a})(),_e=k(2238),qe=k(1095),ht=k(1552);let Je=(()=>{class a{constructor(l){this.data=l}ngOnInit(){}}return a.\u0275fac=function(l){return new(l||a)(n.Y36(_e.WI))},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-confirmation-dialog"]],decls:17,vars:5,consts:[["mat-dialog-title",""],["fxFlex","","fxLayout","row","fxLayoutAlign","start center"],["fxFlex","10","fxLayout","row","fxLayoutAlign","end center"],["mat-icon-button","","mat-dialog-close",""],["closeBtn",""],["aria-label","Close"],["fxFlex","","fxLayout","row","fxLayoutAlign","end center"],["mat-button","","mat-dialog-close","",1,"border-black"],["mat-button","","cdkFocusInitial","",1,"btn-submit",3,"mat-dialog-close"]],template:function(l,h){1&l&&(n.TgZ(0,"h1",0),n.TgZ(1,"div",1),n.TgZ(2,"span"),n._uU(3),n.qZA(),n.qZA(),n.TgZ(4,"div",2),n.TgZ(5,"button",3,4),n.TgZ(7,"mat-icon",5),n._uU(8,"close"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(9,"mat-dialog-content"),n._uU(10),n.qZA(),n.TgZ(11,"mat-dialog-actions"),n.TgZ(12,"div",6),n.TgZ(13,"button",7),n._uU(14),n.qZA(),n.TgZ(15,"button",8),n._uU(16),n.qZA(),n.qZA(),n.qZA()),2&l&&(n.xp6(3),n.Oqu(null==h.data?null:h.data.title),n.xp6(7),n.hij(" ",h.data.message,"\n"),n.xp6(4),n.Oqu(h.data.falseButtonName),n.xp6(1),n.Q6J("mat-dialog-close",!0),n.xp6(1),n.Oqu(h.data.trueButtonName))},directives:[_e.uh,qe.lW,_e.ZT,ht.Hw,_e.xY,_e.H8],styles:[""]}),a})(),Qe=(()=>{class a{constructor(){}ngOnInit(){}}return a.\u0275fac=function(l){return new(l||a)},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-supplementary-education-dialog"]],decls:2,vars:0,template:function(l,h){1&l&&(n.TgZ(0,"p"),n._uU(1,"supplementary-education-dialog works!"),n.qZA())},styles:[""]}),a})(),Kt=(()=>{class a{constructor(){}ngOnInit(){}}return a.\u0275fac=function(l){return new(l||a)},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-work-dialog"]],decls:2,vars:0,template:function(l,h){1&l&&(n.TgZ(0,"p"),n._uU(1,"work-dialog works!"),n.qZA())},styles:[""]}),a})(),Xt=(()=>{class a{constructor(){}ngOnInit(){}}return a.\u0275fac=function(l){return new(l||a)},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-family-dialog"]],decls:2,vars:0,template:function(l,h){1&l&&(n.TgZ(0,"p"),n._uU(1,"family-dialog works!"),n.qZA())},styles:[""]}),a})();const en="dd/MM/yyyy";let On=(()=>{class a{constructor(){}ngOnInit(){}}return a.\u0275fac=function(l){return new(l||a)},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-contact-person-dialog"]],decls:2,vars:0,template:function(l,h){1&l&&(n.TgZ(0,"p"),n._uU(1,"contact-person-dialog works!"),n.qZA())},styles:[""]}),a})();var V=k(8295),ft=k(9983);function fe(a,p){if(1&a&&(n.TgZ(0,"div"),n._uU(1),n.qZA()),2&a){const l=n.oxw();n.xp6(1),n.AsE("",l.controlName," jest wymagan",l.lastLetter,"")}}function Ln(a,p){if(1&a&&(n.TgZ(0,"div"),n._uU(1),n.qZA()),2&a){const l=n.oxw();n.xp6(1),n.AsE("Pole ",l.controlName," jest za d\u0142ugie (max. ",l.maxLength,")")}}function be(a,p){if(1&a&&(n.TgZ(0,"div"),n._uU(1),n.qZA()),2&a){const l=n.oxw();n.xp6(1),n.AsE("Pole ",l.controlName," jest za kr\xf3tkie (min. ",l.minLength,")")}}function Mn(a,p){if(1&a&&(n.TgZ(0,"div"),n._uU(1),n.qZA()),2&a){const l=n.oxw();n.xp6(1),n.hij("",l.controlName," nie mo\u017ce posiada\u0107 liter")}}let Un=(()=>{class a{constructor(){}}return a.\u0275fac=function(l){return new(l||a)},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-validation-feedback"]],inputs:{control:"control",controlName:"controlName",maxLength:"maxLength",minLength:"minLength",lastLetter:"lastLetter",pattern:"pattern"},decls:4,vars:4,consts:[[4,"ngIf"]],template:function(l,h){1&l&&(n.YNc(0,fe,2,2,"div",0),n.YNc(1,Ln,2,2,"div",0),n.YNc(2,be,2,2,"div",0),n.YNc(3,Mn,2,1,"div",0)),2&l&&(n.Q6J("ngIf",h.control.hasError("required")&&(h.control.touched||h.control.dirty||h.control.pristine)),n.xp6(1),n.Q6J("ngIf",h.control.hasError("maxlength")&&h.control.dirty),n.xp6(1),n.Q6J("ngIf",h.control.hasError("minlength")&&h.control.dirty),n.xp6(1),n.Q6J("ngIf",h.control.hasError("pattern")&&h.control.dirty))},directives:[ae.O5],styles:[""]}),a})();var dt=k(7441),Ge=k(3220),Pe=k(2613),$e=k(7539),H=k(2091),Ke=k(552),Xe=k(2458);function P(a,p){1&a&&(n.TgZ(0,"div"),n._uU(1,"PESEL jest wymagany"),n.qZA())}function qn(a,p){1&a&&(n.TgZ(0,"div"),n._uU(1,"PESEL nie mo\u017ce posiada\u0107 liter i znak\xf3w specjalnych "),n.qZA())}function et(a,p){if(1&a&&(n.TgZ(0,"div"),n.YNc(1,P,2,0,"div",13),n.YNc(2,qn,2,0,"div",13),n.qZA()),2&a){const l=n.oxw();n.xp6(1),n.Q6J("ngIf",l.employeeForm.get("pesel").hasError("required")),n.xp6(1),n.Q6J("ngIf",l.employeeForm.get("pesel").errors.pattern)}}function Qn(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Imi\u0119 (imiona) i nazwisko"),n.qZA())}function J(a,p){if(1&a&&(n.TgZ(0,"td",69),n._UZ(1,"span",70),n.qZA()),2&a){const l=p.$implicit;n.Q6J("formGroupName",p.index),n.xp6(1),n.Q6J("innerHTML",l.controls.nameFamily.value,n.oJD)}}function Wn(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Data urodzenia"),n.qZA())}function Rt(a,p){if(1&a&&(n.TgZ(0,"td",69),n._uU(1),n.ALo(2,"date"),n.qZA()),2&a){const l=p.$implicit,h=p.index,_=n.oxw(2);n.Q6J("formGroupName",h),n.xp6(1),n.hij(" ",n.xi3(2,2,l.controls.dobFamily.value,_.FULL_DATE_FORMAT)," ")}}function xt(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Pokrewie\u0144stwo"),n.qZA())}function De(a,p){if(1&a&&(n.TgZ(0,"td",69),n._uU(1),n.qZA()),2&a){const l=p.$implicit,h=p.index,_=n.oxw(2);n.Q6J("formGroupName",h),n.xp6(1),n.hij(" ",_.FamilyRelation[l.controls.relation.value]," ")}}function tn(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Akcja"),n.qZA())}function nn(a,p){if(1&a){const l=n.EpF();n.TgZ(0,"td",69),n.TgZ(1,"mat-icon",71),n.NdJ("click",function(){const v=n.CHM(l).index;return n.oxw(2).openFamilyMemberDialog(v)})("keyup.enter",function(){const v=n.CHM(l).index;return n.oxw(2).openFamilyMemberDialog(v)}),n._uU(2,"edit "),n.qZA(),n.TgZ(3,"mat-icon",72),n.NdJ("click",function(){const v=n.CHM(l).index;return n.oxw(2).deleteFamilyMember(v)})("keyup.enter",function(){const v=n.CHM(l).index;return n.oxw(2).deleteFamilyMember(v)}),n._uU(4,"delete "),n.qZA(),n.qZA()}2&a&&n.Q6J("formGroupName",p.index)}function rn(a,p){1&a&&n._UZ(0,"tr",73)}function on(a,p){1&a&&n._UZ(0,"tr",74)}function Ft(a,p){if(1&a&&(n.TgZ(0,"table",59),n.ynx(1,60),n.YNc(2,Qn,2,0,"th",61),n.YNc(3,J,2,2,"td",62),n.BQk(),n.ynx(4,63),n.YNc(5,Wn,2,0,"th",61),n.YNc(6,Rt,3,5,"td",62),n.BQk(),n.ynx(7,64),n.YNc(8,xt,2,0,"th",61),n.YNc(9,De,2,2,"td",62),n.BQk(),n.ynx(10,65),n.YNc(11,tn,2,0,"th",61),n.YNc(12,nn,5,1,"td",62),n.BQk(),n.YNc(13,rn,1,0,"tr",66),n.YNc(14,on,1,0,"tr",67),n.qZA()),2&a){const l=n.oxw();n.Q6J("dataSource",l.familyDataSource),n.xp6(13),n.Q6J("cdkHeaderRowDef",l.displayedFamilyColumns),n.xp6(1),n.Q6J("cdkRowDefColumns",l.displayedFamilyColumns)}}function mt(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Imi\u0119 (imiona) i nazwisko"),n.qZA())}function zn(a,p){if(1&a&&(n.TgZ(0,"td",69),n._uU(1),n.qZA()),2&a){const l=p.$implicit;n.Q6J("formGroupName",p.index),n.xp6(1),n.hij(" ",l.controls.contactPersonName.value," ")}}function Bn(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1,"Adres"),n.qZA())}function Vn(a,p){if(1&a&&(n.TgZ(0,"td",69),n._uU(1),n.qZA()),2&a){const l=p.$implicit;n.Q6J("formGroupName",p.index),n.xp6(1),n.AsE(" ",l.get("contactPersonAddress").get("street").value," ",l.get("contactPersonAddress").get("city").value," ")}}function sn(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Telefon"),n.qZA())}function jn(a,p){if(1&a&&(n.TgZ(0,"td",69),n._uU(1),n.qZA()),2&a){const l=p.$implicit;n.Q6J("formGroupName",p.index),n.xp6(1),n.AsE(" ",l.get("contactPersonAddress").get("telephone").value," ",l.controls.contactPersonAddress.telephone," ")}}function Yn(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Akcja"),n.qZA())}function an(a,p){if(1&a){const l=n.EpF();n.TgZ(0,"td",69),n.TgZ(1,"mat-icon",79),n.NdJ("click",function(){const v=n.CHM(l).index;return n.oxw(2).openContactPersonDialog(v)})("keyup.enter",function(){const v=n.CHM(l).index;return n.oxw(2).openContactPersonDialog(v)}),n._uU(2,"edit "),n.qZA(),n.TgZ(3,"mat-icon",80),n.NdJ("click",function(){const v=n.CHM(l).index;return n.oxw(2).deleteContactPerson(v)})("keyup.enter",function(){const v=n.CHM(l).index;return n.oxw(2).deleteContactPerson(v)}),n._uU(4,"delete "),n.qZA(),n.qZA()}2&a&&n.Q6J("formGroupName",p.index)}function kt(a,p){1&a&&n._UZ(0,"tr",73)}function Pt(a,p){1&a&&n._UZ(0,"tr",74)}function Dt(a,p){if(1&a&&(n.TgZ(0,"table",75),n.ynx(1,76),n.YNc(2,mt,2,0,"th",61),n.YNc(3,zn,2,2,"td",62),n.BQk(),n.ynx(4,77),n.YNc(5,Bn,2,0,"th",61),n.YNc(6,Vn,2,3,"td",62),n.BQk(),n.ynx(7,78),n.YNc(8,sn,2,0,"th",61),n.YNc(9,jn,2,3,"td",62),n.BQk(),n.ynx(10,65),n.YNc(11,Yn,2,0,"th",61),n.YNc(12,an,5,1,"td",62),n.BQk(),n.YNc(13,kt,1,0,"tr",66),n.YNc(14,Pt,1,0,"tr",67),n.qZA()),2&a){const l=n.oxw();n.Q6J("dataSource",l.contactPersonDataSource),n.xp6(13),n.Q6J("cdkHeaderRowDef",l.displayedContactPersonColumns),n.xp6(1),n.Q6J("cdkRowDefColumns",l.displayedContactPersonColumns)}}function ue(a,p){if(1&a&&(n.TgZ(0,"mat-option",81),n._uU(1),n.qZA()),2&a){const l=p.$implicit,h=n.oxw();n.Q6J("value",l),n.xp6(1),n.Oqu(h.CurrentDegree[l])}}function we(a,p){if(1&a&&(n.TgZ(0,"mat-option",81),n._uU(1),n.qZA()),2&a){const l=p.$implicit;n.Q6J("value",l),n.xp6(1),n.hij(" ",l," ")}}function Hn(a,p){if(1&a&&(n.TgZ(0,"mat-radio-button",82),n._uU(1),n.qZA()),2&a){const l=p.$implicit;n.Q6J("value",l.value),n.xp6(1),n.hij(" ",l.label," ")}}function Ot(a,p){1&a&&(n.TgZ(0,"div",83),n._uU(1," Pierwszy tytu\u0142 zawodowy jest wymagany. "),n.qZA())}function Jn(a,p){if(1&a){const l=n.EpF();n.TgZ(0,"div",84),n.TgZ(1,"div",85),n.TgZ(2,"div",52),n.TgZ(3,"span"),n._uU(4),n.qZA(),n.TgZ(5,"mat-icon",86),n.NdJ("click",function(){const v=n.CHM(l).index;return n.oxw().removeSupplementaryEducationsMember(v)}),n._uU(6,"delete_forever"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(7,"div",87),n.TgZ(8,"div",88),n.TgZ(9,"mat-form-field"),n._UZ(10,"input",89),n.qZA(),n.qZA(),n.qZA(),n.qZA()}if(2&a){const l=p.index;n.xp6(4),n.hij(" ",l+1,""),n.xp6(3),n.Q6J("formGroupName",l)}}function se(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Okres od"),n.qZA())}function ln(a,p){if(1&a&&(n.TgZ(0,"td",69),n._UZ(1,"span",70),n.qZA()),2&a){const l=p.$implicit;n.Q6J("formGroupName",p.index),n.xp6(1),n.Q6J("innerHTML",l.controls.fromJob.value,n.oJD)}}function _t(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Okres do"),n.qZA())}function Lt(a,p){if(1&a&&(n.TgZ(0,"td",69),n._UZ(1,"span",70),n.qZA()),2&a){const l=p.$implicit;n.Q6J("formGroupName",p.index),n.xp6(1),n.Q6J("innerHTML",l.controls.toJob.value,n.oJD)}}function Ae(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Nazwa zak\u0142adu pracy"),n.qZA())}function un(a,p){if(1&a&&(n.TgZ(0,"td",69),n._uU(1),n.qZA()),2&a){const l=p.$implicit;n.Q6J("formGroupName",p.index),n.xp6(1),n.hij(" ",l.controls.companyName.value," ")}}function Q(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1,"Miejscowo\u015b\u0107"),n.qZA())}function Mt(a,p){if(1&a&&(n.TgZ(0,"td",69),n._UZ(1,"span",70),n.qZA()),2&a){const l=p.$implicit;n.Q6J("formGroupName",p.index),n.xp6(1),n.Q6J("innerHTML",l.controls.placeJob.value,n.oJD)}}function Gn(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Stanowisko"),n.qZA())}function $n(a,p){if(1&a&&(n.TgZ(0,"td",69),n._UZ(1,"span",70),n.qZA()),2&a){const l=p.$implicit;n.Q6J("formGroupName",p.index),n.xp6(1),n.Q6J("innerHTML",l.controls.positionJob.value,n.oJD)}}function cn(a,p){1&a&&(n.TgZ(0,"th",68),n._uU(1," Akcja"),n.qZA())}function Ut(a,p){if(1&a){const l=n.EpF();n.TgZ(0,"td",69),n.TgZ(1,"mat-icon",98),n.NdJ("click",function(){const v=n.CHM(l).index;return n.oxw(2).openWorkDialog(v)})("keyup.enter",function(){const v=n.CHM(l).index;return n.oxw(2).openWorkDialog(v)}),n._uU(2,"edit "),n.qZA(),n.TgZ(3,"mat-icon",99),n.NdJ("click",function(){const v=n.CHM(l).index;return n.oxw(2).deleteWork(v)}),n._uU(4,"delete "),n.qZA(),n.qZA()}2&a&&n.Q6J("formGroupName",p.index)}function Kn(a,p){1&a&&n._UZ(0,"tr",73)}function Xn(a,p){1&a&&n._UZ(0,"tr",74)}function er(a,p){if(1&a&&(n.TgZ(0,"table",90),n.ynx(1,91),n.YNc(2,se,2,0,"th",61),n.YNc(3,ln,2,2,"td",62),n.BQk(),n.ynx(4,92),n.YNc(5,_t,2,0,"th",61),n.YNc(6,Lt,2,2,"td",62),n.BQk(),n.ynx(7,93),n.YNc(8,Ae,2,0,"th",61),n.YNc(9,un,2,2,"td",62),n.BQk(),n.ynx(10,94),n.YNc(11,Q,2,0,"th",61),n.YNc(12,Mt,2,2,"td",62),n.BQk(),n.ynx(13,95),n.YNc(14,Gn,2,0,"th",61),n.YNc(15,$n,2,2,"td",62),n.BQk(),n.ynx(16,96),n.YNc(17,cn,2,0,"th",61),n.YNc(18,Ut,5,1,"td",62),n.BQk(),n.YNc(19,Kn,1,0,"tr",66),n.YNc(20,Xn,1,0,"tr",97),n.qZA()),2&a){const l=n.oxw();n.Q6J("dataSource",l.worksDataSource),n.xp6(19),n.Q6J("cdkHeaderRowDef",l.displayedWorkColumns),n.xp6(1),n.Q6J("matRowDefColumns",l.displayedWorkColumns)}}function tr(a,p){1&a&&(n.TgZ(0,"div",100),n.TgZ(1,"p"),n._uU(2,"Brak informacji"),n.qZA(),n.qZA())}let tt=(()=>{class a{constructor(l,h,_,v,w,F){this.formBuilder=l,this.route=h,this.matDialog=_,this.snackBarService=v,this.employeeService=w,this.router=F,this.editMode=!1,this.isClicked=!1,this.familyDataSource=new U.X([]),this.suppliesDataSource=new U.X([]),this.CurrentDegree=Te,this.currentDegrees=Object.keys(Te),this.worksDataSource=new U.X([]),this.FamilyRelation=Ne,this.yesNo=ke,this.contactPersonDataSource=new U.X([]),this.TITLES=Zt,this.YES_NO=Ie,this.FULL_DATE_FORMAT=en,this.date=new Date,this.year=this.date.getFullYear(),this.years=[],this.displayedFamilyColumns=["nameFamily","dobFamily","relation","action"],this.displayedSupplementaryEduColumns=["name","educationDate","during","action"],this.displayedWorkColumns=["fromJob","toJob","companyName","placeJob","positionJob","action"],this.displayedContactPersonColumns=["name","street","phone","action"],this.subscription=new ot.w}ngOnInit(){this.initForm(),this.rangeYear()}initForm(){this.employeeForm=this.formBuilder.group({login:["",L.kI.required],firstName:["",[L.kI.required,L.kI.maxLength(50)]],lastName:["",[L.kI.required,L.kI.maxLength(50)]],pesel:["",[L.kI.required,L.kI.pattern("^[0-9]*$")]],employeeAddress:this.formBuilder.group({street:["",[L.kI.required,L.kI.minLength(3),L.kI.maxLength(50)]],city:["",[L.kI.required,L.kI.maxLength(20)]],zipcode:["",[L.kI.required,L.kI.minLength(5),L.kI.maxLength(5),L.kI.pattern("^[0-9]*$")]],telephone:["",[L.kI.required,L.kI.minLength(9),L.kI.maxLength(12),L.kI.pattern("^[0-9]*$")]]}),currentDegree:["",[L.kI.required]],finishedNameSchool:["",[L.kI.maxLength(255)]],finishedYearSchool:["",L.kI.maxLength(4)],profession:["",L.kI.maxLength(100)],professionAcademicTitle:["",L.kI.maxLength(40)],firstHigherTitle:["",L.kI.required],firstHigherTitleDate:[""],isFirstWork:[""],updateCity:["Toru\u0144",[L.kI.required,L.kI.maxLength(20)]],updateDate:[""],families:this.familyRows,contactPersons:this.contactPersonRows,supplementaryEducations:this.formBuilder.array(this.editMode?[]:[this.buildSupplementaryEducations()]),works:this.workRows,isAgree:["",L.kI.required]})}updateSupplementaryEducationTable(){this.suppliesDataSource.next(this.suppliesRows.controls)}openSupplementaryEducationDialog(l){this.matDialog.open(Qe,{data:null!=l?this.suppliesRows.controls[l]:null}).afterClosed().subscribe(v=>{v&&(null==l?(this.suppliesRows.push(v.resultForm),this.updateSupplementaryEducationTable(),this.snackBarService.open("Zapisano poprawnie","",{panelClass:"snack-success"})):this.snackBarService.open("Edytowano poprawnie","",{panelClass:"snack-success"}),this.employeeForm.markAsDirty())})}deleteSupplementaryEducationDialog(l){var h,_;console.log("index name",null===(h=this.suppliesRows.controls[l].get("name"))||void 0===h?void 0:h.value);const w=this.matDialog.open(Je,{width:"400px",data:{title:"Wykszta\u0142cenie uzupe\u0142niaj\u0105ce",message:`Czy na pewno chcesz usun\u0105\u0107 wykszta\u0142cenie uzupe\u0142niaj\u0105ce ${null===(_=this.suppliesRows.controls[l].get("name"))||void 0===_?void 0:_.value}? `,falseButtonName:"Nie",trueButtonName:"Tak"},panelClass:"dialog-with-borders"}).afterClosed().subscribe(F=>{var Y;F&&(this.suppliesRows.removeAt(l),this.updateSupplementaryEducationTable(),this.snackBarService.open(`Wykszta\u0142cenie ${null===(Y=this.suppliesRows.controls[l].get("name"))||void 0===Y?void 0:Y.value} uzupe\u0142niaj\u0105ce zosta\u0142o poprawnie usuni\u0119te`,"",{panelClass:"snack-success"}),this.employeeForm.markAsDirty())});this.subscription.add(w)}initSupplementaryActionRowsForm(){this.suppliesRows=this.formBuilder.array([])}initWorkRowsForm(){this.workRows=this.formBuilder.array([]),this.employee.works=[],this.employee.works.forEach(l=>this.onNewWork(l,!0)),this.updateWorksTable()}addSupplementaryEducationActionRowForm(l={},h){const _=this.formBuilder.group({name:[l.name]});this.suppliesRows.push(_),h&&this.updateSupplementaryEducationTable()}deleteContactPerson(l){const _=this.matDialog.open(Je,{width:"400px",data:{title:"Osoba do kontaktu",message:"Czy na pewno chcesz usun\u0105\u0107 osob\u0119 do kontaktu?",falseButtonName:"Nie",trueButtonName:"Tak"},panelClass:"dialog-with-borders"}).afterClosed().subscribe(v=>{v&&(this.contactPersonRows.removeAt(l),this.updateContactPersonTable(),this.snackBarService.open("Osoba do kontaktu zosta\u0142a poprawnie usuni\u0119ta","",{panelClass:"snack-success"}),this.employeeForm.markAsDirty())});this.subscription.add(_)}onNewWork(l,h){const _=this.formBuilder.group({fromJob:[l.fromJob],toJob:[l.toJob],companyName:[l.companyName],placeJob:[l.placeJob],positionJob:[l.positionJob]});this.workRows.push(_),h&&this.updateWorksTable()}openWorkDialog(l){const _=this.matDialog.open(Kt,{data:null!=l?this.workRows.controls[l]:null}).afterClosed().subscribe(v=>{v&&(null==l?(this.workRows.push(v.resultForm),this.updateWorksTable(),this.snackBarService.open("Zapisano poprawnie","",{panelClass:"snack-success"})):this.snackBarService.open("Edytowano poprawnie","",{panelClass:"snack-success"}),this.employeeForm.markAsDirty())});this.subscription.add(_)}deleteWork(l){var h;const v=this.matDialog.open(Je,{width:"400px",data:{title:`Praca ${null===(h=this.workRows.controls[l].get("companyName"))||void 0===h?void 0:h.value}`,message:"Czy na pewno chcesz usun\u0105\u0107 prac\u0119?",falseButtonName:"Nie",trueButtonName:"Tak"},panelClass:"dialog-with-borders"}).afterClosed().subscribe(w=>{w&&(this.workRows.removeAt(l),this.updateWorksTable(),this.snackBarService.open("Praca zosta\u0142a poprawnie usuni\u0119ta","",{panelClass:"snack-success"}),this.employeeForm.markAsDirty())});this.subscription.add(v)}updateWorksTable(){this.worksDataSource.next(this.workRows.controls)}initFamilyRowsForm(){this.familyRows=this.formBuilder.array([]),this.employee.families=[],this.employee.families.forEach(l=>this.addFamilyActionRowForm(l,!1)),this.updateFamilyTable()}openFamilyMemberDialog(l){const _=this.matDialog.open(Xt,{data:null!=l?this.familyRows.controls[l]:null}).afterClosed().subscribe(v=>{v&&(null==l?(this.familyRows.push(v.resultForm),this.updateFamilyTable(),this.snackBarService.open("Zapisano poprawnie","",{panelClass:"snack-success"})):this.snackBarService.open("Edytowano poprawnie","",{panelClass:"snack-success"}),this.employeeForm.markAsDirty())});this.subscription.add(_)}updateFamilyTable(){this.familyDataSource.next(this.familyRows.controls)}addFamilyActionRowForm(l,h){const _=this.formBuilder.group({nameFamily:[l.nameFamily],dobFamily:[l.dobFamily],relation:[l.relation]});this.familyRows.push(_),h&&this.updateFamilyTable()}deleteFamilyMember(l){const _=this.matDialog.open(Je,{width:"400px",data:{title:"Cz\u0142onek rodziny",message:"Czy chcesz usun\u0105\u0107 cz\u0142onka rodziny?",falseButtonName:"Nie",trueButtonName:"Tak"},panelClass:"dialog-with-borders"}).afterClosed().subscribe(v=>{v&&(this.familyRows.removeAt(l),this.updateFamilyTable(),this.snackBarService.open("Cz\u0142onek rodziny zosta\u0142 poprawnie usuni\u0119ty","",{panelClass:"snack-success"}),this.employeeForm.markAsDirty())});this.subscription.add(_)}openContactPersonDialog(l){const _=this.matDialog.open(On,{width:"800px",panelClass:"dialog-with-borders",data:null!=l?this.contactPersonRows.controls[l]:null}).afterClosed().subscribe(v=>{v&&(null==l?(this.contactPersonRows.push(v.resultForm),this.updateContactPersonTable(),this.snackBarService.open("Zapisano poprawnie","",{panelClass:"snack-success"})):this.snackBarService.open("Edytowano poprawnie","",{panelClass:"snack-success"}),this.employeeForm.markAsDirty())});this.subscription.add(_)}initContactPersonRowsForm(){this.contactPersonRows=this.formBuilder.array([]),this.employee.contactPersons=[],this.employee.contactPersons.forEach(l=>this.addContactPersonRowForm(l,!1)),this.updateContactPersonTable()}addContactPersonRowForm(l,h){const _=this.formBuilder.group({contactPersonName:[l.contactPersonName],contactPersonAddress:this.formBuilder.group({street:[l.contactPersonAddress.street],city:[l.contactPersonAddress.city],zipcode:[l.contactPersonAddress.zipcode],telephone:[l.contactPersonAddress.telephone]})});this.contactPersonRows.push(_),h&&this.updateContactPersonTable()}updateContactPersonTable(){this.contactPersonDataSource.next(this.contactPersonRows.controls)}setEmployee(l){const _=function(a,p){var l={};for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&p.indexOf(h)<0&&(l[h]=a[h]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols){var _=0;for(h=Object.getOwnPropertySymbols(a);_<h.length;_++)p.indexOf(h[_])<0&&Object.prototype.propertyIsEnumerable.call(a,h[_])&&(l[h[_]]=a[h[_]])}return l}(l,["key"]);this.employeeForm.patchValue(_)}onCloseWithoutChanges(){this.router.navigate(["/dashboard/employees/"])}rangeYear(){}ngOnDestroy(){this.subscription.unsubscribe()}buildSupplementaryEducations(l={}){return this.formBuilder.group({name:[l.name||""]})}addSupplementaryEducation(l){this.supplEducation.push(this.buildSupplementaryEducations(l))}get supplEducation(){return console.log("Supp w get",this.employeeForm.get("supplementaryEducations")),this.employeeForm.get("supplementaryEducations")}removeSupplementaryEducationsMember(l){this.supplEducation.removeAt(l)}}return a.\u0275fac=function(l){return new(l||a)(n.Y36(L.qu),n.Y36(m.gz),n.Y36(_e.uw),n.Y36(We.ux),n.Y36(Le),n.Y36(m.F0))},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-employee-form"]],inputs:{editMode:"editMode",isClicked:"isClicked"},decls:193,vars:69,consts:[[3,"formGroup"],[1,"row"],[1,"shadow-sm","card","w-100"],[1,"card-body"],[1,"card-title","d-flex","align-items-center","section-header"],[1,"material-icons"],[1,"col-md-6","w-100"],["matInput","","formControlName","firstName","id","firstName","type","text","placeholder","Imi\u0119","required","",1,"form-control"],[3,"control","controlName","maxLength","lastLetter"],[1,"col-md-6"],["matInput","","formControlName","lastName","id","lastName","type","text","placeholder","Nazwisko","required","",1,"form-control"],["matInput","","formControlName","login","id","login","type","text","placeholder","Login","required","",1,"form-control"],["matInput","","formControlName","pesel","id","pesel","type","text","placeholder","Pesel","required","",1,"form-control"],[4,"ngIf"],["formGroupName","employeeAddress"],[1,"col-md-3"],["matInput","","formControlName","street","id","street","type","text","placeholder","Adres","required","",1,"form-control"],[3,"control","minLength","controlName","maxLength","lastLetter"],[1,"col-sm-3"],["matInput","","formControlName","city","name","city","type","text","placeholder","Miejscowo\u015b\u0107","required","",1,"form-control"],["matInput","","formControlName","zipcode","type","text","placeholder","Kod pocztowy","required","",1,"form-control"],[3,"control","controlName","maxLength","pattern","minLength","lastLetter"],["matInput","","formControlName","telephone","id","telephone","type","text","placeholder","Telefon","required","",1,"form-control"],[3,"control","controlName","minLength","pattern","maxLength","lastLetter"],[1,"d-flex","justify-content-between","card-title"],["title","Dodaj cz\u0142onka\n      rodziny",1,"btn","btn-primary","btn-add",3,"click"],["mat-table","","formArrayName","families","aria-label","Stan rodziny",3,"dataSource",4,"ngIf","ngIfElse"],[1,"d-flex","align-items-center","section-header"],[1,"btn","btn-primary","btn-add",3,"click"],["fxLayout","row wrap","fxLayoutAlign","space-between baseline","fxLayoutGap","10px"],["mat-table","","formArrayName","contactPersons","aria-label","Osoby do kontaktu",3,"dataSource",4,"ngIf","ngIfElse"],[1,"row","align-items-end"],[1,"col-sm-4"],["formControlName","currentDegree","id","currentDegree","placeholder","Wykszta\u0142cenie","required",""],["role","option",3,"value",4,"ngFor","ngForOf"],[3,"control","controlName","lastLetter"],[1,"col-md-4"],["placeholder","Rok uko\u0144czenia","id","finishedYearSchool","formControlName","finishedYearSchool"],["matInput","","formControlName","finishedNameSchool","id","finishedNameSchool","type","text","placeholder","Nazwa szko\u0142y uko\u0144czenia",1,"form-control"],[3,"control","controlName","maxLength"],["matInput","","formControlName","profession","id","profession","type","text","placeholder","Zaw\xf3d, specjalno\u015b\u0107",1,"form-control"],["matInput","","formControlName","professionAcademicTitle","id","professionAcademicTitle","type","text","placeholder","stopie\u0144",1,"form-control"],["matInput","","formControlName","firstHigherTitleDate","id","firstHigherTitleDate",3,"matDatepicker","max"],["matSuffix","",3,"for"],["picker",""],[1,"col-md-12","custom-radio"],["formControlName","firstHigherTitle","id","firstHigherTitle","required",""],[3,"value",4,"ngFor","ngForOf"],["class","error",4,"ngIf"],["title","Dodaj\n      kursy, studia podyplomowe (itp.)",1,"btn","btn-primary","btn-add",3,"click"],[1,"row","w-100"],["formArrayName","supplementaryEducations","class","crew-cointainer shadow",4,"ngFor","ngForOf"],[1,"col"],["mat-table","","formArrayName","works","aria-label","Praca",3,"dataSource",4,"ngIf","ngIfElse"],[1,"col-md-12"],["formControlName","isAgree","id","isAgree","required",""],["matInput","","formControlName","updateCity","id","updateCity","type","text","placeholder","Miejscowo\u015b\u0107","required","",1,"form-control"],["matInput","","formControlName","updateDate","id","updateDate","type","date","placeholder","Miejscowo\u015b\u0107","required","",1,"form-control"],["emptyInfo",""],["mat-table","","formArrayName","families","aria-label","Stan rodziny",3,"dataSource"],["cdkColumnDef","nameFamily"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"formGroupName",4,"matCellDef"],["cdkColumnDef","dobFamily"],["cdkColumnDef","relation"],["cdkColumnDef","action"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"formGroupName"],[3,"innerHTML"],["title","Edytuj czonka rodziny","tabindex","0","aria-hidden","false",1,"icon","action-icon",3,"click","keyup.enter"],["title","Usu\u0144 cz\u0142onka rodziny","tabindex","0","aria-hidden","false",1,"icon","action-icon",3,"click","keyup.enter"],["mat-header-row",""],["mat-row",""],["mat-table","","formArrayName","contactPersons","aria-label","Osoby do kontaktu",3,"dataSource"],["cdkColumnDef","name"],["cdkColumnDef","street"],["cdkColumnDef","phone"],["title","Edytuj osob\u0119 do kontaktu","tabindex","0","aria-hidden","false",1,"icon","action-icon",3,"click","keyup.enter"],["title","Usu\u0144 osob\u0119 do kontaktu","tabindex","0","aria-hidden","false",1,"icon","action-icon",3,"click","keyup.enter"],["role","option",3,"value"],[3,"value"],[1,"error"],["formArrayName","supplementaryEducations",1,"crew-cointainer","shadow"],[1,"row","crew-header"],[1,"float-right",3,"click"],[1,"row",3,"formGroupName"],[1,"col-sm-5"],["matInput","","formControlName","name","placeholder","Name"],["mat-table","","formArrayName","works","aria-label","Praca",3,"dataSource"],["matColumnDef","fromJob"],["matColumnDef","toJob"],["matColumnDef","companyName"],["matColumnDef","placeJob"],["matColumnDef","positionJob"],["matColumnDef","action"],["mat-row","",4,"matRowDef","matRowDefColumns"],["title","Edytuj prca\u0119","tabindex","0","aria-hidden","false",1,"icon","action-icon",3,"click","keyup.enter"],["title","Usu\u0144","tabindex","0","aria-hidden","false",1,"icon","action-icon",3,"click"],[1,"no-info-of-table"]],template:function(l,h){if(1&l&&(n.TgZ(0,"form",0),n.TgZ(1,"div",1),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n.TgZ(4,"h4",4),n.TgZ(5,"i",5),n._uU(6," account_circle "),n.qZA(),n._uU(7," Dane osobowe"),n.qZA(),n.TgZ(8,"div",1),n.TgZ(9,"div",6),n.TgZ(10,"mat-form-field"),n.TgZ(11,"mat-label"),n._uU(12,"Imi\u0119"),n.qZA(),n._UZ(13,"input",7),n.TgZ(14,"mat-error"),n._UZ(15,"app-validation-feedback",8),n.qZA(),n.qZA(),n.qZA(),n.TgZ(16,"div",9),n.TgZ(17,"mat-form-field"),n.TgZ(18,"mat-label"),n._uU(19,"Nazwisko"),n.qZA(),n._UZ(20,"input",10),n.TgZ(21,"mat-error"),n._UZ(22,"app-validation-feedback",8),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(23,"div",1),n.TgZ(24,"div",6),n.TgZ(25,"mat-form-field"),n.TgZ(26,"mat-label"),n._uU(27,"Login"),n.qZA(),n._UZ(28,"input",11),n.TgZ(29,"mat-error"),n._UZ(30,"app-validation-feedback",8),n.qZA(),n.qZA(),n.qZA(),n.TgZ(31,"div",6),n.TgZ(32,"mat-form-field"),n.TgZ(33,"mat-label"),n._uU(34,"Pesel"),n.qZA(),n.TgZ(35,"label"),n._UZ(36,"input",12),n.qZA(),n.TgZ(37,"mat-error"),n.YNc(38,et,3,2,"div",13),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(39,"div",2),n.TgZ(40,"div",3),n.TgZ(41,"h4",4),n.TgZ(42,"i",5),n._uU(43," home "),n.qZA(),n._uU(44," Adres zamieszkania"),n.qZA(),n.TgZ(45,"div",14),n.TgZ(46,"div",1),n.TgZ(47,"div",15),n.TgZ(48,"mat-form-field"),n.TgZ(49,"mat-label"),n._uU(50,"Adres"),n.qZA(),n._UZ(51,"input",16),n.TgZ(52,"mat-error"),n._UZ(53,"app-validation-feedback",17),n.qZA(),n.qZA(),n.qZA(),n.TgZ(54,"div",18),n.TgZ(55,"mat-form-field"),n.TgZ(56,"mat-label"),n._uU(57,"Miejscowo\u015b\u0107"),n.qZA(),n._UZ(58,"input",19),n.TgZ(59,"mat-error"),n._UZ(60,"app-validation-feedback",8),n.qZA(),n.qZA(),n.qZA(),n.TgZ(61,"div",18),n.TgZ(62,"mat-form-field"),n.TgZ(63,"mat-label"),n._uU(64,"Kod pocztowy"),n.qZA(),n._UZ(65,"input",20),n.TgZ(66,"mat-error"),n._UZ(67,"app-validation-feedback",21),n.qZA(),n.qZA(),n.qZA(),n.TgZ(68,"div",18),n.TgZ(69,"mat-form-field"),n.TgZ(70,"mat-label"),n._uU(71,"Telefon"),n.qZA(),n._UZ(72,"input",22),n.TgZ(73,"mat-error"),n._UZ(74,"app-validation-feedback",23),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(75,"div",2),n.TgZ(76,"div",3),n.TgZ(77,"div",24),n.TgZ(78,"h4",4),n.TgZ(79,"i",5),n._uU(80," people "),n.qZA(),n._uU(81," Stan rodziny"),n.qZA(),n.TgZ(82,"button",25),n.NdJ("click",function(){return h.openFamilyMemberDialog(null)}),n._uU(83,"+ "),n.qZA(),n.qZA(),n.YNc(84,Ft,15,3,"table",26),n.qZA(),n.qZA(),n.TgZ(85,"div",2),n.TgZ(86,"div",3),n.TgZ(87,"div",24),n.TgZ(88,"h4",27),n.TgZ(89,"i",5),n._uU(90," accessibility "),n.qZA(),n._uU(91," Osoba(y), kt\xf3r\u0105 nale\u017cy zawiadomi\u0107 w razie wypadku"),n.qZA(),n.TgZ(92,"button",28),n.NdJ("click",function(){return h.openContactPersonDialog(null)}),n._uU(93,"+"),n.qZA(),n.qZA(),n.TgZ(94,"div",29),n.YNc(95,Dt,15,3,"table",30),n.qZA(),n.qZA(),n.qZA(),n.TgZ(96,"div",2),n.TgZ(97,"div",3),n.TgZ(98,"h4",4),n.TgZ(99,"i",5),n._uU(100," school "),n.qZA(),n._uU(101," Wykszta\u0142cenie"),n.qZA(),n.TgZ(102,"div",31),n.TgZ(103,"div",32),n.TgZ(104,"mat-form-field"),n.TgZ(105,"mat-label"),n._uU(106,"Wykszta\u0142cenie:"),n.qZA(),n.TgZ(107,"mat-select",33),n.YNc(108,ue,2,2,"mat-option",34),n.qZA(),n.TgZ(109,"mat-error"),n._UZ(110,"app-validation-feedback",35),n.qZA(),n.qZA(),n.qZA(),n.TgZ(111,"div",36),n.TgZ(112,"mat-form-field"),n.TgZ(113,"mat-label"),n._uU(114,"Rok uko\u0144czenia:"),n.qZA(),n.TgZ(115,"mat-select",37),n.YNc(116,we,2,2,"mat-option",34),n.qZA(),n.qZA(),n.qZA(),n.TgZ(117,"div",36),n.TgZ(118,"mat-form-field"),n.TgZ(119,"mat-label"),n._uU(120,"Nazwa szko\u0142y:"),n.qZA(),n._UZ(121,"input",38),n.TgZ(122,"mat-error"),n._UZ(123,"app-validation-feedback",39),n.qZA(),n.qZA(),n.qZA(),n.TgZ(124,"div",36),n.TgZ(125,"mat-form-field"),n.TgZ(126,"mat-label"),n._uU(127,"Zaw\xf3d, specjalno\u015b\u0107:"),n.qZA(),n._UZ(128,"input",40),n.TgZ(129,"mat-error"),n._UZ(130,"app-validation-feedback",39),n.qZA(),n.qZA(),n.qZA(),n.TgZ(131,"div",36),n.TgZ(132,"mat-form-field"),n.TgZ(133,"mat-label"),n._uU(134,"Stopie\u0144 (tytu\u0142 zawodowy - naukowy):"),n.qZA(),n._UZ(135,"input",41),n.TgZ(136,"mat-error"),n._UZ(137,"app-validation-feedback",39),n.qZA(),n.qZA(),n.qZA(),n.TgZ(138,"div",36),n.TgZ(139,"mat-form-field"),n.TgZ(140,"mat-label"),n._uU(141,"Data uzyskania pierwszego tytu\u0142u zawodowego"),n.qZA(),n._UZ(142,"input",42),n._UZ(143,"mat-datepicker-toggle",43),n._UZ(144,"mat-datepicker",null,44),n.qZA(),n.qZA(),n.TgZ(146,"div",45),n._uU(147," Pierwszy tytu\u0142 zawodowy:* "),n.TgZ(148,"mat-radio-group",46),n.YNc(149,Hn,2,2,"mat-radio-button",47),n.qZA(),n.TgZ(150,"mat-error"),n.YNc(151,Ot,2,0,"div",48),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(152,"div",2),n.TgZ(153,"div",3),n.TgZ(154,"div",24),n.TgZ(155,"h4",27),n.TgZ(156,"i",5),n._uU(157," cast_for_education "),n.qZA(),n._uU(158," Wykszta\u0142cenie uzupe\u0142niaj\u0105ce"),n.qZA(),n.TgZ(159,"button",49),n.NdJ("click",function(){return h.openSupplementaryEducationDialog(null)}),n._uU(160,"+ "),n.qZA(),n.qZA(),n.TgZ(161,"div",50),n.YNc(162,Jn,11,2,"div",51),n.qZA(),n.qZA(),n.qZA(),n.TgZ(163,"div",2),n.TgZ(164,"div",3),n.TgZ(165,"div",24),n.TgZ(166,"h4",27),n.TgZ(167,"i",5),n._uU(168," timeline "),n.qZA(),n._uU(169," Przebieg pracy zawodowej"),n.qZA(),n.TgZ(170,"button",28),n.NdJ("click",function(){return h.openWorkDialog(null)}),n._uU(171,"+"),n.qZA(),n.qZA(),n.TgZ(172,"div",1),n.TgZ(173,"div",52),n.YNc(174,er,21,3,"table",53),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(175,"div",2),n.TgZ(176,"div",3),n.TgZ(177,"div",1),n.TgZ(178,"div",54),n.TgZ(179,"mat-checkbox",55),n.TgZ(180,"p"),n._uU(181," Wyra\u017cam zgod\u0119 na przetwarzanie moich danych osobowych w firmie XYZ.PL Sp. z o. o. Jednocze\u015bnie o\u015bwiadczam, \u017ce przekazuj\u0119 moje dane osobowe ca\u0142kowicie dobrowolnie. O\u015bwiadczam ponadto, \u017ce zosta\u0142em/zosta\u0142am poinformowany/poinformowana o przys\u0142uguj\u0105cym mi prawie dost\u0119pu do tre\u015bci tych danych i mo\u017cliwo\u015bci ich poprawiania, a tak\u017ce o prawie wycofania zgody na przetwarzanie tych danych w ka\u017cdym czasie."),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(182,"div",31),n.TgZ(183,"mat-form-field"),n._UZ(184,"input",56),n.TgZ(185,"mat-error"),n._UZ(186,"app-validation-feedback",8),n.qZA(),n.qZA(),n.TgZ(187,"mat-form-field"),n._UZ(188,"input",57),n.TgZ(189,"mat-error"),n._UZ(190,"app-validation-feedback",8),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.YNc(191,tr,3,0,"ng-template",null,58,n.W1O),n.qZA(),n.qZA()),2&l){const _=n.MAs(145),v=n.MAs(192);n.Q6J("formGroup",h.employeeForm),n.xp6(15),n.Q6J("control",h.employeeForm.get("firstName"))("controlName","Imi\u0119")("maxLength","50")("lastLetter","e"),n.xp6(7),n.Q6J("control",h.employeeForm.get("lastName"))("controlName","Nazwisko")("maxLength","50")("lastLetter","e"),n.xp6(8),n.Q6J("control",h.employeeForm.get("login"))("controlName","Login")("maxLength","50")("lastLetter","y"),n.xp6(8),n.Q6J("ngIf",(h.employeeForm.get("pesel").dirty||h.employeeForm.get("pesel").touched||h.employeeForm.get("pesel").pristine)&&h.employeeForm.get("pesel").invalid),n.xp6(15),n.Q6J("control",h.employeeForm.get("employeeAddress").get("street"))("minLength","3")("controlName","Adres")("maxLength","50")("lastLetter","y"),n.xp6(7),n.Q6J("control",h.employeeForm.get("employeeAddress").get("city"))("controlName","Miejscowo\u015b\u0107")("maxLength","20")("lastLetter","a"),n.xp6(7),n.Q6J("control",h.employeeForm.get("employeeAddress").get("zipcode"))("controlName","Kod pocztowy")("maxLength","5")("pattern",!0)("minLength",5)("lastLetter","y"),n.xp6(7),n.Q6J("control",h.employeeForm.get("employeeAddress").get("telephone"))("controlName","Telefon")("minLength",9)("pattern",!0)("maxLength",12)("lastLetter","y"),n.xp6(10),n.Q6J("ngIf",h.familyRows&&h.familyRows.length>0)("ngIfElse",v),n.xp6(11),n.Q6J("ngIf",h.contactPersonRows&&h.contactPersonRows.length>0)("ngIfElse",v),n.xp6(13),n.Q6J("ngForOf",h.currentDegrees),n.xp6(2),n.Q6J("control",h.employeeForm.get("currentDegree"))("controlName","Wykszta\u0142cenie")("lastLetter","e"),n.xp6(6),n.Q6J("ngForOf",h.years),n.xp6(7),n.Q6J("control",h.employeeForm.get("finishedNameSchool"))("controlName","Nazwa szko\u0142y uko\u0144czenia")("maxLength","255"),n.xp6(7),n.Q6J("control",h.employeeForm.get("profession"))("controlName","Zaw\xf3d, specjalno\u015b\u0107")("maxLength",100),n.xp6(7),n.Q6J("control",h.employeeForm.get("professionAcademicTitle"))("controlName","Stopie\u0144")("maxLength","40"),n.xp6(5),n.Q6J("matDatepicker",_)("max",h.date),n.xp6(1),n.Q6J("for",_),n.xp6(6),n.Q6J("ngForOf",h.TITLES),n.xp6(2),n.Q6J("ngIf",h.employeeForm.get("firstHigherTitle").hasError("required")&&h.isClicked),n.xp6(11),n.Q6J("ngForOf",h.supplEducation.controls),n.xp6(12),n.Q6J("ngIf",h.workRows&&h.workRows.length>0)("ngIfElse",v),n.xp6(12),n.Q6J("control",h.employeeForm.get("updateCity"))("controlName","Miejscowo\u015b\u0107")("maxLength","20")("lastLetter","a"),n.xp6(4),n.Q6J("control",h.employeeForm.get("updateCity"))("controlName","Miejscowo\u015b\u0107")("maxLength","20")("lastLetter","a")}},directives:[L._Y,L.JL,L.sg,V.KE,V.hX,ft.Nt,L.Fj,L.JJ,L.u,L.Q7,V.TO,Un,ae.O5,L.x0,dt.gD,ae.sg,Ge.hl,Ge.nW,V.R9,Ge.Mq,Pe.VQ,$e.oG,$e.e_,H.BZ,L.CE,Ke.fo,H.fO,H.Dz,Ke.s$,Ke.Sq,H.ge,H.ev,ht.Hw,H.XQ,H.Gk,Xe.ey,Pe.U0,H.w1,H.nj],pipes:[ae.uU],styles:[".invalid[_ngcontent-%COMP%]{color:#f44336}.mat-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:16px}form[_ngcontent-%COMP%]{padding:15px}.custom-radio[_ngcontent-%COMP%]{line-height:2.5}button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:22px}.action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:5px}.error[_ngcontent-%COMP%]{font-size:75%}"]}),a})();var qt=k(3738);const pn=["employeeFormValues"];let hn=(()=>{class a{constructor(l,h,_){this.snackBarService=l,this.router=h,this.employeeService=_,this.eventSubmit=new n.vpe,this.date=new Date,this.subscription=new ot.w}ngOnInit(){}saveEmployee(){if(console.log("Data 1",this.date),console.log("Data 2",this.employeeFormValues.employeeForm.get("updateDate")),this.employeeFormValues.employeeForm.invalid)return this.employeeFormValues.isClicked=!0,this.employeeFormValues.employeeForm.markAllAsTouched(),void this.snackBarService.open("Wype\u0142nij formularz ","",{panelClass:"snack-error"});console.log("w add value",this.employeeFormValues.employeeForm.value),this.employeeService.addEmployee(this.employeeFormValues.employeeForm.value).then(this.onEditSuccess.bind(this),this.onFailure.bind(this))}onEditSuccess(){this.router.navigate(["/dashboard/"]),this.snackBarService.open("Zosta\u0142o pomy\u015blnie zapisane","",{panelClass:"toast-success"})}onFailure(l){this.snackBarService.open(l.message,"",{panelClass:"toast-error"})}}return a.\u0275fac=function(l){return new(l||a)(n.Y36(We.ux),n.Y36(m.F0),n.Y36(Le))},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-new-employee"]],viewQuery:function(l,h){if(1&l&&n.Gf(pn,5),2&l){let _;n.iGM(_=n.CRH())&&(h.employeeFormValues=_.first)}},outputs:{eventSubmit:"eventSubmit"},decls:11,vars:0,consts:[[1,"data-container"],[1,"h1-employee"],["employeeFormValues",""],["align","end"],["role","group",1,"btn-group","d-flex"],["mat-button","",1,"btn","btn-sm","btn-secondary","w-75",3,"click"],["mat-button","",1,"btn","btn-large","btn-success","w-75",3,"click"]],template:function(l,h){if(1&l){const _=n.EpF();n.TgZ(0,"div",0),n.TgZ(1,"h1",1),n._uU(2,"Kwestionariusz osobowy dla pracownika "),n.qZA(),n._UZ(3,"app-employee-form",null,2),n.TgZ(5,"mat-card-actions",3),n.TgZ(6,"div",4),n.TgZ(7,"button",5),n.NdJ("click",function(){return n.CHM(_),n.MAs(4).onCloseWithoutChanges()}),n._uU(8,"Zamknij"),n.qZA(),n.TgZ(9,"button",6),n.NdJ("click",function(){return h.saveEmployee()}),n._uU(10,"Dodaj"),n.qZA(),n.qZA(),n.qZA(),n.qZA()}},directives:[tt,qt.hq,qe.lW],styles:[".account-list-table[_ngcontent-%COMP%]{margin-top:15px;min-width:600px}.account-list-table[_ngcontent-%COMP%]   .mat-column-actions[_ngcontent-%COMP%]{padding-right:5px}.account-list-content[_ngcontent-%COMP%]{max-width:1200px}.add-button[_ngcontent-%COMP%]{background-color:#b8c5cf;color:#fff}.no-info-of-table[_ngcontent-%COMP%]{text-align:left;font-size:14px;text-transform:uppercase;font-weight:700;color:#e2e8ec;padding:20px;background:#ffffff}"]}),a})();var nr=k(3342);const rr=["employeeFormValues"];let fn=(()=>{class a{constructor(l,h,_,v){this.route=l,this.employeeService=h,this.router=_,this.snackBarService=v,this.date=new Date}ngOnInit(){}ngAfterViewInit(){this.loadEmployee()}loadEmployee(){const l=this.route.snapshot.params.key;console.log("key edit",l),this.employeeService.getEmployee(l).pipe((0,nr.b)(h=>{console.log("employe values w load 1",h,this.employeeFormValues),this.employeeFormValues.setEmployee(h),console.log("employe values w load 2",this.employeeFormValues)})).subscribe(h=>{this.employee=h,console.log("w subscriberze",h)}),console.log("employee w load",this.employee)}editEmployee(){if(console.log("values",this.employeeFormValues.employeeForm.value),this.employeeFormValues.employeeForm.invalid)return this.employeeFormValues.isClicked=!0,this.employeeFormValues.employeeForm.markAllAsTouched(),void this.snackBarService.open("Wype\u0142nij formularz ","",{panelClass:"snack-error"});console.log("employee",this.employee),this.employeeService.editEmployee(this.employee.key,this.employeeFormValues.employeeForm.value).then(this.onEditSuccess.bind(this),this.onFailure.bind(this))}onEditSuccess(){this.router.navigate(["/dashboard/"]),this.snackBarService.open("Zosta\u0142o pomy\u015blnie zapisane","",{panelClass:"toast-success"})}onRemoveSuccess(){this.router.navigate(["/dashboard/"]),this.snackBarService.open("Flight has been sucessfull removed","",{panelClass:"toast-success"})}onFailure(l){this.snackBarService.open(l.message,"",{panelClass:"toast-error"})}}return a.\u0275fac=function(l){return new(l||a)(n.Y36(m.gz),n.Y36(Le),n.Y36(m.F0),n.Y36(We.ux))},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-edit-employee"]],viewQuery:function(l,h){if(1&l&&n.Gf(rr,5),2&l){let _;n.iGM(_=n.CRH())&&(h.employeeFormValues=_.first)}},decls:13,vars:2,consts:[[1,"data-container"],[1,"h1-employee"],[3,"editMode"],["employeeFormValues",""],["align","end"],["role","group",1,"btn-group","d-flex"],["mat-button","",1,"btn","btn-sm","btn-secondary","w-75",3,"click"],["mat-button","",1,"btn","btn-large","btn-success","w-75",3,"click"]],template:function(l,h){if(1&l){const _=n.EpF();n.TgZ(0,"div",0),n.TgZ(1,"h1",1),n._uU(2,"Kwestionariusz osobowy dla pracownika "),n.TgZ(3,"strong"),n._uU(4),n.qZA(),n.qZA(),n._UZ(5,"app-employee-form",2,3),n.TgZ(7,"mat-card-actions",4),n.TgZ(8,"div",5),n.TgZ(9,"button",6),n.NdJ("click",function(){return n.CHM(_),n.MAs(6).onCloseWithoutChanges()}),n._uU(10,"Zamknij"),n.qZA(),n.TgZ(11,"button",7),n.NdJ("click",function(){return h.editEmployee()}),n._uU(12,"Zapisz"),n.qZA(),n.qZA(),n.qZA(),n.qZA()}2&l&&(n.xp6(4),n.hij(" ",null==h.employee?null:h.employee.key,"- edycja"),n.xp6(1),n.Q6J("editMode",!0))},directives:[tt,qt.hq,qe.lW],styles:[""]}),a})();var dn=k(9692),Qt=k(1494);function yt(a,p){if(1&a&&(n.TgZ(0,"tr",26),n.TgZ(1,"td"),n._uU(2),n.qZA(),n.TgZ(3,"td"),n._uU(4),n.qZA(),n.TgZ(5,"td"),n._uU(6),n.qZA(),n.TgZ(7,"td"),n._uU(8),n.qZA(),n.qZA()),2&a){const l=p.$implicit,h=p.index,_=n.oxw(2);n.xp6(2),n.Oqu(h+1),n.xp6(2),n.hij(" ",l.nameFamily,""),n.xp6(2),n.hij(" ",l.dobFamily," "),n.xp6(2),n.hij(" ",_.FamilyRelation[l.relation],"")}}function mn(a,p){if(1&a&&(n.TgZ(0,"table",24),n.TgZ(1,"thead"),n.TgZ(2,"tr"),n.TgZ(3,"th"),n._uU(4,"nr"),n.qZA(),n.TgZ(5,"th"),n._uU(6,"imi\u0119(imiona) i nazwisko"),n.qZA(),n.TgZ(7,"th"),n._uU(8," data ur"),n.qZA(),n.TgZ(9,"th"),n._uU(10,"pokrewie\u0144stwo"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(11,"tbody"),n.YNc(12,yt,9,4,"tr",25),n.qZA(),n.qZA()),2&a){const l=n.oxw();n.xp6(12),n.Q6J("ngForOf",l.employee.families)}}function _n(a,p){if(1&a&&(n.TgZ(0,"tr",26),n.TgZ(1,"td"),n._uU(2),n.qZA(),n.TgZ(3,"td"),n._uU(4),n.qZA(),n.TgZ(5,"td"),n._uU(6),n.qZA(),n.TgZ(7,"td"),n._uU(8),n.qZA(),n.qZA()),2&a){const l=p.$implicit,h=p.index;n.xp6(2),n.Oqu(h+1),n.xp6(2),n.hij(" ",l.contactPersonName,""),n.xp6(2),n.lnq(" ",l.contactPersonAddress.street," ",l.contactPersonAddress.zipcode," ",l.contactPersonAddress.city,""),n.xp6(2),n.hij(" ",l.contactPersonAddress.telephone,"")}}function ir(a,p){if(1&a&&(n.TgZ(0,"table",24),n.TgZ(1,"thead"),n.TgZ(2,"tr"),n.TgZ(3,"th"),n._uU(4,"Nr"),n.qZA(),n.TgZ(5,"th"),n._uU(6,"Imi\u0119 i nazwisko"),n.qZA(),n.TgZ(7,"th"),n._uU(8," Adres"),n.qZA(),n.TgZ(9,"th"),n._uU(10,"Telefon"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(11,"tbody"),n.YNc(12,_n,9,6,"tr",25),n.qZA(),n.qZA()),2&a){const l=n.oxw();n.xp6(12),n.Q6J("ngForOf",l.employee.contactPersons)}}function or(a,p){if(1&a&&(n.TgZ(0,"span"),n._uU(1),n.qZA()),2&a){const l=n.oxw().$implicit,h=n.oxw();n.xp6(1),n.AsE(" - ",l.educationDate," ",h.yesNo[l.during],"")}}function sr(a,p){if(1&a&&(n.TgZ(0,"li"),n._uU(1),n.YNc(2,or,2,2,"span",27),n.qZA()),2&a){const l=p.$implicit;n.xp6(1),n.hij(" ",l.name," "),n.xp6(1),n.Q6J("ngIf",l.educationDate||l.during)}}function ar(a,p){1&a&&n._UZ(0,"div")}function lr(a,p){1&a&&(n.TgZ(0,"p",28),n._uU(1,"tak"),n.qZA())}function yn(a,p){1&a&&(n.TgZ(0,"p",28),n._uU(1,"nie"),n.qZA())}function ur(a,p){if(1&a&&(n.TgZ(0,"tr",26),n.TgZ(1,"td"),n._uU(2),n.qZA(),n.TgZ(3,"td"),n._uU(4),n.qZA(),n.TgZ(5,"td"),n._uU(6),n.qZA(),n.TgZ(7,"td"),n._uU(8),n.qZA(),n.TgZ(9,"td"),n._uU(10),n.qZA(),n.qZA()),2&a){const l=p.$implicit;n.xp6(2),n.Oqu(l.fromJob),n.xp6(2),n.Oqu(l.toJob),n.xp6(2),n.hij(" ",l.companyName,""),n.xp6(2),n.hij(" ",l.placeJob,""),n.xp6(2),n.hij(" ",l.positionJob,"")}}function vn(a,p){if(1&a&&(n.TgZ(0,"table",24),n.TgZ(1,"thead"),n.TgZ(2,"tr"),n.TgZ(3,"th"),n._uU(4,"Okres od"),n.qZA(),n.TgZ(5,"th"),n._uU(6,"Okres do"),n.qZA(),n.TgZ(7,"th"),n._uU(8,"Nazwa zak\u0142adu pracy"),n.qZA(),n.TgZ(9,"th"),n._uU(10,"Miejscowo\u015b\u0107"),n.qZA(),n.TgZ(11,"th"),n._uU(12,"Stanowisko"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(13,"tbody"),n.YNc(14,ur,11,5,"tr",25),n.qZA(),n.qZA()),2&a){const l=n.oxw();n.xp6(14),n.Q6J("ngForOf",l.employee.works)}}function cr(a,p){1&a&&(n.TgZ(0,"div",29),n.TgZ(1,"p"),n._uU(2,"Brak"),n.qZA(),n.qZA())}function gn(a,p){1&a&&(n.TgZ(0,"div",30),n.TgZ(1,"p"),n._uU(2,"Brak informacji"),n.qZA(),n.qZA())}let En=(()=>{class a{constructor(l,h,_,v,w){this.employeeService=l,this.route=h,this.router=_,this.dialogRef=v,this.data=w,this.current=Te,this.TITLES=[]=Zt,this.FamilyRelation=Ne,this.yesNo=ke,this.FULL_DATE_FORMAT=en,this.employee=w}getTitle(l){return this.TITLES.filter(_=>l.firstHigherTitle===_.value).map(_=>_.label)}onCloseWithoutChanges(){this.dialogRef.close()}goToEditEmployee(){this.onCloseWithoutChanges(),this.router.navigate(["/dashboard/employees/edit",this.employee.key])}}return a.\u0275fac=function(l){return new(l||a)(n.Y36(Le),n.Y36(m.gz),n.Y36(m.F0),n.Y36(_e.so),n.Y36(_e.WI))},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-view-employee"]],inputs:{employee:"employee"},decls:144,vars:30,consts:[[1,"h1-employee"],[1,"shadow-sm","card","w-100"],[1,"card-body"],[1,"card-title","d-flex","align-items-center","section-header"],[1,"material-icons"],[1,"row"],[1,"col-md-4","float-right"],[1,"col-md-4"],[1,"col-md-3"],[1,"label"],[1,"col-md-12label"],[1,"col-md-12"],["class","cs-table table table-striped",4,"ngIf","ngIfElse"],[1,"d-flex","align-items-center","section-header"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfThen","ngIfElse"],["yes",""],["no",""],["noWorkInfo",""],[1,"col"],["role","group",1,"btn-group","d-flex"],["mat-button","",1,"btn","btn-large","btn-secondary","w-75",3,"click"],["mat-button","",1,"btn","btn-large","btn-success","w-75",3,"click"],["emptyInfo",""],[1,"cs-table","table","table-striped"],["class","row-contact",4,"ngFor","ngForOf"],[1,"row-contact"],[4,"ngIf"],[1,"work"],[1,"no-Work-Info"],[1,"no-info-of-table"]],template:function(l,h){if(1&l&&(n.TgZ(0,"mat-dialog-content"),n.TgZ(1,"h1",0),n._uU(2,"Kwestionariusz osobowy dla pracownika "),n.TgZ(3,"strong"),n._uU(4),n.qZA(),n.qZA(),n.TgZ(5,"div",1),n.TgZ(6,"div",2),n.TgZ(7,"h4",3),n.TgZ(8,"i",4),n._uU(9," account_circle "),n.qZA(),n._uU(10," Dane osobowe"),n.qZA(),n.TgZ(11,"div",5),n.TgZ(12,"div",6),n.TgZ(13,"p"),n._uU(14,"Nazwisko:"),n.qZA(),n._uU(15),n.qZA(),n.TgZ(16,"div",7),n.TgZ(17,"p"),n._uU(18,"Imi\u0119 (imiona): "),n.qZA(),n._uU(19),n.qZA(),n.TgZ(20,"div",7),n.TgZ(21,"p"),n._uU(22,"PESEL: "),n.qZA(),n._uU(23),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(24,"div",1),n.TgZ(25,"div",2),n.TgZ(26,"h4",3),n.TgZ(27,"i",4),n._uU(28," home "),n.qZA(),n._uU(29," Adres zamieszkania"),n.qZA(),n.TgZ(30,"div",5),n.TgZ(31,"div",8),n.TgZ(32,"p",9),n._uU(33,"Adres:"),n.qZA(),n._uU(34),n.qZA(),n.TgZ(35,"div",8),n.TgZ(36,"p",9),n._uU(37,"Miejscowo\u015b\u0107:"),n.qZA(),n._uU(38),n.qZA(),n.TgZ(39,"div",8),n.TgZ(40,"p",9),n._uU(41,"Kod pocztowy: "),n.qZA(),n._uU(42),n.qZA(),n.TgZ(43,"div",8),n.TgZ(44,"p",10),n._uU(45,"Telefon:"),n.qZA(),n._uU(46),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(47,"div",1),n.TgZ(48,"div",2),n.TgZ(49,"h4",3),n.TgZ(50,"i",4),n._uU(51," people "),n.qZA(),n._uU(52," Stan rodziny"),n.qZA(),n.TgZ(53,"div",5),n.TgZ(54,"div",11),n.YNc(55,mn,13,1,"table",12),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(56,"div",1),n.TgZ(57,"div",2),n.TgZ(58,"h4",13),n.TgZ(59,"i",4),n._uU(60," accessibility "),n.qZA(),n._uU(61," Osoba(y), kt\xf3r\u0105 nale\u017cy zawiadomi\u0107 w razie wypadku"),n.qZA(),n.TgZ(62,"div",5),n.TgZ(63,"div",11),n.YNc(64,ir,13,1,"table",12),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(65,"div",1),n.TgZ(66,"div",2),n.TgZ(67,"h4",3),n.TgZ(68,"i",4),n._uU(69," school "),n.qZA(),n._uU(70," Wykszta\u0142cenie"),n.qZA(),n.TgZ(71,"div",5),n.TgZ(72,"div",7),n.TgZ(73,"p"),n._uU(74,"Wykszta\u0142cenie:"),n.qZA(),n._uU(75),n.qZA(),n.TgZ(76,"div",7),n.TgZ(77,"p"),n._uU(78,"Rok uko\u0144czenia:"),n.qZA(),n._uU(79),n.qZA(),n.TgZ(80,"div",7),n.TgZ(81,"p"),n._uU(82,"Nazwa szko\u0142y uko\u0144czenia: "),n.qZA(),n._uU(83),n.qZA(),n.TgZ(84,"div",7),n.TgZ(85,"p"),n._uU(86,"Stopie\u0144 (tytu\u0142 naukowy):"),n.qZA(),n._uU(87),n.qZA(),n.TgZ(88,"div",7),n.TgZ(89,"p"),n._uU(90,"Data uzyskania pierwszego tytu\u0142u zawodowego: "),n.qZA(),n._uU(91),n.qZA(),n.TgZ(92,"div",7),n.TgZ(93,"p"),n._uU(94,"Pierwszy tytu\u0142 zawodowy:"),n.qZA(),n._uU(95),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(96,"div",1),n.TgZ(97,"div",2),n.TgZ(98,"h4",13),n.TgZ(99,"i",4),n._uU(100," cast_for_education "),n.qZA(),n._uU(101," Wykszta\u0142cenie uzupe\u0142niaj\u0105ce"),n.qZA(),n.TgZ(102,"p"),n._uU(103," (kursy, studia podyplomowe, data uko\u0144czenia lub rozpocz\u0119cia nauki w przypadku jej trwania):"),n.qZA(),n.TgZ(104,"div",5),n.TgZ(105,"div",11),n.TgZ(106,"ul"),n.YNc(107,sr,3,2,"li",14),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(108,"div",1),n.TgZ(109,"div",2),n.TgZ(110,"h4",13),n.TgZ(111,"i",4),n._uU(112," timeline "),n.qZA(),n._uU(113," Przebieg pracy zawodowej"),n.qZA(),n.TgZ(114,"div",11),n.TgZ(115,"p"),n._uU(116,"Pierwsza praca na umow\u0119 o prac\u0119"),n.qZA(),n.YNc(117,ar,1,0,"div",15),n.YNc(118,lr,2,0,"ng-template",null,16,n.W1O),n.YNc(120,yn,2,0,"ng-template",null,17,n.W1O),n.qZA(),n.TgZ(122,"div",5),n.TgZ(123,"div",11),n.YNc(124,vn,15,1,"table",12),n.YNc(125,cr,3,0,"ng-template",null,18,n.W1O),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(127,"div",1),n.TgZ(128,"div",2),n.TgZ(129,"div",5),n.TgZ(130,"div",19),n.TgZ(131,"p"),n._uU(132," Wyra\u017cam zgod\u0119 na przetwarzanie moich danych osobowych w firmie XYZ Sp. z o. o. Jednocze\u015bnie o\u015bwiadczam, \u017ce przekazuj\u0119 moje dane osobowe ca\u0142kowicie dobrowolnie. O\u015bwiadczam ponadto, \u017ce zosta\u0142em/zosta\u0142am poinformowany/poinformowana o przys\u0142uguj\u0105cym mi prawie dost\u0119pu do tre\u015bci tych danych i mo\u017cliwo\u015bci ich poprawiania, a tak\u017ce o prawie wycofania zgody na przetwarzanie tych danych w ka\u017cdym czasie."),n.qZA(),n.qZA(),n.qZA(),n.TgZ(133,"div",5),n.TgZ(134,"div",19),n._uU(135),n.ALo(136,"date"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(137,"div",20),n.TgZ(138,"button",21),n.NdJ("click",function(){return h.onCloseWithoutChanges()}),n._uU(139,"Zamknij"),n.qZA(),n.TgZ(140,"button",22),n.NdJ("click",function(){return h.goToEditEmployee()}),n._uU(141,"Edytuj"),n.qZA(),n.qZA(),n.YNc(142,gn,3,0,"ng-template",null,23,n.W1O),n.qZA(),n.qZA()),2&l){const _=n.MAs(119),v=n.MAs(121),w=n.MAs(126),F=n.MAs(143);n.xp6(4),n.hij(" ",null==h.employee?null:h.employee.login,""),n.xp6(11),n.hij(" ",null==h.employee?null:h.employee.lastName,""),n.xp6(4),n.Oqu(h.employee.firstName),n.xp6(4),n.Oqu(h.employee.pesel),n.xp6(11),n.hij(" ",h.employee.employeeAddress.street,""),n.xp6(4),n.hij(" ",h.employee.employeeAddress.city,""),n.xp6(4),n.Oqu(h.employee.employeeAddress.zipcode),n.xp6(4),n.hij(" ",h.employee.employeeAddress.telephone,""),n.xp6(9),n.Q6J("ngIf",h.employee.families&&h.employee.families.length>0)("ngIfElse",F),n.xp6(9),n.Q6J("ngIf",h.employee.contactPersons&&h.employee.contactPersons.length>0)("ngIfElse",F),n.xp6(11),n.hij(" ",h.current[h.employee.currentDegree],""),n.xp6(4),n.hij(" ",h.employee.finishedYearSchool,""),n.xp6(4),n.Oqu(h.employee.finishedNameSchool),n.xp6(4),n.AsE("",null==h.employee?null:h.employee.profession," ",null==h.employee?null:h.employee.professionAcademicTitle," "),n.xp6(4),n.hij("",h.employee.firstHigherTitleDate," "),n.xp6(4),n.Oqu(h.getTitle(h.employee)),n.xp6(12),n.Q6J("ngForOf",h.employee.supplementaryEducations),n.xp6(10),n.Q6J("ngIf",h.employee.isFirstWork)("ngIfThen",_)("ngIfElse",v),n.xp6(7),n.Q6J("ngIf",h.employee.works&&h.employee.works.length>0)("ngIfElse",w),n.xp6(11),n.AsE("Miejscowo\u015b\u0107 ",h.employee.updateCity,", dnia ",n.xi3(136,27,h.employee.updateDate,h.FULL_DATE_FORMAT)," ")}},directives:[_e.xY,ae.O5,ae.sg,qe.lW],pipes:[ae.uU],styles:[".work[_ngcontent-%COMP%]{text-transform:uppercase;font-style:normal;color:#000}"]}),a})();function pr(a,p){1&a&&(n.TgZ(0,"th",17),n._uU(1," Login"),n.qZA())}function hr(a,p){if(1&a&&(n.TgZ(0,"td",18),n._uU(1),n.qZA()),2&a){const l=p.$implicit;n.xp6(1),n.hij(" ",l.login," ")}}function Cn(a,p){1&a&&(n.TgZ(0,"th",17),n._uU(1," Imi\u0119"),n.qZA())}function Tn(a,p){if(1&a&&(n.TgZ(0,"td",18),n._uU(1),n.qZA()),2&a){const l=p.$implicit;n.xp6(1),n.hij(" ",l.firstName," ")}}function bn(a,p){1&a&&(n.TgZ(0,"th",17),n._uU(1," Nazwisko"),n.qZA())}function fr(a,p){if(1&a&&(n.TgZ(0,"td",18),n._uU(1),n.qZA()),2&a){const l=p.$implicit;n.xp6(1),n.hij(" ",l.lastName," ")}}function dr(a,p){1&a&&(n.TgZ(0,"th",19),n._uU(1," Akcja"),n.qZA())}function mr(a,p){if(1&a){const l=n.EpF();n.TgZ(0,"td",18),n.TgZ(1,"button",20),n.NdJ("click",function(){const v=n.CHM(l).$implicit;return n.oxw().showDetails(v)}),n.TgZ(2,"mat-icon",21),n._uU(3,"reorder"),n.qZA(),n.qZA(),n.TgZ(4,"button",22),n.NdJ("click",function(){const v=n.CHM(l).$implicit;return n.oxw().goToEditEmployee(v)}),n.TgZ(5,"mat-icon",21),n._uU(6,"mode"),n.qZA(),n.qZA(),n.qZA()}}function _r(a,p){1&a&&(n.TgZ(0,"th",19),n._uU(1," Usu\u0144"),n.qZA())}function yr(a,p){1&a&&(n.TgZ(0,"td",18),n.TgZ(1,"button",23),n.TgZ(2,"mat-icon",21),n._uU(3,"delete"),n.qZA(),n.qZA(),n.qZA())}function wn(a,p){1&a&&n._UZ(0,"tr",24)}function An(a,p){1&a&&n._UZ(0,"tr",25)}function vr(a,p){if(1&a&&(n.TgZ(0,"td",26),n._UZ(1,"mat-paginator",27),n.qZA()),2&a){const l=n.oxw();n.Q6J("colSpan",l.displayedColumns.length),n.xp6(1),n.Q6J("length",l.totalSize)("pageSize",l.pageSize)("pageSizeOptions",l.pageSizeOptions)("showFirstLastButtons",!0)}}function gr(a,p){1&a&&n._UZ(0,"tr",28)}const Er=function(){return["paginator"]},Cr=[{path:"",component:(()=>{class a{constructor(l,h,_,v){this.employeesService=l,this.router=h,this.dialog=_,this.route=v,this.dataSource=new H.by,this.displayedColumns=["login","firstName","lastName","actions","delete"],this.employees$=this.employeesService.getEmployeesFromProjector(),this.pageSize=25,this.totalSize=0,this.pageSizeOptions=[5,10,25,100]}ngOnInit(){this.employeesService.getEmployeesFromProjector().subscribe(l=>{this.employees=l,this.dataSource.data=l,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.totalSize=this.employees.length},l=>{console.log(l.status)})}showDetails(l){console.log("Employee jak idzie do view ",l),this.dialog.open(En,{data:l})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}addEmployee(){this.router.navigate(["/dashboard/employees/new/"])}goToEditEmployee(l){console.log("Employee jak idzie do edit ",l),this.router.navigate(["/dashboard/employees/edit/",l.key])}}return a.\u0275fac=function(l){return new(l||a)(n.Y36(Le),n.Y36(m.F0),n.Y36(_e.uw),n.Y36(m.gz))},a.\u0275cmp=n.Xpm({type:a,selectors:[["app-employees"]],viewQuery:function(l,h){if(1&l&&(n.Gf(dn.NW,5),n.Gf(Qt.YE,5)),2&l){let _;n.iGM(_=n.CRH())&&(h.paginator=_.first),n.iGM(_=n.CRH())&&(h.sort=_.first)}},decls:27,vars:6,consts:[[1,"data-container"],["matSort","","matTableFilter","",1,"table","table-striped","w-100",3,"dataSource"],["table",""],["matColumnDef","login"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","firstName"],["matColumnDef","lastName"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","delete"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["matColumnDef","paginator"],["mat-footer-cell","",3,"colSpan",4,"matFooterCellDef"],["mat-footer-row","",4,"matFooterRowDef","matFooterRowDefSticky"],["mat-fab","","color","accent","id","new-questionnaire-btn",3,"click"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","primary",3,"click"],[1,"mat-18"],["mat-icon-button","","color","accent","title","Edytuj",3,"click"],["mat-icon-button","","color","warn","title","Usu\u0144"],["mat-header-row",""],["mat-row",""],["mat-footer-cell","",3,"colSpan"],[3,"length","pageSize","pageSizeOptions","showFirstLastButtons"],["mat-footer-row",""]],template:function(l,h){1&l&&(n.TgZ(0,"div",0),n.TgZ(1,"mat-table",1,2),n.ynx(3,3),n.YNc(4,pr,2,0,"th",4),n.YNc(5,hr,2,1,"td",5),n._UZ(6,"p"),n.BQk(),n._uU(7," > "),n.ynx(8,6),n.YNc(9,Cn,2,0,"th",4),n.YNc(10,Tn,2,1,"td",5),n.BQk(),n.ynx(11,7),n.YNc(12,bn,2,0,"th",4),n.YNc(13,fr,2,1,"td",5),n.BQk(),n.ynx(14,8),n.YNc(15,dr,2,0,"th",9),n.YNc(16,mr,7,0,"td",5),n.BQk(),n.ynx(17,10),n.YNc(18,_r,2,0,"th",9),n.YNc(19,yr,4,0,"td",5),n.BQk(),n.YNc(20,wn,1,0,"tr",11),n.YNc(21,An,1,0,"tr",12),n.ynx(22,13),n.YNc(23,vr,2,5,"td",14),n.BQk(),n.YNc(24,gr,1,0,"tr",15),n.qZA(),n.TgZ(25,"button",16),n.NdJ("click",function(){return h.addEmployee()}),n._uU(26," + "),n.qZA(),n.qZA()),2&l&&(n.xp6(1),n.Q6J("dataSource",h.dataSource),n.xp6(19),n.Q6J("matHeaderRowDef",h.displayedColumns),n.xp6(1),n.Q6J("matRowDefColumns",h.displayedColumns),n.xp6(3),n.Q6J("matFooterRowDef",n.DdM(5,Er))("matFooterRowDefSticky",!0))},directives:[H.BZ,Qt.YE,H.w1,H.fO,H.Dz,H.as,H.nj,H.mD,H.Ke,qe.lW,H.ge,Qt.nU,H.ev,ht.Hw,H.XQ,H.Gk,H.yh,dn.NW,H.Q2],styles:[""]}),a})()},{path:"view/:key",component:En},{path:"edit/:key",component:fn,data:{isAdded:!0}},{path:"new",component:hn,data:{isAdded:!1}}];let Wt=(()=>{class a{}return a.\u0275fac=function(l){return new(l||a)},a.\u0275mod=n.oAB({type:a}),a.\u0275inj=n.cJS({imports:[[m.Bz.forChild(Cr)],m.Bz]}),a})();var Tr=k(4466);let br=(()=>{class a{}return a.\u0275fac=function(l){return new(l||a)},a.\u0275mod=n.oAB({type:a}),a.\u0275inj=n.cJS({imports:[[ae.ez,M.q,Wt,L.UX,Tr.m]]}),a})()},209:(Zn,ie,k)=>{k.r(ie),k.d(ie,{__extends:()=>M,__assign:()=>m,__rest:()=>n,__decorate:()=>ot,__param:()=>We,__metadata:()=>de,__awaiter:()=>gt,__generator:()=>Et,__createBinding:()=>st,__exportStar:()=>me,__values:()=>Re,__read:()=>ge,__spread:()=>ze,__spreadArrays:()=>at,__await:()=>pe,__asyncGenerator:()=>Ee,__asyncDelegator:()=>lt,__asyncValues:()=>Be,__makeTemplateObject:()=>G,__importStar:()=>xe,__importDefault:()=>Ve,__classPrivateFieldGet:()=>he,__classPrivateFieldSet:()=>K});var ae=function(C,S){return(ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,Z){b.__proto__=Z}||function(b,Z){for(var x in Z)Z.hasOwnProperty(x)&&(b[x]=Z[x])})(C,S)};function M(C,S){function b(){this.constructor=C}ae(C,S),C.prototype=null===S?Object.create(S):(b.prototype=S.prototype,new b)}var m=function(){return(m=Object.assign||function(S){for(var b,Z=1,x=arguments.length;Z<x;Z++)for(var A in b=arguments[Z])Object.prototype.hasOwnProperty.call(b,A)&&(S[A]=b[A]);return S}).apply(this,arguments)};function n(C,S){var b={};for(var Z in C)Object.prototype.hasOwnProperty.call(C,Z)&&S.indexOf(Z)<0&&(b[Z]=C[Z]);if(null!=C&&"function"==typeof Object.getOwnPropertySymbols){var x=0;for(Z=Object.getOwnPropertySymbols(C);x<Z.length;x++)S.indexOf(Z[x])<0&&Object.prototype.propertyIsEnumerable.call(C,Z[x])&&(b[Z[x]]=C[Z[x]])}return b}function ot(C,S,b,Z){var q,x=arguments.length,A=x<3?S:null===Z?Z=Object.getOwnPropertyDescriptor(S,b):Z;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)A=Reflect.decorate(C,S,b,Z);else for(var j=C.length-1;j>=0;j--)(q=C[j])&&(A=(x<3?q(A):x>3?q(S,b,A):q(S,b))||A);return x>3&&A&&Object.defineProperty(S,b,A),A}function We(C,S){return function(b,Z){S(b,Z,C)}}function de(C,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(C,S)}function gt(C,S,b,Z){return new(b||(b=Promise))(function(A,q){function j(z){try{O(Z.next(z))}catch(oe){q(oe)}}function re(z){try{O(Z.throw(z))}catch(oe){q(oe)}}function O(z){z.done?A(z.value):function(A){return A instanceof b?A:new b(function(q){q(A)})}(z.value).then(j,re)}O((Z=Z.apply(C,S||[])).next())})}function Et(C,S){var Z,x,A,q,b={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return q={next:j(0),throw:j(1),return:j(2)},"function"==typeof Symbol&&(q[Symbol.iterator]=function(){return this}),q;function j(O){return function(z){return function(O){if(Z)throw new TypeError("Generator is already executing.");for(;b;)try{if(Z=1,x&&(A=2&O[0]?x.return:O[0]?x.throw||((A=x.return)&&A.call(x),0):x.next)&&!(A=A.call(x,O[1])).done)return A;switch(x=0,A&&(O=[2&O[0],A.value]),O[0]){case 0:case 1:A=O;break;case 4:return b.label++,{value:O[1],done:!1};case 5:b.label++,x=O[1],O=[0];continue;case 7:O=b.ops.pop(),b.trys.pop();continue;default:if(!(A=(A=b.trys).length>0&&A[A.length-1])&&(6===O[0]||2===O[0])){b=0;continue}if(3===O[0]&&(!A||O[1]>A[0]&&O[1]<A[3])){b.label=O[1];break}if(6===O[0]&&b.label<A[1]){b.label=A[1],A=O;break}if(A&&b.label<A[2]){b.label=A[2],b.ops.push(O);break}A[2]&&b.ops.pop(),b.trys.pop();continue}O=S.call(C,b)}catch(z){O=[6,z],x=0}finally{Z=A=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,z])}}}function st(C,S,b,Z){void 0===Z&&(Z=b),C[Z]=S[b]}function me(C,S){for(var b in C)"default"!==b&&!S.hasOwnProperty(b)&&(S[b]=C[b])}function Re(C){var S="function"==typeof Symbol&&Symbol.iterator,b=S&&C[S],Z=0;if(b)return b.call(C);if(C&&"number"==typeof C.length)return{next:function(){return C&&Z>=C.length&&(C=void 0),{value:C&&C[Z++],done:!C}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function ge(C,S){var b="function"==typeof Symbol&&C[Symbol.iterator];if(!b)return C;var x,q,Z=b.call(C),A=[];try{for(;(void 0===S||S-- >0)&&!(x=Z.next()).done;)A.push(x.value)}catch(j){q={error:j}}finally{try{x&&!x.done&&(b=Z.return)&&b.call(Z)}finally{if(q)throw q.error}}return A}function ze(){for(var C=[],S=0;S<arguments.length;S++)C=C.concat(ge(arguments[S]));return C}function at(){for(var C=0,S=0,b=arguments.length;S<b;S++)C+=arguments[S].length;var Z=Array(C),x=0;for(S=0;S<b;S++)for(var A=arguments[S],q=0,j=A.length;q<j;q++,x++)Z[x]=A[q];return Z}function pe(C){return this instanceof pe?(this.v=C,this):new pe(C)}function Ee(C,S,b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var x,Z=b.apply(C,S||[]),A=[];return x={},q("next"),q("throw"),q("return"),x[Symbol.asyncIterator]=function(){return this},x;function q(X){Z[X]&&(x[X]=function(Ce){return new Promise(function(je,Ct){A.push([X,Ce,je,Ct])>1||j(X,Ce)})})}function j(X,Ce){try{!function(X){X.value instanceof pe?Promise.resolve(X.value.v).then(O,z):oe(A[0][2],X)}(Z[X](Ce))}catch(je){oe(A[0][3],je)}}function O(X){j("next",X)}function z(X){j("throw",X)}function oe(X,Ce){X(Ce),A.shift(),A.length&&j(A[0][0],A[0][1])}}function lt(C){var S,b;return S={},Z("next"),Z("throw",function(x){throw x}),Z("return"),S[Symbol.iterator]=function(){return this},S;function Z(x,A){S[x]=C[x]?function(q){return(b=!b)?{value:pe(C[x](q)),done:"return"===x}:A?A(q):q}:A}}function Be(C){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b,S=C[Symbol.asyncIterator];return S?S.call(C):(C=Re(C),b={},Z("next"),Z("throw"),Z("return"),b[Symbol.asyncIterator]=function(){return this},b);function Z(A){b[A]=C[A]&&function(q){return new Promise(function(j,re){!function(A,q,j,re){Promise.resolve(re).then(function(O){A({value:O,done:j})},q)}(j,re,(q=C[A](q)).done,q.value)})}}}function G(C,S){return Object.defineProperty?Object.defineProperty(C,"raw",{value:S}):C.raw=S,C}function xe(C){if(C&&C.__esModule)return C;var S={};if(null!=C)for(var b in C)Object.hasOwnProperty.call(C,b)&&(S[b]=C[b]);return S.default=C,S}function Ve(C){return C&&C.__esModule?C:{default:C}}function he(C,S){if(!S.has(C))throw new TypeError("attempted to get private field on non-instance");return S.get(C)}function K(C,S,b){if(!S.has(C))throw new TypeError("attempted to set private field on non-instance");return S.set(C,b),b}}}]);