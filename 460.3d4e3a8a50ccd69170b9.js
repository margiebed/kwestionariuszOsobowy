"use strict";(self.webpackChunkquestionnaire=self.webpackChunkquestionnaire||[]).push([[460],{4614:(Zt,J,L)=>{Object.defineProperty(J,"__esModule",{value:!0});var fe=L(6279),D=L(209),c=L(1704),s=L(300),Ke=L(1100);function Xe(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}var n,G=Xe(fe),Be=function(){function n(e){this.domStorage_=e,this.prefix_="firebase:"}return n.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),c.stringify(t))},n.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:c.jsonEval(t)},n.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},n.prototype.prefixedName_=function(e){return this.prefix_+e},n.prototype.toString=function(){return this.domStorage_.toString()},n}(),Fe=function(){function n(){this.cache_={},this.isInMemoryStorage=!0}return n.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},n.prototype.get=function(e){return c.contains(this.cache_,e)?this.cache_[e]:null},n.prototype.remove=function(e){delete this.cache_[e]},n}(),Ee=function(n){try{if("undefined"!=typeof window&&void 0!==window[n]){var e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Be(e)}}catch(t){}return new Fe},ne=Ee("localStorage"),Ce=Ee("sessionStorage"),de=new s.Logger("@firebase/database"),Te=(n=1,function(){return n++}),we=function(n){var e=c.stringToByteArray(n),t=new c.Sha1;t.update(e);var r=t.digest();return c.base64.encodeByteArray(r)},oe=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];for(var t="",r=0;r<n.length;r++){var i=n[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=oe.apply(null,i):t+="object"==typeof i?c.stringify(i):i,t+=" "}return t},ve=null,se=!0,Le=function(n,e){c.assert(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(de.logLevel=s.LogLevel.VERBOSE,ve=de.log.bind(de),e&&Ce.set("logging_enabled",!0)):"function"==typeof n?ve=n:(ve=null,Ce.remove("logging_enabled"))},j=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];if(!0===se&&(se=!1,null===ve&&!0===Ce.get("logging_enabled")&&Le(!0)),ve){var t=oe.apply(null,n);ve(t)}},Se=function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];j.apply(void 0,D.__spread([n],e))}},Ne=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t="FIREBASE INTERNAL ERROR: "+oe.apply(void 0,D.__spread(n));de.error(t)},ae=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t="FIREBASE FATAL ERROR: "+oe.apply(void 0,D.__spread(n));throw de.error(t),new Error(t)},z=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t="FIREBASE WARNING: "+oe.apply(void 0,D.__spread(n));de.warn(t)},T=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},I="[MIN_NAME]",N="[MAX_NAME]",w=function(n,e){if(n===e)return 0;if(n===I||e===N)return-1;if(e===I||n===N)return 1;var t=ht(n),r=ht(e);return null!==t?null!==r?t-r==0?n.length-e.length:t-r:-1:null!==r?1:n<e?-1:1},F=function(n,e){return n===e?0:n<e?-1:1},V=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+c.stringify(e))},ee=function(n){if("object"!=typeof n||null===n)return c.stringify(n);var e=[];for(var t in n)e.push(t);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=c.stringify(e[i]),r+=":",r+=ee(n[e[i]]);return r+"}"},x=function(n,e){var t=n.length;if(t<=e)return[n];for(var r=[],i=0;i<t;i+=e)r.push(n.substring(i,i+e>t?t:i+e));return r};function Z(n,e){for(var t in n)n.hasOwnProperty(t)&&e(t,n[t])}var ze,st,Pt,Dt,xt,O,K=function(n){c.assert(!T(n),"Invalid JSON number");var i,o,a,l,u,r=1023;0===n?(o=0,a=0,i=1/n==-1/0?1:0):(i=n<0,(n=Math.abs(n))>=Math.pow(2,1-r)?(o=(l=Math.min(Math.floor(Math.log(n)/Math.LN2),r))+r,a=Math.round(n*Math.pow(2,52-l)-Math.pow(2,52))):(o=0,a=Math.round(n/Math.pow(2,-1074))));var h=[];for(u=52;u;u-=1)h.push(a%2?1:0),a=Math.floor(a/2);for(u=11;u;u-=1)h.push(o%2?1:0),o=Math.floor(o/2);h.push(i?1:0),h.reverse();var f=h.join(""),_="";for(u=0;u<64;u+=8){var y=parseInt(f.substr(u,8),2).toString(16);1===y.length&&(y="0"+y),_+=y}return _.toLowerCase()},$e=new RegExp("^-?(0*)\\d{1,10}$"),ht=function(n){if($e.test(n)){var e=Number(n);if(e>=-2147483648&&e<=2147483647)return e}return null},Oe=function(n){try{n()}catch(e){setTimeout(function(){throw z("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},Pe=function(n,e){var t=setTimeout(n,e);return"object"==typeof t&&t.unref&&t.unref(),t},A=function(){function n(e,t){if(void 0===t){this.pieces_=e.split("/");for(var r=0,i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return Object.defineProperty(n,"Empty",{get:function(){return new n("")},enumerable:!1,configurable:!0}),n.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},n.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},n.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new n(this.pieces_,e)},n.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},n.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},n.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},n.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},n.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],t=this.pieceNum_;t<this.pieces_.length-1;t++)e.push(this.pieces_[t]);return new n(e,0)},n.prototype.child=function(e){for(var t=[],r=this.pieceNum_;r<this.pieces_.length;r++)t.push(this.pieces_[r]);if(e instanceof n)for(r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new n(t,0)},n.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},n.relativePath=function(e,t){var r=e.getFront(),i=t.getFront();if(null===r)return t;if(r===i)return n.relativePath(e.popFront(),t.popFront());throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")},n.comparePaths=function(e,t){for(var r=e.slice(),i=t.slice(),o=0;o<r.length&&o<i.length;o++){var a=w(r[o],i[o]);if(0!==a)return a}return r.length===i.length?0:r.length<i.length?-1:1},n.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,r=e.pieceNum_;t<=this.pieces_.length;t++,r++)if(this.pieces_[t]!==e.pieces_[r])return!1;return!0},n.prototype.contains=function(e){var t=this.pieceNum_,r=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0},n}(),pt=function(){function n(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var r=0;r<this.parts_.length;r++)this.byteLength_+=c.stringLength(this.parts_[r]);this.checkValid_()}return Object.defineProperty(n,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(n,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),n.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=c.stringLength(e),this.checkValid_()},n.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=c.stringLength(e),this.parts_.length>0&&(this.byteLength_-=1)},n.prototype.checkValid_=function(){if(this.byteLength_>n.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+n.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>n.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+n.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},n.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},n}(),et="firebaseio.com",yt="websocket",gt="long_polling",mt=function(){function n(e,t,r,i,o,a,l){void 0===o&&(o=!1),void 0===a&&(a=""),void 0===l&&(l=!1),this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=o,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=ne.get("host:"+e)||this.host}return n.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},n.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},n.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},n.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},n.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ne.set("host:"+this.host,this.internalHost))},n.prototype.connectionURL=function(e,t){var r;if(c.assert("string"==typeof e,"typeof type must == string"),c.assert("object"==typeof t,"typeof params must == object"),e===yt)r=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==gt)throw new Error("Unknown connection type: "+e);r=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var i=[];return Z(t,function(o,a){i.push(o+"="+a)}),r+i.join("&")},n.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},n.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},n}(),nt=function(n,e){var t=Ct(n),r=t.namespace;return"firebase.com"===t.domain&&ae(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||"undefined"===r)&&"localhost"!==t.domain&&ae("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&z("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new mt(t.host,t.secure,r,e,"ws"===t.scheme||"wss"===t.scheme,"",r!==t.subdomain),path:new A(t.pathString)}},Ct=function(n){var e="",t="",r="",i="",o="",a=!0,l="https",u=443;if("string"==typeof n){var h=n.indexOf("//");h>=0&&(l=n.substring(0,h-1),n=n.substring(h+2));var f=n.indexOf("/");-1===f&&(f=n.length);var _=n.indexOf("?");-1===_&&(_=n.length),e=n.substring(0,Math.min(f,_)),f<_&&(i=function(n){for(var e="",t=n.split("/"),r=0;r<t.length;r++)if(t[r].length>0){var i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}e+="/"+i}return e}(n.substring(f,_)));var y=function(n){var e,t,r={};"?"===n.charAt(0)&&(n=n.substring(1));try{for(var i=D.__values(n.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var l=a.split("=");2===l.length?r[decodeURIComponent(l[0])]=decodeURIComponent(l[1]):z("Invalid query segment '"+a+"' in query '"+n+"'")}}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r}(n.substring(Math.min(n.length,_)));(h=e.indexOf(":"))>=0?(a="https"===l||"wss"===l,u=parseInt(e.substring(h+1),10)):h=e.length;var m=e.slice(0,h);if("localhost"===m.toLowerCase())t="localhost";else if(m.split(".").length<=2)t=m;else{var b=e.indexOf(".");r=e.substring(0,b).toLowerCase(),t=e.substring(b+1),o=r}"ns"in y&&(o=y.ns)}return{host:e,port:u,domain:t,subdomain:r,secure:a,scheme:l,pathString:i,namespace:o}},Qt=/[\[\].#$\/\u0000-\u001F\u007F]/,Tt=/[\[\].#$\u0000-\u001F\u007F]/,He=10485760,je=function(n){return"string"==typeof n&&0!==n.length&&!Qt.test(n)},qt=function(n){return"string"==typeof n&&0!==n.length&&!Tt.test(n)},De=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!T(n)||n&&"object"==typeof n&&c.contains(n,".sv")},ye=function(n,e,t,r,i){i&&void 0===t||Me(c.errorPrefix(n,e,i),t,r)},Me=function(n,e,t){var r=t instanceof A?new pt(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(T(e))throw new Error(n+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>He/3&&c.stringLength(e)>He)throw new Error(n+"contains a string greater than "+He+" utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(Z(e,function(a,l){if(".value"===a)i=!0;else if(".priority"!==a&&".sv"!==a&&(o=!0,!je(a)))throw new Error(n+" contains an invalid key ("+a+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(a),Me(n,l,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},St=function(n,e,t,r,i){if(!i||void 0!==t){var o=c.errorPrefix(n,e,i);if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(o+" must be an object containing the children to replace.");var a=[];Z(t,function(l,u){var h=new A(l);if(Me(o,u,r.child(h)),".priority"===h.getBack()&&!De(u))throw new Error(o+"contains an invalid value for '"+h.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(h)}),function(n,e){var t,r;for(t=0;t<e.length;t++)for(var i=(r=e[t]).slice(),o=0;o<i.length;o++)if((".priority"!==i[o]||o!==i.length-1)&&!je(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(A.comparePaths);var a=null;for(t=0;t<e.length;t++){if(r=e[t],null!==a&&a.contains(r))throw new Error(n+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}},rt=function(n,e,t,r){if(!r||void 0!==t){if(T(t))throw new Error(c.errorPrefix(n,e,r)+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!De(t))throw new Error(c.errorPrefix(n,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},it=function(n,e,t,r){if(!r||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(c.errorPrefix(n,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},ot=function(n,e,t,r){if(!(r&&void 0===t||je(t)))throw new Error(c.errorPrefix(n,e,r)+'was an invalid key = "'+t+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Ue=function(n,e,t,r){if(!(r&&void 0===t||qt(t)))throw new Error(c.errorPrefix(n,e,r)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Bt=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ue(n,e,t,r)},re=function(n,e){if(".info"===e.getFront())throw new Error(n+" failed = Can't modify data under /.info/")},bt=function(n,e,t){var r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!je(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),qt(n)}(r))throw new Error(c.errorPrefix(n,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Ht=function(n,e,t,r){if((!r||void 0!==t)&&"boolean"!=typeof t)throw new Error(c.errorPrefix(n,e,r)+"must be a boolean.")},At=function(){function n(e,t){this.repo_=e,this.path_=t}return n.prototype.cancel=function(e){c.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),c.validateCallback("OnDisconnect.cancel",1,e,!0);var t=new c.Deferred;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},n.prototype.remove=function(e){c.validateArgCount("OnDisconnect.remove",0,1,arguments.length),re("OnDisconnect.remove",this.path_),c.validateCallback("OnDisconnect.remove",1,e,!0);var t=new c.Deferred;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},n.prototype.set=function(e,t){c.validateArgCount("OnDisconnect.set",1,2,arguments.length),re("OnDisconnect.set",this.path_),ye("OnDisconnect.set",1,e,this.path_,!1),c.validateCallback("OnDisconnect.set",2,t,!0);var r=new c.Deferred;return this.repo_.onDisconnectSet(this.path_,e,r.wrapCallback(t)),r.promise},n.prototype.setWithPriority=function(e,t,r){c.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),re("OnDisconnect.setWithPriority",this.path_),ye("OnDisconnect.setWithPriority",1,e,this.path_,!1),rt("OnDisconnect.setWithPriority",2,t,!1),c.validateCallback("OnDisconnect.setWithPriority",3,r,!0);var i=new c.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,i.wrapCallback(r)),i.promise},n.prototype.update=function(e,t){if(c.validateArgCount("OnDisconnect.update",1,2,arguments.length),re("OnDisconnect.update",this.path_),Array.isArray(e)){for(var r={},i=0;i<e.length;++i)r[""+i]=e[i];e=r,z("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}St("OnDisconnect.update",1,e,this.path_,!1),c.validateCallback("OnDisconnect.update",2,t,!0);var o=new c.Deferred;return this.repo_.onDisconnectUpdate(this.path_,e,o.wrapCallback(t)),o.promise},n}(),It=function(){function n(e,t){this.committed=e,this.snapshot=t}return n.prototype.toJSON=function(){return c.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},n}(),jt=function(){var n="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",e=0,t=[];return function(r){var i=r===e;e=r;var o,a=new Array(8);for(o=7;o>=0;o--)a[o]=n.charAt(r%64),r=Math.floor(r/64);c.assert(0===r,"Cannot push at time == 0");var l=a.join("");if(i){for(o=11;o>=0&&63===t[o];o--)t[o]=0;t[o]++}else for(o=0;o<12;o++)t[o]=Math.floor(64*Math.random());for(o=0;o<12;o++)l+=n.charAt(t[o]);return c.assert(20===l.length,"nextPushId: Length should be 20."),l}}(),k=function(){function n(e,t){this.name=e,this.node=t}return n.Wrap=function(e,t){return new n(e,t)},n}(),Ye=function(){function n(){}return n.prototype.getCompare=function(){return this.compare.bind(this)},n.prototype.indexedValueChanged=function(e,t){var r=new k(I,e),i=new k(I,t);return 0!==this.compare(r,i)},n.prototype.minPost=function(){return k.MIN},n}(),Rt=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return D.__extends(e,n),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return ze},set:function(t){ze=t},enumerable:!1,configurable:!0}),e.prototype.compare=function(t,r){return w(t.name,r.name)},e.prototype.isDefinedOn=function(t){throw c.assertionError("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,r){return!1},e.prototype.minPost=function(){return k.MIN},e.prototype.maxPost=function(){return new k(N,ze)},e.prototype.makePost=function(t,r){return c.assert("string"==typeof t,"KeyIndex indexValue must always be a string."),new k(t,ze)},e.prototype.toString=function(){return".key"},e}(Ye),ge=new Rt,Nt=function(n){return"number"==typeof n?"number:"+K(n):"string:"+n},Ot=function(n){if(n.isLeafNode()){var e=n.val();c.assert("string"==typeof e||"number"==typeof e||"object"==typeof e&&c.contains(e,".sv"),"Priority must be a string or number.")}else c.assert(n===st||n.isEmpty(),"priority of unexpected type.");c.assert(n===st||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},xe=function(){function n(e,t){void 0===t&&(t=n.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=t,this.lazyHash_=null,c.assert(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Ot(this.priorityNode_)}return Object.defineProperty(n,"__childrenNodeConstructor",{get:function(){return Pt},set:function(e){Pt=e},enumerable:!1,configurable:!0}),n.prototype.isLeafNode=function(){return!0},n.prototype.getPriority=function(){return this.priorityNode_},n.prototype.updatePriority=function(e){return new n(this.value_,e)},n.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE},n.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE},n.prototype.hasChild=function(){return!1},n.prototype.getPredecessorChildName=function(e,t){return null},n.prototype.updateImmediateChild=function(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)},n.prototype.updateChild=function(e,t){var r=e.getFront();return null===r?t:t.isEmpty()&&".priority"!==r?this:(c.assert(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),t)))},n.prototype.isEmpty=function(){return!1},n.prototype.numChildren=function(){return 0},n.prototype.forEachChild=function(e,t){return!1},n.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},n.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Nt(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?K(this.value_):this.value_,this.lazyHash_=we(e)}return this.lazyHash_},n.prototype.getValue=function(){return this.value_},n.prototype.compareTo=function(e){return e===n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n.__childrenNodeConstructor?-1:(c.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},n.prototype.compareToLeafNode_=function(e){var t=typeof e.value_,r=typeof this.value_,i=n.VALUE_TYPE_ORDER.indexOf(t),o=n.VALUE_TYPE_ORDER.indexOf(r);return c.assert(i>=0,"Unknown leaf type: "+t),c.assert(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-i},n.prototype.withIndex=function(){return this},n.prototype.isIndexed=function(){return!0},n.prototype.equals=function(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))},n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n}(),B=new(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return D.__extends(e,n),e.prototype.compare=function(t,r){var i=t.node.getPriority(),o=r.node.getPriority(),a=i.compareTo(o);return 0===a?w(t.name,r.name):a},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,r){return!t.getPriority().equals(r.getPriority())},e.prototype.minPost=function(){return k.MIN},e.prototype.maxPost=function(){return new k(N,new xe("[PRIORITY-POST]",xt))},e.prototype.makePost=function(t,r){var i=Dt(t);return new k(r,new xe("[PRIORITY-POST]",i))},e.prototype.toString=function(){return".priority"},e}(Ye)),Ge=function(){function n(e,t,r,i,o){void 0===o&&(o=null),this.isReverse_=i,this.resultGenerator_=o,this.nodeStack_=[];for(var a=1;!e.isEmpty();)if(e=e,a=t?r(e.key,t):1,i&&(a*=-1),a<0)e=this.isReverse_?e.left:e.right;else{if(0===a){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return n.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},n.prototype.hasNext=function(){return this.nodeStack_.length>0},n.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},n}(),le=function(){function n(e,t,r,i,o){this.key=e,this.value=t,this.color=null!=r?r:n.RED,this.left=null!=i?i:v.EMPTY_NODE,this.right=null!=o?o:v.EMPTY_NODE}return n.prototype.copy=function(e,t,r,i,o){return new n(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},n.prototype.count=function(){return this.left.count()+1+this.right.count()},n.prototype.isEmpty=function(){return!1},n.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},n.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},n.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},n.prototype.minKey=function(){return this.min_().key},n.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},n.prototype.insert=function(e,t,r){var i=this,o=r(e,i.key);return(i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===o?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r))).fixUp_()},n.prototype.removeMin_=function(){if(this.left.isEmpty())return v.EMPTY_NODE;var e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},n.prototype.remove=function(e,t){var r,i;if(t(e,(r=this).key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),0===t(e,r.key)){if(r.right.isEmpty())return v.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()},n.prototype.isRed_=function(){return this.color},n.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},n.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},n.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},n.prototype.rotateLeft_=function(){var e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},n.prototype.rotateRight_=function(){var e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},n.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},n.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},n.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},n.RED=!0,n.BLACK=!1,n}(),p=function(){function n(){}return n.prototype.copy=function(e,t,r,i,o){return this},n.prototype.insert=function(e,t,r){return new le(e,t,null)},n.prototype.remove=function(e,t){return this},n.prototype.count=function(){return 0},n.prototype.isEmpty=function(){return!0},n.prototype.inorderTraversal=function(e){return!1},n.prototype.reverseTraversal=function(e){return!1},n.prototype.minKey=function(){return null},n.prototype.maxKey=function(){return null},n.prototype.check_=function(){return 0},n.prototype.isRed_=function(){return!1},n}(),v=function(){function n(e,t){void 0===t&&(t=n.EMPTY_NODE),this.comparator_=e,this.root_=t}return n.prototype.insert=function(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,le.BLACK,null,null))},n.prototype.remove=function(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,le.BLACK,null,null))},n.prototype.get=function(e){for(var t,r=this.root_;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key)))return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null},n.prototype.getPredecessorKey=function(e){for(var t,r=this.root_,i=null;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key))){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}t<0?r=r.left:t>0&&(i=r,r=r.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},n.prototype.isEmpty=function(){return this.root_.isEmpty()},n.prototype.count=function(){return this.root_.count()},n.prototype.minKey=function(){return this.root_.minKey()},n.prototype.maxKey=function(){return this.root_.maxKey()},n.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},n.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},n.prototype.getIterator=function(e){return new Ge(this.root_,null,this.comparator_,!1,e)},n.prototype.getIteratorFrom=function(e,t){return new Ge(this.root_,e,this.comparator_,!1,t)},n.prototype.getReverseIteratorFrom=function(e,t){return new Ge(this.root_,e,this.comparator_,!0,t)},n.prototype.getReverseIterator=function(e){return new Ge(this.root_,null,this.comparator_,!0,e)},n.EMPTY_NODE=new p,n}(),d=Math.log(2),g=function(){function n(e){this.count=parseInt(Math.log(e+1)/d,10),this.current_=this.count-1;var i=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&i}return n.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},n}(),S=function(n,e,t,r){n.sort(e);var i=function(u,h){var _,y,f=h-u;if(0===f)return null;if(1===f)return _=n[u],y=t?t(_):_,new le(y,_.node,le.BLACK,null,null);var m=parseInt(f/2,10)+u,b=i(u,m),R=i(m+1,h);return _=n[m],y=t?t(_):_,new le(y,_.node,le.BLACK,b,R)},l=function(u){for(var h=null,f=null,_=n.length,y=function(W,ie){var ce=_-W,qe=_;_-=W;var Ve=i(ce+1,qe),pn=n[ce],Si=t?t(pn):pn;m(new le(Si,pn.node,ie,null,Ve))},m=function(W){h?(h.left=W,h=W):(f=W,h=W)},b=0;b<u.count;++b){var R=u.nextBitIsOne(),U=Math.pow(2,u.count-(b+1));R?y(U,le.BLACK):(y(U,le.BLACK),y(U,le.RED))}return f}(new g(n.length));return new v(r||e,l)},Q={},q=function(){function n(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(n,"Default",{get:function(){return c.assert(Q&&B,"ChildrenNode.ts has not been loaded"),O=O||new n({".priority":Q},{".priority":B})},enumerable:!1,configurable:!0}),n.prototype.get=function(e){var t=c.safeGet(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof v?t:null},n.prototype.hasIndex=function(e){return c.contains(this.indexSet_,e.toString())},n.prototype.addIndex=function(e,t){c.assert(e!==ge,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r=[],i=!1,o=t.getIterator(k.Wrap),a=o.getNext();a;)i=i||e.isDefinedOn(a.node),r.push(a),a=o.getNext();var l;l=i?S(r,e.getCompare()):Q;var u=e.toString(),h=D.__assign({},this.indexSet_);h[u]=e;var f=D.__assign({},this.indexes_);return f[u]=l,new n(f,h)},n.prototype.addToIndexes=function(e,t){var r=this;return new n(c.map(this.indexes_,function(o,a){var l=c.safeGet(r.indexSet_,a);if(c.assert(l,"Missing index implementation for "+a),o===Q){if(l.isDefinedOn(e.node)){for(var u=[],h=t.getIterator(k.Wrap),f=h.getNext();f;)f.name!==e.name&&u.push(f),f=h.getNext();return u.push(e),S(u,l.getCompare())}return Q}var _=t.get(e.name),y=o;return _&&(y=y.remove(new k(e.name,_))),y.insert(e,e.node)}),this.indexSet_)},n.prototype.removeFromIndexes=function(e,t){return new n(c.map(this.indexes_,function(i){if(i===Q)return i;var o=t.get(e.name);return o?i.remove(new k(e.name,o)):i}),this.indexSet_)},n}();function te(n,e){return w(n.name,e.name)}function be(n,e){return w(n,e)}var Ae,P=function(){function n(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Ot(this.priorityNode_),this.children_.isEmpty()&&c.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(n,"EMPTY_NODE",{get:function(){return Ae||(Ae=new n(new v(be),null,q.Default))},enumerable:!1,configurable:!0}),n.prototype.isLeafNode=function(){return!1},n.prototype.getPriority=function(){return this.priorityNode_||Ae},n.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new n(this.children_,e,this.indexMap_)},n.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ae:t},n.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},n.prototype.hasChild=function(e){return null!==this.children_.get(e)},n.prototype.updateImmediateChild=function(e,t){if(c.assert(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);var r=new k(e,t),i=void 0,o=void 0;t.isEmpty()?(i=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(r,this.children_));var a=i.isEmpty()?Ae:this.priorityNode_;return new n(i,a,o)},n.prototype.updateChild=function(e,t){var r=e.getFront();if(null===r)return t;c.assert(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var i=this.getImmediateChild(r).updateChild(e.popFront(),t);return this.updateImmediateChild(r,i)},n.prototype.isEmpty=function(){return this.children_.isEmpty()},n.prototype.numChildren=function(){return this.children_.count()},n.prototype.val=function(e){if(this.isEmpty())return null;var t={},r=0,i=0,o=!0;if(this.forEachChild(B,function(u,h){t[u]=h.val(e),r++,o&&n.INTEGER_REGEXP_.test(u)?i=Math.max(i,Number(u)):o=!1}),!e&&o&&i<2*r){var a=[];for(var l in t)a[l]=t[l];return a}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t},n.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Nt(this.getPriority().val())+":"),this.forEachChild(B,function(t,r){var i=r.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":we(e)}return this.lazyHash_},n.prototype.getPredecessorChildName=function(e,t,r){var i=this.resolveIndex_(r);if(i){var o=i.getPredecessorKey(new k(e,t));return o?o.name:null}return this.children_.getPredecessorKey(e)},n.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var r=t.minKey();return r&&r.name}return this.children_.minKey()},n.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new k(t,this.children_.get(t)):null},n.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var r=t.maxKey();return r&&r.name}return this.children_.maxKey()},n.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new k(t,this.children_.get(t)):null},n.prototype.forEachChild=function(e,t){var r=this.resolveIndex_(e);return r?r.inorderTraversal(function(i){return t(i.name,i.node)}):this.children_.inorderTraversal(t)},n.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},n.prototype.getIteratorFrom=function(e,t){var r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,function(a){return a});for(var i=this.children_.getIteratorFrom(e.name,k.Wrap),o=i.peek();null!=o&&t.compare(o,e)<0;)i.getNext(),o=i.peek();return i},n.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},n.prototype.getReverseIteratorFrom=function(e,t){var r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,function(a){return a});for(var i=this.children_.getReverseIteratorFrom(e.name,k.Wrap),o=i.peek();null!=o&&t.compare(o,e)>0;)i.getNext(),o=i.peek();return i},n.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===at?-1:0},n.prototype.withIndex=function(e){if(e===ge||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new n(this.children_,this.priorityNode_,t)},n.prototype.isIndexed=function(e){return e===ge||this.indexMap_.hasIndex(e)},n.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var r=this.getIterator(B),i=t.getIterator(B),o=r.getNext(),a=i.getNext();o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=i.getNext()}return null===o&&null===a}return!1}return!1},n.prototype.resolveIndex_=function(e){return e===ge?null:this.indexMap_.get(e.toString())},n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n}(),at=new(function(n){function e(){return n.call(this,new v(be),P.EMPTY_NODE,q.Default)||this}return D.__extends(e,n),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return P.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(P));function H(n,e){if(void 0===e&&(e=null),null===n)return P.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),c.assert(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new xe(n,H(e));if(n instanceof Array){var u=P.EMPTY_NODE;return Z(n,function(h,f){if(c.contains(n,h)&&"."!==h.substring(0,1)){var _=H(f);(_.isLeafNode()||!_.isEmpty())&&(u=u.updateImmediateChild(h,_))}}),u.updatePriority(H(e))}var r=[],i=!1;if(Z(n,function(h,f){if("."!==h.substring(0,1)){var _=H(f);_.isEmpty()||(i=i||!_.getPriority().isEmpty(),r.push(new k(h,_)))}}),0===r.length)return P.EMPTY_NODE;var a=S(r,te,function(h){return h.name},be);if(i){var l=S(r,B.getCompare());return new P(a,H(e),new q({".priority":l},{".priority":B}))}return new P(a,H(e),q.Default)}Object.defineProperties(k,{MIN:{value:new k(I,P.EMPTY_NODE)},MAX:{value:new k(N,at)}}),Rt.__EMPTY_NODE=P.EMPTY_NODE,xe.__childrenNodeConstructor=P,function(n){st=n}(at),function(n){xt=n}(at),function(n){Dt=n}(H);var $t,Kt=new(function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return D.__extends(e,n),e.prototype.compare=function(t,r){var i=t.node.compareTo(r.node);return 0===i?w(t.name,r.name):i},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,r){return!t.equals(r)},e.prototype.minPost=function(){return k.MIN},e.prototype.maxPost=function(){return k.MAX},e.prototype.makePost=function(t,r){var i=H(t);return new k(r,i)},e.prototype.toString=function(){return".value"},e}(Ye)),Xt=function(n){function e(t){var r=n.call(this)||this;return r.indexPath_=t,c.assert(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),r}return D.__extends(e,n),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,r){var i=this.extractChild(t.node),o=this.extractChild(r.node),a=i.compareTo(o);return 0===a?w(t.name,r.name):a},e.prototype.makePost=function(t,r){var i=H(t),o=P.EMPTY_NODE.updateChild(this.indexPath_,i);return new k(r,o)},e.prototype.maxPost=function(){var t=P.EMPTY_NODE.updateChild(this.indexPath_,at);return new k(N,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(Ye),Ze=function(){function n(e,t,r){this.node_=e,this.ref_=t,this.index_=r}return n.prototype.val=function(){return c.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},n.prototype.exportVal=function(){return c.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},n.prototype.toJSON=function(){return c.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},n.prototype.exists=function(){return c.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},n.prototype.child=function(e){c.validateArgCount("DataSnapshot.child",0,1,arguments.length),e=String(e),Ue("DataSnapshot.child",1,e,!1);var t=new A(e),r=this.ref_.child(t);return new n(this.node_.getChild(t),r,B)},n.prototype.hasChild=function(e){c.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),Ue("DataSnapshot.hasChild",1,e,!1);var t=new A(e);return!this.node_.getChild(t).isEmpty()},n.prototype.getPriority=function(){return c.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},n.prototype.forEach=function(e){var t=this;if(c.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),c.validateCallback("DataSnapshot.forEach",1,e,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,function(i,o){return e(new n(o,t.ref_.child(i),B))})},n.prototype.hasChildren=function(){return c.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(n.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),n.prototype.numChildren=function(){return c.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},n.prototype.getRef=function(){return c.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(n.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),n}(),dn=function(){function n(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}return n.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},n.prototype.getEventType=function(){return this.eventType},n.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},n.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+c.stringify(this.snapshot.exportVal())},n}(),vn=function(){function n(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}return n.prototype.getPath=function(){return this.path},n.prototype.getEventType=function(){return"cancel"},n.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},n.prototype.toString=function(){return this.path.toString()+":cancel"},n}(),_n=function(){function n(e,t,r){this.callback_=e,this.cancelCallback_=t,this.context_=r}return n.prototype.respondsTo=function(e){return"value"===e},n.prototype.createEvent=function(e,t){var r=t.getQueryParams().getIndex();return new dn("value",this,new Ze(e.snapshotNode,t.getRef(),r))},n.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){c.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var r=this.cancelCallback_;return function(){r.call(t,e.error)}}var i=this.callback_;return function(){i.call(t,e.snapshot)}},n.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new vn(this,e,t):null},n.prototype.matches=function(e){return e instanceof n&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},n.prototype.hasAnyCallback=function(){return null!==this.callback_},n}(),yn=function(){function n(e,t,r){this.callbacks_=e,this.cancelCallback_=t,this.context_=r}return n.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return c.contains(this.callbacks_,t="children_removed"===t?"child_removed":t)},n.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new vn(this,e,t):null},n.prototype.createEvent=function(e,t){c.assert(null!=e.childName,"Child events should have a childName.");var r=t.getRef().child(e.childName),i=t.getQueryParams().getIndex();return new dn(e.type,this,new Ze(e.snapshotNode,r,i),e.prevName)},n.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){c.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var r=this.cancelCallback_;return function(){r.call(t,e.error)}}var i=this.callbacks_[e.eventType];return function(){i.call(t,e.snapshot,e.prevName)}},n.prototype.matches=function(e){var t=this;if(e instanceof n){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var r=Object.keys(e.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var l=r[0],u=i[0];return!(u!==l||e.callbacks_[l]&&this.callbacks_[u]&&e.callbacks_[l]!==this.callbacks_[u])}return i.every(function(h){return e.callbacks_[h]===t.callbacks_[h]})}}}return!1},n.prototype.hasAnyCallback=function(){return null!==this.callbacks_},n}(),Ft=function(){function n(e,t,r,i){this.repo=e,this.path=t,this.queryParams_=r,this.orderByCalled_=i}return Object.defineProperty(n,"__referenceConstructor",{get:function(){return c.assert($t,"Reference.ts has not been loaded"),$t},set:function(e){$t=e},enumerable:!1,configurable:!0}),n.validateQueryEndpoints_=function(e){var t=null,r=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(r=e.getIndexEndValue()),e.getIndex()===ge){var i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==I)throw new Error(i);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==N)throw new Error(i);if("string"!=typeof r)throw new Error(o)}}else if(e.getIndex()===B){if(null!=t&&!De(t)||null!=r&&!De(r))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(c.assert(e.getIndex()instanceof Xt||e.getIndex()===Kt,"unknown index type."),null!=t&&"object"==typeof t||null!=r&&"object"==typeof r)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},n.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},n.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},n.prototype.getQueryParams=function(){return this.queryParams_},n.prototype.getRef=function(){return c.validateArgCount("Query.ref",0,0,arguments.length),new n.__referenceConstructor(this.repo,this.path)},n.prototype.on=function(e,t,r,i){c.validateArgCount("Query.on",2,4,arguments.length),it("Query.on",1,e,!1),c.validateCallback("Query.on",2,t,!1);var o=n.getCancelAndContextArgs_("Query.on",r,i);if("value"===e)this.onValueEvent(t,o.cancel,o.context);else{var a={};a[e]=t,this.onChildEvent(a,o.cancel,o.context)}return t},n.prototype.onValueEvent=function(e,t,r){var i=new _n(e,t||null,r||null);this.repo.addEventCallbackForQuery(this,i)},n.prototype.onChildEvent=function(e,t,r){var i=new yn(e,t,r);this.repo.addEventCallbackForQuery(this,i)},n.prototype.off=function(e,t,r){c.validateArgCount("Query.off",0,3,arguments.length),it("Query.off",1,e,!0),c.validateCallback("Query.off",2,t,!0),c.validateContextObject("Query.off",3,r,!0);var i=null,o=null;if("value"===e){var a=t||null;i=new _n(a,null,r||null)}else e&&(t&&((o={})[e]=t),i=new yn(o,null,r||null));this.repo.removeEventCallbackForQuery(this,i)},n.prototype.once=function(e,t,r,i){var o=this;c.validateArgCount("Query.once",1,4,arguments.length),it("Query.once",1,e,!1),c.validateCallback("Query.once",2,t,!0);var a=n.getCancelAndContextArgs_("Query.once",r,i),l=!0,u=new c.Deferred;u.promise.catch(function(){});var h=function(f){l&&(l=!1,o.off(e,h),t&&t.bind(a.context)(f),u.resolve(f))};return this.on(e,h,function(f){o.off(e,h),a.cancel&&a.cancel.bind(a.context)(f),u.reject(f)}),u.promise},n.prototype.limitToFirst=function(e){if(c.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new n(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},n.prototype.limitToLast=function(e){if(c.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new n(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},n.prototype.orderByChild=function(e){if(c.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Ue("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var t=new A(e);if(t.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new Xt(t),i=this.queryParams_.orderBy(r);return n.validateQueryEndpoints_(i),new n(this.repo,this.path,i,!0)},n.prototype.orderByKey=function(){c.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(ge);return n.validateQueryEndpoints_(e),new n(this.repo,this.path,e,!0)},n.prototype.orderByPriority=function(){c.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(B);return n.validateQueryEndpoints_(e),new n(this.repo,this.path,e,!0)},n.prototype.orderByValue=function(){c.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Kt);return n.validateQueryEndpoints_(e),new n(this.repo,this.path,e,!0)},n.prototype.startAt=function(e,t){void 0===e&&(e=null),c.validateArgCount("Query.startAt",0,2,arguments.length),ye("Query.startAt",1,e,this.path,!0),ot("Query.startAt",2,t,!0);var r=this.queryParams_.startAt(e,t);if(n.validateLimit_(r),n.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,t=null),new n(this.repo,this.path,r,this.orderByCalled_)},n.prototype.endAt=function(e,t){void 0===e&&(e=null),c.validateArgCount("Query.endAt",0,2,arguments.length),ye("Query.endAt",1,e,this.path,!0),ot("Query.endAt",2,t,!0);var r=this.queryParams_.endAt(e,t);if(n.validateLimit_(r),n.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new n(this.repo,this.path,r,this.orderByCalled_)},n.prototype.equalTo=function(e,t){if(c.validateArgCount("Query.equalTo",1,2,arguments.length),ye("Query.equalTo",1,e,this.path,!1),ot("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},n.prototype.toString=function(){return c.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},n.prototype.toJSON=function(){return c.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},n.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},n.prototype.queryIdentifier=function(){var e=this.queryObject(),t=ee(e);return"{}"===t?"default":t},n.prototype.isEqual=function(e){if(c.validateArgCount("Query.isEqual",1,1,arguments.length),!(e instanceof n)){var t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}var r=this.repo===e.repo,i=this.path.equals(e.path),o=this.queryIdentifier()===e.queryIdentifier();return r&&i&&o},n.getCancelAndContextArgs_=function(e,t,r){var i={cancel:null,context:null};if(t&&r)i.cancel=t,c.validateCallback(e,3,i.cancel,!0),i.context=r,c.validateContextObject(e,4,i.context,!0);else if(t)if("object"==typeof t&&null!==t)i.context=t;else{if("function"!=typeof t)throw new Error(c.errorPrefix(e,3,!0)+" must either be a cancel callback or a context object.");i.cancel=t}return i},Object.defineProperty(n.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),n}(),er=function(){function n(e){this.node_=e}return n.prototype.getImmediateChild=function(e){return new n(this.node_.getImmediateChild(e))},n.prototype.node=function(){return this.node_},n}(),tr=function(){function n(e,t){this.syncTree_=e,this.path_=t}return n.prototype.getImmediateChild=function(e){var t=this.path_.child(e);return new n(this.syncTree_,t)},n.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},n}(),gn=function(n,e,t){return n&&"object"==typeof n?(c.assert(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?rr(n[".sv"],e,t):"object"==typeof n[".sv"]?ir(n[".sv"],e):void c.assert(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},rr=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:c.assert(!1,"Unexpected server value: "+n)}},ir=function(n,e,t){n.hasOwnProperty("increment")||c.assert(!1,"Unexpected server value: "+JSON.stringify(n,null,2));var r=n.increment;"number"!=typeof r&&c.assert(!1,"Unexpected increment value: "+r);var i=e.node();if(c.assert(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var a=i.getValue();return"number"!=typeof a?r:a+r},mn=function(n,e,t,r){return en(e,new tr(t,n),r)},Jt=function(n,e,t){return en(n,new er(e),t)};function en(n,e,t){var o,r=n.getPriority().val(),i=gn(r,e.getImmediateChild(".priority"),t);if(n.isLeafNode()){var a=n,l=gn(a.getValue(),e,t);return l!==a.getValue()||i!==a.getPriority().val()?new xe(l,H(i)):n}var u=n;return o=u,i!==u.getPriority().val()&&(o=o.updatePriority(new xe(i))),u.forEachChild(B,function(h,f){var _=en(f,e.getImmediateChild(h),t);_!==f&&(o=o.updateImmediateChild(h,_))}),o}var nn,kt,tn=function(){function n(){this.value=null,this.children=new Map}return n.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!e.isEmpty()&&this.children.size>0){var t=e.getFront();return e=e.popFront(),this.children.has(t)?this.children.get(t).find(e):null}return null},n.prototype.remember=function(e,t){if(e.isEmpty())this.value=t,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(e,t);else{var r=e.getFront();this.children.has(r)||this.children.set(r,new n);var i=this.children.get(r);e=e.popFront(),i.remember(e,t)}},n.prototype.forget=function(e){if(e.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var r=this;return t.forEachChild(B,function(a,l){r.remember(new A(a),l)}),this.forget(e)}if(this.children.size>0){var i=e.getFront();return e=e.popFront(),this.children.has(i)&&this.children.get(i).forget(e)&&this.children.delete(i),0===this.children.size}return!0},n.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild(function(r,i){var o=new A(e.toString()+"/"+r);i.forEachTree(o,t)})},n.prototype.forEachChild=function(e){this.children.forEach(function(t,r){e(r,t)})},n}(),he=(()=>(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(he||(he={})),he))(),Ie=function(){function n(e,t,r,i){this.fromUser=e,this.fromServer=t,this.queryId=r,this.tagged=i,c.assert(!i||t,"Tagged queries must be from server.")}return n.User=new n(!0,!1,null,!1),n.Server=new n(!1,!0,null,!1),n.forServerTaggedQuery=function(e){return new n(!1,!0,e,!0)},n}(),or=function(){function n(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=he.ACK_USER_WRITE,this.source=Ie.User}return n.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return c.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new A(e));return new n(A.Empty,t,this.revert)}return c.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new n(this.path.popFront(),this.affectedTree,this.revert)},n}(),ue=function(){function n(e,t){void 0===t&&(nn||(nn=new v(F)),t=nn),this.value=e,this.children=t}return n.fromObject=function(e){var t=n.Empty;return Z(e,function(r,i){t=t.set(new A(r),i)}),t},n.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},n.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:A.Empty,value:this.value};if(e.isEmpty())return null;var r=e.getFront(),i=this.children.get(r);if(null!==i){var o=i.findRootMostMatchingPathAndValue(e.popFront(),t);return null!=o?{path:new A(r).child(o.path),value:o.value}:null}return null},n.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},n.prototype.subtree=function(e){if(e.isEmpty())return this;var t=e.getFront(),r=this.children.get(t);return null!==r?r.subtree(e.popFront()):n.Empty},n.prototype.set=function(e,t){if(e.isEmpty())return new n(t,this.children);var r=e.getFront(),o=(this.children.get(r)||n.Empty).set(e.popFront(),t),a=this.children.insert(r,o);return new n(this.value,a)},n.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?n.Empty:new n(null,this.children);var t=e.getFront(),r=this.children.get(t);if(r){var i=r.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&o.isEmpty()?n.Empty:new n(this.value,o)}return this},n.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),r=this.children.get(t);return r?r.get(e.popFront()):null},n.prototype.setTree=function(e,t){if(e.isEmpty())return t;var a,r=e.getFront(),o=(this.children.get(r)||n.Empty).setTree(e.popFront(),t);return a=o.isEmpty()?this.children.remove(r):this.children.insert(r,o),new n(this.value,a)},n.prototype.fold=function(e){return this.fold_(A.Empty,e)},n.prototype.fold_=function(e,t){var r={};return this.children.inorderTraversal(function(i,o){r[i]=o.fold_(e.child(i),t)}),t(e,this.value,r)},n.prototype.findOnPath=function(e,t){return this.findOnPath_(e,A.Empty,t)},n.prototype.findOnPath_=function(e,t,r){var i=!!this.value&&r(t,this.value);if(i)return i;if(e.isEmpty())return null;var o=e.getFront(),a=this.children.get(o);return a?a.findOnPath_(e.popFront(),t.child(o),r):null},n.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,A.Empty,t)},n.prototype.foreachOnPath_=function(e,t,r){if(e.isEmpty())return this;this.value&&r(t,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),t.child(i),r):n.Empty},n.prototype.foreach=function(e){this.foreach_(A.Empty,e)},n.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(r,i){i.foreach_(e.child(r),t)}),this.value&&t(e,this.value)},n.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,r){r.value&&e(t,r.value)})},n.Empty=new n(null),n}(),En=function(){function n(e,t){this.source=e,this.path=t,this.type=he.LISTEN_COMPLETE}return n.prototype.operationForChild=function(e){return this.path.isEmpty()?new n(this.source,A.Empty):new n(this.source,this.path.popFront())},n}(),Lt=function(){function n(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=he.OVERWRITE}return n.prototype.operationForChild=function(e){return this.path.isEmpty()?new n(this.source,A.Empty,this.snap.getImmediateChild(e)):new n(this.source,this.path.popFront(),this.snap)},n}(),rn=function(){function n(e,t,r){this.source=e,this.path=t,this.children=r,this.type=he.MERGE}return n.prototype.operationForChild=function(e){if(this.path.isEmpty()){var t=this.children.subtree(new A(e));return t.isEmpty()?null:t.value?new Lt(this.source,A.Empty,t.value):new n(this.source,A.Empty,t)}return c.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,this.path.popFront(),this.children)},n.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},n}(),Re=function(){function n(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}return n.prototype.isFullyInitialized=function(){return this.fullyInitialized_},n.prototype.isFiltered=function(){return this.filtered_},n.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},n.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},n.prototype.getNode=function(){return this.node_},n}(),Cn=function(){function n(e,t){this.eventCache_=e,this.serverCache_=t}return n.prototype.updateEventSnap=function(e,t,r){return new n(new Re(e,t,r),this.serverCache_)},n.prototype.updateServerSnap=function(e,t,r){return new n(this.eventCache_,new Re(e,t,r))},n.prototype.getEventCache=function(){return this.eventCache_},n.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},n.prototype.getServerCache=function(){return this.serverCache_},n.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},n.Empty=new n(new Re(P.EMPTY_NODE,!1,!1),new Re(P.EMPTY_NODE,!1,!1)),n}(),M=function(){function n(e,t,r,i,o){this.type=e,this.snapshotNode=t,this.childName=r,this.oldSnap=i,this.prevName=o}return n.valueChange=function(e){return new n(n.VALUE,e)},n.childAddedChange=function(e,t){return new n(n.CHILD_ADDED,t,e)},n.childRemovedChange=function(e,t){return new n(n.CHILD_REMOVED,t,e)},n.childChangedChange=function(e,t,r){return new n(n.CHILD_CHANGED,t,e,r)},n.childMovedChange=function(e,t){return new n(n.CHILD_MOVED,t,e)},n.CHILD_ADDED="child_added",n.CHILD_REMOVED="child_removed",n.CHILD_CHANGED="child_changed",n.CHILD_MOVED="child_moved",n.VALUE="value",n}(),on=function(){function n(e){this.index_=e}return n.prototype.updateChild=function(e,t,r,i,o,a){c.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var l=e.getImmediateChild(t);return l.getChild(i).equals(r.getChild(i))&&l.isEmpty()===r.isEmpty()||(null!=a&&(r.isEmpty()?e.hasChild(t)?a.trackChildChange(M.childRemovedChange(t,l)):c.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?a.trackChildChange(M.childAddedChange(t,r)):a.trackChildChange(M.childChangedChange(t,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)},n.prototype.updateFullNode=function(e,t,r){return null!=r&&(e.isLeafNode()||e.forEachChild(B,function(i,o){t.hasChild(i)||r.trackChildChange(M.childRemovedChange(i,o))}),t.isLeafNode()||t.forEachChild(B,function(i,o){if(e.hasChild(i)){var a=e.getImmediateChild(i);a.equals(o)||r.trackChildChange(M.childChangedChange(i,o,a))}else r.trackChildChange(M.childAddedChange(i,o))})),t.withIndex(this.index_)},n.prototype.updatePriority=function(e,t){return e.isEmpty()?P.EMPTY_NODE:e.updatePriority(t)},n.prototype.filtersNodes=function(){return!1},n.prototype.getIndexedFilter=function(){return this},n.prototype.getIndex=function(){return this.index_},n}(),ar=function(){function n(){this.changeMap=new Map}return n.prototype.trackChildChange=function(e){var t=e.type,r=e.childName;c.assert(t===M.CHILD_ADDED||t===M.CHILD_CHANGED||t===M.CHILD_REMOVED,"Only child changes supported for tracking"),c.assert(".priority"!==r,"Only non-priority child changes can be tracked.");var i=this.changeMap.get(r);if(i){var o=i.type;if(t===M.CHILD_ADDED&&o===M.CHILD_REMOVED)this.changeMap.set(r,M.childChangedChange(r,e.snapshotNode,i.snapshotNode));else if(t===M.CHILD_REMOVED&&o===M.CHILD_ADDED)this.changeMap.delete(r);else if(t===M.CHILD_REMOVED&&o===M.CHILD_CHANGED)this.changeMap.set(r,M.childRemovedChange(r,i.oldSnap));else if(t===M.CHILD_CHANGED&&o===M.CHILD_ADDED)this.changeMap.set(r,M.childAddedChange(r,e.snapshotNode));else{if(t!==M.CHILD_CHANGED||o!==M.CHILD_CHANGED)throw c.assertionError("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(r,M.childChangedChange(r,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(r,e)},n.prototype.getChanges=function(){return Array.from(this.changeMap.values())},n}(),Tn=new(function(){function n(){}return n.prototype.getCompleteChild=function(e){return null},n.prototype.getChildAfterChild=function(e,t,r){return null},n}()),sn=function(){function n(e,t,r){void 0===r&&(r=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}return n.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var r=null!=this.optCompleteServerCache_?new Re(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,r)},n.prototype.getChildAfterChild=function(e,t,r){var i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),o=this.writes_.calcIndexedSlice(i,t,1,r,e);return 0===o.length?null:o[0]},n}(),ur=function(e,t){this.viewCache=e,this.changes=t},hr=function(){function n(e){this.filter_=e}return n.prototype.assertIndexed=function(e){c.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),c.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},n.prototype.applyOperation=function(e,t,r,i){var a,l,o=new ar;if(t.type===he.OVERWRITE){var u=t;u.source.fromUser?a=this.applyUserOverwrite_(e,u.path,u.snap,r,i,o):(c.assert(u.source.fromServer,"Unknown source."),l=u.source.tagged||e.getServerCache().isFiltered()&&!u.path.isEmpty(),a=this.applyServerOverwrite_(e,u.path,u.snap,r,i,l,o))}else if(t.type===he.MERGE){var h=t;h.source.fromUser?a=this.applyUserMerge_(e,h.path,h.children,r,i,o):(c.assert(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.getServerCache().isFiltered(),a=this.applyServerMerge_(e,h.path,h.children,r,i,l,o))}else if(t.type===he.ACK_USER_WRITE){var f=t;a=f.revert?this.revertUserWrite_(e,f.path,r,i,o):this.ackUserWrite_(e,f.path,f.affectedTree,r,i,o)}else{if(t.type!==he.LISTEN_COMPLETE)throw c.assertionError("Unknown operation type: "+t.type);a=this.listenComplete_(e,t.path,r,o)}var _=o.getChanges();return n.maybeAddValueEvent_(e,a,_),new ur(a,_)},n.maybeAddValueEvent_=function(e,t,r){var i=t.getEventCache();if(i.isFullyInitialized()){var o=i.getNode().isLeafNode()||i.getNode().isEmpty(),a=e.getCompleteEventSnap();(r.length>0||!e.getEventCache().isFullyInitialized()||o&&!i.getNode().equals(a)||!i.getNode().getPriority().equals(a.getPriority()))&&r.push(M.valueChange(t.getCompleteEventSnap()))}},n.prototype.generateEventCacheAfterServerEvent_=function(e,t,r,i,o){var a=e.getEventCache();if(null!=r.shadowingWrite(t))return e;var l=void 0,u=void 0;if(t.isEmpty())if(c.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var h=e.getCompleteServerSnap(),_=r.calcCompleteEventChildren(h instanceof P?h:P.EMPTY_NODE);l=this.filter_.updateFullNode(e.getEventCache().getNode(),_,o)}else{var y=r.calcCompleteEventCache(e.getCompleteServerSnap());l=this.filter_.updateFullNode(e.getEventCache().getNode(),y,o)}else{var m=t.getFront();if(".priority"===m){c.assert(1===t.getLength(),"Can't have a priority with additional path components");var b=a.getNode();u=e.getServerCache().getNode();var R=r.calcEventCacheAfterServerOverwrite(t,b,u);l=null!=R?this.filter_.updatePriority(b,R):a.getNode()}else{var U=t.popFront(),W=void 0;if(a.isCompleteForChild(m)){u=e.getServerCache().getNode();var ie=r.calcEventCacheAfterServerOverwrite(t,a.getNode(),u);W=null!=ie?a.getNode().getImmediateChild(m).updateChild(U,ie):a.getNode().getImmediateChild(m)}else W=r.calcCompleteChild(m,e.getServerCache());l=null!=W?this.filter_.updateChild(a.getNode(),m,W,U,i,o):a.getNode()}}return e.updateEventSnap(l,a.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},n.prototype.applyServerOverwrite_=function(e,t,r,i,o,a,l){var h,u=e.getServerCache(),f=a?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())h=f.updateFullNode(u.getNode(),r,null);else if(f.filtersNodes()&&!u.isFiltered()){var _=u.getNode().updateChild(t,r);h=f.updateFullNode(u.getNode(),_,null)}else{var y=t.getFront();if(!u.isCompleteForPath(t)&&t.getLength()>1)return e;var m=t.popFront(),R=u.getNode().getImmediateChild(y).updateChild(m,r);h=".priority"===y?f.updatePriority(u.getNode(),R):f.updateChild(u.getNode(),y,R,m,Tn,null)}var U=e.updateServerSnap(h,u.isFullyInitialized()||t.isEmpty(),f.filtersNodes()),W=new sn(i,U,o);return this.generateEventCacheAfterServerEvent_(U,t,i,W,l)},n.prototype.applyUserOverwrite_=function(e,t,r,i,o,a){var u,h,l=e.getEventCache(),f=new sn(i,e,o);if(t.isEmpty())h=this.filter_.updateFullNode(e.getEventCache().getNode(),r,a),u=e.updateEventSnap(h,!0,this.filter_.filtersNodes());else{var _=t.getFront();if(".priority"===_)h=this.filter_.updatePriority(e.getEventCache().getNode(),r),u=e.updateEventSnap(h,l.isFullyInitialized(),l.isFiltered());else{var y=t.popFront(),m=l.getNode().getImmediateChild(_),b=void 0;if(y.isEmpty())b=r;else{var R=f.getCompleteChild(_);b=null!=R?".priority"===y.getBack()&&R.getChild(y.parent()).isEmpty()?R:R.updateChild(y,r):P.EMPTY_NODE}if(m.equals(b))u=e;else{var U=this.filter_.updateChild(l.getNode(),_,b,y,f,a);u=e.updateEventSnap(U,l.isFullyInitialized(),this.filter_.filtersNodes())}}}return u},n.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},n.prototype.applyUserMerge_=function(e,t,r,i,o,a){var l=this,u=e;return r.foreach(function(h,f){var _=t.child(h);n.cacheHasChild_(e,_.getFront())&&(u=l.applyUserOverwrite_(u,_,f,i,o,a))}),r.foreach(function(h,f){var _=t.child(h);n.cacheHasChild_(e,_.getFront())||(u=l.applyUserOverwrite_(u,_,f,i,o,a))}),u},n.prototype.applyMerge_=function(e,t){return t.foreach(function(r,i){e=e.updateChild(r,i)}),e},n.prototype.applyServerMerge_=function(e,t,r,i,o,a,l){var u=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var f,h=e;f=t.isEmpty()?r:ue.Empty.setTree(t,r);var _=e.getServerCache().getNode();return f.children.inorderTraversal(function(y,m){if(_.hasChild(y)){var b=e.getServerCache().getNode().getImmediateChild(y),R=u.applyMerge_(b,m);h=u.applyServerOverwrite_(h,new A(y),R,i,o,a,l)}}),f.children.inorderTraversal(function(y,m){var b=!e.getServerCache().isCompleteForChild(y)&&null==m.value;if(!_.hasChild(y)&&!b){var R=e.getServerCache().getNode().getImmediateChild(y),U=u.applyMerge_(R,m);h=u.applyServerOverwrite_(h,new A(y),U,i,o,a,l)}}),h},n.prototype.ackUserWrite_=function(e,t,r,i,o,a){if(null!=i.shadowingWrite(t))return e;var l=e.getServerCache().isFiltered(),u=e.getServerCache();if(null!=r.value){if(t.isEmpty()&&u.isFullyInitialized()||u.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,u.getNode().getChild(t),i,o,l,a);if(t.isEmpty()){var h=ue.Empty;return u.getNode().forEachChild(ge,function(_,y){h=h.set(new A(_),y)}),this.applyServerMerge_(e,t,h,i,o,l,a)}return e}var f=ue.Empty;return r.foreach(function(_,y){var m=t.child(_);u.isCompleteForPath(m)&&(f=f.set(_,u.getNode().getChild(m)))}),this.applyServerMerge_(e,t,f,i,o,l,a)},n.prototype.listenComplete_=function(e,t,r,i){var o=e.getServerCache(),a=e.updateServerSnap(o.getNode(),o.isFullyInitialized()||t.isEmpty(),o.isFiltered());return this.generateEventCacheAfterServerEvent_(a,t,r,Tn,i)},n.prototype.revertUserWrite_=function(e,t,r,i,o){var a;if(null!=r.shadowingWrite(t))return e;var l=new sn(r,e,i),u=e.getEventCache().getNode(),h=void 0;if(t.isEmpty()||".priority"===t.getFront()){var f=void 0;if(e.getServerCache().isFullyInitialized())f=r.calcCompleteEventCache(e.getCompleteServerSnap());else{var _=e.getServerCache().getNode();c.assert(_ instanceof P,"serverChildren would be complete if leaf node"),f=r.calcCompleteEventChildren(_)}h=this.filter_.updateFullNode(u,f=f,o)}else{var y=t.getFront(),m=r.calcCompleteChild(y,e.getServerCache());null==m&&e.getServerCache().isCompleteForChild(y)&&(m=u.getImmediateChild(y)),(h=null!=m?this.filter_.updateChild(u,y,m,t.popFront(),l,o):e.getEventCache().getNode().hasChild(y)?this.filter_.updateChild(u,y,P.EMPTY_NODE,t.popFront(),l,o):u).isEmpty()&&e.getServerCache().isFullyInitialized()&&(a=r.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(h=this.filter_.updateFullNode(h,a,o))}return a=e.getServerCache().isFullyInitialized()||null!=r.shadowingWrite(A.Empty),e.updateEventSnap(h,a,this.filter_.filtersNodes())},n}(),cr=function(){function n(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return n.prototype.generateEventsForChanges=function(e,t,r){var i=this,o=[],a=[];return e.forEach(function(l){l.type===M.CHILD_CHANGED&&i.index_.indexedValueChanged(l.oldSnap,l.snapshotNode)&&a.push(M.childMovedChange(l.childName,l.snapshotNode))}),this.generateEventsForType_(o,M.CHILD_REMOVED,e,r,t),this.generateEventsForType_(o,M.CHILD_ADDED,e,r,t),this.generateEventsForType_(o,M.CHILD_MOVED,a,r,t),this.generateEventsForType_(o,M.CHILD_CHANGED,e,r,t),this.generateEventsForType_(o,M.VALUE,e,r,t),o},n.prototype.generateEventsForType_=function(e,t,r,i,o){var a=this,l=r.filter(function(u){return u.type===t});l.sort(this.compareChanges_.bind(this)),l.forEach(function(u){var h=a.materializeSingleChange_(u,o);i.forEach(function(f){f.respondsTo(u.type)&&e.push(f.createEvent(h,a.query_))})})},n.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_)),e},n.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw c.assertionError("Should only compare child_ events.");var r=new k(e.childName,e.snapshotNode),i=new k(t.childName,t.snapshotNode);return this.index_.compare(r,i)},n}(),pr=function(){function n(e,t){this.query_=e,this.eventRegistrations_=[];var r=this.query_.getQueryParams(),i=new on(r.getIndex()),o=r.getNodeFilter();this.processor_=new hr(o);var a=t.getServerCache(),l=t.getEventCache(),u=i.updateFullNode(P.EMPTY_NODE,a.getNode(),null),h=o.updateFullNode(P.EMPTY_NODE,l.getNode(),null),f=new Re(u,a.isFullyInitialized(),i.filtersNodes()),_=new Re(h,l.isFullyInitialized(),o.filtersNodes());this.viewCache_=new Cn(_,f),this.eventGenerator_=new cr(this.query_)}return n.prototype.getQuery=function(){return this.query_},n.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},n.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},n.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},n.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},n.prototype.removeEventRegistration=function(e,t){var r=[];if(t){c.assert(null==e,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(u){var h=u.createCancelEvent(t=t,i);h&&r.push(h)})}if(e){for(var o=[],a=0;a<this.eventRegistrations_.length;++a){var l=this.eventRegistrations_[a];if(l.matches(e)){if(e.hasAnyCallback()){o=o.concat(this.eventRegistrations_.slice(a+1));break}}else o.push(l)}this.eventRegistrations_=o}else this.eventRegistrations_=[];return r},n.prototype.applyOperation=function(e,t,r){e.type===he.MERGE&&null!==e.source.queryId&&(c.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),c.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var i=this.viewCache_,o=this.processor_.applyOperation(i,e,t,r);return this.processor_.assertIndexed(o.viewCache),c.assert(o.viewCache.getServerCache().isFullyInitialized()||!i.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=o.viewCache,this.generateEventsForChanges_(o.changes,o.viewCache.getEventCache().getNode(),null)},n.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(B,function(o,a){r.push(M.childAddedChange(o,a))}),t.isFullyInitialized()&&r.push(M.valueChange(t.getNode())),this.generateEventsForChanges_(r,t.getNode(),e)},n.prototype.generateEventsForChanges_=function(e,t,r){return this.eventGenerator_.generateEventsForChanges(e,t,r?[r]:this.eventRegistrations_)},n}(),wn=function(){function n(){this.views=new Map}return Object.defineProperty(n,"__referenceConstructor",{get:function(){return c.assert(kt,"Reference.ts has not been loaded"),kt},set:function(e){c.assert(!kt,"__referenceConstructor has already been defined"),kt=e},enumerable:!1,configurable:!0}),n.prototype.isEmpty=function(){return 0===this.views.size},n.prototype.applyOperation=function(e,t,r){var i,o,a=e.source.queryId;if(null!==a){var l=this.views.get(a);return c.assert(null!=l,"SyncTree gave us an op for an invalid query."),l.applyOperation(e,t,r)}var u=[];try{for(var h=D.__values(this.views.values()),f=h.next();!f.done;f=h.next())u=u.concat((l=f.value).applyOperation(e,t,r))}catch(_){i={error:_}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return u},n.prototype.addEventRegistration=function(e,t,r,i,o){var a=e.queryIdentifier(),l=this.views.get(a);if(!l){var u=r.calcCompleteEventCache(o?i:null),h=!1;u?h=!0:i instanceof P?(u=r.calcCompleteEventChildren(i),h=!1):(u=P.EMPTY_NODE,h=!1);var f=new Cn(new Re(u,h,!1),new Re(i,o,!1));l=new pr(e,f),this.views.set(a,l)}return l.addEventRegistration(t),l.getInitialEvents(t)},n.prototype.removeEventRegistration=function(e,t,r){var i,o,a=e.queryIdentifier(),l=[],u=[],h=this.hasCompleteView();if("default"===a)try{for(var f=D.__values(this.views.entries()),_=f.next();!_.done;_=f.next()){var b,y=D.__read(_.value,2),m=y[0];u=u.concat((b=y[1]).removeEventRegistration(t,r)),b.isEmpty()&&(this.views.delete(m),b.getQuery().getQueryParams().loadsAllData()||l.push(b.getQuery()))}}catch(R){i={error:R}}finally{try{_&&!_.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}else(b=this.views.get(a))&&(u=u.concat(b.removeEventRegistration(t,r)),b.isEmpty()&&(this.views.delete(a),b.getQuery().getQueryParams().loadsAllData()||l.push(b.getQuery())));return h&&!this.hasCompleteView()&&l.push(new n.__referenceConstructor(e.repo,e.path)),{removed:l,events:u}},n.prototype.getQueryViews=function(){var e,t,r=[];try{for(var i=D.__values(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;a.getQuery().getQueryParams().loadsAllData()||r.push(a)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},n.prototype.getCompleteServerCache=function(e){var t,r,i=null;try{for(var o=D.__values(this.views.values()),a=o.next();!a.done;a=o.next())i=i||a.value.getCompleteServerCache(e)}catch(u){t={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},n.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var r=e.queryIdentifier();return this.views.get(r)},n.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},n.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},n.prototype.getCompleteView=function(){var e,t;try{for(var r=D.__values(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.getQuery().getQueryParams().loadsAllData())return o}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return null},n}(),Sn=function(){function n(e){this.writeTree_=e}return n.prototype.addWrite=function(e,t){if(e.isEmpty())return new n(new ue(t));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,a=A.relativePath(i,e);return o=o.updateChild(a,t),new n(this.writeTree_.set(i,o))}var l=new ue(t);return new n(this.writeTree_.setTree(e,l))},n.prototype.addWrites=function(e,t){var r=this;return Z(t,function(i,o){r=r.addWrite(e.child(i),o)}),r},n.prototype.removeWrite=function(e){return e.isEmpty()?n.Empty:new n(this.writeTree_.setTree(e,ue.Empty))},n.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},n.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(A.relativePath(t.path,e)):null},n.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(B,function(r,i){e.push(new k(r,i))}):this.writeTree_.children.inorderTraversal(function(r,i){null!=i.value&&e.push(new k(r,i.value))}),e},n.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var t=this.getCompleteNode(e);return new n(null!=t?new ue(t):this.writeTree_.subtree(e))},n.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},n.prototype.apply=function(e){return bn(A.Empty,this.writeTree_,e)},n.Empty=new n(new ue(null)),n}();function bn(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);var r=null;return e.children.inorderTraversal(function(i,o){".priority"===i?(c.assert(null!==o.value,"Priority writes must always be leaf nodes"),r=o.value):t=bn(n.child(i),o,t)}),!t.getChild(n).isEmpty()&&null!==r&&(t=t.updateChild(n.child(".priority"),r)),t}var fr=function(){function n(){this.visibleWrites_=Sn.Empty,this.allWrites_=[],this.lastWriteId_=-1}return n.prototype.childWrites=function(e){return new dr(e,this)},n.prototype.addOverwrite=function(e,t,r,i){c.assert(r>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),this.allWrites_.push({path:e,snap:t,writeId:r,visible:i}),i&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=r},n.prototype.addMerge=function(e,t,r){c.assert(r>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:r,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=r},n.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var r=this.allWrites_[t];if(r.writeId===e)return r}return null},n.prototype.removeWrite=function(e){var t=this,r=this.allWrites_.findIndex(function(f){return f.writeId===e});c.assert(r>=0,"removeWrite called with nonexistent writeId.");var i=this.allWrites_[r];this.allWrites_.splice(r,1);for(var o=i.visible,a=!1,l=this.allWrites_.length-1;o&&l>=0;){var u=this.allWrites_[l];u.visible&&(l>=r&&this.recordContainsPath_(u,i.path)?o=!1:i.path.contains(u.path)&&(a=!0)),l--}return!!o&&(a?(this.resetTree_(),!0):(i.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(i.path):Z(i.children,function(f){t.visibleWrites_=t.visibleWrites_.removeWrite(i.path.child(f))}),!0))},n.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},n.prototype.calcCompleteEventCache=function(e,t,r,i){if(r||i){var u=this.visibleWrites_.childCompoundWrite(e);return!i&&u.isEmpty()?t:i||null!=t||u.hasCompleteWrite(A.Empty)?n.layerTree_(this.allWrites_,function(y){return(y.visible||i)&&(!r||!~r.indexOf(y.writeId))&&(y.path.contains(e)||e.contains(y.path))},e).apply(t||P.EMPTY_NODE):null}var o=this.visibleWrites_.getCompleteNode(e);if(null!=o)return o;var a=this.visibleWrites_.childCompoundWrite(e);return a.isEmpty()?t:null!=t||a.hasCompleteWrite(A.Empty)?a.apply(t||P.EMPTY_NODE):null},n.prototype.calcCompleteEventChildren=function(e,t){var r=P.EMPTY_NODE,i=this.visibleWrites_.getCompleteNode(e);if(i)return i.isLeafNode()||i.forEachChild(B,function(l,u){r=r.updateImmediateChild(l,u)}),r;if(t){var o=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(B,function(l,u){var h=o.childCompoundWrite(new A(l)).apply(u);r=r.updateImmediateChild(l,h)}),o.getCompleteChildren().forEach(function(l){r=r.updateImmediateChild(l.name,l.node)}),r}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach(function(l){r=r.updateImmediateChild(l.name,l.node)}),r},n.prototype.calcEventCacheAfterServerOverwrite=function(e,t,r,i){c.assert(r||i,"Either existingEventSnap or existingServerSnap must exist");var o=e.child(t);if(this.visibleWrites_.hasCompleteWrite(o))return null;var a=this.visibleWrites_.childCompoundWrite(o);return a.isEmpty()?i.getChild(t):a.apply(i.getChild(t))},n.prototype.calcCompleteChild=function(e,t,r){var i=e.child(t),o=this.visibleWrites_.getCompleteNode(i);return null!=o?o:r.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(i).apply(r.getNode().getImmediateChild(t)):null},n.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},n.prototype.calcIndexedSlice=function(e,t,r,i,o,a){var l,u=this.visibleWrites_.childCompoundWrite(e),h=u.getCompleteNode(A.Empty);if(null!=h)l=h;else{if(null==t)return[];l=u.apply(t)}if((l=l.withIndex(a)).isEmpty()||l.isLeafNode())return[];for(var f=[],_=a.getCompare(),y=o?l.getReverseIteratorFrom(r,a):l.getIteratorFrom(r,a),m=y.getNext();m&&f.length<i;)0!==_(m,r)&&f.push(m),m=y.getNext();return f},n.prototype.recordContainsPath_=function(e,t){if(e.snap)return e.path.contains(t);for(var r in e.children)if(e.children.hasOwnProperty(r)&&e.path.child(r).contains(t))return!0;return!1},n.prototype.resetTree_=function(){this.visibleWrites_=n.layerTree_(this.allWrites_,n.DefaultFilter_,A.Empty),this.lastWriteId_=this.allWrites_.length>0?this.allWrites_[this.allWrites_.length-1].writeId:-1},n.DefaultFilter_=function(e){return e.visible},n.layerTree_=function(e,t,r){for(var i=Sn.Empty,o=0;o<e.length;++o){var a=e[o];if(t(a)){var l=a.path,u=void 0;if(a.snap)r.contains(l)?(u=A.relativePath(r,l),i=i.addWrite(u,a.snap)):l.contains(r)&&(u=A.relativePath(l,r),i=i.addWrite(A.Empty,a.snap.getChild(u)));else{if(!a.children)throw c.assertionError("WriteRecord should have .snap or .children");if(r.contains(l))u=A.relativePath(r,l),i=i.addWrites(u,a.children);else if(l.contains(r))if((u=A.relativePath(l,r)).isEmpty())i=i.addWrites(A.Empty,a.children);else{var h=c.safeGet(a.children,u.getFront());if(h){var f=h.getChild(u.popFront());i=i.addWrite(A.Empty,f)}}}}}return i},n}(),dr=function(){function n(e,t){this.treePath_=e,this.writeTree_=t}return n.prototype.calcCompleteEventCache=function(e,t,r){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,r)},n.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},n.prototype.calcEventCacheAfterServerOverwrite=function(e,t,r){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,r)},n.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},n.prototype.calcIndexedSlice=function(e,t,r,i,o){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,r,i,o)},n.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},n.prototype.child=function(e){return new n(this.treePath_.child(e),this.writeTree_)},n}(),An=function(){function n(e){this.listenProvider_=e,this.syncPointTree_=ue.Empty,this.pendingWriteTree_=new fr,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return n.prototype.applyUserOverwrite=function(e,t,r,i){return this.pendingWriteTree_.addOverwrite(e,t,r,i),i?this.applyOperationToSyncPoints_(new Lt(Ie.User,e,t)):[]},n.prototype.applyUserMerge=function(e,t,r){this.pendingWriteTree_.addMerge(e,t,r);var i=ue.fromObject(t);return this.applyOperationToSyncPoints_(new rn(Ie.User,e,i))},n.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var r=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var o=ue.Empty;return null!=r.snap?o=o.set(A.Empty,!0):Z(r.children,function(a,l){o=o.set(new A(a),l)}),this.applyOperationToSyncPoints_(new or(r.path,o,t))}return[]},n.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new Lt(Ie.Server,e,t))},n.prototype.applyServerMerge=function(e,t){var r=ue.fromObject(t);return this.applyOperationToSyncPoints_(new rn(Ie.Server,e,r))},n.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new En(Ie.Server,e))},n.prototype.applyTaggedQueryOverwrite=function(e,t,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=n.parseQueryKey_(i),a=o.path,l=o.queryId,u=A.relativePath(a,e),h=new Lt(Ie.forServerTaggedQuery(l),u,t);return this.applyTaggedOperation_(a,h)}return[]},n.prototype.applyTaggedQueryMerge=function(e,t,r){var i=this.queryKeyForTag_(r);if(i){var o=n.parseQueryKey_(i),a=o.path,l=o.queryId,u=A.relativePath(a,e),h=ue.fromObject(t),f=new rn(Ie.forServerTaggedQuery(l),u,h);return this.applyTaggedOperation_(a,f)}return[]},n.prototype.applyTaggedListenComplete=function(e,t){var r=this.queryKeyForTag_(t);if(r){var i=n.parseQueryKey_(r),o=i.path,a=i.queryId,l=A.relativePath(o,e),u=new En(Ie.forServerTaggedQuery(a),l);return this.applyTaggedOperation_(o,u)}return[]},n.prototype.addEventRegistration=function(e,t){var r=e.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(R,U){var W=A.relativePath(R,r);i=i||U.getCompleteServerCache(W),o=o||U.hasCompleteView()});var l,a=this.syncPointTree_.get(r);a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(A.Empty)):(a=new wn,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i?l=!0:(l=!1,i=P.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(R,U){var W=U.getCompleteServerCache(A.Empty);W&&(i=i.updateImmediateChild(R,W))}));var h=a.viewExistsForQuery(e);if(!h&&!e.getQueryParams().loadsAllData()){var f=n.makeQueryKey_(e);c.assert(!this.queryToTagMap.has(f),"View does not exist, but we have a tag");var _=n.getNextQueryTag_();this.queryToTagMap.set(f,_),this.tagToQueryMap.set(_,f)}var y=this.pendingWriteTree_.childWrites(r),m=a.addEventRegistration(e,t,y,i,l);if(!h&&!o){var b=a.viewForQuery(e);m=m.concat(this.setupListener_(e,b))}return m},n.prototype.removeEventRegistration=function(e,t,r){var i=this,o=e.path,a=this.syncPointTree_.get(o),l=[];if(a&&("default"===e.queryIdentifier()||a.viewExistsForQuery(e))){var u=a.removeEventRegistration(e,t,r);a.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var h=u.removed;l=u.events;var f=-1!==h.findIndex(function(ce){return ce.getQueryParams().loadsAllData()}),_=this.syncPointTree_.findOnPath(o,function(ce,qe){return qe.hasCompleteView()});if(f&&!_){var y=this.syncPointTree_.subtree(o);if(!y.isEmpty())for(var m=this.collectDistinctViewsForSubTree_(y),b=0;b<m.length;++b){var R=m[b],U=R.getQuery(),W=this.createListenerForView_(R);this.listenProvider_.startListening(n.queryForListening_(U),this.tagForQuery_(U),W.hashFn,W.onComplete)}}!_&&h.length>0&&!r&&(f?this.listenProvider_.stopListening(n.queryForListening_(e),null):h.forEach(function(ce){var qe=i.queryToTagMap.get(n.makeQueryKey_(ce));i.listenProvider_.stopListening(n.queryForListening_(ce),qe)})),this.removeTags_(h)}return l},n.prototype.calcCompleteEventCache=function(e,t){var i=this.pendingWriteTree_,o=this.syncPointTree_.findOnPath(e,function(a,l){var u=A.relativePath(a,e),h=l.getCompleteServerCache(u);if(h)return h});return i.calcCompleteEventCache(e,o,t,!0)},n.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(t,r,i){if(r&&r.hasCompleteView())return[r.getCompleteView()];var a=[];return r&&(a=r.getQueryViews()),Z(i,function(l,u){a=a.concat(u)}),a})},n.prototype.removeTags_=function(e){for(var t=0;t<e.length;++t){var r=e[t];if(!r.getQueryParams().loadsAllData()){var i=n.makeQueryKey_(r),o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o)}}},n.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},n.prototype.setupListener_=function(e,t){var r=e.path,i=this.tagForQuery_(e),o=this.createListenerForView_(t),a=this.listenProvider_.startListening(n.queryForListening_(e),i,o.hashFn,o.onComplete),l=this.syncPointTree_.subtree(r);if(i)c.assert(!l.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=l.fold(function(_,y,m){if(!_.isEmpty()&&y&&y.hasCompleteView())return[y.getCompleteView().getQuery()];var b=[];return y&&(b=b.concat(y.getQueryViews().map(function(R){return R.getQuery()}))),Z(m,function(R,U){b=b.concat(U)}),b}),h=0;h<u.length;++h){var f=u[h];this.listenProvider_.stopListening(n.queryForListening_(f),this.tagForQuery_(f))}return a},n.prototype.createListenerForView_=function(e){var t=this,r=e.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(e.getServerCache()||P.EMPTY_NODE).hash()},onComplete:function(o){if("ok"===o)return i?t.applyTaggedListenComplete(r.path,i):t.applyListenComplete(r.path);var a=function(n,e){var t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");var r=new Error(n+" at "+e.path.toString()+": "+t);return r.code=n.toUpperCase(),r}(o,r);return t.removeEventRegistration(r,null,a)}}},n.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},n.parseQueryKey_=function(e){var t=e.indexOf("$");return c.assert(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new A(e.substr(0,t))}},n.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},n.prototype.tagForQuery_=function(e){var t=n.makeQueryKey_(e);return this.queryToTagMap.get(t)},n.getNextQueryTag_=function(){return n.nextQueryTag_++},n.prototype.applyTaggedOperation_=function(e,t){var r=this.syncPointTree_.get(e);c.assert(r,"Missing sync point for query tag that we're tracking");var i=this.pendingWriteTree_.childWrites(e);return r.applyOperation(t,i,null)},n.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(A.Empty))},n.prototype.applyOperationHelper_=function(e,t,r,i){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,r,i);var o=t.get(A.Empty);null==r&&null!=o&&(r=o.getCompleteServerCache(A.Empty));var a=[],l=e.path.getFront(),u=e.operationForChild(l),h=t.children.get(l);if(h&&u){var f=r?r.getImmediateChild(l):null,_=i.child(l);a=a.concat(this.applyOperationHelper_(u,h,f,_))}return o&&(a=a.concat(o.applyOperation(e,i,r))),a},n.prototype.applyOperationDescendantsHelper_=function(e,t,r,i){var o=this,a=t.get(A.Empty);null==r&&null!=a&&(r=a.getCompleteServerCache(A.Empty));var l=[];return t.children.inorderTraversal(function(u,h){var f=r?r.getImmediateChild(u):null,_=i.child(u),y=e.operationForChild(u);y&&(l=l.concat(o.applyOperationDescendantsHelper_(y,h,f,_)))}),a&&(l=l.concat(a.applyOperation(e,i,r))),l},n.nextQueryTag_=1,n}(),vr=function(){function n(){this.rootNode_=P.EMPTY_NODE}return n.prototype.getNode=function(e){return this.rootNode_.getChild(e)},n.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},n}(),_r=function(){function n(){this.counters_={}}return n.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),c.contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},n.prototype.get=function(){return c.deepCopy(this.counters_)},n}(),Mt=function(){function n(){}return n.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new _r),this.collections_[t]},n.getOrCreateReporter=function(e,t){var r=e.toString();return this.reporters_[r]||(this.reporters_[r]=t()),this.reporters_[r]},n.collections_={},n.reporters_={},n}(),In=function(){function n(e){this.collection_=e,this.last_=null}return n.prototype.get=function(){var e=this.collection_.get(),t=D.__assign({},e);return this.last_&&Z(this.last_,function(r,i){t[r]=t[r]-i}),this.last_=e,t},n}(),mr=function(){function n(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new In(e);var r=1e4+2e4*Math.random();Pe(this.reportStats_.bind(this),Math.floor(r))}return n.prototype.includeStat=function(e){this.statsToReport_[e]=!0},n.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),r={},i=!1;Z(t,function(o,a){a>0&&c.contains(e.statsToReport_,o)&&(r[o]=a,i=!0)}),i&&this.server_.reportStats(r),Pe(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},n}(),Er=function(){function n(){this.eventLists_=[],this.recursionDepth_=0}return n.prototype.queueEvents=function(e){for(var t=null,r=0;r<e.length;r++){var i=e[r],o=i.getPath();null!==t&&!o.equals(t.getPath())&&(this.eventLists_.push(t),t=null),null===t&&(t=new Cr(o)),t.add(i)}t&&this.eventLists_.push(t)},n.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(r){return r.equals(e)})},n.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(r){return r.contains(e)||e.contains(r)})},n.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,r=0;r<this.eventLists_.length;r++){var i=this.eventLists_[r];i&&(e(i.getPath())?(this.eventLists_[r].raise(),this.eventLists_[r]=null):t=!1)}t&&(this.eventLists_=[]),this.recursionDepth_--},n}(),Cr=function(){function n(e){this.path_=e,this.events_=[]}return n.prototype.add=function(e){this.events_.push(e)},n.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var r=t.getEventRunner();ve&&j("event: "+t.toString()),Oe(r)}}},n.prototype.getPath=function(){return this.path_},n}(),Nn=function(){function n(e){this.allowedEvents_=e,this.listeners_={},c.assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return n.prototype.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(Array.isArray(this.listeners_[e]))for(var i=D.__spread(this.listeners_[e]),o=0;o<i.length;o++)i[o].callback.apply(i[o].context,t)},n.prototype.on=function(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});var i=this.getInitialEvent(e);i&&t.apply(r,i)},n.prototype.off=function(e,t,r){this.validateEventType_(e);for(var i=this.listeners_[e]||[],o=0;o<i.length;o++)if(i[o].callback===t&&(!r||r===i[o].context))return void i.splice(o,1)},n.prototype.validateEventType_=function(e){c.assert(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},n}(),Tr=function(n){function e(){var r,i,t=n.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(i="visibilitychange",r="hidden"):void 0!==document.mozHidden?(i="mozvisibilitychange",r="mozHidden"):void 0!==document.msHidden?(i="msvisibilitychange",r="msHidden"):void 0!==document.webkitHidden&&(i="webkitvisibilitychange",r="webkitHidden")),t.visible_=!0,i&&document.addEventListener(i,function(){var o=!document[r];o!==t.visible_&&(t.visible_=o,t.trigger("visible",o))},!1),t}return D.__extends(e,n),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return c.assert("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(Nn),On=function(n){function e(){var t=n.call(this,["online"])||this;return t.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!c.isMobileCordova()&&(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return D.__extends(e,n),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return c.assert("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(Nn),wr=function(){function n(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return n.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},n.prototype.handleResponse=function(e,t){var r=this;this.pendingResponses[e]=t;for(var i=function(){var l=o.pendingResponses[o.currentResponseNum];delete o.pendingResponses[o.currentResponseNum];for(var u=function(f){l[f]&&Oe(function(){r.onMessage_(l[f])})},h=0;h<l.length;++h)u(h);if(o.currentResponseNum===o.closeAfterResponse)return o.onClose&&(o.onClose(),o.onClose=null),"break";o.currentResponseNum++},o=this;this.pendingResponses[this.currentResponseNum]&&"break"!==i(););},n}(),an=function(){function n(e,t,r,i,o){this.connId=e,this.repoInfo=t,this.applicationId=r,this.transportSessionId=i,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Se(e),this.stats_=Mt.getCollection(t),this.urlFn=function(a){return t.connectionURL(gt,a)}}return n.prototype.open=function(e,t){var r=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new wr(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){r.log_("Timed out trying to connect."),r.onClosed_(),r.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if(c.isNodeSdk()||"complete"===document.readyState)n();else{var e=!1,t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(function(){if(!r.isClosed_){r.scriptTagHolder=new Lr(function(){for(var a=[],l=0;l<arguments.length;l++)a[l]=arguments[l];var u=D.__read(a,5),h=u[0],f=u[1],_=u[2];if(r.incrementIncomingBytes_(a),r.scriptTagHolder)if(r.connectTimeoutTimer_&&(clearTimeout(r.connectTimeoutTimer_),r.connectTimeoutTimer_=null),r.everConnected_=!0,"start"===h)r.id=f,r.password=_;else{if("close"!==h)throw new Error("Unrecognized command received: "+h);f?(r.scriptTagHolder.sendNewPolls=!1,r.myPacketOrderer.closeAfter(f,function(){r.onClosed_()})):r.onClosed_()}},function(){for(var a=[],l=0;l<arguments.length;l++)a[l]=arguments[l];var u=D.__read(a,2),h=u[0],f=u[1];r.incrementIncomingBytes_(a),r.myPacketOrderer.handleResponse(h,f)},function(){r.onClosed_()},r.urlFn);var i={start:"t"};i.ser=Math.floor(1e8*Math.random()),r.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=r.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",r.transportSessionId&&(i.s=r.transportSessionId),r.lastSessionId&&(i.ls=r.lastSessionId),r.applicationId&&(i.p=r.applicationId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(et)&&(i.r="f");var o=r.urlFn(i);r.log_("Connecting via long-poll to "+o),r.scriptTagHolder.addTag(o,function(){})}})},n.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},n.forceAllow=function(){n.forceAllow_=!0},n.forceDisallow=function(){n.forceDisallow_=!0},n.isAvailable=function(){return!(c.isNodeSdk()||!n.forceAllow_&&(n.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},n.prototype.markConnectionHealthy=function(){},n.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},n.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},n.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},n.prototype.send=function(e){var t=c.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var r=c.base64Encode(t),i=x(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},n.prototype.addDisconnectPingFrame=function(e,t){if(!c.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var r={dframe:"t"};r.id=e,r.pw=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},n.prototype.incrementIncomingBytes_=function(e){var t=c.stringify(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},n}(),Lr=function(){function n(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,c.isNodeSdk())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Te(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();var o="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(o='<script>document.domain="'+document.domain+'";<\/script>');var l="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(l),this.myIFrame.doc.close()}catch(u){j("frame writing exception"),u.stack&&j(u.stack),j(u)}}}return n.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||j("No IE domain setting required")}catch(i){var r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},n.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},n.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},n.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),r="",i=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+r.length<=1870;){var a=this.pendingSegs.shift();r=r+"&seg"+i+"="+a.seg+"&ts"+i+"="+a.ts+"&d"+i+"="+a.d,i++}return this.addLongPollTag_(t+=r,this.currentSerial),!0}return!1},n.prototype.enqueueSegment=function(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()},n.prototype.addLongPollTag_=function(e,t){var r=this;this.outstandingRequests.add(t);var i=function(){r.outstandingRequests.delete(t),r.newRequest_()},o=setTimeout(i,Math.floor(25e3));this.addTag(e,function(){clearTimeout(o),i()})},n.prototype.addTag=function(e,t){var r=this;c.isNodeSdk()?this.doNodeLongPoll(e,t):setTimeout(function(){try{if(!r.sendNewPolls)return;var i=r.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){var o=i.readyState;(!o||"loaded"===o||"complete"===o)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=function(){j("Long-poll script failed to load: "+e),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(i)}catch(o){}},Math.floor(1))},n}(),ln="",lt=null;"undefined"!=typeof MozWebSocket?lt=MozWebSocket:"undefined"!=typeof WebSocket&&(lt=WebSocket);var We=function(){function n(e,t,r,i,o){this.connId=e,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Se(this.connId),this.stats_=Mt.getCollection(t),this.connURL=n.connectionURL_(t,i,o),this.nodeAdmin=t.nodeAdmin}return n.connectionURL_=function(e,t,r){var i={v:"5"};return!c.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(et)&&(i.r="f"),t&&(i.s=t),r&&(i.ls=r),e.connectionURL(yt,i)},n.prototype.open=function(e,t){var r=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ne.set("previous_websocket_failure",!0);try{if(c.isNodeSdk()){var o={headers:{"User-Agent":"Firebase/5/"+ln+"/"+process.platform+"/"+(this.nodeAdmin?"AdminNode":"Node"),"X-Firebase-GMPID":this.applicationId||""}},a=process.env,l=0===this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;l&&(o.proxy={origin:l}),this.mySock=new lt(this.connURL,[],o)}else this.mySock=new lt(this.connURL,[],o={headers:{"X-Firebase-GMPID":this.applicationId||""}})}catch(h){this.log_("Error instantiating WebSocket.");var u=h.message||h.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(h){r.handleIncomingFrame(h)},this.mySock.onerror=function(h){r.log_("WebSocket error.  Closing connection.");var f=h.message||h.data;f&&r.log_(f),r.onClosed_()}},n.prototype.start=function(){},n.forceDisallow=function(){n.forceDisallow_=!0},n.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var r=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&null!==lt&&!n.forceDisallow_},n.previouslyFailed=function(){return ne.isInMemoryStorage||!0===ne.get("previous_websocket_failure")},n.prototype.markConnectionHealthy=function(){ne.remove("previous_websocket_failure")},n.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var r=c.jsonEval(t);this.onMessage(r)}},n.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},n.prototype.extractFrameCount_=function(e){if(c.assert(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},n.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var r=this.extractFrameCount_(t);null!==r&&this.appendFrame_(r)}}},n.prototype.send=function(e){this.resetKeepAlive();var t=c.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var r=x(t,16384);r.length>1&&this.sendString_(String(r.length));for(var i=0;i<r.length;i++)this.sendString_(r[i])},n.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},n.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},n.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},n.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(45e3))},n.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n}(),Zr=function(){function n(e){this.initTransports_(e)}return Object.defineProperty(n,"ALL_TRANSPORTS",{get:function(){return[an,We]},enumerable:!1,configurable:!0}),n.prototype.initTransports_=function(e){var t,r,i=We&&We.isAvailable(),o=i&&!We.previouslyFailed();if(e.webSocketOnly&&(i||z("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[We];else{var a=this.transports_=[];try{for(var l=D.__values(n.ALL_TRANSPORTS),u=l.next();!u.done;u=l.next()){var h=u.value;h&&h.isAvailable()&&a.push(h)}}catch(f){t={error:f}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}},n.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},n.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},n}(),Vn=function(){function n(e,t,r,i,o,a,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.onMessage_=i,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Se("c:"+this.id+":"),this.transportManager_=new Zr(t),this.log_("Connection created"),this.start_()}return n.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var r=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(r,i)},Math.floor(0));var o=t.healthyTimeout||0;o>0&&(this.healthyTimeout_=Pe(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(o)))},n.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},n.prototype.disconnReceiver_=function(e){var t=this;return function(r){e===t.conn_?t.onConnectionLost_(r):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},n.prototype.connReceiver_=function(e){var t=this;return function(r){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(r):e===t.secondaryConn_?t.onSecondaryMessageReceived_(r):t.log_("message on old connection"))}},n.prototype.sendRequest=function(e){this.sendData_({t:"d",d:e})},n.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},n.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},n.prototype.onSecondaryMessageReceived_=function(e){var t=V("t",e),r=V("d",e);if("c"===t)this.onSecondaryControl_(r);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(r)}},n.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},n.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},n.prototype.onPrimaryMessageReceived_=function(e){var t=V("t",e),r=V("d",e);"c"===t?this.onControl_(r):"d"===t&&this.onDataMessage_(r)},n.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},n.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},n.prototype.onControl_=function(e){var t=V("t",e);if("d"in e){var r=e.d;if("h"===t)this.onHandshake_(r);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(r):"r"===t?this.onReset_(r):"e"===t?Ne("Server Error: "+r):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ne("Unknown control packet command: "+t)}},n.prototype.onHandshake_=function(e){var t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(i),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==r&&z("Protocol version mismatch detected"),this.tryStartUpgrade_())},n.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},n.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var r=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(r,i),Pe(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(6e4))},n.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},n.prototype.onConnectionEstablished_=function(e,t){var r=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Pe(function(){r.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},n.prototype.sendPingOnPrimaryIfNecessary_=function(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},n.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()},n.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ne.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},n.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},n.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},n.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},n.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},n}(),Bn=function(){function n(){}return n.prototype.put=function(e,t,r,i){},n.prototype.merge=function(e,t,r,i){},n.prototype.refreshAuthToken=function(e){},n.prototype.onDisconnectPut=function(e,t,r){},n.prototype.onDisconnectMerge=function(e,t,r){},n.prototype.onDisconnectCancel=function(e,t){},n.prototype.reportStats=function(e){},n}(),ut=1e3,Qe=function(n){function e(t,r,i,o,a,l,u){var h=n.call(this)||this;if(h.repoInfo_=t,h.applicationId_=r,h.onDataUpdate_=i,h.onConnectStatus_=o,h.onServerInfoUpdate_=a,h.authTokenProvider_=l,h.authOverride_=u,h.id=e.nextPersistentConnectionId_++,h.log_=Se("p:"+h.id+":"),h.interruptReasons_={},h.listens=new Map,h.outstandingPuts_=[],h.outstandingPutCount_=0,h.onDisconnectRequestQueue_=[],h.connected_=!1,h.reconnectDelay_=ut,h.maxReconnectDelay_=3e5,h.securityDebugCallback_=null,h.lastSessionId=null,h.establishConnectionTimer_=null,h.visible_=!1,h.requestCBHash_={},h.requestNumber_=0,h.realtime_=null,h.authToken_=null,h.forceTokenRefresh_=!1,h.invalidAuthTokenCount_=0,h.firstConnection_=!0,h.lastConnectionAttemptTime_=null,h.lastConnectionEstablishedTime_=null,u&&!c.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return h.scheduleConnect_(0),Tr.getInstance().on("visible",h.onVisible_,h),-1===t.host.indexOf("fblocal")&&On.getInstance().on("online",h.onOnline_,h),h}return D.__extends(e,n),e.prototype.sendRequest=function(t,r,i){var o=++this.requestNumber_,a={r:o,a:t,b:r};this.log_(c.stringify(a)),c.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(a),i&&(this.requestCBHash_[o]=i)},e.prototype.listen=function(t,r,i,o){var a=t.queryIdentifier(),l=t.path.toString();this.log_("Listen called for "+l+" "+a),this.listens.has(l)||this.listens.set(l,new Map),c.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),c.assert(!this.listens.get(l).has(a),"listen() called twice for same path/queryId.");var u={onComplete:o,hashFn:r,query:t,tag:i};this.listens.get(l).set(a,u),this.connected_&&this.sendListen_(u)},e.prototype.sendListen_=function(t){var r=this,i=t.query,o=i.path.toString(),a=i.queryIdentifier();this.log_("Listen on "+o+" for "+a);var l={p:o};t.tag&&(l.q=i.queryObject(),l.t=t.tag),l.h=t.hashFn(),this.sendRequest("q",l,function(h){var f=h.d,_=h.s;e.warnOnListenWarnings_(f,i),(r.listens.get(o)&&r.listens.get(o).get(a))===t&&(r.log_("listen response",h),"ok"!==_&&r.removeListen_(o,a),t.onComplete&&t.onComplete(_,f))})},e.warnOnListenWarnings_=function(t,r){if(t&&"object"==typeof t&&c.contains(t,"w")){var i=c.safeGet(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){var o='".indexOn": "'+r.getQueryParams().getIndex().toString()+'"',a=r.path.toString();z("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+o+" at "+a+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||c.isAdmin(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var r=this.authToken_,i=c.isValidFormat(r)?"auth":"gauth",o={cred:r};null===this.authOverride_?o.noauth=!0:"object"==typeof this.authOverride_&&(o.authvar=this.authOverride_),this.sendRequest(i,o,function(a){var l=a.s,u=a.d||"error";t.authToken_===r&&("ok"===l?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(l,u))})}},e.prototype.unlisten=function(t,r){var i=t.path.toString(),o=t.queryIdentifier();this.log_("Unlisten called for "+i+" "+o),c.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,o)&&this.connected_&&this.sendUnlisten_(i,o,t.queryObject(),r)},e.prototype.sendUnlisten_=function(t,r,i,o){this.log_("Unlisten on "+t+" for "+r);var a={p:t};o&&(a.q=i,a.t=o),this.sendRequest("n",a)},e.prototype.onDisconnectPut=function(t,r,i){this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})},e.prototype.onDisconnectMerge=function(t,r,i){this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})},e.prototype.onDisconnectCancel=function(t,r){this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})},e.prototype.sendOnDisconnect_=function(t,r,i,o){var a={p:r,d:i};this.log_("onDisconnect "+t,a),this.sendRequest(t,a,function(l){o&&setTimeout(function(){o(l.s,l.d)},Math.floor(0))})},e.prototype.put=function(t,r,i,o){this.putInternal("p",t,r,i,o)},e.prototype.merge=function(t,r,i,o){this.putInternal("m",t,r,i,o)},e.prototype.putInternal=function(t,r,i,o,a){var l={p:r,d:i};void 0!==a&&(l.h=a),this.outstandingPuts_.push({action:t,request:l,onComplete:o}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+r)},e.prototype.sendPut_=function(t){var r=this,i=this.outstandingPuts_[t].action,o=this.outstandingPuts_[t].request,a=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,o,function(l){r.log_(i+" response",l),delete r.outstandingPuts_[t],r.outstandingPutCount_--,0===r.outstandingPutCount_&&(r.outstandingPuts_=[]),a&&a(l.s,l.d)})},e.prototype.reportStats=function(t){var r=this;if(this.connected_){var i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,function(o){"ok"!==o.s&&r.log_("reportStats","Error sending stats: "+o.d)})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+c.stringify(t));var r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,r){this.log_("handleServerMessage",t,r),"d"===t?this.onDataUpdate_(r.p,r.d,!1,r.t):"m"===t?this.onDataUpdate_(r.p,r.d,!0,r.t):"c"===t?this.onListenRevoked_(r.p,r.q):"ac"===t?this.onAuthRevoked_(r.s,r.d):"sd"===t?this.onSecurityDebugPacket_(r):Ne("Unrecognized action received from server: "+c.stringify(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var r=this;c.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){r.establishConnectionTimer_=null,r.establishConnection_()},Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ut,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=ut,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=ut),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var r=(new Date).getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-r);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){var t=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var r=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),o=this.onRealtimeDisconnect_.bind(this),a=this.id+":"+e.nextConnectionId_++,l=this,u=this.lastSessionId,h=!1,f=null,_=function(){f?f.close():(h=!0,o())};this.realtime_={close:_,sendRequest:function(b){c.assert(f,"sendRequest call when we're not connected not allowed."),f.sendRequest(b)}};var m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(m).then(function(b){h?j("getToken() completed but was canceled"):(j("getToken() completed. Creating connection."),l.authToken_=b&&b.accessToken,f=new Vn(a,l.repoInfo_,l.applicationId_,r,i,o,function(R){z(R+" ("+l.repoInfo_.toString()+")"),l.interrupt("server_kill")},u))}).then(null,function(b){l.log_("Failed to get token: "+b),h||(t.repoInfo_.nodeAdmin&&z(b),_())})}},e.prototype.interrupt=function(t){j("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){j("Resuming connection for reason: "+t),delete this.interruptReasons_[t],c.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=ut,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var r=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:r})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,r){var i;i=r?r.map(function(a){return ee(a)}).join("$"):"default";var o=this.removeListen_(t,i);o&&o.onComplete&&o.onComplete("permission_denied")},e.prototype.removeListen_=function(t,r){var o,i=new A(t).toString();if(this.listens.has(i)){var a=this.listens.get(i);o=a.get(r),a.delete(r),0===a.size&&this.listens.delete(i)}else o=void 0;return o},e.prototype.onAuthRevoked_=function(t,r){j("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,r,i,o;this.tryAuth();try{for(var a=D.__values(this.listens.values()),l=a.next();!l.done;l=a.next()){var u=l.value;try{for(var h=(i=void 0,D.__values(u.values())),f=h.next();!f.done;f=h.next())this.sendListen_(f.value)}catch(b){i={error:b}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}}}catch(b){t={error:b}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}for(var y=0;y<this.outstandingPuts_.length;y++)this.outstandingPuts_[y]&&this.sendPut_(y);for(;this.onDisconnectRequestQueue_.length;){var m=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(m.action,m.pathString,m.data,m.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},r="js";c.isNodeSdk()&&(r=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+r+"."+ln.replace(/\./g,"-")]=1,c.isMobileCordova()?t["framework.cordova"]=1:c.isReactNative()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=On.getInstance().currentlyOnline();return c.isEmpty(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(Bn),$r=function(n){function e(t,r,i){var o=n.call(this)||this;return o.repoInfo_=t,o.onDataUpdate_=r,o.authTokenProvider_=i,o.log_=Se("p:rest:"),o.listens_={},o}return D.__extends(e,n),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,r){return void 0!==r?"tag$"+r:(c.assert(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,r,i,o){var a=this,l=t.path.toString();this.log_("Listen called for "+l+" "+t.queryIdentifier());var u=e.getListenId_(t,i),h={};this.listens_[u]=h;var f=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(l+".json",f,function(_,y){var m=y;404===_&&(m=null,_=null),null===_&&a.onDataUpdate_(l,m,!1,i),c.safeGet(a.listens_,u)===h&&o(_?401===_?"permission_denied":"rest_error:"+_:"ok",null)})},e.prototype.unlisten=function(t,r){var i=e.getListenId_(t,r);delete this.listens_[i]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,r,i){var o=this;void 0===r&&(r={}),r.format="export",this.authTokenProvider_.getToken(!1).then(function(a){var l=a&&a.accessToken;l&&(r.auth=l);var u=(o.repoInfo_.secure?"https://":"http://")+o.repoInfo_.host+t+"?ns="+o.repoInfo_.namespace+c.querystring(r);o.log_("Sending REST request for "+u);var h=new XMLHttpRequest;h.onreadystatechange=function(){if(i&&4===h.readyState){o.log_("REST Response for "+u+" received. status:",h.status,"response:",h.responseText);var f=null;if(h.status>=200&&h.status<300){try{f=c.jsonEval(h.responseText)}catch(_){z("Failed to parse JSON response for "+u+": "+h.responseText)}i(null,f)}else 401!==h.status&&404!==h.status&&z("Got unsuccessful REST response for "+u+" Status: "+h.status),i(h.status);i=null}},h.open("GET",u,!0),h.send()})},e}(Bn),jn="repo_interrupt",$=function(){function n(e,t,r,i){var o=this;if(this.repoInfo_=e,this.app=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Er,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new tn,this.persistentConnection_=null,this.stats_=Mt.getCollection(e),t||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new $r(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var a=r.options.databaseAuthVariableOverride;if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{c.stringify(a)}catch(l){throw new Error("Invalid authOverride provided: "+l)}}this.persistentConnection_=new Qe(this.repoInfo_,r.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,a),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(l){o.server_.refreshAuthToken(l)}),this.statsReporter_=Mt.getOrCreateReporter(e,function(){return new mr(o.stats_,o.server_)}),this.transactionsInit_(),this.infoData_=new vr,this.infoSyncTree_=new An({startListening:function(l,u,h,f){var _=[],y=o.infoData_.getNode(l.path);return y.isEmpty()||(_=o.infoSyncTree_.applyServerOverwrite(l.path,y),setTimeout(function(){f("ok")},0)),_},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new An({startListening:function(l,u,h,f){return o.server_.listen(l,h,u,function(_,y){var m=f(_,y);o.eventQueue_.raiseEventsForChangedPath(l.path,m)}),[]},stopListening:function(l,u){o.server_.unlisten(l,u)}})}return n.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},n.prototype.name=function(){return this.repoInfo_.namespace},n.prototype.serverTime=function(){var t=this.infoData_.getNode(new A(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},n.prototype.generateServerValues=function(){return function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n}({timestamp:this.serverTime()})},n.prototype.onDataUpdate_=function(e,t,r,i){this.dataUpdateCount++;var o=new A(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var a=[];if(i)if(r){var l=c.map(t,function(y){return H(y)});a=this.serverSyncTree_.applyTaggedQueryMerge(o,l,i)}else{var u=H(t);a=this.serverSyncTree_.applyTaggedQueryOverwrite(o,u,i)}else if(r){var h=c.map(t,function(y){return H(y)});a=this.serverSyncTree_.applyServerMerge(o,h)}else{var f=H(t);a=this.serverSyncTree_.applyServerOverwrite(o,f)}var _=o;a.length>0&&(_=this.rerunTransactions_(o)),this.eventQueue_.raiseEventsForChangedPath(_,a)},n.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},n.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},n.prototype.onServerInfoUpdate_=function(e){var t=this;Z(e,function(r,i){t.updateInfo_(r,i)})},n.prototype.updateInfo_=function(e,t){var r=new A("/.info/"+e),i=H(t);this.infoData_.updateSnapshot(r,i);var o=this.infoSyncTree_.applyServerOverwrite(r,i);this.eventQueue_.raiseEventsForChangedPath(r,o)},n.prototype.getNextWriteId_=function(){return this.nextWriteId_++},n.prototype.setWithPriority=function(e,t,r,i){var o=this;this.log_("set",{path:e.toString(),value:t,priority:r});var a=this.generateServerValues(),l=H(t,r),u=this.serverSyncTree_.calcCompleteEventCache(e),h=Jt(l,u,a),f=this.getNextWriteId_(),_=this.serverSyncTree_.applyUserOverwrite(e,h,f,!0);this.eventQueue_.queueEvents(_),this.server_.put(e.toString(),l.val(!0),function(m,b){var R="ok"===m;R||z("set at "+e+" failed: "+m);var U=o.serverSyncTree_.ackUserWrite(f,!R);o.eventQueue_.raiseEventsForChangedPath(e,U),o.callOnCompleteCallback(i,m,b)});var y=this.abortTransactions_(e);this.rerunTransactions_(y),this.eventQueue_.raiseEventsForChangedPath(y,[])},n.prototype.update=function(e,t,r){var i=this;this.log_("update",{path:e.toString(),value:t});var o=!0,a=this.generateServerValues(),l={};if(Z(t,function(f,_){o=!1,l[f]=mn(e.child(f),H(_),i.serverSyncTree_,a)}),o)j("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(r,"ok");else{var u=this.getNextWriteId_(),h=this.serverSyncTree_.applyUserMerge(e,l,u);this.eventQueue_.queueEvents(h),this.server_.merge(e.toString(),t,function(f,_){var y="ok"===f;y||z("update at "+e+" failed: "+f);var m=i.serverSyncTree_.ackUserWrite(u,!y),b=m.length>0?i.rerunTransactions_(e):e;i.eventQueue_.raiseEventsForChangedPath(b,m),i.callOnCompleteCallback(r,f,_)}),Z(t,function(f){var _=i.abortTransactions_(e.child(f));i.rerunTransactions_(_)}),this.eventQueue_.raiseEventsForChangedPath(e,[])}},n.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),r=new tn;this.onDisconnect_.forEachTree(A.Empty,function(o,a){var l=mn(o,a,e.serverSyncTree_,t);r.remember(o,l)});var i=[];r.forEachTree(A.Empty,function(o,a){i=i.concat(e.serverSyncTree_.applyServerOverwrite(o,a));var l=e.abortTransactions_(o);e.rerunTransactions_(l)}),this.onDisconnect_=new tn,this.eventQueue_.raiseEventsForChangedPath(A.Empty,i)},n.prototype.onDisconnectCancel=function(e,t){var r=this;this.server_.onDisconnectCancel(e.toString(),function(i,o){"ok"===i&&r.onDisconnect_.forget(e),r.callOnCompleteCallback(t,i,o)})},n.prototype.onDisconnectSet=function(e,t,r){var i=this,o=H(t);this.server_.onDisconnectPut(e.toString(),o.val(!0),function(a,l){"ok"===a&&i.onDisconnect_.remember(e,o),i.callOnCompleteCallback(r,a,l)})},n.prototype.onDisconnectSetWithPriority=function(e,t,r,i){var o=this,a=H(t,r);this.server_.onDisconnectPut(e.toString(),a.val(!0),function(l,u){"ok"===l&&o.onDisconnect_.remember(e,a),o.callOnCompleteCallback(i,l,u)})},n.prototype.onDisconnectUpdate=function(e,t,r){var i=this;if(c.isEmpty(t))return j("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(r,"ok");this.server_.onDisconnectMerge(e.toString(),t,function(o,a){"ok"===o&&Z(t,function(l,u){var h=H(u);i.onDisconnect_.remember(e.child(l),h)}),i.callOnCompleteCallback(r,o,a)})},n.prototype.addEventCallbackForQuery=function(e,t){var r;r=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,r)},n.prototype.removeEventCallbackForQuery=function(e,t){var r;r=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,r)},n.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(jn)},n.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(jn)},n.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new In(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var r=Object.keys(t).reduce(function(i,o){return Math.max(o.length,i)},0);Z(t,function(i,o){for(var a=i,l=i.length;l<r+2;l++)a+=" ";console.log(a+o)})}},n.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},n.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="";this.persistentConnection_&&(r=this.persistentConnection_.id+":"),j.apply(void 0,D.__spread([r],e))},n.prototype.callOnCompleteCallback=function(e,t,r){e&&Oe(function(){if("ok"===t)e(null);else{var i=(t||"error").toUpperCase(),o=i;r&&(o+=": "+r);var a=new Error(o);a.code=i,e(a)}})},Object.defineProperty(n.prototype,"database",{get:function(){return this.__database||(this.__database=new Ut(this))},enumerable:!1,configurable:!0}),n}(),Yn=function(){function n(e){this.indexedFilter_=new on(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e)}return n.prototype.getStartPost=function(){return this.startPost_},n.prototype.getEndPost=function(){return this.endPost_},n.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},n.prototype.updateChild=function(e,t,r,i,o,a){return this.matches(new k(t,r))||(r=P.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,o,a)},n.prototype.updateFullNode=function(e,t,r){t.isLeafNode()&&(t=P.EMPTY_NODE);var i=t.withIndex(this.index_);i=i.updatePriority(P.EMPTY_NODE);var o=this;return t.forEachChild(B,function(a,l){o.matches(new k(a,l))||(i=i.updateImmediateChild(a,P.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)},n.prototype.updatePriority=function(e,t){return e},n.prototype.filtersNodes=function(){return!0},n.prototype.getIndexedFilter=function(){return this.indexedFilter_},n.prototype.getIndex=function(){return this.index_},n.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},n.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},n}(),Jr=function(){function n(e){this.rangedFilter_=new Yn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return n.prototype.updateChild=function(e,t,r,i,o,a){return this.rangedFilter_.matches(new k(t,r))||(r=P.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,o,a):this.fullLimitUpdateChild_(e,t,r,o,a)},n.prototype.updateFullNode=function(e,t,r){var i;if(t.isLeafNode()||t.isEmpty())i=P.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){i=P.EMPTY_NODE.withIndex(this.index_);var o=void 0;o=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var a=0;o.hasNext()&&a<this.limit_;){var l=o.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),l)<=0:this.index_.compare(l,this.rangedFilter_.getEndPost())<=0))break;i=i.updateImmediateChild(l.name,l.node),a++}}else{i=(i=t.withIndex(this.index_)).updatePriority(P.EMPTY_NODE);var h=void 0,f=void 0,_=void 0;if(o=void 0,this.reverse_){o=i.getReverseIterator(this.index_),h=this.rangedFilter_.getEndPost(),f=this.rangedFilter_.getStartPost();var y=this.index_.getCompare();_=function(U,W){return y(W,U)}}else o=i.getIterator(this.index_),h=this.rangedFilter_.getStartPost(),f=this.rangedFilter_.getEndPost(),_=this.index_.getCompare();a=0;for(var m=!1;o.hasNext();)l=o.getNext(),!m&&_(h,l)<=0&&(m=!0),m&&a<this.limit_&&_(l,f)<=0?a++:i=i.updateImmediateChild(l.name,P.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)},n.prototype.updatePriority=function(e,t){return e},n.prototype.filtersNodes=function(){return!0},n.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},n.prototype.getIndex=function(){return this.index_},n.prototype.fullLimitUpdateChild_=function(e,t,r,i,o){var a;if(this.reverse_){var l=this.index_.getCompare();a=function(ie,ce){return l(ce,ie)}}else a=this.index_.getCompare();var u=e;c.assert(u.numChildren()===this.limit_,"");var h=new k(t,r),f=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),_=this.rangedFilter_.matches(h);if(u.hasChild(t)){for(var y=u.getImmediateChild(t),m=i.getChildAfterChild(this.index_,f,this.reverse_);null!=m&&(m.name===t||u.hasChild(m.name));)m=i.getChildAfterChild(this.index_,m,this.reverse_);var b=null==m?1:a(m,h);if(_&&!r.isEmpty()&&b>=0)return null!=o&&o.trackChildChange(M.childChangedChange(t,r,y)),u.updateImmediateChild(t,r);null!=o&&o.trackChildChange(M.childRemovedChange(t,y));var U=u.updateImmediateChild(t,P.EMPTY_NODE);return null!=m&&this.rangedFilter_.matches(m)?(null!=o&&o.trackChildChange(M.childAddedChange(m.name,m.node)),U.updateImmediateChild(m.name,m.node)):U}return r.isEmpty()?e:_&&a(f,h)>=0?(null!=o&&(o.trackChildChange(M.childRemovedChange(f.name,f.node)),o.trackChildChange(M.childAddedChange(t,r))),u.updateImmediateChild(t,r).updateImmediateChild(f.name,P.EMPTY_NODE)):e},n}(),ei=function(){function n(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=B}return n.prototype.hasStart=function(){return this.startSet_},n.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===n.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},n.prototype.getIndexStartValue=function(){return c.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},n.prototype.getIndexStartName=function(){return c.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:I},n.prototype.hasEnd=function(){return this.endSet_},n.prototype.getIndexEndValue=function(){return c.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},n.prototype.getIndexEndName=function(){return c.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:N},n.prototype.hasLimit=function(){return this.limitSet_},n.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},n.prototype.getLimit=function(){return c.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},n.prototype.getIndex=function(){return this.index_},n.prototype.copy_=function(){var e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},n.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},n.prototype.limitToFirst=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=n.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,t},n.prototype.limitToLast=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=n.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,t},n.prototype.startAt=function(e,t){var r=this.copy_();return r.startSet_=!0,void 0===e&&(e=null),r.indexStartValue_=e,null!=t?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r},n.prototype.endAt=function(e,t){var r=this.copy_();return r.endSet_=!0,void 0===e&&(e=null),r.indexEndValue_=e,void 0!==t?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r},n.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},n.prototype.getQueryObject=function(){var e=n.WIRE_PROTOCOL_CONSTANTS_,t={};if(this.startSet_&&(t[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(t[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(t[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(t[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){t[e.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),t[e.VIEW_FROM]=r}return this.index_!==B&&(t[e.INDEX]=this.index_.toString()),t},n.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},n.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===B},n.prototype.getNodeFilter=function(){return this.loadsAllData()?new on(this.getIndex()):this.hasLimit()?new Jr(this):new Yn(this)},n.prototype.toRestQueryStringParameters=function(){var r,e=n.REST_QUERY_CONSTANTS_,t={};return this.isDefault()||(this.index_===B?r=e.PRIORITY_INDEX:this.index_===Kt?r=e.VALUE_INDEX:this.index_===ge?r=e.KEY_INDEX:(c.assert(this.index_ instanceof Xt,"Unrecognized index type!"),r=this.index_.toString()),t[e.ORDER_BY]=c.stringify(r),this.startSet_&&(t[e.START_AT]=c.stringify(this.indexStartValue_),this.startNameSet_&&(t[e.START_AT]+=","+c.stringify(this.indexStartName_))),this.endSet_&&(t[e.END_AT]=c.stringify(this.indexEndValue_),this.endNameSet_&&(t[e.END_AT]+=","+c.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?t[e.LIMIT_TO_FIRST]=this.limit_:t[e.LIMIT_TO_LAST]=this.limit_)),t},n.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},n.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},n.DEFAULT=new n,n}(),me=function(n){function e(t,r){if(!(t instanceof $))throw new Error("new Reference() no longer supported - use app.database().");return n.call(this,t,r,ei.DEFAULT,!1)||this}return D.__extends(e,n),e.prototype.getKey=function(){return c.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return c.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof A||(null===this.path.getFront()?Bt("Reference.child",1,t,!1):Ue("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){c.validateArgCount("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){c.validateArgCount("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,r){c.validateArgCount("Reference.set",1,2,arguments.length),re("Reference.set",this.path),ye("Reference.set",1,t,this.path,!1),c.validateCallback("Reference.set",2,r,!0);var i=new c.Deferred;return this.repo.setWithPriority(this.path,t,null,i.wrapCallback(r)),i.promise},e.prototype.update=function(t,r){if(c.validateArgCount("Reference.update",1,2,arguments.length),re("Reference.update",this.path),Array.isArray(t)){for(var i={},o=0;o<t.length;++o)i[""+o]=t[o];t=i,z("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}St("Reference.update",1,t,this.path,!1),c.validateCallback("Reference.update",2,r,!0);var a=new c.Deferred;return this.repo.update(this.path,t,a.wrapCallback(r)),a.promise},e.prototype.setWithPriority=function(t,r,i){if(c.validateArgCount("Reference.setWithPriority",2,3,arguments.length),re("Reference.setWithPriority",this.path),ye("Reference.setWithPriority",1,t,this.path,!1),rt("Reference.setWithPriority",2,r,!1),c.validateCallback("Reference.setWithPriority",3,i,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var o=new c.Deferred;return this.repo.setWithPriority(this.path,t,r,o.wrapCallback(i)),o.promise},e.prototype.remove=function(t){return c.validateArgCount("Reference.remove",0,1,arguments.length),re("Reference.remove",this.path),c.validateCallback("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,r,i){if(c.validateArgCount("Reference.transaction",1,3,arguments.length),re("Reference.transaction",this.path),c.validateCallback("Reference.transaction",1,t,!1),c.validateCallback("Reference.transaction",2,r,!0),Ht("Reference.transaction",3,i,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===i&&(i=!0);var o=new c.Deferred;"function"==typeof r&&o.promise.catch(function(){});var a=function(l,u,h){l?o.reject(l):o.resolve(new It(u,h)),"function"==typeof r&&r(l,u,h)};return this.repo.startTransaction(this.path,t,a,i),o.promise},e.prototype.setPriority=function(t,r){c.validateArgCount("Reference.setPriority",1,2,arguments.length),re("Reference.setPriority",this.path),rt("Reference.setPriority",1,t,!1),c.validateCallback("Reference.setPriority",2,r,!0);var i=new c.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),t,null,i.wrapCallback(r)),i.promise},e.prototype.push=function(t,r){c.validateArgCount("Reference.push",0,2,arguments.length),re("Reference.push",this.path),ye("Reference.push",1,t,this.path,!0),c.validateCallback("Reference.push",2,r,!0);var u,i=this.repo.serverTime(),o=jt(i),a=this.child(o),l=this.child(o);return u=null!=t?a.set(t,r).then(function(){return l}):Promise.resolve(l),a.then=u.then.bind(u),a.catch=u.then.bind(u,void 0),"function"==typeof r&&u.catch(function(){}),a},e.prototype.onDisconnect=function(){return re("Reference.onDisconnect",this.path),new At(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),e}(Ft);Ft.__referenceConstructor=me,wn.__referenceConstructor=me;var zn=function(){this.children={},this.childCount=0,this.value=null},ti=function(){function n(e,t,r){void 0===e&&(e=""),void 0===t&&(t=null),void 0===r&&(r=new zn),this.name_=e,this.parent_=t,this.node_=r}return n.prototype.subTree=function(e){for(var t=e instanceof A?e:new A(e),r=this,i=t.getFront();null!==i;)r=new n(i,r,c.safeGet(r.node_.children,i)||new zn),i=(t=t.popFront()).getFront();return r},n.prototype.getValue=function(){return this.node_.value},n.prototype.setValue=function(e){c.assert(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},n.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},n.prototype.hasChildren=function(){return this.node_.childCount>0},n.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},n.prototype.forEachChild=function(e){var t=this;Z(this.node_.children,function(r,i){e(new n(r,t,i))})},n.prototype.forEachDescendant=function(e,t,r){t&&!r&&e(this),this.forEachChild(function(i){i.forEachDescendant(e,!0,r)}),t&&r&&e(this)},n.prototype.forEachAncestor=function(e,t){for(var r=t?this:this.parent();null!==r;){if(e(r))return!0;r=r.parent()}return!1},n.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},n.prototype.path=function(){return new A(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},n.prototype.name=function(){return this.name_},n.prototype.parent=function(){return this.parent_},n.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},n.prototype.updateChild_=function(e,t){var r=t.isEmpty(),i=c.contains(this.node_.children,e);r&&i?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):!r&&!i&&(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},n}(),Y=(()=>(function(n){n[n.RUN=0]="RUN",n[n.SENT=1]="SENT",n[n.COMPLETED=2]="COMPLETED",n[n.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",n[n.NEEDS_ABORT=4]="NEEDS_ABORT"}(Y||(Y={})),Y))();$.MAX_TRANSACTION_RETRIES_=25,$.prototype.transactionsInit_=function(){this.transactionQueueTree_=new ti},$.prototype.startTransaction=function(n,e,t,r){this.log_("transaction on "+n);var i=function(){},o=new me(this,n);o.on("value",i);var l={path:n,update:e,onComplete:t,status:null,order:Te(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},u=this.getLatestState_(n);l.currentInputSnapshot=u;var h=l.update(u.val());if(void 0===h){if(l.unwatcher(),l.currentOutputSnapshotRaw=null,l.currentOutputSnapshotResolved=null,l.onComplete){var f=new Ze(l.currentInputSnapshot,new me(this,l.path),B);l.onComplete(null,!1,f)}}else{Me("transaction failed: Data returned ",h,l.path),l.status=Y.RUN;var _=this.transactionQueueTree_.subTree(n),y=_.getValue()||[];y.push(l),_.setValue(y);var m=void 0;"object"==typeof h&&null!==h&&c.contains(h,".priority")?(m=c.safeGet(h,".priority"),c.assert(De(m),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):m=(this.serverSyncTree_.calcCompleteEventCache(n)||P.EMPTY_NODE).getPriority().val(),m=m;var R=this.generateServerValues(),U=H(h,m),W=Jt(U,u,R);l.currentOutputSnapshotRaw=U,l.currentOutputSnapshotResolved=W,l.currentWriteId=this.getNextWriteId_();var ie=this.serverSyncTree_.applyUserOverwrite(n,W,l.currentWriteId,l.applyLocally);this.eventQueue_.raiseEventsForChangedPath(n,ie),this.sendReadyTransactions_()}},$.prototype.getLatestState_=function(n,e){return this.serverSyncTree_.calcCompleteEventCache(n,e)||P.EMPTY_NODE},$.prototype.sendReadyTransactions_=function(n){var e=this;if(void 0===n&&(n=this.transactionQueueTree_),n||this.pruneCompletedTransactionsBelowNode_(n),null!==n.getValue()){var t=this.buildTransactionQueue_(n);c.assert(t.length>0,"Sending zero length transaction queue"),t.every(function(i){return i.status===Y.RUN})&&this.sendTransactionQueue_(n.path(),t)}else n.hasChildren()&&n.forEachChild(function(i){e.sendReadyTransactions_(i)})},$.prototype.sendTransactionQueue_=function(n,e){for(var t=this,r=e.map(function(y){return y.currentWriteId}),i=this.getLatestState_(n,r),o=i,a=i.hash(),l=0;l<e.length;l++){var u=e[l];c.assert(u.status===Y.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=Y.SENT,u.retryCount++;var h=A.relativePath(n,u.path);o=o.updateChild(h,u.currentOutputSnapshotRaw)}var f=o.val(!0),_=n;this.server_.put(_.toString(),f,function(y){t.log_("transaction put response",{path:_.toString(),status:y});var m=[];if("ok"===y){for(var b=[],R=0;R<e.length;R++){if(e[R].status=Y.COMPLETED,m=m.concat(t.serverSyncTree_.ackUserWrite(e[R].currentWriteId)),e[R].onComplete){var U=e[R].currentOutputSnapshotResolved,W=new me(t,e[R].path),ie=new Ze(U,W,B);b.push(e[R].onComplete.bind(null,null,!0,ie))}e[R].unwatcher()}for(t.pruneCompletedTransactionsBelowNode_(t.transactionQueueTree_.subTree(n)),t.sendReadyTransactions_(),t.eventQueue_.raiseEventsForChangedPath(n,m),R=0;R<b.length;R++)Oe(b[R])}else{if("datastale"===y)for(R=0;R<e.length;R++)e[R].status=e[R].status===Y.SENT_NEEDS_ABORT?Y.NEEDS_ABORT:Y.RUN;else for(z("transaction at "+_.toString()+" failed: "+y),R=0;R<e.length;R++)e[R].status=Y.NEEDS_ABORT,e[R].abortReason=y;t.rerunTransactions_(n)}},a)},$.prototype.rerunTransactions_=function(n){var e=this.getAncestorTransactionNode_(n),t=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,t),t},$.prototype.rerunTransactionQueue_=function(n,e){if(0!==n.length){for(var t=[],r=[],o=n.filter(function(Ve){return Ve.status===Y.RUN}).map(function(Ve){return Ve.currentWriteId}),a=0;a<n.length;a++){var l=n[a],u=A.relativePath(e,l.path),h=!1,f=void 0;if(c.assert(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===Y.NEEDS_ABORT)h=!0,f=l.abortReason,r=r.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,!0));else if(l.status===Y.RUN)if(l.retryCount>=$.MAX_TRANSACTION_RETRIES_)h=!0,f="maxretry",r=r.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,!0));else{var _=this.getLatestState_(l.path,o);l.currentInputSnapshot=_;var y=n[a].update(_.val());if(void 0!==y){Me("transaction failed: Data returned ",y,l.path);var m=H(y);"object"==typeof y&&null!=y&&c.contains(y,".priority")||(m=m.updatePriority(_.getPriority()));var R=l.currentWriteId,U=this.generateServerValues(),W=Jt(m,_,U);l.currentOutputSnapshotRaw=m,l.currentOutputSnapshotResolved=W,l.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(R),1),r=(r=r.concat(this.serverSyncTree_.applyUserOverwrite(l.path,W,l.currentWriteId,l.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(R,!0))}else h=!0,f="nodata",r=r.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,r),r=[],h&&(n[a].status=Y.COMPLETED,setTimeout(n[a].unwatcher,Math.floor(0)),n[a].onComplete))if("nodata"===f){var ie=new me(this,n[a].path),qe=new Ze(n[a].currentInputSnapshot,ie,B);t.push(n[a].onComplete.bind(null,null,!1,qe))}else t.push(n[a].onComplete.bind(null,new Error(f),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),a=0;a<t.length;a++)Oe(t[a]);this.sendReadyTransactions_()}},$.prototype.getAncestorTransactionNode_=function(n){var e,t=this.transactionQueueTree_;for(e=n.getFront();null!==e&&null===t.getValue();)t=t.subTree(e),e=(n=n.popFront()).getFront();return t},$.prototype.buildTransactionQueue_=function(n){var e=[];return this.aggregateTransactionQueuesForNode_(n,e),e.sort(function(t,r){return t.order-r.order}),e},$.prototype.aggregateTransactionQueuesForNode_=function(n,e){var t=this,r=n.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);n.forEachChild(function(o){t.aggregateTransactionQueuesForNode_(o,e)})},$.prototype.pruneCompletedTransactionsBelowNode_=function(n){var e=this,t=n.getValue();if(t){for(var r=0,i=0;i<t.length;i++)t[i].status!==Y.COMPLETED&&(t[r]=t[i],r++);t.length=r,n.setValue(t.length>0?t:null)}n.forEachChild(function(o){e.pruneCompletedTransactionsBelowNode_(o)})},$.prototype.abortTransactions_=function(n){var e=this,t=this.getAncestorTransactionNode_(n).path(),r=this.transactionQueueTree_.subTree(n);return r.forEachAncestor(function(i){e.abortTransactionsOnNode_(i)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(i){e.abortTransactionsOnNode_(i)}),t},$.prototype.abortTransactionsOnNode_=function(n){var e=n.getValue();if(null!==e){for(var t=[],r=[],i=-1,o=0;o<e.length;o++)e[o].status!==Y.SENT_NEEDS_ABORT&&(e[o].status===Y.SENT?(c.assert(i===o-1,"All SENT items should be at beginning of queue."),i=o,e[o].status=Y.SENT_NEEDS_ABORT,e[o].abortReason="set"):(c.assert(e[o].status===Y.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&t.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?n.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(n.path(),r),o=0;o<t.length;o++)Oe(t[o])}};var hn,ni=function(){function n(e,t){var r=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then(function(i){return r.auth_=i})}return n.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch(function(t){return t&&"auth/token-not-initialized"===t.code?(j("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)}):Promise.resolve(null)},n.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout(function(){return e(null)},0),this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)}))},n.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})},n.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';z(e+="credential"in this.app_.options?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.')},n}(),ri=function(){function n(){}return n.prototype.getToken=function(e){return Promise.resolve({accessToken:n.EMULATOR_AUTH_TOKEN})},n.prototype.addTokenChangeListener=function(e){e(n.EMULATOR_AUTH_TOKEN)},n.prototype.removeTokenChangeListener=function(e){},n.prototype.notifyForInvalidToken=function(){},n.EMULATOR_AUTH_TOKEN="owner",n}(),cn=function(){function n(){this.repos_={},this.useRestClient_=!1}return n.getInstance=function(){return hn||(hn=new n),hn},n.prototype.interrupt=function(){var e,t,r,i;try{for(var o=D.__values(Object.keys(this.repos_)),a=o.next();!a.done;a=o.next()){var l=a.value;try{for(var u=(r=void 0,D.__values(Object.keys(this.repos_[l]))),h=u.next();!h.done;h=u.next())this.repos_[l][h.value].interrupt()}catch(_){r={error:_}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}}catch(_){e={error:_}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},n.prototype.resume=function(){var e,t,r,i;try{for(var o=D.__values(Object.keys(this.repos_)),a=o.next();!a.done;a=o.next()){var l=a.value;try{for(var u=(r=void 0,D.__values(Object.keys(this.repos_[l]))),h=u.next();!h.done;h=u.next())this.repos_[l][h.value].resume()}catch(_){r={error:_}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}}catch(_){e={error:_}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},n.prototype.databaseFromApp=function(e,t,r,i){var o=r||e.options.databaseURL;void 0===o&&(e.options.projectId||ae("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),j("Using default host for project ",e.options.projectId),o=e.options.projectId+"-default-rtdb.firebaseio.com");var u,a=nt(o,i),l=a.repoInfo,h=void 0;"undefined"!=typeof process&&(h=process.env.FIREBASE_DATABASE_EMULATOR_HOST),h?(u=!0,l=(a=nt(o="http://"+h+"?ns="+l.namespace,i)).repoInfo):u=!a.repoInfo.secure;var f=i&&u?new ri:new ni(e,t);return bt("Invalid Firebase Database URL",1,a),a.path.isEmpty()||ae("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(l,e,f).database},n.prototype.deleteRepo=function(e){var t=c.safeGet(this.repos_,e.app.name);(!t||c.safeGet(t,e.repoInfo_.toURLString())!==e)&&ae("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.repoInfo_.toURLString()]},n.prototype.createRepo=function(e,t,r){var i=c.safeGet(this.repos_,t.name);i||(this.repos_[t.name]=i={});var o=c.safeGet(i,e.toURLString());return o&&ae("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new $(e,this.useRestClient_,t,r),i[e.toURLString()]=o,o},n.prototype.forceRestClient=function(e){this.useRestClient_=e},n}(),Ut=function(){function n(e){this.repo_=e,e instanceof $||ae("Don't call new Database() directly - please use firebase.database()."),this.root_=new me(e,A.Empty),this.INTERNAL=new oi(this)}return Object.defineProperty(n.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),n.prototype.ref=function(e){return this.checkDeleted_("ref"),c.validateArgCount("database.ref",0,1,arguments.length),e instanceof me?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},n.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),c.validateArgCount(t,1,1,arguments.length);var r=nt(e,this.repo_.repoInfo_.nodeAdmin);bt(t,1,r);var i=r.repoInfo;return i.host!==this.repo_.repoInfo_.host&&ae(t+": Host name does not match the current database: (found "+i.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(r.path.toString())},n.prototype.checkDeleted_=function(e){null===this.repo_&&ae("Cannot call "+e+" on a deleted database.")},n.prototype.goOffline=function(){c.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},n.prototype.goOnline=function(){c.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},n.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},n}(),oi=function(){function n(e){this.database=e}return n.prototype.delete=function(){return D.__awaiter(this,void 0,void 0,function(){return D.__generator(this,function(e){return this.database.checkDeleted_("delete"),cn.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},n}(),di=Object.freeze({__proto__:null,forceLongPolling:function(){We.forceDisallow(),an.forceAllow()},forceWebSockets:function(){an.forceDisallow()},isWebSocketsAvailable:function(){return We.isAvailable()},setSecurityDebugCallback:function(n,e){n.repo.persistentConnection_.securityDebugCallback_=e},stats:function(n,e){n.repo.stats(e)},statsIncrementCounter:function(n,e){n.repo.statsIncrementCounter(e)},dataUpdateCount:function(n){return n.repo.dataUpdateCount},interceptServerData:function(n,e){return n.repo.interceptServerData_(e)}}),vi=Qe;Qe.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},Qe.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};var Ci=Object.freeze({__proto__:null,DataConnection:vi,RealTimeConnection:Vn,hijackHash:function(n){var e=Qe.prototype.put;return Qe.prototype.put=function(t,r,i,o){void 0!==o&&(o=n()),e.call(this,t,r,i,o)},function(){Qe.prototype.put=e}},ConnectionTarget:mt,queryIdentifier:function(n){return n.queryIdentifier()},forceRestClient:function(n){cn.getInstance().forceRestClient(n)}}),Gn=Ut.ServerValue;function Kn(n){!function(n){ln=n}(n.SDK_VERSION);var e=n.INTERNAL.registerComponent(new Ke.Component("database",function(t,r){var i=t.getProvider("app").getImmediate(),o=t.getProvider("auth-internal");return cn.getInstance().databaseFromApp(i,o,r)},"PUBLIC").setServiceProps({Reference:me,Query:Ft,Database:Ut,DataSnapshot:Ze,enableLogging:Le,INTERNAL:di,ServerValue:Gn,TEST_ACCESS:Ci}).setMultipleInstances(!0));n.registerVersion("@firebase/database","0.6.13"),c.isNodeSdk()&&(Zt.exports=e)}Kn(G.default),J.DataSnapshot=Ze,J.Database=Ut,J.OnDisconnect=At,J.Query=Ft,J.Reference=me,J.ServerValue=Gn,J.enableLogging=Le,J.registerDatabase=Kn},5460:(Zt,J,L)=>{L.r(J),L.d(J,{QuestionnaireModule:()=>le});var fe=L(8583),D=L(6141),c=L(5987),s=L(7716);let Ke=(()=>{class p{constructor(){}ngOnInit(){}}return p.\u0275fac=function(d){return new(d||p)},p.\u0275cmp=s.Xpm({type:p,selectors:[["app-new-employee"]],decls:2,vars:0,template:function(d,g){1&d&&(s.TgZ(0,"p"),s._uU(1,"new-employee works!"),s.qZA())},styles:[""]}),p})(),Xe=(()=>{class p{constructor(){}ngOnInit(){}}return p.\u0275fac=function(d){return new(d||p)},p.\u0275cmp=s.Xpm({type:p,selectors:[["app-edit-employee"]],decls:2,vars:0,template:function(d,g){1&d&&(s.TgZ(0,"p"),s._uU(1,"edit-employee works!"),s.qZA())},styles:[""]}),p})();var G=L(2091),Be=L(9692),Fe=L(1494),Ee=L(2238),ne=(()=>{return(p=ne||(ne={})).P="podstawowe",p.S="\u015brednie",p.W="wy\u017csze",ne;var p})();const Ce=[{label:"nie dotyczy",value:"nieDot"},{label:"licencjat",value:"lic"},{label:"magister",value:"mgr"},{label:"in\u017cynier",value:"inz"},{label:"magister in\u017cynier",value:"mgrInz"}];var Te=(()=>{return(p=Te||(Te={})).Y="w trakcie",p.N="uko\u0144czone",Te;var p})(),we=(()=>{return(p=we||(we={})).spouse="wsp\xf3\u0142ma\u0142\u017conek",p.child="dziecko",we;var p})(),se=L(8002),Le=L(3637),j=L(7574),Se=L(5917),Ne=L(6682),ae=L(8819),z=L(3190),E=L(2145),T=L(7519),C=L(5197),I=L(509);class w{constructor(v,d){this.observables=v,this.project=d}call(v,d){return d.subscribe(new F(v,this.observables,this.project))}}class F extends C.L{constructor(v,d,g){super(v),this.observables=d,this.project=g,this.toRespond=[];const S=d.length;this.values=new Array(S);for(let O=0;O<S;O++)this.toRespond.push(O);for(let O=0;O<S;O++)this.add((0,I.D)(this,d[O],void 0,O))}notifyNext(v,d,g){this.values[g]=d;const S=this.toRespond;if(S.length>0){const O=S.indexOf(g);-1!==O&&S.splice(O,1)}}notifyComplete(){}_next(v){if(0===this.toRespond.length){const d=[v,...this.values];this.project?this._tryProject(d):this.destination.next(d)}}_tryProject(v){let d;try{d=this.project.apply(this,v)}catch(g){return void this.destination.error(g)}this.destination.next(d)}}var V=L(7393);class x{constructor(v){this.predicate=v}call(v,d){return d.subscribe(new Z(v,this.predicate))}}class Z extends V.L{constructor(v,d){super(v),this.predicate=d,this.skipping=!0,this.index=0}_next(v){const d=this.destination;this.skipping&&this.tryCallPredicate(v),this.skipping||d.next(v)}tryCallPredicate(v){try{const d=this.predicate(v,this.index++);this.skipping=Boolean(d)}catch(d){this.destination.error(d)}}}var K=L(57),pe=(L(4614),L(9829)),ke=L(4395),$e=L.n(ke);function ct(p){return null==p}function Pe(p){return"function"==typeof p.set}function A(p,v){return Pe(v)?v:p.ref(v)}function pt(p,v){if(function(p){return"string"==typeof p}(p))return v.stringCase();if(Pe(p))return v.firebaseCase();if(function(p){return"function"==typeof p.exportVal}(p))return v.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof p)}function _e(p,v,d="on",g=Le.z){return new j.y(S=>{let O=null;return O=p[d](v,(Q,q)=>{g.schedule(()=>{S.next({snapshot:Q,prevKey:q})}),"once"===d&&g.schedule(()=>S.complete())},Q=>{g.schedule(()=>S.error(Q))}),"on"===d?{unsubscribe(){null!=O&&p.off(v,O)}}:{unsubscribe(){}}}).pipe((0,se.U)(S=>{const{snapshot:O,prevKey:Q}=S;let q=null;return O.exists()&&(q=O.key),{type:v,payload:O,prevKey:Q,key:q}}),(0,ae.B)())}function Je(p,v){const d=p.length;for(let g=0;g<d;g++)if(p[g].payload.key===v)return g;return-1}function vt(p,v){const{payload:d,prevKey:g,key:S}=v,O=Je(p,S),Q=function(p,v){if(ct(v))return 0;{const d=Je(p,v);return-1===d?p.length:d+1}}(p,g);switch(v.type){case"value":if(v.payload&&v.payload.exists()){let q=null;v.payload.forEach(te=>{const be={payload:te,type:"value",prevKey:q,key:te.key};return q=te.key,p=[...p,be],!1})}return p;case"child_added":if(O>-1){const q=p[O-1];(q&&q.key||null)!==g&&(p=p.filter(te=>te.payload.key!==d.key)).splice(Q,0,v)}else{if(null==g)return[v,...p];(p=p.slice()).splice(Q,0,v)}return p;case"child_removed":return p.filter(q=>q.payload.key!==d.key);case"child_changed":return p.map(q=>q.payload.key===S?v:q);case"child_moved":if(O>-1){const q=p.splice(O,1)[0];return(p=p.slice()).splice(Q,0,q),p}return p;default:return p}}function et(p){return(ct(p)||0===p.length)&&(p=["child_added","child_removed","child_changed","child_moved"]),p}function tt(p,v,d){return function(p,v,d){return _e(p,"value","once",d).pipe((0,z.w)(g=>{const S=[(0,Se.of)(g)];return v.forEach(O=>S.push(_e(p,O,"on",d))),(0,Ne.T)(...S).pipe((0,E.R)(vt,[]))}),(0,T.x)())}(p,v=et(v),d)}function _t(p,v,d){const g=(v=et(v)).map(S=>_e(p,S,"on",d));return(0,Ne.T)(...g)}function Et(p,v){return function(g,S){return pt(g,{stringCase:()=>p.child(g)[v](S),firebaseCase:()=>g[v](S),snapshotCase:()=>g.ref[v](S)})}}function Wt(p){return function(d){return d?pt(d,{stringCase:()=>p.child(d).remove(),firebaseCase:()=>d.remove(),snapshotCase:()=>d.ref.remove()}):p.remove()}}function Ct(p,v){return function(){return _e(p,"value","on",v)}}const Tt=new s.OlP("angularfire2.realtimeDatabaseURL"),He=new s.OlP("angularfire2.database.use-emulator");let je=(()=>{class p{constructor(d,g,S,O,Q,q,te){this.schedulers=new K.HU(Q),this.keepUnstableUntilFirst=(0,K.ss)(this.schedulers);const be=q,Ae=(0,K.on)(d,Q,g);!$e().auth&&te&&(0,K.yq)(),this.database=(0,K.sI)(`${Ae.name}.database.${S}`,"AngularFireDatabase",Ae,()=>{const P=Q.runOutsideAngular(()=>Ae.database(S||void 0));return be&&P.useEmulator(...be),P},[be])}list(d,g){const S=this.schedulers.ngZone.runOutsideAngular(()=>A(this.database,d));let O=S;return g&&(O=g(S)),function(p,v){const d=v.schedulers.outsideAngular,g=v.schedulers.ngZone.run(()=>p.ref);return{query:p,update:Et(g,"update"),set:Et(g,"set"),push:S=>g.push(S),remove:Wt(g),snapshotChanges:S=>tt(p,S,d).pipe(v.keepUnstableUntilFirst),stateChanges:S=>_t(p,S,d).pipe(v.keepUnstableUntilFirst),auditTrail:S=>function(p,v,d){return function(p,v,d){return function(p,v){return _e(p,"value","on",v).pipe((0,se.U)(d=>{let g;return d.payload.forEach(S=>(g=S.key,!1)),{data:d,lastKeyToLoad:g}}))}(p,d).pipe(function(...p){return v=>{let d;return"function"==typeof p[p.length-1]&&(d=p.pop()),v.lift(new w(p,d))}}(v),(0,se.U)(([S,O])=>{const Q=S.lastKeyToLoad,q=O.map(te=>te.key);return{actions:O,lastKeyToLoad:Q,loadedKeys:q}}),function(p){return v=>v.lift(new x(p))}(S=>-1===S.loadedKeys.indexOf(S.lastKeyToLoad)),(0,se.U)(S=>S.actions))}(p,_t(p,v).pipe((0,E.R)((S,O)=>[...S,O],[])),d)}(p,S,d).pipe(v.keepUnstableUntilFirst),valueChanges:(S,O)=>tt(p,S,d).pipe((0,se.U)(q=>q.map(te=>O&&O.idField?Object.assign(Object.assign({},te.payload.val()),{[O.idField]:te.key}):te.payload.val())),v.keepUnstableUntilFirst)}}(O,this)}object(d){return function(p,v){return{query:p,snapshotChanges:()=>Ct(p,v.schedulers.outsideAngular)().pipe(v.keepUnstableUntilFirst),update:d=>p.ref.update(d),set:d=>p.ref.set(d),remove:()=>p.ref.remove(),valueChanges:()=>Ct(p,v.schedulers.outsideAngular)().pipe(v.keepUnstableUntilFirst,(0,se.U)(g=>g.payload.exists()?g.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>A(this.database,d)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return p.\u0275fac=function(d){return new(d||p)(s.LFG(K.Dh),s.LFG(K.xv,8),s.LFG(Tt,8),s.LFG(s.Lbi),s.LFG(s.R0b),s.LFG(He,8),s.LFG(pe.Qv,8))},p.\u0275prov=s.Yz7({factory:function(){return new p(s.LFG(K.Dh),s.LFG(K.xv,8),s.LFG(Tt,8),s.LFG(s.Lbi),s.LFG(s.R0b),s.LFG(He,8),s.LFG(pe.Qv,8))},token:p,providedIn:"any"}),p})(),wt=(()=>{class p{constructor(d){this.db=d,this.API_URL="/employees"}getEmployeesFromProjector(){return this.db.list(this.API_URL).snapshotChanges().pipe((0,se.U)(d=>d.map(g=>this.assignKey(g))))}getEmployee(d){return this.db.object(`${this.API_URL}/${d}`).snapshotChanges().pipe((0,se.U)(g=>this.assignKey(g)))}addEmployee(d){return this.db.list(this.API_URL).push(d)}editEmployee(d,g){return this.db.object(`${this.API_URL}/${d}`).update(g)}assignKey(d){return Object.assign(Object.assign({},d.payload.val()),{key:d.key})}}return p.\u0275fac=function(d){return new(d||p)(s.LFG(je))},p.\u0275prov=s.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();var De=L(1095);function ye(p,v){if(1&p&&(s.TgZ(0,"tr",26),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.TgZ(5,"td"),s._uU(6),s.qZA(),s.TgZ(7,"td"),s._uU(8),s.qZA(),s.qZA()),2&p){const d=v.$implicit,g=v.index,S=s.oxw(2);s.xp6(2),s.Oqu(g+1),s.xp6(2),s.hij(" ",d.nameFamily,""),s.xp6(2),s.hij(" ",d.dobFamily," "),s.xp6(2),s.hij(" ",S.FamilyRelation[d.relation],"")}}function Me(p,v){if(1&p&&(s.TgZ(0,"table",24),s.TgZ(1,"thead"),s.TgZ(2,"tr"),s.TgZ(3,"th"),s._uU(4,"nr"),s.qZA(),s.TgZ(5,"th"),s._uU(6,"imi\u0119(imiona) i nazwisko"),s.qZA(),s.TgZ(7,"th"),s._uU(8," data ur"),s.qZA(),s.TgZ(9,"th"),s._uU(10,"pokrewie\u0144stwo"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(11,"tbody"),s.YNc(12,ye,9,4,"tr",25),s.qZA(),s.qZA()),2&p){const d=s.oxw();s.xp6(12),s.Q6J("ngForOf",d.employee.families)}}function Vt(p,v){if(1&p&&(s.TgZ(0,"tr",26),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.TgZ(5,"td"),s._uU(6),s.qZA(),s.TgZ(7,"td"),s._uU(8),s.qZA(),s.qZA()),2&p){const d=v.$implicit,g=v.index;s.xp6(2),s.Oqu(g+1),s.xp6(2),s.hij(" ",d.contactPersonName,""),s.xp6(2),s.lnq(" ",d.contactPersonAddress.street," ",d.contactPersonAddress.zipcode," ",d.contactPersonAddress.city,""),s.xp6(2),s.hij(" ",d.contactPersonAddress.telephone,"")}}function St(p,v){if(1&p&&(s.TgZ(0,"table",24),s.TgZ(1,"thead"),s.TgZ(2,"tr"),s.TgZ(3,"th"),s._uU(4,"Nr"),s.qZA(),s.TgZ(5,"th"),s._uU(6,"Imi\u0119 i nazwisko"),s.qZA(),s.TgZ(7,"th"),s._uU(8," Adres"),s.qZA(),s.TgZ(9,"th"),s._uU(10,"Telefon"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(11,"tbody"),s.YNc(12,Vt,9,6,"tr",25),s.qZA(),s.qZA()),2&p){const d=s.oxw();s.xp6(12),s.Q6J("ngForOf",d.employee.contactPersons)}}function rt(p,v){if(1&p&&(s.TgZ(0,"span"),s._uU(1),s.qZA()),2&p){const d=s.oxw().$implicit,g=s.oxw();s.xp6(1),s.AsE(" - ",d.educationDate," ",g.yesNo[d.during],"")}}function it(p,v){if(1&p&&(s.TgZ(0,"li"),s._uU(1),s.YNc(2,rt,2,2,"span",27),s.qZA()),2&p){const d=v.$implicit;s.xp6(1),s.hij(" ",d.name," "),s.xp6(1),s.Q6J("ngIf",d.educationDate||d.during)}}function ot(p,v){1&p&&s._UZ(0,"div")}function Ue(p,v){1&p&&(s.TgZ(0,"p",28),s._uU(1,"tak"),s.qZA())}function Bt(p,v){1&p&&(s.TgZ(0,"p",28),s._uU(1,"nie"),s.qZA())}function re(p,v){if(1&p&&(s.TgZ(0,"tr",26),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.TgZ(5,"td"),s._uU(6),s.qZA(),s.TgZ(7,"td"),s._uU(8),s.qZA(),s.TgZ(9,"td"),s._uU(10),s.qZA(),s.qZA()),2&p){const d=v.$implicit;s.xp6(2),s.Oqu(d.fromJob),s.xp6(2),s.Oqu(d.toJob),s.xp6(2),s.hij(" ",d.companyName,""),s.xp6(2),s.hij(" ",d.placeJob,""),s.xp6(2),s.hij(" ",d.positionJob,"")}}function bt(p,v){if(1&p&&(s.TgZ(0,"table",24),s.TgZ(1,"thead"),s.TgZ(2,"tr"),s.TgZ(3,"th"),s._uU(4,"Okres od"),s.qZA(),s.TgZ(5,"th"),s._uU(6,"Okres do"),s.qZA(),s.TgZ(7,"th"),s._uU(8,"Nazwa zak\u0142adu pracy"),s.qZA(),s.TgZ(9,"th"),s._uU(10,"Miejscowo\u015b\u0107"),s.qZA(),s.TgZ(11,"th"),s._uU(12,"Stanowisko"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(13,"tbody"),s.YNc(14,re,11,5,"tr",25),s.qZA(),s.qZA()),2&p){const d=s.oxw();s.xp6(14),s.Q6J("ngForOf",d.employee.works)}}function Ht(p,v){1&p&&(s.TgZ(0,"div",29),s.TgZ(1,"p"),s._uU(2,"Brak"),s.qZA(),s.qZA())}function At(p,v){1&p&&(s.TgZ(0,"div",30),s.TgZ(1,"p"),s._uU(2,"Brak informacji"),s.qZA(),s.qZA())}let It=(()=>{class p{constructor(d,g,S,O,Q){this.employeeService=d,this.route=g,this.router=S,this.dialogRef=O,this.data=Q,this.current=ne,this.TITLES=[]=Ce,this.FamilyRelation=we,this.yesNo=Te,this.FULL_DATE_FORMAT="dd/MM/yyyy",this.employee=Q}getTitle(d){return this.TITLES.filter(S=>d.firstHigherTitle===S.value).map(S=>S.label)}onCloseWithoutChanges(){this.dialogRef.close()}goToEditEmployee(){this.onCloseWithoutChanges(),this.router.navigate(["/dashboard/employees/edit",this.employee.key])}}return p.\u0275fac=function(d){return new(d||p)(s.Y36(wt),s.Y36(c.gz),s.Y36(c.F0),s.Y36(Ee.so),s.Y36(Ee.WI))},p.\u0275cmp=s.Xpm({type:p,selectors:[["app-view-employee"]],inputs:{employee:"employee"},decls:144,vars:30,consts:[[1,"h1-employee"],[1,"shadow-sm","card","w-100"],[1,"card-body"],[1,"card-title","d-flex","align-items-center","section-header"],[1,"material-icons"],[1,"row"],[1,"col-md-4","float-right"],[1,"col-md-4"],[1,"col-md-3"],[1,"label"],[1,"col-md-12label"],[1,"col-md-12"],["class","cs-table table table-striped",4,"ngIf","ngIfElse"],[1,"d-flex","align-items-center","section-header"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfThen","ngIfElse"],["yes",""],["no",""],["noWorkInfo",""],[1,"col"],["role","group",1,"btn-group","d-flex"],["mat-button","",1,"btn","btn-large","btn-secondary","w-75",3,"click"],["mat-button","",1,"btn","btn-large","btn-success","w-75",3,"click"],["emptyInfo",""],[1,"cs-table","table","table-striped"],["class","row-contact",4,"ngFor","ngForOf"],[1,"row-contact"],[4,"ngIf"],[1,"work"],[1,"no-Work-Info"],[1,"no-info-of-table"]],template:function(d,g){if(1&d&&(s.TgZ(0,"mat-dialog-content"),s.TgZ(1,"h1",0),s._uU(2,"Kwestionariusz osobowy dla pracownika "),s.TgZ(3,"strong"),s._uU(4),s.qZA(),s.qZA(),s.TgZ(5,"div",1),s.TgZ(6,"div",2),s.TgZ(7,"h4",3),s.TgZ(8,"i",4),s._uU(9," account_circle "),s.qZA(),s._uU(10," Dane osobowe"),s.qZA(),s.TgZ(11,"div",5),s.TgZ(12,"div",6),s.TgZ(13,"p"),s._uU(14,"Nazwisko:"),s.qZA(),s._uU(15),s.qZA(),s.TgZ(16,"div",7),s.TgZ(17,"p"),s._uU(18,"Imi\u0119 (imiona): "),s.qZA(),s._uU(19),s.qZA(),s.TgZ(20,"div",7),s.TgZ(21,"p"),s._uU(22,"PESEL: "),s.qZA(),s._uU(23),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(24,"div",1),s.TgZ(25,"div",2),s.TgZ(26,"h4",3),s.TgZ(27,"i",4),s._uU(28," home "),s.qZA(),s._uU(29," Adres zamieszkania"),s.qZA(),s.TgZ(30,"div",5),s.TgZ(31,"div",8),s.TgZ(32,"p",9),s._uU(33,"Adres:"),s.qZA(),s._uU(34),s.qZA(),s.TgZ(35,"div",8),s.TgZ(36,"p",9),s._uU(37,"Miejscowo\u015b\u0107:"),s.qZA(),s._uU(38),s.qZA(),s.TgZ(39,"div",8),s.TgZ(40,"p",9),s._uU(41,"Kod pocztowy: "),s.qZA(),s._uU(42),s.qZA(),s.TgZ(43,"div",8),s.TgZ(44,"p",10),s._uU(45,"Telefon:"),s.qZA(),s._uU(46),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(47,"div",1),s.TgZ(48,"div",2),s.TgZ(49,"h4",3),s.TgZ(50,"i",4),s._uU(51," people "),s.qZA(),s._uU(52," Stan rodziny"),s.qZA(),s.TgZ(53,"div",5),s.TgZ(54,"div",11),s.YNc(55,Me,13,1,"table",12),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(56,"div",1),s.TgZ(57,"div",2),s.TgZ(58,"h4",13),s.TgZ(59,"i",4),s._uU(60," accessibility "),s.qZA(),s._uU(61," Osoba(y), kt\xf3r\u0105 nale\u017cy zawiadomi\u0107 w razie wypadku"),s.qZA(),s.TgZ(62,"div",5),s.TgZ(63,"div",11),s.YNc(64,St,13,1,"table",12),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(65,"div",1),s.TgZ(66,"div",2),s.TgZ(67,"h4",3),s.TgZ(68,"i",4),s._uU(69," school "),s.qZA(),s._uU(70," Wykszta\u0142cenie"),s.qZA(),s.TgZ(71,"div",5),s.TgZ(72,"div",7),s.TgZ(73,"p"),s._uU(74,"Wykszta\u0142cenie:"),s.qZA(),s._uU(75),s.qZA(),s.TgZ(76,"div",7),s.TgZ(77,"p"),s._uU(78,"Rok uko\u0144czenia:"),s.qZA(),s._uU(79),s.qZA(),s.TgZ(80,"div",7),s.TgZ(81,"p"),s._uU(82,"Nazwa szko\u0142y uko\u0144czenia: "),s.qZA(),s._uU(83),s.qZA(),s.TgZ(84,"div",7),s.TgZ(85,"p"),s._uU(86,"Stopie\u0144 (tytu\u0142 naukowy):"),s.qZA(),s._uU(87),s.qZA(),s.TgZ(88,"div",7),s.TgZ(89,"p"),s._uU(90,"Data uzyskania pierwszego tytu\u0142u zawodowego: "),s.qZA(),s._uU(91),s.qZA(),s.TgZ(92,"div",7),s.TgZ(93,"p"),s._uU(94,"Pierwszy tytu\u0142 zawodowy:"),s.qZA(),s._uU(95),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(96,"div",1),s.TgZ(97,"div",2),s.TgZ(98,"h4",13),s.TgZ(99,"i",4),s._uU(100," cast_for_education "),s.qZA(),s._uU(101," Wykszta\u0142cenie uzupe\u0142niaj\u0105ce"),s.qZA(),s.TgZ(102,"p"),s._uU(103," (kursy, studia podyplomowe, data uko\u0144czenia lub rozpocz\u0119cia nauki w przypadku jej trwania):"),s.qZA(),s.TgZ(104,"div",5),s.TgZ(105,"div",11),s.TgZ(106,"ul"),s.YNc(107,it,3,2,"li",14),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(108,"div",1),s.TgZ(109,"div",2),s.TgZ(110,"h4",13),s.TgZ(111,"i",4),s._uU(112," timeline "),s.qZA(),s._uU(113," Przebieg pracy zawodowej"),s.qZA(),s.TgZ(114,"div",11),s.TgZ(115,"p"),s._uU(116,"Pierwsza praca na umow\u0119 o prac\u0119"),s.qZA(),s.YNc(117,ot,1,0,"div",15),s.YNc(118,Ue,2,0,"ng-template",null,16,s.W1O),s.YNc(120,Bt,2,0,"ng-template",null,17,s.W1O),s.qZA(),s.TgZ(122,"div",5),s.TgZ(123,"div",11),s.YNc(124,bt,15,1,"table",12),s.YNc(125,Ht,3,0,"ng-template",null,18,s.W1O),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(127,"div",1),s.TgZ(128,"div",2),s.TgZ(129,"div",5),s.TgZ(130,"div",19),s.TgZ(131,"p"),s._uU(132," Wyra\u017cam zgod\u0119 na przetwarzanie moich danych osobowych w firmie XYZ Sp. z o. o. Jednocze\u015bnie o\u015bwiadczam, \u017ce przekazuj\u0119 moje dane osobowe ca\u0142kowicie dobrowolnie. O\u015bwiadczam ponadto, \u017ce zosta\u0142em/zosta\u0142am poinformowany/poinformowana o przys\u0142uguj\u0105cym mi prawie dost\u0119pu do tre\u015bci tych danych i mo\u017cliwo\u015bci ich poprawiania, a tak\u017ce o prawie wycofania zgody na przetwarzanie tych danych w ka\u017cdym czasie."),s.qZA(),s.qZA(),s.qZA(),s.TgZ(133,"div",5),s.TgZ(134,"div",19),s._uU(135),s.ALo(136,"date"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(137,"div",20),s.TgZ(138,"button",21),s.NdJ("click",function(){return g.onCloseWithoutChanges()}),s._uU(139,"Zamknij"),s.qZA(),s.TgZ(140,"button",22),s.NdJ("click",function(){return g.goToEditEmployee()}),s._uU(141,"Edytuj"),s.qZA(),s.qZA(),s.YNc(142,At,3,0,"ng-template",null,23,s.W1O),s.qZA(),s.qZA()),2&d){const S=s.MAs(119),O=s.MAs(121),Q=s.MAs(126),q=s.MAs(143);s.xp6(4),s.hij(" ",null==g.employee?null:g.employee.login,""),s.xp6(11),s.hij(" ",null==g.employee?null:g.employee.lastName,""),s.xp6(4),s.Oqu(g.employee.firstName),s.xp6(4),s.Oqu(g.employee.pesel),s.xp6(11),s.hij(" ",g.employee.employeeAddress.street,""),s.xp6(4),s.hij(" ",g.employee.employeeAddress.city,""),s.xp6(4),s.Oqu(g.employee.employeeAddress.zipcode),s.xp6(4),s.hij(" ",g.employee.employeeAddress.telephone,""),s.xp6(9),s.Q6J("ngIf",g.employee.families&&g.employee.families.length>0)("ngIfElse",q),s.xp6(9),s.Q6J("ngIf",g.employee.contactPersons&&g.employee.contactPersons.length>0)("ngIfElse",q),s.xp6(11),s.hij(" ",g.current[g.employee.currentDegree],""),s.xp6(4),s.hij(" ",g.employee.finishedYearSchool,""),s.xp6(4),s.Oqu(g.employee.finishedNameSchool),s.xp6(4),s.AsE("",null==g.employee?null:g.employee.profession," ",null==g.employee?null:g.employee.professionAcademicTitle," "),s.xp6(4),s.hij("",g.employee.firstHigherTitleDate," "),s.xp6(4),s.Oqu(g.getTitle(g.employee)),s.xp6(12),s.Q6J("ngForOf",g.employee.supplementaryEducations),s.xp6(10),s.Q6J("ngIf",g.employee.isFirstWork)("ngIfThen",S)("ngIfElse",O),s.xp6(7),s.Q6J("ngIf",g.employee.works&&g.employee.works.length>0)("ngIfElse",Q),s.xp6(11),s.AsE("Miejscowo\u015b\u0107 ",g.employee.updateCity,", dnia ",s.xi3(136,27,g.employee.updateDate,g.FULL_DATE_FORMAT)," ")}},directives:[Ee.xY,fe.O5,fe.sg,De.lW],pipes:[fe.uU],styles:[".work[_ngcontent-%COMP%]{text-transform:uppercase;font-style:normal;color:#000}"]}),p})();var jt=L(1552);function k(p,v){1&p&&(s.TgZ(0,"th",17),s._uU(1," Login"),s.qZA())}function Ye(p,v){if(1&p&&(s.TgZ(0,"td",18),s._uU(1),s.qZA()),2&p){const d=v.$implicit;s.xp6(1),s.hij(" ",d.login," ")}}function ze(p,v){1&p&&(s.TgZ(0,"th",17),s._uU(1," Imi\u0119"),s.qZA())}function Rt(p,v){if(1&p&&(s.TgZ(0,"td",18),s._uU(1),s.qZA()),2&p){const d=v.$implicit;s.xp6(1),s.hij(" ",d.firstName," ")}}function ge(p,v){1&p&&(s.TgZ(0,"th",17),s._uU(1," Nazwisko"),s.qZA())}function st(p,v){if(1&p&&(s.TgZ(0,"td",18),s._uU(1),s.qZA()),2&p){const d=v.$implicit;s.xp6(1),s.hij(" ",d.lastName," ")}}function Yt(p,v){1&p&&(s.TgZ(0,"th",19),s._uU(1," Akcja"),s.qZA())}function Nt(p,v){if(1&p){const d=s.EpF();s.TgZ(0,"td",18),s.TgZ(1,"button",20),s.NdJ("click",function(){const O=s.CHM(d).$implicit;return s.oxw().showDetails(O)}),s.TgZ(2,"mat-icon",21),s._uU(3,"reorder"),s.qZA(),s.qZA(),s.TgZ(4,"button",22),s.NdJ("click",function(){const O=s.CHM(d).$implicit;return s.oxw().goToEditEmployee(O)}),s.TgZ(5,"mat-icon",21),s._uU(6,"mode"),s.qZA(),s.qZA(),s.qZA()}}function Ot(p,v){1&p&&(s.TgZ(0,"th",19),s._uU(1," Usu\u0144"),s.qZA())}function Pt(p,v){1&p&&(s.TgZ(0,"td",18),s.TgZ(1,"button",23),s.TgZ(2,"mat-icon",21),s._uU(3,"delete"),s.qZA(),s.qZA(),s.qZA())}function xe(p,v){1&p&&s._UZ(0,"tr",24)}function Dt(p,v){1&p&&s._UZ(0,"tr",25)}function xt(p,v){if(1&p&&(s.TgZ(0,"td",26),s._UZ(1,"mat-paginator",27),s.qZA()),2&p){const d=s.oxw();s.Q6J("colSpan",d.displayedColumns.length),s.xp6(1),s.Q6J("length",d.totalSize)("pageSize",d.pageSize)("pageSizeOptions",d.pageSizeOptions)("showFirstLastButtons",!0)}}function zt(p,v){1&p&&s._UZ(0,"tr",28)}const Gt=function(){return["paginator"]},B=[{path:"",component:(()=>{class p{constructor(d,g,S,O){this.employeesService=d,this.router=g,this.dialog=S,this.route=O,this.dataSource=new G.by,this.displayedColumns=["login","firstName","lastName","actions","delete"],this.employees$=this.employeesService.getEmployeesFromProjector(),this.pageSize=25,this.totalSize=0,this.pageSizeOptions=[5,10,25,100]}ngOnInit(){this.employeesService.getEmployeesFromProjector().subscribe(d=>{this.employees=d,this.dataSource.data=d,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.totalSize=this.employees.length},d=>{console.log(d.status)})}showDetails(d){console.log("Employee jak idzie do view ",d),this.dialog.open(It,{data:d})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}addEmployee(){this.router.navigate(["/dashboard/employees/new/"])}goToEditEmployee(d){console.log("Employee jak idzie do edit ",d),this.router.navigate(["/dashboard/employees/edit/",d.key])}}return p.\u0275fac=function(d){return new(d||p)(s.Y36(wt),s.Y36(c.F0),s.Y36(Ee.uw),s.Y36(c.gz))},p.\u0275cmp=s.Xpm({type:p,selectors:[["app-employees"]],viewQuery:function(d,g){if(1&d&&(s.Gf(Be.NW,5),s.Gf(Fe.YE,5)),2&d){let S;s.iGM(S=s.CRH())&&(g.paginator=S.first),s.iGM(S=s.CRH())&&(g.sort=S.first)}},decls:27,vars:6,consts:[[1,"data-container"],["matSort","","matTableFilter","",1,"table","table-striped","w-100",3,"dataSource"],["table",""],["matColumnDef","login"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","firstName"],["matColumnDef","lastName"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","delete"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["matColumnDef","paginator"],["mat-footer-cell","",3,"colSpan",4,"matFooterCellDef"],["mat-footer-row","",4,"matFooterRowDef","matFooterRowDefSticky"],["mat-fab","","color","accent","id","new-questionnaire-btn",3,"click"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","primary",3,"click"],[1,"mat-18"],["mat-icon-button","","color","accent","title","Edytuj",3,"click"],["mat-icon-button","","color","warn","title","Usu\u0144"],["mat-header-row",""],["mat-row",""],["mat-footer-cell","",3,"colSpan"],[3,"length","pageSize","pageSizeOptions","showFirstLastButtons"],["mat-footer-row",""]],template:function(d,g){1&d&&(s.TgZ(0,"div",0),s.TgZ(1,"mat-table",1,2),s.ynx(3,3),s.YNc(4,k,2,0,"th",4),s.YNc(5,Ye,2,1,"td",5),s._UZ(6,"p"),s.BQk(),s._uU(7," > "),s.ynx(8,6),s.YNc(9,ze,2,0,"th",4),s.YNc(10,Rt,2,1,"td",5),s.BQk(),s.ynx(11,7),s.YNc(12,ge,2,0,"th",4),s.YNc(13,st,2,1,"td",5),s.BQk(),s.ynx(14,8),s.YNc(15,Yt,2,0,"th",9),s.YNc(16,Nt,7,0,"td",5),s.BQk(),s.ynx(17,10),s.YNc(18,Ot,2,0,"th",9),s.YNc(19,Pt,4,0,"td",5),s.BQk(),s.YNc(20,xe,1,0,"tr",11),s.YNc(21,Dt,1,0,"tr",12),s.ynx(22,13),s.YNc(23,xt,2,5,"td",14),s.BQk(),s.YNc(24,zt,1,0,"tr",15),s.qZA(),s.TgZ(25,"button",16),s.NdJ("click",function(){return g.addEmployee()}),s._uU(26," + "),s.qZA(),s.qZA()),2&d&&(s.xp6(1),s.Q6J("dataSource",g.dataSource),s.xp6(19),s.Q6J("matHeaderRowDef",g.displayedColumns),s.xp6(1),s.Q6J("matRowDefColumns",g.displayedColumns),s.xp6(3),s.Q6J("matFooterRowDef",s.DdM(5,Gt))("matFooterRowDefSticky",!0))},directives:[G.BZ,Fe.YE,G.w1,G.fO,G.Dz,G.as,G.nj,G.mD,G.Ke,De.lW,G.ge,Fe.nU,G.ev,jt.Hw,G.XQ,G.Gk,G.yh,Be.NW,G.Q2],styles:[""]}),p})()},{path:"view/:key",component:It},{path:"edit/:key",component:Xe,data:{isAdded:!0}},{path:"new",component:Ke,data:{isAdded:!1}}];let Ge=(()=>{class p{}return p.\u0275fac=function(d){return new(d||p)},p.\u0275mod=s.oAB({type:p}),p.\u0275inj=s.cJS({imports:[[c.Bz.forChild(B)],c.Bz]}),p})(),le=(()=>{class p{}return p.\u0275fac=function(d){return new(d||p)},p.\u0275mod=s.oAB({type:p}),p.\u0275inj=s.cJS({imports:[[fe.ez,D.q,Ge]]}),p})()},209:(Zt,J,L)=>{L.r(J),L.d(J,{__extends:()=>D,__assign:()=>c,__rest:()=>s,__decorate:()=>Ke,__param:()=>Xe,__metadata:()=>G,__awaiter:()=>Be,__generator:()=>Fe,__createBinding:()=>Ee,__exportStar:()=>ne,__values:()=>Ce,__read:()=>de,__spread:()=>Te,__spreadArrays:()=>we,__await:()=>oe,__asyncGenerator:()=>ve,__asyncDelegator:()=>se,__asyncValues:()=>Le,__makeTemplateObject:()=>j,__importStar:()=>Se,__importDefault:()=>Ne,__classPrivateFieldGet:()=>ae,__classPrivateFieldSet:()=>z});var fe=function(E,T){return(fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,I){C.__proto__=I}||function(C,I){for(var N in I)I.hasOwnProperty(N)&&(C[N]=I[N])})(E,T)};function D(E,T){function C(){this.constructor=E}fe(E,T),E.prototype=null===T?Object.create(T):(C.prototype=T.prototype,new C)}var c=function(){return(c=Object.assign||function(T){for(var C,I=1,N=arguments.length;I<N;I++)for(var w in C=arguments[I])Object.prototype.hasOwnProperty.call(C,w)&&(T[w]=C[w]);return T}).apply(this,arguments)};function s(E,T){var C={};for(var I in E)Object.prototype.hasOwnProperty.call(E,I)&&T.indexOf(I)<0&&(C[I]=E[I]);if(null!=E&&"function"==typeof Object.getOwnPropertySymbols){var N=0;for(I=Object.getOwnPropertySymbols(E);N<I.length;N++)T.indexOf(I[N])<0&&Object.prototype.propertyIsEnumerable.call(E,I[N])&&(C[I[N]]=E[I[N]])}return C}function Ke(E,T,C,I){var F,N=arguments.length,w=N<3?T:null===I?I=Object.getOwnPropertyDescriptor(T,C):I;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(E,T,C,I);else for(var V=E.length-1;V>=0;V--)(F=E[V])&&(w=(N<3?F(w):N>3?F(T,C,w):F(T,C))||w);return N>3&&w&&Object.defineProperty(T,C,w),w}function Xe(E,T){return function(C,I){T(C,I,E)}}function G(E,T){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(E,T)}function Be(E,T,C,I){return new(C||(C=Promise))(function(w,F){function V(Z){try{x(I.next(Z))}catch(K){F(K)}}function ee(Z){try{x(I.throw(Z))}catch(K){F(K)}}function x(Z){Z.done?w(Z.value):function(w){return w instanceof C?w:new C(function(F){F(w)})}(Z.value).then(V,ee)}x((I=I.apply(E,T||[])).next())})}function Fe(E,T){var I,N,w,F,C={label:0,sent:function(){if(1&w[0])throw w[1];return w[1]},trys:[],ops:[]};return F={next:V(0),throw:V(1),return:V(2)},"function"==typeof Symbol&&(F[Symbol.iterator]=function(){return this}),F;function V(x){return function(Z){return function(x){if(I)throw new TypeError("Generator is already executing.");for(;C;)try{if(I=1,N&&(w=2&x[0]?N.return:x[0]?N.throw||((w=N.return)&&w.call(N),0):N.next)&&!(w=w.call(N,x[1])).done)return w;switch(N=0,w&&(x=[2&x[0],w.value]),x[0]){case 0:case 1:w=x;break;case 4:return C.label++,{value:x[1],done:!1};case 5:C.label++,N=x[1],x=[0];continue;case 7:x=C.ops.pop(),C.trys.pop();continue;default:if(!(w=(w=C.trys).length>0&&w[w.length-1])&&(6===x[0]||2===x[0])){C=0;continue}if(3===x[0]&&(!w||x[1]>w[0]&&x[1]<w[3])){C.label=x[1];break}if(6===x[0]&&C.label<w[1]){C.label=w[1],w=x;break}if(w&&C.label<w[2]){C.label=w[2],C.ops.push(x);break}w[2]&&C.ops.pop(),C.trys.pop();continue}x=T.call(E,C)}catch(Z){x=[6,Z],N=0}finally{I=w=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}([x,Z])}}}function Ee(E,T,C,I){void 0===I&&(I=C),E[I]=T[C]}function ne(E,T){for(var C in E)"default"!==C&&!T.hasOwnProperty(C)&&(T[C]=E[C])}function Ce(E){var T="function"==typeof Symbol&&Symbol.iterator,C=T&&E[T],I=0;if(C)return C.call(E);if(E&&"number"==typeof E.length)return{next:function(){return E&&I>=E.length&&(E=void 0),{value:E&&E[I++],done:!E}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")}function de(E,T){var C="function"==typeof Symbol&&E[Symbol.iterator];if(!C)return E;var N,F,I=C.call(E),w=[];try{for(;(void 0===T||T-- >0)&&!(N=I.next()).done;)w.push(N.value)}catch(V){F={error:V}}finally{try{N&&!N.done&&(C=I.return)&&C.call(I)}finally{if(F)throw F.error}}return w}function Te(){for(var E=[],T=0;T<arguments.length;T++)E=E.concat(de(arguments[T]));return E}function we(){for(var E=0,T=0,C=arguments.length;T<C;T++)E+=arguments[T].length;var I=Array(E),N=0;for(T=0;T<C;T++)for(var w=arguments[T],F=0,V=w.length;F<V;F++,N++)I[N]=w[F];return I}function oe(E){return this instanceof oe?(this.v=E,this):new oe(E)}function ve(E,T,C){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var N,I=C.apply(E,T||[]),w=[];return N={},F("next"),F("throw"),F("return"),N[Symbol.asyncIterator]=function(){return this},N;function F(X){I[X]&&(N[X]=function(pe){return new Promise(function(ke,$e){w.push([X,pe,ke,$e])>1||V(X,pe)})})}function V(X,pe){try{!function(X){X.value instanceof oe?Promise.resolve(X.value.v).then(x,Z):K(w[0][2],X)}(I[X](pe))}catch(ke){K(w[0][3],ke)}}function x(X){V("next",X)}function Z(X){V("throw",X)}function K(X,pe){X(pe),w.shift(),w.length&&V(w[0][0],w[0][1])}}function se(E){var T,C;return T={},I("next"),I("throw",function(N){throw N}),I("return"),T[Symbol.iterator]=function(){return this},T;function I(N,w){T[N]=E[N]?function(F){return(C=!C)?{value:oe(E[N](F)),done:"return"===N}:w?w(F):F}:w}}function Le(E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var C,T=E[Symbol.asyncIterator];return T?T.call(E):(E=Ce(E),C={},I("next"),I("throw"),I("return"),C[Symbol.asyncIterator]=function(){return this},C);function I(w){C[w]=E[w]&&function(F){return new Promise(function(V,ee){!function(w,F,V,ee){Promise.resolve(ee).then(function(x){w({value:x,done:V})},F)}(V,ee,(F=E[w](F)).done,F.value)})}}}function j(E,T){return Object.defineProperty?Object.defineProperty(E,"raw",{value:T}):E.raw=T,E}function Se(E){if(E&&E.__esModule)return E;var T={};if(null!=E)for(var C in E)Object.hasOwnProperty.call(E,C)&&(T[C]=E[C]);return T.default=E,T}function Ne(E){return E&&E.__esModule?E:{default:E}}function ae(E,T){if(!T.has(E))throw new TypeError("attempted to get private field on non-instance");return T.get(E)}function z(E,T,C){if(!T.has(E))throw new TypeError("attempted to set private field on non-instance");return T.set(E,C),C}}}]);